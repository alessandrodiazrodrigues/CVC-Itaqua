<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTELOS TUR - Controle de Orbiuns</title>

    <!-- Meta Tags -->
    <meta name="description" content="SYSTELOS TUR - Sistemas com prop√≥sito">
    <meta name="keywords" content="SYSTELOS, TUR, Itaquaquecetuba, gest√£o, viagens, turismo, sistema">
    <meta name="author" content="SYSTELOS TUR">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="SYSTELOS TUR - Sistema Integrado de Gest√£o">
    <meta property="og:description" content="Sistema de gest√£o integrado da CVC Itaquaquecetuba">
    <meta property="og:image" content="assets/images/systelos-logo.png">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/systelos-favicon.ico">
    <link rel="apple-touch-icon" href="assets/images/systelos-apple-icon.png">
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/systelos-styles.css" rel="stylesheet">
    
    <!-- Config.js Centralizado -->
    <script src="config.js"></script>
    
    <style>
        /* Estilos espec√≠ficos do controle de orbiuns */
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: var(--systelos-sombra-forte);
            backdrop-filter: blur(10px);
            margin: 20px auto;
            max-width: 1400px;
            overflow: hidden;
        }
        
        .content-section {
            padding: 30px;
        }
        
        /* ‚ú® KPIs DISCRETOS NO TOPO */
        .kpis-container {
            background: linear-gradient(135deg, #0F1B3D 0%, #1a2951 100%);
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 25px;
            box-shadow: 0 4px 15px rgba(15, 27, 61, 0.2);
        }
        
        .kpis-title {
            color: #FFB800;
            font-size: 0.9rem;
            font-weight: 600;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .kpis-vendedores {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 15px;
        }
        
        .kpi-vendedor {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 184, 0, 0.3);
            border-radius: 10px;
            padding: 10px 15px;
            min-width: 140px;
            transition: all 0.3s ease;
        }
        
        .kpi-vendedor:hover {
            background: rgba(255, 184, 0, 0.1);
            border-color: #FFB800;
            transform: translateY(-2px);
        }
        
        .kpi-vendedor-nome {
            color: white;
            font-size: 0.85rem;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .kpi-vendedor-numero {
            color: #FFB800;
            font-size: 1.8rem;
            font-weight: bold;
            line-height: 1;
        }
        
        .kpi-vendedor-label {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.75rem;
            margin-top: 3px;
        }
        
        .kpis-total {
            border-top: 1px solid rgba(255, 184, 0, 0.3);
            padding-top: 15px;
            color: white;
            font-size: 1.1rem;
            font-weight: 600;
        }
        
        .kpis-total span {
            color: #FFB800;
            font-size: 1.5rem;
            margin-left: 10px;
        }
        
        .stats-container {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            margin-top: 20px;
            backdrop-filter: blur(10px);
        }
        
        .stat-card {
            text-align: center;
            padding: 15px;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.1);
            margin: 0 10px;
            transition: all 0.3s ease;
        }
        
        .stat-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }
        
        .stat-card i {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: var(--systelos-amarelo);
        }
        
        .stat-card h6 {
            margin: 5px 0;
            font-weight: 600;
        }
        
        .stat-card span {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--systelos-amarelo);
        }
        
        .header-links {
            background: var(--systelos-bg-info-light);
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 25px;
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .header-link {
            background: white;
            color: var(--systelos-azul);
            text-decoration: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            display: inline-flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .header-link:hover {
            background: var(--systelos-azul);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(10, 0, 180, 0.3);
            text-decoration: none;
        }
        
        .filter-section {
            background: var(--systelos-branco);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--systelos-sombra-suave);
            border-left: 4px solid var(--systelos-azul);
        }
        
        .filter-section h4 {
            color: var(--systelos-azul);
            margin-bottom: 20px;
            font-weight: 700;
            font-size: 1.2rem;
        }
        
        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .filter-input {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
        }
        
        .filter-input:focus {
            border-color: var(--systelos-azul);
            outline: none;
            box-shadow: 0 0 0 3px rgba(15, 27, 61, 0.1);
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 15px;
        }
        
        .btn-filtrar, .btn-limpar {
            padding: 10px 25px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.95rem;
        }
        
        .btn-filtrar {
            background: var(--systelos-azul);
            color: white;
        }
        
        .btn-filtrar:hover {
            background: #1a2951;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(15, 27, 61, 0.3);
        }
        
        .btn-limpar {
            background: #6c757d;
            color: white;
        }
        
        .btn-limpar:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }
        
        .orbium-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--systelos-sombra-suave);
            border-left: 5px solid var(--systelos-azul);
            transition: all 0.3s ease;
        }
        
        .orbium-card:hover {
            box-shadow: var(--systelos-sombra-forte);
            transform: translateY(-2px);
        }
        
        .orbium-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .orbium-titulo {
            font-weight: 700;
            color: var(--systelos-azul);
            font-size: 1.3rem;
            margin: 0;
        }
        
        .orbium-status {
            padding: 8px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
        }
        
        .status-problema {
            background: #fee;
            color: #c00;
            border: 2px solid #c00;
        }
        
        .status-atendimento {
            background: #ffeaa7;
            color: #d63031;
            border: 2px solid #fdcb6e;
        }
        
        .status-resolvido {
            background: #d4edda;
            color: #155724;
            border: 2px solid #28a745;
        }
        
        .orbium-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .orbium-info-item {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .orbium-info-item i {
            color: var(--systelos-azul);
            font-size: 1.2rem;
            width: 25px;
            text-align: center;
        }
        
        .orbium-info-label {
            font-weight: 600;
            color: #666;
            font-size: 0.85rem;
        }
        
        .orbium-info-value {
            color: #333;
            font-size: 0.95rem;
        }
        
        .orbium-observacoes {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin: 15px 0;
            border-left: 3px solid var(--systelos-amarelo);
        }
        
        .orbium-observacoes strong {
            color: var(--systelos-azul);
            display: block;
            margin-bottom: 8px;
        }
        
        .orbium-acoes {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f0f0f0;
        }
        
        .btn-acao {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn-editar {
            background: #17a2b8;
            color: white;
        }
        
        .btn-editar:hover {
            background: #138496;
            transform: translateY(-2px);
        }
        
        .btn-whatsapp {
            background: #25D366;
            color: white;
        }
        
        .btn-whatsapp:hover {
            background: #1fa855;
            transform: translateY(-2px);
        }
        
        .btn-deletar {
            background: #dc3545;
            color: white;
        }
        
        .btn-deletar:hover {
            background: #c82333;
            transform: translateY(-2px);
        }
        
        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }
        
        .loading-spinner {
            border: 5px solid #f3f3f3;
            border-top: 5px solid var(--systelos-azul);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .empty-state i {
            font-size: 4rem;
            color: #ddd;
            margin-bottom: 20px;
        }
        
        .empty-state h3 {
            color: #666;
            margin-bottom: 10px;
        }
        
        .empty-state p {
            color: #999;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background-color: white;
            margin: 50px auto;
            padding: 0;
            border-radius: 20px;
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
        
        .modal-header {
            background: linear-gradient(135deg, var(--systelos-azul) 0%, #1a2951 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 20px 20px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-header h2 {
            margin: 0;
            font-weight: 700;
            font-size: 1.5rem;
        }
        
        .close {
            color: white;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            background: none;
            border: none;
            padding: 0;
            line-height: 1;
            transition: all 0.3s ease;
        }
        
        .close:hover {
            color: var(--systelos-amarelo);
            transform: rotate(90deg);
        }
        
        .modal-body {
            padding: 30px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: var(--systelos-azul);
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            font-family: inherit;
        }
        
        .form-input:focus, .form-select:focus, .form-textarea:focus {
            border-color: var(--systelos-azul);
            outline: none;
            box-shadow: 0 0 0 3px rgba(15, 27, 61, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .required {
            color: #dc3545;
        }
        
        .form-help {
            font-size: 0.85rem;
            color: #666;
            margin-top: 5px;
        }
        
        .btn-submit {
            background: var(--systelos-azul);
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 10px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            margin-top: 20px;
        }
        
        .btn-submit:hover {
            background: #1a2951;
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(15, 27, 61, 0.3);
        }
        
        .btn-submit:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .alert-custom {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 20px 30px;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            z-index: 2000;
            animation: slideInRight 0.3s ease;
            display: flex;
            align-items: center;
            gap: 15px;
            font-weight: 600;
            max-width: 400px;
        }
        
        @keyframes slideInRight {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .alert-success-custom {
            background: #d4edda;
            color: #155724;
            border-left: 5px solid #28a745;
        }
        
        .alert-error-custom {
            background: #f8d7da;
            color: #721c24;
            border-left: 5px solid #dc3545;
        }
        
        .alert-custom i {
            font-size: 1.5rem;
        }
        
        @media (max-width: 768px) {
            .orbium-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .orbium-acoes {
                flex-direction: column;
            }
            
            .btn-acao {
                width: 100%;
                justify-content: center;
            }
            
            .modal-content {
                width: 95%;
                margin: 20px auto;
            }
            
            .filter-grid {
                grid-template-columns: 1fr;
            }
            
            .kpis-vendedores {
                flex-direction: column;
            }
        }

        /* ============================================================================
           üÜï NOTIFICA√á√ïES ORBIUNS - BADGE E CARDS v13.0
           ============================================================================ */

        /* Badge de notifica√ß√£o no menu */
        .badge-notificacao {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #dc3545;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            font-weight: bold;
            box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);
            animation: pulseNotification 2s infinite;
        }

        .badge-notificacao.hidden {
            display: none;
        }

        @keyframes pulseNotification {
            0%, 100% {
                transform: scale(1);
                box-shadow: 0 2px 8px rgba(220, 53, 69, 0.4);
            }
            50% {
                transform: scale(1.1);
                box-shadow: 0 4px 12px rgba(220, 53, 69, 0.6);
            }
        }

        /* Se√ß√£o de atualiza√ß√µes */
        .secao-atualizacoes {
            background: linear-gradient(135deg, #fff8e1 0%, #fffbf0 100%);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 25px;
            border: 2px solid #FFB800;
            box-shadow: 0 4px 15px rgba(255, 184, 0, 0.2);
        }

        .secao-atualizacoes-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid rgba(255, 184, 0, 0.3);
        }

        .secao-atualizacoes-titulo {
            color: #0F1B3D;
            font-weight: 700;
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .secao-atualizacoes-titulo i {
            color: #FFB800;
            animation: ringBell 2s infinite;
        }

        @keyframes ringBell {
            0%, 100% { transform: rotate(0deg); }
            10%, 30% { transform: rotate(-10deg); }
            20%, 40% { transform: rotate(10deg); }
        }

        .btn-marcar-todas-lidas {
            background: #0F1B3D;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-marcar-todas-lidas:hover {
            background: #1a2951;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(15, 27, 61, 0.3);
        }

        .atualizacoes-lista {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .atualizacao-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 3px 10px rgba(0,0,0,0.1);
            border-left: 5px solid #FFB800;
            transition: all 0.3s ease;
            position: relative;
        }

        .atualizacao-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.15);
        }

        .atualizacao-card.lida {
            opacity: 0.6;
            border-left-color: #ccc;
        }

        .atualizacao-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 12px;
        }

        .atualizacao-orbium {
            font-weight: 700;
            color: #0F1B3D;
            font-size: 1.1rem;
        }

        .atualizacao-status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .status-badge-resolvido {
            background: #d4edda;
            color: #155724;
        }

        .status-badge-problema {
            background: #f8d7da;
            color: #721c24;
        }

        .status-badge-atendimento {
            background: #fff3cd;
            color: #856404;
        }

        .atualizacao-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-bottom: 12px;
        }

        .atualizacao-info-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #666;
        }

        .atualizacao-info-item i {
            color: #FFB800;
            width: 20px;
        }

        .atualizacao-observacoes {
            background: #f8f9fa;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 12px;
            font-size: 0.9rem;
            color: #333;
            border-left: 3px solid #FFB800;
        }

        .atualizacao-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 12px;
            border-top: 1px solid #eee;
        }

        .atualizacao-timestamp {
            font-size: 0.85rem;
            color: #999;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-marcar-lido {
            background: #28a745;
            color: white;
            border: none;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-marcar-lido:hover {
            background: #218838;
            transform: translateY(-2px);
        }

        .btn-marcar-lido.lido {
            background: #6c757d;
            cursor: default;
        }

        .btn-marcar-lido.lido:hover {
            background: #6c757d;
            transform: none;
        }

        .atualizacoes-vazio {
            text-align: center;
            padding: 40px 20px;
            color: #999;
        }

        .atualizacoes-vazio i {
            font-size: 3rem;
            color: #FFB800;
            margin-bottom: 15px;
        }

        .loading-atualizacoes {
            text-align: center;
            padding: 30px;
            color: #666;
        }

        .loading-atualizacoes i {
            font-size: 2rem;
            color: #FFB800;
            animation: spin 1s linear infinite;
        }

        @media (max-width: 768px) {
            .secao-atualizacoes-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .btn-marcar-todas-lidas {
                width: 100%;
            }

            .atualizacao-info {
                grid-template-columns: 1fr;
            }

            .atualizacao-footer {
                flex-direction: column;
                gap: 10px;
                align-items: flex-start;
            }

            .btn-marcar-lido {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="content-section">
            <!-- Header com t√≠tulo e a√ß√µes -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <div>
                    <h1 style="color: var(--systelos-azul); font-weight: 800; margin: 0; font-size: 2rem;">
                        <i class="fas fa-orbit" style="color: var(--systelos-amarelo);"></i> 
                        Controle de Orbiuns
                    </h1>
                    <p style="color: #666; margin: 5px 0 0 0; font-size: 0.95rem;">
                        Sistema de gest√£o de processos internos
                    </p>
                </div>
                <button onclick="abrirModalNovoOrbium()" class="header-link">
                    <i class="fas fa-plus-circle"></i> Novo Orbium (Ctrl+N)
                </button>
            </div>

            <!-- üÜï SE√á√ÉO DE ATUALIZA√á√ïES RECENTES -->
            <section class="secao-atualizacoes" id="secaoAtualizacoes" style="display: none;">
                <div class="secao-atualizacoes-header">
                    <h3 class="secao-atualizacoes-titulo">
                        <i class="fas fa-bell"></i>
                        Atualiza√ß√µes Recentes
                        <span id="badgeContador" style="background: #dc3545; color: white; padding: 4px 10px; border-radius: 12px; font-size: 0.85rem; margin-left: 10px;"></span>
                    </h3>
                    <button onclick="marcarTodasComoLidas()" class="btn-marcar-todas-lidas">
                        <i class="fas fa-check-double"></i> Marcar todas como lidas
                    </button>
                </div>

                <div id="loadingAtualizacoes" class="loading-atualizacoes">
                    <i class="fas fa-spinner fa-spin"></i>
                    <p>Carregando atualiza√ß√µes...</p>
                </div>

                <div id="atualizacoesLista" class="atualizacoes-lista"></div>

                <div id="atualizacoesVazio" class="atualizacoes-vazio" style="display: none;">
                    <i class="fas fa-check-circle"></i>
                    <p><strong>Nenhuma atualiza√ß√£o pendente</strong></p>
                    <p style="font-size: 0.9rem;">Voc√™ est√° em dia com todos os orbiuns!</p>
                </div>
            </section>

            <!-- Links r√°pidos -->
            <div class="header-links">
                <a href="index.html" class="header-link">
                    <i class="fas fa-home"></i> Dashboard
                </a>
                <a href="embarques.html" class="header-link">
                    <i class="fas fa-plane-departure"></i> Embarques
                </a>
                <a href="https://docs.google.com/spreadsheets/d/1A7HOrMOw60Rks4_fwj0BNP5i9cZQ9H-dOJ7LKFw5Jis/edit" 
                   target="_blank" class="header-link">
                    <i class="fas fa-table"></i> Planilha Orbiuns
                </a>
            </div>

            <!-- KPIs por Vendedor -->
            <div class="kpis-container" id="kpisContainer">
                <div class="kpis-title">
                    <i class="fas fa-chart-bar"></i> Orbiuns Ativos por Vendedor
                </div>
                <div class="kpis-vendedores" id="kpisVendedores">
                    <!-- KPIs ser√£o inseridos aqui via JS -->
                </div>
                <div class="kpis-total" id="kpisTotal">
                    <!-- Total ser√° inserido aqui via JS -->
                </div>
            </div>

            <!-- Filtros -->
            <div class="filter-section">
                <h4><i class="fas fa-filter"></i> Filtros de Busca</h4>
                <div class="filter-grid">
                    <input type="text" id="filtroOrbium" class="filter-input" placeholder="üîç N√∫mero do Orbium">
                    <select id="filtroStatus" class="filter-input">
                        <option value="">üìä Todos os Status</option>
                        <option value="problema">üî¥ Problema</option>
                        <option value="em atendimento">üü° Em atendimento</option>
                        <option value="resolvido">üü¢ Resolvido</option>
                    </select>
                    <select id="filtroVendedor" class="filter-input">
                        <option value="">üë§ Todos os Vendedores</option>
                    </select>
                    <select id="filtroDepartamento" class="filter-input">
                        <option value="">üè¢ Todos os Departamentos</option>
                        <option value="vendas">Vendas</option>
                        <option value="marketing">Marketing</option>
                        <option value="rh">RH</option>
                        <option value="financeiro">Financeiro</option>
                        <option value="tecnologia">Tecnologia</option>
                        <option value="gerencia">Ger√™ncia</option>
                        <option value="atendimento">Atendimento</option>
                    </select>
                    <input type="text" id="filtroCliente" class="filter-input" placeholder="üë• Nome do Cliente">
                    <input type="text" id="filtroWhatsApp" class="filter-input" placeholder="üì± WhatsApp">
                    <input type="text" id="filtroRecibo" class="filter-input" placeholder="üìÑ Recibo">
                </div>
                <div class="button-group">
                    <button onclick="filtrarOrbiuns()" class="btn-filtrar">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                    <button onclick="limparFiltros()" class="btn-limpar">
                        <i class="fas fa-times"></i> Limpar
                    </button>
                </div>
            </div>

            <!-- Loading -->
            <div id="loadingContainer" class="loading-container">
                <div class="loading-spinner"></div>
                <p style="color: var(--systelos-azul); font-weight: 600; font-size: 1.1rem;">
                    Carregando orbiuns...
                </p>
            </div>

            <!-- Lista de Orbiuns -->
            <div id="orbiunsContainer"></div>

            <!-- Empty State -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <i class="fas fa-inbox"></i>
                <h3>Nenhum orbium encontrado</h3>
                <p>N√£o h√° orbiuns que correspondam aos filtros aplicados.</p>
                <button onclick="limparFiltros()" class="btn-filtrar" style="margin-top: 15px;">
                    <i class="fas fa-redo"></i> Limpar Filtros
                </button>
            </div>
        </div>
    </div>

    <!-- Modal Novo Orbium -->
    <div id="modalNovoOrbium" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-plus-circle"></i> Novo Orbium</h2>
                <span class="close" onclick="fecharModalNovoOrbium()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formNovoOrbium" onsubmit="event.preventDefault(); salvarNovoOrbium();">
                    
                    <!-- Campo COLAR DADOS -->
                    <div class="form-group">
                        <label class="form-label">
                            <i class="fas fa-paste"></i> Colar Dados (Auto-preenchimento)
                        </label>
                        <textarea 
                            id="colarDados" 
                            class="form-textarea" 
                            placeholder="Cole aqui os dados da planilha (tab-separated). Exemplo:
123456	Problema	01/01/2025	Vendas	Alessandro	REC123	RES456	PED789	LATAM	ABCDEF	GHIJKL	Cliente com problema	Jo√£o Silva	11999999999	12345678900"
                            style="min-height: 120px; font-family: monospace; font-size: 0.85rem;"
                        ></textarea>
                        <div class="form-help">
                            üí° Cole os dados da planilha e os campos abaixo ser√£o preenchidos automaticamente
                        </div>
                    </div>

                    <hr style="margin: 25px 0; border: 0; border-top: 2px solid #f0f0f0;">

                    <div class="form-group">
                        <label class="form-label">
                            üì± WhatsApp do Cliente <span class="required">*</span>
                        </label>
                        <input type="text" id="whatsCliente" class="form-input" 
                               placeholder="Ex: 11999999999" required>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">üî¢ N√∫mero do Orbium</label>
                            <input type="text" id="orbiumNumero" class="form-input" 
                                   placeholder="Ex: 123456">
                        </div>

                        <div class="form-group">
                            <label class="form-label">üìä Status</label>
                            <select id="status" class="form-select">
                                <option value="Problema">üî¥ Problema</option>
                                <option value="Em atendimento" selected>üü° Em atendimento</option>
                                <option value="Resolvido">üü¢ Resolvido</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">üè¢ Departamento</label>
                            <select id="departamento" class="form-select">
                                <option value="">Selecione...</option>
                                <option value="Vendas" selected>Vendas</option>
                                <option value="Marketing">Marketing</option>
                                <option value="RH">RH</option>
                                <option value="Financeiro">Financeiro</option>
                                <option value="Tecnologia">Tecnologia</option>
                                <option value="Ger√™ncia">Ger√™ncia</option>
                                <option value="Atendimento">Atendimento</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üë§ Vendedor</label>
                            <select id="vendedor" class="form-select">
                                <option value="">Selecione...</option>
                            </select>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">üìÑ Recibo</label>
                            <input type="text" id="recibo" class="form-input" 
                                   placeholder="Ex: REC123">
                        </div>

                        <div class="form-group">
                            <label class="form-label">üé´ Reserva</label>
                            <input type="text" id="reserva" class="form-input" 
                                   placeholder="Ex: RES456">
                        </div>

                        <div class="form-group">
                            <label class="form-label">üì¶ Pedido</label>
                            <input type="text" id="pedido" class="form-input" 
                                   placeholder="Ex: PED789">
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">‚úàÔ∏è CIA</label>
                            <input type="text" id="cia" class="form-input" 
                                   placeholder="Ex: LATAM">
                        </div>

                        <div class="form-group">
                            <label class="form-label">üîñ LOC GDS</label>
                            <input type="text" id="locGds" class="form-input" 
                                   placeholder="Ex: ABCDEF">
                        </div>

                        <div class="form-group">
                            <label class="form-label">üîñ LOC CIA</label>
                            <input type="text" id="locCia" class="form-input" 
                                   placeholder="Ex: GHIJKL">
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üë• Nome do Cliente</label>
                        <input type="text" id="nomeCliente" class="form-input" 
                               placeholder="Ex: Jo√£o Silva">
                    </div>

                    <div class="form-group">
                        <label class="form-label">üÜî CPF do Cliente</label>
                        <input type="text" id="cpfCliente" class="form-input" 
                               placeholder="Ex: 12345678900">
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìù Observa√ß√µes</label>
                        <textarea id="observacoes" class="form-textarea" 
                                  placeholder="Descreva o problema ou situa√ß√£o..."></textarea>
                    </div>

                    <button type="submit" class="btn-submit">
                        <i class="fas fa-save"></i> Salvar Orbium
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal Editar Orbium -->
    <div id="modalEditarOrbium" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2><i class="fas fa-edit"></i> Editar Orbium</h2>
                <span class="close" onclick="fecharModalEditarOrbium()">&times;</span>
            </div>
            <div class="modal-body">
                <form id="formEditarOrbium" onsubmit="event.preventDefault(); salvarEdicaoOrbium();">
                    <input type="hidden" id="editarId">

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label class="form-label">üî¢ N√∫mero do Orbium</label>
                            <input type="text" id="editarOrbiumNumero" class="form-input" readonly>
                        </div>

                        <div class="form-group">
                            <label class="form-label">üìä Status <span class="required">*</span></label>
                            <select id="editarStatus" class="form-select" required>
                                <option value="Problema">üî¥ Problema</option>
                                <option value="Em atendimento">üü° Em atendimento</option>
                                <option value="Resolvido">üü¢ Resolvido</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">üìù Observa√ß√µes Adicionais</label>
                        <textarea id="editarObservacoes" class="form-textarea" 
                                  placeholder="Adicione novas observa√ß√µes..."></textarea>
                        <div class="form-help">
                            üí° As novas observa√ß√µes ser√£o adicionadas √†s existentes com timestamp
                        </div>
                    </div>

                    <button type="submit" class="btn-submit">
                        <i class="fas fa-save"></i> Salvar Altera√ß√µes
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // ================================================================================
        // VARI√ÅVEIS GLOBAIS
        // ================================================================================
        let orbiunsData = [];
        let orbiunsFiltrados = [];
        let atualizacoesData = [];

        // ================================================================================
        // INICIALIZA√á√ÉO
        // ================================================================================
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ Inicializando sistema de Orbiuns v13.0 COM WEBHOOK', 'info');
            
            // Preencher dropdown de vendedores
            preencherVendedores();
            
            // Carregar orbiuns
            carregarOrbiuns();
            
            // üÜï Carregar atualiza√ß√µes recentes
            carregarAtualizacoes();
            
            // Auto-refresh a cada 5 minutos
            setInterval(() => {
                carregarOrbiuns(true);
                carregarAtualizacoes(true); // üÜï Auto-refresh atualiza√ß√µes
            }, 5 * 60 * 1000);
            
            // Event listener para colar dados
            document.getElementById('colarDados').addEventListener('input', processarDadosColados);
        });

        // ================================================================================
        // üÜï SISTEMA DE NOTIFICA√á√ïES WEBHOOK ORBIUNS
        // ================================================================================

        /**
         * Carregar atualiza√ß√µes recentes
         */
        async function carregarAtualizacoes(silencioso = false) {
            if (!silencioso) {
                document.getElementById('loadingAtualizacoes').style.display = 'block';
                document.getElementById('atualizacoesLista').innerHTML = '';
                document.getElementById('atualizacoesVazio').style.display = 'none';
            }

            try {
                debugLog('üì• Buscando atualiza√ß√µes recentes...', 'info');

                const result = await chamarAPI({
                    action: 'listar_atualizacoes_recentes'
                });

                if (result.success && result.data && result.data.atualizacoes) {
                    atualizacoesData = result.data.atualizacoes;
                    
                    debugLog(`‚úÖ ${atualizacoesData.length} atualiza√ß√£o(√µes) carregada(s)`, 'success');
                    
                    renderizarAtualizacoes();
                } else {
                    throw new Error(result.message || 'Erro ao carregar atualiza√ß√µes');
                }

            } catch (error) {
                debugLog('‚ùå Erro ao carregar atualiza√ß√µes: ' + error.message, 'error');
                document.getElementById('loadingAtualizacoes').style.display = 'none';
                document.getElementById('atualizacoesVazio').style.display = 'block';
                document.getElementById('atualizacoesVazio').innerHTML = `
                    <i class="fas fa-exclamation-triangle"></i>
                    <p><strong>Erro ao carregar atualiza√ß√µes</strong></p>
                    <p style="font-size: 0.9rem;">${error.message}</p>
                `;
            }
        }

        /**
         * Renderizar atualiza√ß√µes na interface
         */
        function renderizarAtualizacoes() {
            const container = document.getElementById('atualizacoesLista');
            const secao = document.getElementById('secaoAtualizacoes');
            const loading = document.getElementById('loadingAtualizacoes');
            const vazio = document.getElementById('atualizacoesVazio');

            loading.style.display = 'none';

            // Filtrar atualiza√ß√µes n√£o lidas
            const naoLidas = atualizacoesData.filter(a => a.lido !== 'SIM');

            if (naoLidas.length === 0) {
                secao.style.display = 'none';
                return;
            }

            // Mostrar se√ß√£o
            secao.style.display = 'block';
            vazio.style.display = 'none';

            // Atualizar contador
            document.getElementById('badgeContador').textContent = naoLidas.length;

            // Renderizar cards
            container.innerHTML = naoLidas.map(atualizacao => {
                const isLida = atualizacao.lido === 'SIM';
                const statusClass = 
                    atualizacao.status_novo === 'Resolvido' ? 'status-badge-resolvido' :
                    atualizacao.status_novo === 'Problema' ? 'status-badge-problema' :
                    'status-badge-atendimento';

                return `
                    <div class="atualizacao-card ${isLida ? 'lida' : ''}" data-id="${atualizacao.id}">
                        <div class="atualizacao-header">
                            <span class="atualizacao-orbium">
                                <i class="fas fa-orbit"></i> Orbium ${atualizacao.orbium || 'N/A'}
                            </span>
                            <span class="atualizacao-status-badge ${statusClass}">
                                ${atualizacao.status_novo}
                            </span>
                        </div>

                        <div class="atualizacao-info">
                            <div class="atualizacao-info-item">
                                <i class="fas fa-user"></i>
                                <span><strong>Cliente:</strong> ${atualizacao.nome_cliente || 'N/A'}</span>
                            </div>
                            <div class="atualizacao-info-item">
                                <i class="fas fa-user-tie"></i>
                                <span><strong>Vendedor:</strong> ${atualizacao.vendedor || 'N/A'}</span>
                            </div>
                            <div class="atualizacao-info-item">
                                <i class="fas fa-building"></i>
                                <span><strong>Depto:</strong> ${atualizacao.departamento || 'N/A'}</span>
                            </div>
                            ${atualizacao.recibo ? `
                            <div class="atualizacao-info-item">
                                <i class="fas fa-receipt"></i>
                                <span><strong>Recibo:</strong> ${atualizacao.recibo}</span>
                            </div>
                            ` : ''}
                        </div>

                        ${atualizacao.observacoes ? `
                        <div class="atualizacao-observacoes">
                            <i class="fas fa-comment-dots"></i> ${atualizacao.observacoes}
                        </div>
                        ` : ''}

                        <div class="atualizacao-footer">
                            <span class="atualizacao-timestamp">
                                <i class="far fa-clock"></i>
                                ${formatarData(atualizacao.data_atualizacao)}
                            </span>
                            <button 
                                onclick="marcarComoLida(${atualizacao.id})" 
                                class="btn-marcar-lido ${isLida ? 'lido' : ''}"
                                ${isLida ? 'disabled' : ''}>
                                <i class="fas fa-check"></i> ${isLida ? '‚úì Lido' : 'Marcar como lido'}
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        /**
         * Marcar atualiza√ß√£o como lida
         */
        async function marcarComoLida(id) {
            try {
                debugLog(`üìñ Marcando atualiza√ß√£o ${id} como lida...`, 'info');

                const result = await chamarAPI({
                    action: 'marcar_como_lido',
                    id: id
                });

                if (result.success) {
                    debugLog('‚úÖ Atualiza√ß√£o marcada como lida', 'success');
                    
                    // Atualizar dados localmente
                    const atualizacao = atualizacoesData.find(a => a.id == id);
                    if (atualizacao) {
                        atualizacao.lido = 'SIM';
                    }
                    
                    // Re-renderizar
                    renderizarAtualizacoes();
                    
                    mostrarAlertaSucesso('‚úÖ Atualiza√ß√£o marcada como lida!');
                } else {
                    throw new Error(result.message || 'Erro ao marcar como lida');
                }

            } catch (error) {
                debugLog('‚ùå Erro ao marcar como lida: ' + error.message, 'error');
                mostrarAlertaErro(`‚ùå Erro: ${error.message}`);
            }
        }

        /**
         * Marcar todas as atualiza√ß√µes como lidas
         */
        async function marcarTodasComoLidas() {
            if (!confirm('Deseja marcar todas as atualiza√ß√µes como lidas?')) {
                return;
            }

            try {
                debugLog('üìñ Marcando todas as atualiza√ß√µes como lidas...', 'info');

                const result = await chamarAPI({
                    action: 'marcar_todas_como_lidas'
                });

                if (result.success) {
                    debugLog('‚úÖ Todas as atualiza√ß√µes marcadas como lidas', 'success');
                    
                    // Atualizar dados localmente
                    atualizacoesData.forEach(a => a.lido = 'SIM');
                    
                    // Re-renderizar
                    renderizarAtualizacoes();
                    
                    mostrarAlertaSucesso('‚úÖ Todas as atualiza√ß√µes marcadas como lidas!');
                } else {
                    throw new Error(result.message || 'Erro ao marcar todas como lidas');
                }

            } catch (error) {
                debugLog('‚ùå Erro ao marcar todas como lidas: ' + error.message, 'error');
                mostrarAlertaErro(`‚ùå Erro: ${error.message}`);
            }
        }

        // ================================================================================
        // CHAMADA API
        // ================================================================================
        async function chamarAPI(parametros) {
            try {
                const url = getApiUrl('googleScript');
                debugLog(`üåê Chamando API: ${url}`, 'info');
                debugLog(`üì§ Par√¢metros: ${JSON.stringify(parametros)}`, 'info');

                const queryString = new URLSearchParams(parametros).toString();
                const urlCompleta = `${url}?${queryString}`;

                const response = await fetch(urlCompleta, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }

                const data = await response.json();
                debugLog(`üì• Resposta recebida: ${JSON.stringify(data)}`, 'info');

                return data;

            } catch (error) {
                debugLog(`‚ùå Erro na API: ${error.message}`, 'error');
                throw error;
            }
        }

        // ================================================================================
        // CARREGAR ORBIUNS
        // ================================================================================
        async function carregarOrbiuns(silencioso = false) {
            if (!silencioso) {
                document.getElementById('loadingContainer').style.display = 'block';
                document.getElementById('orbiunsContainer').innerHTML = '';
                document.getElementById('emptyState').style.display = 'none';
                document.getElementById('kpisContainer').style.display = 'none';
            }

            try {
                debugLog('üì• Carregando orbiuns...', 'info');

                const result = await chamarAPI({
                    action: 'listar_orbiuns'
                });

                if (result.success && result.data && result.data.orbiuns) {
                    orbiunsData = result.data.orbiuns;
                    
                    debugLog(`‚úÖ ${orbiunsData.length} orbium(s) carregado(s)`, 'success');
                    
                    // Filtro padr√£o: Problemas e Em atendimento
                    orbiunsFiltrados = orbiunsData.filter(o => 
                        o.status === 'Problema' || o.status === 'Em atendimento'
                    );

                    renderizarKPIs();
                    renderizarOrbiuns();
                    document.getElementById('loadingContainer').style.display = 'none';
                    document.getElementById('kpisContainer').style.display = 'block';
                } else {
                    throw new Error(result.message || 'Erro ao carregar orbiuns');
                }

            } catch (error) {
                debugLog('‚ùå Erro ao carregar orbiuns: ' + error.message, 'error');
                document.getElementById('loadingContainer').style.display = 'none';
                mostrarAlertaErro(`‚ùå Erro ao carregar: ${error.message}`);
            }
        }

        // ================================================================================
        // RENDERIZAR KPIs
        // ================================================================================
        function renderizarKPIs() {
            const vendedores = {};
            
            // Contar orbiuns ativos por vendedor
            orbiunsData
                .filter(o => o.status === 'Problema' || o.status === 'Em atendimento')
                .forEach(o => {
                    const vendedor = o.vendedor || 'Sem vendedor';
                    vendedores[vendedor] = (vendedores[vendedor] || 0) + 1;
                });

            const containerVendedores = document.getElementById('kpisVendedores');
            const containerTotal = document.getElementById('kpisTotal');

            // Renderizar KPIs por vendedor
            containerVendedores.innerHTML = Object.entries(vendedores)
                .sort((a, b) => b[1] - a[1])
                .map(([vendedor, total]) => `
                    <div class="kpi-vendedor">
                        <div class="kpi-vendedor-nome">${vendedor}</div>
                        <div class="kpi-vendedor-numero">${total}</div>
                        <div class="kpi-vendedor-label">orbium${total !== 1 ? 's' : ''} ativo${total !== 1 ? 's' : ''}</div>
                    </div>
                `).join('');

            // Total geral
            const totalAtivos = Object.values(vendedores).reduce((a, b) => a + b, 0);
            containerTotal.innerHTML = `
                <i class="fas fa-chart-line"></i> Total de Orbiuns Ativos:
                <span>${totalAtivos}</span>
            `;
        }

        // ================================================================================
        // RENDERIZAR ORBIUNS
        // ================================================================================
        function renderizarOrbiuns() {
            const container = document.getElementById('orbiunsContainer');
            const emptyState = document.getElementById('emptyState');

            if (orbiunsFiltrados.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';

            container.innerHTML = orbiunsFiltrados.map(orbium => {
                const statusClass = 
                    orbium.status === 'Problema' ? 'status-problema' :
                    orbium.status === 'Resolvido' ? 'status-resolvido' :
                    'status-atendimento';

                return `
                    <div class="orbium-card">
                        <div class="orbium-header">
                            <h3 class="orbium-titulo">
                                <i class="fas fa-orbit"></i> Orbium ${orbium.orbium || 'N/A'}
                            </h3>
                            <span class="orbium-status ${statusClass}">
                                ${orbium.status}
                            </span>
                        </div>

                        <div class="orbium-info-grid">
                            <div class="orbium-info-item">
                                <i class="fas fa-calendar-alt"></i>
                                <div>
                                    <div class="orbium-info-label">Data Abertura</div>
                                    <div class="orbium-info-value">${formatarData(orbium.data_abertura)}</div>
                                </div>
                            </div>

                            <div class="orbium-info-item">
                                <i class="fas fa-building"></i>
                                <div>
                                    <div class="orbium-info-label">Departamento</div>
                                    <div class="orbium-info-value">${orbium.departamento || 'N/A'}</div>
                                </div>
                            </div>

                            <div class="orbium-info-item">
                                <i class="fas fa-user-tie"></i>
                                <div>
                                    <div class="orbium-info-label">Vendedor</div>
                                    <div class="orbium-info-value">${orbium.vendedor || 'N/A'}</div>
                                </div>
                            </div>

                            ${orbium.recibo ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-receipt"></i>
                                <div>
                                    <div class="orbium-info-label">Recibo</div>
                                    <div class="orbium-info-value">${orbium.recibo}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.reserva ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-ticket-alt"></i>
                                <div>
                                    <div class="orbium-info-label">Reserva</div>
                                    <div class="orbium-info-value">${orbium.reserva}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.pedido ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-box"></i>
                                <div>
                                    <div class="orbium-info-label">Pedido</div>
                                    <div class="orbium-info-value">${orbium.pedido}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.cia ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-plane"></i>
                                <div>
                                    <div class="orbium-info-label">CIA</div>
                                    <div class="orbium-info-value">${orbium.cia}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.loc_gds ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-tag"></i>
                                <div>
                                    <div class="orbium-info-label">LOC GDS</div>
                                    <div class="orbium-info-value">${orbium.loc_gds}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.loc_cia ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-tag"></i>
                                <div>
                                    <div class="orbium-info-label">LOC CIA</div>
                                    <div class="orbium-info-value">${orbium.loc_cia}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.nome_cliente ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-user"></i>
                                <div>
                                    <div class="orbium-info-label">Cliente</div>
                                    <div class="orbium-info-value">${orbium.nome_cliente}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.whats_cliente ? `
                            <div class="orbium-info-item">
                                <i class="fab fa-whatsapp"></i>
                                <div>
                                    <div class="orbium-info-label">WhatsApp</div>
                                    <div class="orbium-info-value">${formatarWhatsApp(orbium.whats_cliente)}</div>
                                </div>
                            </div>
                            ` : ''}

                            ${orbium.cpf_cliente ? `
                            <div class="orbium-info-item">
                                <i class="fas fa-id-card"></i>
                                <div>
                                    <div class="orbium-info-label">CPF</div>
                                    <div class="orbium-info-value">${orbium.cpf_cliente}</div>
                                </div>
                            </div>
                            ` : ''}
                        </div>

                        ${orbium.observacoes ? `
                        <div class="orbium-observacoes">
                            <strong><i class="fas fa-comment-dots"></i> Observa√ß√µes:</strong>
                            ${orbium.observacoes}
                        </div>
                        ` : ''}

                        <div class="orbium-acoes">
                            <button onclick="abrirModalEditarOrbium('${orbium.id}')" class="btn-acao btn-editar">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            ${orbium.whats_cliente ? `
                            <button onclick="abrirWhatsApp('${orbium.whats_cliente}', '${orbium.nome_cliente || 'Cliente'}')" 
                                    class="btn-acao btn-whatsapp">
                                <i class="fab fa-whatsapp"></i> WhatsApp
                            </button>
                            ` : ''}
                            <button onclick="confirmarDelete('${orbium.id}')" class="btn-acao btn-deletar">
                                <i class="fas fa-trash"></i> Deletar
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ================================================================================
        // MODAL NOVO ORBIUM
        // ================================================================================
        function abrirModalNovoOrbium() {
            document.getElementById('modalNovoOrbium').style.display = 'block';
            document.getElementById('formNovoOrbium').reset();
        }

        function fecharModalNovoOrbium() {
            document.getElementById('modalNovoOrbium').style.display = 'none';
        }

        // ================================================================================
        // PROCESSAR DADOS COLADOS
        // ================================================================================
        function processarDadosColados() {
            const texto = document.getElementById('colarDados').value.trim();
            if (!texto) return;

            const colunas = texto.split('\t');
            
            if (colunas.length >= 15) {
                document.getElementById('orbiumNumero').value = colunas[0] || '';
                document.getElementById('status').value = colunas[1] || 'Em atendimento';
                document.getElementById('departamento').value = colunas[3] || 'Vendas';
                document.getElementById('vendedor').value = colunas[4] || '';
                document.getElementById('recibo').value = colunas[5] || '';
                document.getElementById('reserva').value = colunas[6] || '';
                document.getElementById('pedido').value = colunas[7] || '';
                document.getElementById('cia').value = colunas[8] || '';
                document.getElementById('locGds').value = colunas[9] || '';
                document.getElementById('locCia').value = colunas[10] || '';
                document.getElementById('observacoes').value = colunas[11] || '';
                document.getElementById('nomeCliente').value = colunas[12] || '';
                document.getElementById('whatsCliente').value = colunas[13] || '';
                document.getElementById('cpfCliente').value = colunas[14] || '';
                
                mostrarAlertaSucesso('‚úÖ Dados preenchidos automaticamente!');
            }
        }

        // ================================================================================
        // SALVAR NOVO ORBIUM
        // ================================================================================
        async function salvarNovoOrbium() {
            const botaoSubmit = document.querySelector('#formNovoOrbium button[type="submit"]');
            const textoOriginal = botaoSubmit.innerHTML;

            try {
                botaoSubmit.disabled = true;
                botaoSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';

                const dados = {
                    action: 'cadastrar_orbium',
                    orbium: document.getElementById('orbiumNumero').value,
                    status: document.getElementById('status').value,
                    departamento: document.getElementById('departamento').value,
                    vendedor: document.getElementById('vendedor').value,
                    recibo: document.getElementById('recibo').value,
                    reserva: document.getElementById('reserva').value,
                    pedido: document.getElementById('pedido').value,
                    cia: document.getElementById('cia').value,
                    loc_gds: document.getElementById('locGds').value,
                    loc_cia: document.getElementById('locCia').value,
                    observacoes: document.getElementById('observacoes').value,
                    nome_cliente: document.getElementById('nomeCliente').value,
                    whats_cliente: document.getElementById('whatsCliente').value,
                    cpf_cliente: document.getElementById('cpfCliente').value
                };

                if (!dados.whats_cliente) {
                    throw new Error('WhatsApp do cliente √© obrigat√≥rio!');
                }

                debugLog('üíæ Salvando novo orbium...', 'info');

                const result = await chamarAPI(dados);

                if (result.success) {
                    mostrarAlertaSucesso('‚úÖ Orbium cadastrado com sucesso!');
                    fecharModalNovoOrbium();
                    setTimeout(() => {
                        carregarOrbiuns();
                    }, 1000);
                } else {
                    throw new Error(result.message || 'Erro ao cadastrar orbium');
                }

            } catch (error) {
                debugLog('‚ùå Erro ao salvar: ' + error.message, 'error');
                mostrarAlertaErro(`‚ùå Erro: ${error.message}`);
            } finally {
                botaoSubmit.disabled = false;
                botaoSubmit.innerHTML = textoOriginal;
            }
        }

        // ================================================================================
        // MODAL EDITAR ORBIUM
        // ================================================================================
        function abrirModalEditarOrbium(id) {
            const orbium = orbiunsData.find(o => o.id == id);
            if (!orbium) {
                mostrarAlertaErro('‚ö†Ô∏è Orbium n√£o encontrado!');
                return;
            }

            document.getElementById('editarId').value = id;
            document.getElementById('editarOrbiumNumero').value = orbium.orbium || '';
            document.getElementById('editarStatus').value = orbium.status || 'Em atendimento';
            document.getElementById('editarObservacoes').value = '';

            document.getElementById('modalEditarOrbium').style.display = 'block';
        }

        function fecharModalEditarOrbium() {
            document.getElementById('modalEditarOrbium').style.display = 'none';
        }

        // ================================================================================
        // SALVAR EDI√á√ÉO ORBIUM
        // ================================================================================
        async function salvarEdicaoOrbium() {
            const botaoSubmit = document.querySelector('#formEditarOrbium button[type="submit"]');
            const textoOriginal = botaoSubmit.innerHTML;

            try {
                botaoSubmit.disabled = true;
                botaoSubmit.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';

                const id = document.getElementById('editarId').value;
                const novoStatus = document.getElementById('editarStatus').value;
                const observacoesAdicionais = document.getElementById('editarObservacoes').value;

                debugLog('üíæ Atualizando orbium: ' + id, 'info');

                const result = await chamarAPI({
                    action: 'atualizar_status_orbium',
                    id: id,
                    novo_status: novoStatus,
                    observacoes: observacoesAdicionais
                });

                if (result.success) {
                    mostrarAlertaSucesso('‚úÖ Orbium atualizado com sucesso!');
                    fecharModalEditarOrbium();
                    setTimeout(() => {
                        carregarOrbiuns();
                    }, 1000);
                } else {
                    throw new Error(result.message || 'Erro ao atualizar orbium');
                }

            } catch (error) {
                debugLog('‚ùå Erro ao atualizar: ' + error.message, 'error');
                mostrarAlertaErro(`‚ùå Erro: ${error.message}`);
            } finally {
                botaoSubmit.disabled = false;
                botaoSubmit.innerHTML = textoOriginal;
            }
        }

        // ================================================================================
        // DELETAR ORBIUM
        // ================================================================================
        async function confirmarDelete(id) {
            if (!confirm('‚ö†Ô∏è Tem certeza que deseja deletar este orbium?\n\nEsta a√ß√£o n√£o pode ser desfeita!')) {
                return;
            }

            try {
                debugLog('üóëÔ∏è Deletando orbium: ' + id, 'info');

                const result = await chamarAPI({
                    action: 'deletar_orbium',
                    id: id
                });

                if (result.success) {
                    mostrarAlertaSucesso('‚úÖ Orbium deletado com sucesso!');
                    setTimeout(() => {
                        carregarOrbiuns();
                    }, 1000);
                } else {
                    throw new Error(result.message || 'Erro ao deletar orbium');
                }

            } catch (error) {
                debugLog('‚ùå Erro ao deletar orbium: ' + error.message, 'error');
                mostrarAlertaErro(`‚ùå Erro: ${error.message}`);
            }
        }

        // ================================================================================
        // ABRIR WHATSAPP
        // ================================================================================
        function abrirWhatsApp(numero, nome) {
            if (!numero) {
                mostrarAlertaErro('‚ö†Ô∏è N√∫mero de WhatsApp n√£o dispon√≠vel!');
                return;
            }
            
            const numeroLimpo = numero.toString().replace(/\D/g, '');
            const mensagem = `Ol√° ${nome || 'Cliente'}! Aqui √© da CVC Itaqu√°. Como posso ajudar?`;
            const mensagemEncoded = encodeURIComponent(mensagem);
            const url = `https://wa.me/55${numeroLimpo}?text=${mensagemEncoded}`;
            window.open(url, '_blank');
            
            debugLog(`üì± WhatsApp aberto: ${numeroLimpo}`, 'info');
        }

        // ================================================================================
        // FILTROS
        // ================================================================================
        function filtrarOrbiuns() {
            const filtros = {
                orbium: document.getElementById('filtroOrbium').value.toLowerCase(),
                status: document.getElementById('filtroStatus').value.toLowerCase(),
                vendedor: document.getElementById('filtroVendedor').value.toLowerCase(),
                departamento: document.getElementById('filtroDepartamento').value.toLowerCase(),
                cliente: document.getElementById('filtroCliente').value.toLowerCase(),
                whatsapp: document.getElementById('filtroWhatsApp').value,
                recibo: document.getElementById('filtroRecibo').value.toLowerCase()
            };

            const temFiltroAtivo = Object.values(filtros).some(v => v !== '');
            
            if (!temFiltroAtivo) {
                orbiunsFiltrados = orbiunsData.filter(o => 
                    o.status === 'Problema' || o.status === 'Em atendimento'
                );
            } else {
                orbiunsFiltrados = orbiunsData.filter(orbium => {
                    if (filtros.orbium && (!orbium.orbium || !orbium.orbium.toString().toLowerCase().includes(filtros.orbium))) {
                        return false;
                    }
                    if (filtros.status && (!orbium.status || !orbium.status.toString().toLowerCase().includes(filtros.status))) {
                        return false;
                    }
                    if (filtros.vendedor && (!orbium.vendedor || !orbium.vendedor.toString().toLowerCase().includes(filtros.vendedor))) {
                        return false;
                    }
                    if (filtros.departamento && (!orbium.departamento || !orbium.departamento.toString().toLowerCase().includes(filtros.departamento))) {
                        return false;
                    }
                    if (filtros.cliente && (!orbium.nome_cliente || !orbium.nome_cliente.toString().toLowerCase().includes(filtros.cliente))) {
                        return false;
                    }
                    if (filtros.whatsapp && (!orbium.whats_cliente || !orbium.whats_cliente.toString().includes(filtros.whatsapp))) {
                        return false;
                    }
                    if (filtros.recibo && (!orbium.recibo || !orbium.recibo.toString().toLowerCase().includes(filtros.recibo))) {
                        return false;
                    }
                    return true;
                });
            }
            
            renderizarOrbiuns();
            debugLog(`üîç Filtros aplicados: ${orbiunsFiltrados.length} de ${orbiunsData.length} orbiuns exibidos`, 'info');
        }

        function limparFiltros() {
            document.getElementById('filtroOrbium').value = '';
            document.getElementById('filtroStatus').value = '';
            document.getElementById('filtroVendedor').value = '';
            document.getElementById('filtroDepartamento').value = '';
            document.getElementById('filtroCliente').value = '';
            document.getElementById('filtroWhatsApp').value = '';
            document.getElementById('filtroRecibo').value = '';
            
            orbiunsFiltrados = orbiunsData.filter(o => 
                o.status === 'Problema' || o.status === 'Em atendimento'
            );
            renderizarOrbiuns();
        }

        // ================================================================================
        // FUN√á√ïES AUXILIARES
        // ================================================================================
        function preencherVendedores() {
            const select = document.getElementById('vendedor');
            const selectFiltro = document.getElementById('filtroVendedor');
            
            const vendedores = SYSTELOS_CONFIG.vendedores || [];
            
            vendedores.forEach(vendedor => {
                const option = document.createElement('option');
                option.value = vendedor;
                option.textContent = vendedor;
                select.appendChild(option);
                
                const optionFiltro = document.createElement('option');
                optionFiltro.value = vendedor;
                optionFiltro.textContent = vendedor;
                selectFiltro.appendChild(optionFiltro);
            });
        }

        function formatarWhatsApp(numero) {
            if (!numero) return 'N/A';
            const numeroLimpo = numero.toString().replace(/\D/g, '');
            if (numeroLimpo.length === 11) {
                return `(${numeroLimpo.slice(0,2)}) ${numeroLimpo.slice(2,7)}-${numeroLimpo.slice(7)}`;
            }
            return numero;
        }

        function formatarData(data) {
            if (!data) return 'N/A';
            try {
                const dataObj = new Date(data);
                if (isNaN(dataObj.getTime())) return data;
                return dataObj.toLocaleDateString('pt-BR');
            } catch {
                return data;
            }
        }

        // ================================================================================
        // SISTEMA DE ALERTAS
        // ================================================================================
        function mostrarAlertaSucesso(mensagem) {
            criarAlertaTemporario(mensagem, 'success');
        }

        function mostrarAlertaErro(mensagem) {
            criarAlertaTemporario(mensagem, 'error');
        }

        function criarAlertaTemporario(mensagem, tipo) {
            const alerta = document.createElement('div');
            alerta.className = tipo === 'success' ? 'alert-custom alert-success-custom' : 'alert-custom alert-error-custom';
            
            alerta.innerHTML = `
                <i class="fas fa-${tipo === 'success' ? 'check-circle' : 'exclamation-circle'}"></i>
                ${mensagem}
                <button onclick="this.parentElement.remove()" 
                        style="background: none; border: none; color: inherit; 
                               font-size: 18px; cursor: pointer; margin-left: 10px;">√ó</button>
            `;
            
            document.body.appendChild(alerta);
            
            setTimeout(() => {
                if (alerta.parentElement) {
                    alerta.remove();
                }
            }, 5000);
        }

        // Fechar modais ao clicar fora
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        }

        // Atalho de teclado para novo orbium
        document.addEventListener('keydown', function(e) {
            if (e.ctrlKey && e.key === 'n') {
                e.preventDefault();
                abrirModalNovoOrbium();
            }
        });

        debugLog('‚úÖ Sistema de Orbiuns v13.0 WEBHOOK COMPLETO!', 'success');
        debugLog('üîß NOVIDADES v13.0:', 'info');
        debugLog('   1. üÜï Se√ß√£o de atualiza√ß√µes recentes', 'info');
        debugLog('   2. üÜï Badge de notifica√ß√µes', 'info');
        debugLog('   3. üÜï Cards de atualiza√ß√£o', 'info');
        debugLog('   4. üÜï Marcar como lido individual', 'info');
        debugLog('   5. üÜï Marcar todas como lidas', 'info');
        debugLog('   6. üÜï Auto-refresh a cada 5 minutos', 'info');
        debugLog('   7. ‚úÖ Integra√ß√£o completa com webhook', 'info');
        debugLog('‚úÖ Sistema pronto para uso!', 'success');
    </script>
</body>
</html>