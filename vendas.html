<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTELOS TUR - Informe de Vendas</title>

    <!-- Meta Tags -->
    <meta name="description" content="SYSTELOS TUR - Sistemas com prop√≥sito">
    <meta name="keywords" content="SYSTELOS, TUR, vendas, cadastro, viagens, Itaquaquecetuba">
    <meta name="author" content="SYSTELOS TUR">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/systelos-favicon.ico">
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/systelos-styles.css" rel="stylesheet">
    
    <style>
        /* ============================================================================
           HEADER E SIDEBAR SYSTELOS - PADR√ÉO UNIFICADO
           ============================================================================ */
        body { padding-top: 70px; }
        
        .systelos-header {
            background: linear-gradient(135deg, #0F1B3D 0%, #1a2642 100%);
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }
        
        .menu-toggle {
            background: none;
            border: none;
            color: #FFB800;
            font-size: 24px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .menu-toggle:hover {
            background: rgba(255,184,0,0.1);
            transform: scale(1.1);
        }
        
        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: 20px;
        }
        
        .logo-icon {
            background: linear-gradient(135deg, #FFB800 0%, #ff8800 100%);
            color: #0F1B3D;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            font-family: 'Poppins', sans-serif;
        }
        
        .logo-text { display: flex; flex-direction: column; }
        .logo-title { color: #FFFFFF; font-size: 24px; font-weight: 600; font-family: 'Poppins', sans-serif; }
        .logo-subtitle { color: rgba(255,255,255,0.7); font-size: 11px; font-family: 'Inter', sans-serif; }
        
        .user-info { display: flex; align-items: center; gap: 16px; margin-left: auto; }
        .user-avatar { width: 44px; height: 44px; border-radius: 50%; background: linear-gradient(135deg, #FFB800 0%, #ff8800 100%); display: flex; align-items: center; justify-content: center; }
        .user-avatar span { color: #0F1B3D; font-weight: bold; font-size: 16px; }
        .user-details { display: flex; flex-direction: column; }
        .user-name { color: #FFFFFF; font-size: 14px; font-weight: 600; }
        .user-email { color: #14B8A6; font-size: 12px; }
        
        .btn-gestor { background: #14B8A6; color: white; border: none; padding: 8px 16px; border-radius: 8px; font-size: 12px; font-weight: 600; display: flex; align-items: center; gap: 6px; cursor: pointer; }
        .btn-sair { background: #FFB800; color: #0F1B3D; border: none; padding: 8px 16px; border-radius: 8px; font-size: 14px; font-weight: 600; display: flex; align-items: center; gap: 6px; cursor: pointer; }
        
        .sidebar-menu {
            position: fixed;
            left: -340px;
            top: 0;
            width: 320px;
            height: 100vh;
            background: #0F1B3D;
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            overflow-y: auto;
            box-shadow: 2px 0 20px rgba(0,0,0,0.5);
        }
        
        .sidebar-menu.show { left: 0; }
        
        @media (max-width: 768px) {
            .systelos-header { height: 60px; }
            body { padding-top: 60px; }
            .user-name, .user-email { display: none; }
        }

        /* Estilos espec√≠ficos do sistema de vendas */
        .content-section {
            padding: 30px;
            background: var(--systelos-fundo-area, #f8f9fa);
        }
        
        .form-section {
            background: var(--systelos-fundo-card, #fff);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border-left: 4px solid #0F1B3D;
        }
        
        .form-section h4 {
            color: #0F1B3D;
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .form-label {
            font-weight: 600;
            color: #0F1B3D;
            margin-bottom: 8px;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cliente-ale-section {
            background: #fff3cd;
            border: 2px solid #FFB800;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
        }
        
        .cliente-ale-section h4 {
            color: #856404;
            font-weight: 700;
            margin-bottom: 15px;
        }
        
        .cliente-ale-toggle {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .toggle-option {
            display: flex;
            align-items: center;
            background: white;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid #FFB800;
            font-weight: 600;
            color: #856404;
            min-width: 120px;
            justify-content: center;
        }
        
        .toggle-option.selected {
            background: #FFB800;
            color: white;
        }
        
        .radio-group, .checkbox-group {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }
        
        .radio-item, .checkbox-item {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 12px 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .radio-item:hover, .checkbox-item:hover {
            border-color: #0F1B3D;
            background: rgba(15,27,61,0.05);
        }
        
        .radio-item.selected, .checkbox-item.selected {
            border-color: #0F1B3D;
            background: rgba(15,27,61,0.1);
            font-weight: 600;
        }
        
        .recibo-container {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            border: 2px solid #dee2e6;
            transition: all 0.3s ease;
        }
        
        .recibo-container:hover {
            border-color: #0F1B3D;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .recibo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .recibo-number {
            font-size: 1.2rem;
            font-weight: 700;
            color: #0F1B3D;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .btn-remove-recibo {
            background: #dc3545;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-remove-recibo:hover {
            background: #c82333;
            transform: scale(1.05);
        }
        
        .extra-fields {
            background: rgba(15,27,61,0.03);
            border-radius: 12px;
            padding: 20px;
            margin-top: 15px;
            border: 1px dashed #0F1B3D;
            display: none;
        }
        
        .extra-fields h5 {
            color: #0F1B3D;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .btn-submit {
            background: linear-gradient(135deg, #0F1B3D 0%, #1a2642 100%);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 12px;
            cursor: pointer;
            width: 100%;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
        }
        
        .btn-submit:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(15,27,61,0.3);
        }
        
        .btn-submit:disabled {
            background: #6c757d;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-cvc-primary {
            background: #0F1B3D;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-cvc-primary:hover {
            background: #1a2642;
            transform: scale(1.05);
        }
        
        .btn-cvc-secondary {
            background: #6c757d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
        }
        
        .form-control-cvc {
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 12px 15px;
            transition: all 0.3s ease;
        }
        
        .form-control-cvc:focus {
            border-color: #0F1B3D;
            box-shadow: 0 0 0 3px rgba(15,27,61,0.1);
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15,27,61,0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            flex-direction: column;
        }
        
        .loading-overlay.show {
            display: flex;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255,184,0,0.3);
            border-top: 4px solid #FFB800;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        .loading-text {
            color: white;
            margin-top: 20px;
            font-size: 1.2rem;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Status messages */
        .status-message {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: none;
        }
        
        .status-message.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
            display: block;
        }
        
        .status-message.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
            display: block;
        }
    </style>
</head>
<script>
    // ============================================================================
    // FUN√á√ïES DO HEADER SYSTELOS - ESCOPO GLOBAL
    // ============================================================================
    
    function loadUserInfo() {
        try {
            const savedUser = localStorage.getItem('systelos_user');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                const initials = userData.nome.split(' ').map(n => n[0]).slice(0, 2).join('').toUpperCase();
                const el1 = document.getElementById('userInitials');
                const el2 = document.getElementById('userName');
                const el3 = document.getElementById('userEmail');
                const el4 = document.getElementById('adminBadgeHeader');
                if (el1) el1.textContent = initials;
                if (el2) el2.textContent = userData.nome;
                if (el3) el3.textContent = userData.email;
                if (userData.isAdmin && el4) el4.style.display = 'flex';
            }
        } catch (error) { console.error('Erro loadUserInfo:', error); }
    }

    function logout() {
        if (confirm('Deseja sair do sistema?')) {
            localStorage.removeItem('systelos_user');
            window.location.href = 'index.html';
        }
    }

    function toggleSidebar() {
        const sidebar = document.getElementById('sidebarMenu');
        if (!sidebar) return;
        sidebar.classList.toggle('show');
        let overlay = document.getElementById('sidebarOverlay');
        if (sidebar.classList.contains('show')) {
            if (!overlay) {
                overlay = document.createElement('div');
                overlay.id = 'sidebarOverlay';
                overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.7);z-index:9998;cursor:pointer;';
                overlay.onclick = toggleSidebar;
                document.body.appendChild(overlay);
            }
        } else {
            if (overlay) overlay.remove();
        }
    }

    document.addEventListener('DOMContentLoaded', loadUserInfo);
</script>
<body>
    <!-- LOADING OVERLAY -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text" id="loadingText">Cadastrando venda...</div>
    </div>

    <header class="systelos-header">
        <button class="menu-toggle" onclick="toggleSidebar()"><i class="fas fa-bars"></i></button>
        <div class="logo-container">
            <div class="logo-icon">[S]</div>
            <div class="logo-text">
                <div class="logo-title">SYSTELOS TUR</div>
                <div class="logo-subtitle">Sistemas com prop√≥sito</div>
            </div>
        </div>
        <div class="user-info" id="userInfoHeader">
            <div class="user-avatar" id="userAvatar"><span id="userInitials">AR</span></div>
            <div class="user-details">
                <div class="user-name" id="userName">Alessandro</div>
                <div class="user-email" id="userEmail">usuario@systelos.com.br</div>
            </div>
            <button class="btn-gestor" id="adminBadgeHeader" style="display:none;"><i class="fas fa-crown"></i> Gestor</button>
            <button class="btn-sair" onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
        </div>
    </header>
    
    <nav id="sidebarMenu" class="sidebar-menu">
        <div style="padding:20px;border-bottom:1px solid rgba(255,184,0,0.3);position:relative;">
            <h3 style="color:#FFB800;margin:0;font-family:Poppins,sans-serif;">[S] SYSTELOS TUR</h3>
            <button onclick="toggleSidebar()" style="position:absolute;top:15px;right:15px;background:transparent;border:none;color:white;font-size:32px;cursor:pointer;">&times;</button>
        </div>
        <ul style="list-style:none;padding:0;margin:0;">
            <li><a href="index.html" style="display:block;padding:18px 25px;color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.1);">In√≠cio</a></li>
            <li><a href="orcamentos.html" style="display:block;padding:18px 25px;color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.1);">Or√ßamentos</a></li>
            <li><a href="embarques.html" style="display:block;padding:18px 25px;color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.1);">Embarques</a></li>
            <li><a href="vendas.html" style="display:block;padding:18px 25px;color:#FFB800;background:rgba(255,184,0,0.2);text-decoration:none;font-weight:600;border-left:4px solid #FFB800;">Informe de Vendas</a></li>
            <li><a href="orbiuns.html" style="display:block;padding:18px 25px;color:white;text-decoration:none;border-bottom:1px solid rgba(255,255,255,0.1);">Orbiuns</a></li>
            <li><a href="importacao.html" style="display:block;padding:18px 25px;color:white;text-decoration:none;">Importa√ß√£o</a></li>
        </ul>
    </nav>
    
    <div class="container-fluid">
        <div class="main-container">
            <!-- CONTE√öDO -->
            <div class="content-section">
                <!-- Status Message -->
                <div class="status-message" id="statusMessage"></div>
                
                <form id="formVendaCompleta">
                    <!-- Informa√ß√µes Gerais -->
                    <div class="form-section">
                        <h4><i class="fas fa-info-circle"></i> Informa√ß√µes Gerais</h4>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="nInforme" class="form-label">
                                    <i class="fas fa-hashtag"></i> N¬∫ do Informe
                                </label>
                                <input type="text" class="form-control form-control-cvc" id="nInforme" name="nInforme" 
                                       placeholder="Autom√°tico (deixe vazio)">
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label">
                                    <i class="fas fa-building"></i> Filial
                                </label>
                                <div class="radio-group">
                                    <div class="radio-item selected">
                                        <input type="radio" name="filial" value="6220" checked>
                                        <span>6220 - Itaquaquecetuba</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="vendedor" class="form-label">
                                    <i class="fas fa-user-tie"></i> Vendedor
                                </label>
                                <select class="form-select form-control-cvc" id="vendedor" name="vendedor" required>
                                    <option value="">Selecione...</option>
                                    <!-- Preenchido via JavaScript -->
                                </select>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <label class="form-label">
                                <i class="fas fa-box"></i> Tipo de Pacote
                            </label>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" name="pacote" value="Nacional" id="pacoteNacional">
                                    <span>üáßüá∑ Nacional</span>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="pacote" value="Internacional" id="pacoteInternacional">
                                    <span>üåç Internacional</span>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" name="pacote" value="Mar√≠timo" id="pacoteMaritimo">
                                    <span>üö¢ Mar√≠timo</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Dados do Cliente -->
                    <div class="form-section">
                        <h4><i class="fas fa-user"></i> Dados do Cliente</h4>
                        
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label for="cpfCliente" class="form-label">
                                    <i class="fas fa-id-card"></i> CPF
                                </label>
                                <input type="text" class="form-control form-control-cvc" id="cpfCliente" name="cpfCliente" 
                                       required placeholder="000.000.000-00" maxlength="14">
                            </div>
                            
                            <div class="col-md-4">
                                <label for="nomeCliente" class="form-label">
                                    <i class="fas fa-signature"></i> Nome Completo
                                </label>
                                <input type="text" class="form-control form-control-cvc" id="nomeCliente" name="nomeCliente" required>
                            </div>
                            
                            <div class="col-md-4">
                                <label for="whatsappCliente" class="form-label">
                                    <i class="fab fa-whatsapp"></i> WhatsApp
                                </label>
                                <input type="text" class="form-control form-control-cvc" id="whatsappCliente" name="whatsappCliente" 
                                       placeholder="(11) 99999-9999" maxlength="15">
                            </div>
                        </div>
                    </div>

                    <!-- √â CLIENTE DO ALE? -->
                    <div class="cliente-ale-section">
                        <h4><i class="fas fa-star"></i> √â cliente do Ale?</h4>
                        <div class="cliente-ale-toggle">
                            <div class="toggle-option" onclick="setClienteAle(true)">
                                <input type="radio" name="clienteAle" value="Sim">
                                <span>‚úÖ Sim</span>
                            </div>
                            <div class="toggle-option selected" onclick="setClienteAle(false)">
                                <input type="radio" name="clienteAle" value="N√£o" checked>
                                <span>‚ùå N√£o</span>
                            </div>
                        </div>
                    </div>

                    <!-- Recibos -->
                    <div class="form-section">
                        <h4><i class="fas fa-receipt"></i> Recibos e Servi√ßos</h4>
                        
                        <div id="recibosContainer">
                            <!-- Recibos aparecem aqui -->
                        </div>
                        
                        <div class="text-center mt-3">
                            <button type="button" class="btn btn-cvc-primary" onclick="adicionarRecibo()">
                                <i class="fas fa-plus-circle"></i> Adicionar Recibo
                            </button>
                            <button type="button" class="btn btn-cvc-secondary ms-2" onclick="removerUltimoRecibo()" 
                                    id="btnRemover" style="display: none;">
                                <i class="fas fa-minus-circle"></i> Remover √öltimo
                            </button>
                        </div>
                    </div>

                    <!-- Seguro -->
                    <div class="form-section">
                        <h4><i class="fas fa-shield-alt"></i> Seguro Viagem</h4>
                        
                        <div class="radio-group">
                            <div class="radio-item">
                                <input type="radio" name="seguro" value="recusado">
                                <span>‚ùå Oferecido e RECUSADO</span>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="seguro" value="nao_oferecido">
                                <span>‚ö†Ô∏è N√£o Ofertou</span>
                            </div>
                            <div class="radio-item">
                                <input type="radio" name="seguro" value="comprou">
                                <span>‚úÖ COMPROU</span>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn-submit" id="btnSubmit">
                        <i class="fas fa-save"></i> Cadastrar Venda Completa
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- CONFIG.JS -->
    <script src="config.js"></script>
    
    <!-- JAVASCRIPT PRINCIPAL -->
    <script>
        // ================================================================================
        // CONFIGURA√á√ïES E VARI√ÅVEIS GLOBAIS
        // ================================================================================
        
        const API_URL = (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.API_URL) 
            ? CVC_CONFIG.API_URL 
            : 'https://script.google.com/macros/s/AKfycbxw0y2qTzQFdnHsOwLqoVJjV00GtqNnftr4dK6LYiLK/dev';
        
        const VENDEDORES = (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.VENDEDORES) 
            ? CVC_CONFIG.VENDEDORES 
            : [
                'ANA PAULA MUNIZ DE SOUZA',
                'ADRIELLY CORREA DE SOUSA',
                'DAINA ADRIANA SILVA DE BRITO',
                'ALESSANDRO DIAZ RODRIGUES',
                'CONCEPCION DIAZ RODRIGUES'
            ];
        
        let contadorRecibos = 0;
        
        // Debug log
        function debugLog(msg, tipo = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const prefixos = {
                'info': 'üìã',
                'success': '‚úÖ',
                'error': '‚ùå',
                'warning': '‚ö†Ô∏è'
            };
            console.log(`[${timestamp}] ${prefixos[tipo] || 'üìã'} ${msg}`);
        }
        
        debugLog('üöÄ Sistema v12.0 - FUNCIONAL - Integrado com API', 'info');
        
        // ================================================================================
        // POPULAR VENDEDORES
        // ================================================================================
        function popularVendedores() {
            const select = document.getElementById('vendedor');
            if (!select) return;
            
            // Limpar op√ß√µes exceto a primeira
            select.innerHTML = '<option value="">Selecione...</option>';
            
            VENDEDORES.forEach(vendedor => {
                const option = document.createElement('option');
                // Pegar primeiro nome ou nome curto
                const nomeCurto = vendedor.split(' ')[0];
                option.value = nomeCurto;
                option.textContent = vendedor;
                select.appendChild(option);
            });
            
            debugLog(`‚úÖ ${VENDEDORES.length} vendedores carregados`, 'success');
        }
        
        // ================================================================================
        // CLIENTE DO ALE
        // ================================================================================
        function setClienteAle(isCliente) {
            const opcoes = document.querySelectorAll('.toggle-option');
            opcoes.forEach(op => op.classList.remove('selected'));
            
            if (isCliente) {
                opcoes[0].classList.add('selected');
                opcoes[0].querySelector('input').checked = true;
                debugLog('‚úÖ Cliente do Ale: SIM', 'success');
            } else {
                opcoes[1].classList.add('selected');
                opcoes[1].querySelector('input').checked = true;
                debugLog('‚ùå Cliente do Ale: N√ÉO', 'info');
            }
        }
        
        // ================================================================================
        // ADICIONAR RECIBO
        // ================================================================================
        function adicionarRecibo() {
            debugLog('üßæ Adicionando recibo...', 'info');
            
            contadorRecibos++;
            const container = document.getElementById('recibosContainer');
            
            const reciboDiv = document.createElement('div');
            reciboDiv.className = 'recibo-container';
            reciboDiv.id = `recibo-${contadorRecibos}`;
            
            reciboDiv.innerHTML = `
                <div class="recibo-header">
                    <div class="recibo-number">
                        <i class="fas fa-receipt"></i> Recibo ${contadorRecibos}
                    </div>
                    <button type="button" class="btn-remove-recibo" onclick="removerRecibo(${contadorRecibos})">
                        <i class="fas fa-trash"></i> Remover
                    </button>
                </div>

                <div class="row g-3">
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-hashtag"></i> N¬∫ do Recibo
                        </label>
                        <input type="text" class="form-control form-control-cvc" name="recibo[]" 
                               placeholder="Apenas n√∫meros" oninput="this.value = this.value.replace(/\\D/g, '')">
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-file-alt"></i> N¬∫ do Pedido
                        </label>
                        <input type="text" class="form-control form-control-cvc" name="pedido[]">
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-ticket-alt"></i> Reserva
                        </label>
                        <input type="text" class="form-control form-control-cvc" name="reserva[]">
                    </div>
                </div>

                <div class="row g-3 mt-2">
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-tag"></i> Tipo de Servi√ßo
                        </label>
                        <select class="form-select form-control-cvc" name="tipo[]" onchange="toggleExtras(this, ${contadorRecibos})" required>
                            <option value="">Selecione...</option>
                            <option value="A√©reo">A√©reo</option>
                            <option value="A√©reo Facial">A√©reo Facial</option>
                            <option value="A+H">A+H</option>
                            <option value="A+H+S">A+H+S</option>
                            <option value="Hotel">Hotel</option>
                            <option value="Terrestre">Terrestre</option>
                            <option value="Mar√≠timo">Mar√≠timo</option>
                            <option value="Seguro">Seguro</option>
                            <option value="C√¢mbio">C√¢mbio</option>
                            <option value="Chip">Chip</option>
                            <option value="Transfer">Transfer</option>
                            <option value="Passeio">Passeio</option>
                            <option value="Ingresso">Ingresso</option>
                            <option value="Outros">Outros</option>
                        </select>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-calendar-alt"></i> Data Ida
                        </label>
                        <input type="date" class="form-control form-control-cvc" name="dataIda[]" required>
                    </div>
                    
                    <div class="col-md-4">
                        <label class="form-label">
                            <i class="fas fa-calendar-check"></i> Data Volta
                        </label>
                        <input type="date" class="form-control form-control-cvc" name="dataVolta[]">
                    </div>
                </div>

                <!-- CAMPOS EXTRAS PARA A√âREO -->
                <div class="extra-fields" id="extras-${contadorRecibos}">
                    <h5><i class="fas fa-plane"></i> Detalhes A√©reos</h5>
                    
                    <div class="row g-3 mt-2">
                        <div class="col-md-4">
                            <label class="form-label">Companhia A√©rea</label>
                            <select class="form-select form-control-cvc" name="cia[]">
                                <option value="">Selecione...</option>
                                <option value="LATAM">LATAM</option>
                                <option value="AZUL">AZUL</option>
                                <option value="GOL">GOL</option>
                                <option value="VOEPASS">VOEPASS</option>
                                <option value="Air France">Air France</option>
                                <option value="American Airlines">American Airlines</option>
                                <option value="Emirates">Emirates</option>
                                <option value="OUTRAS">OUTRAS</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4">
                            <label class="form-label">LOC GDS</label>
                            <input type="text" class="form-control form-control-cvc" name="locGds[]" 
                                   style="text-transform: uppercase;" maxlength="6">
                        </div>
                        
                        <div class="col-md-4">
                            <label class="form-label">LOC CIA</label>
                            <input type="text" class="form-control form-control-cvc" name="locCia[]"
                                   style="text-transform: uppercase;" maxlength="6">
                        </div>
                    </div>

                    <div class="row g-3 mt-2">
                        <div class="col-md-6">
                            <div class="checkbox-item">
                                <input type="checkbox" name="temBagagem_${contadorRecibos}" value="true">
                                <span><i class="fas fa-suitcase"></i> Tem Bagagem?</span>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="checkbox-item">
                                <input type="checkbox" name="temAssento_${contadorRecibos}" value="true">
                                <span><i class="fas fa-chair"></i> Tem Assento Marcado?</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="mt-3">
                    <label class="form-label">
                        <i class="fas fa-comment-dots"></i> Observa√ß√µes
                    </label>
                    <textarea class="form-control form-control-cvc" name="observacoes[]" rows="2" 
                              placeholder="Informa√ß√µes adicionais..."></textarea>
                </div>
            `;
            
            container.appendChild(reciboDiv);
            atualizarBotaoRemover();
            
            debugLog(`‚úÖ Recibo ${contadorRecibos} adicionado!`, 'success');
        }
        
        // ================================================================================
        // GERENCIAR RECIBOS
        // ================================================================================
        function removerRecibo(numero) {
            const recibo = document.getElementById(`recibo-${numero}`);
            if (recibo) {
                recibo.remove();
                atualizarBotaoRemover();
                debugLog(`üóëÔ∏è Recibo ${numero} removido`, 'info');
            }
        }
        
        function removerUltimoRecibo() {
            const container = document.getElementById('recibosContainer');
            const ultimo = container.lastElementChild;
            if (ultimo) {
                ultimo.remove();
                atualizarBotaoRemover();
                debugLog('üóëÔ∏è √öltimo recibo removido', 'info');
            }
        }
        
        function atualizarBotaoRemover() {
            const container = document.getElementById('recibosContainer');
            const btnRemover = document.getElementById('btnRemover');
            const temRecibos = container.children.length > 0;
            btnRemover.style.display = temRecibos ? 'inline-block' : 'none';
        }
        
        // ================================================================================
        // CAMPOS DIN√ÇMICOS
        // ================================================================================
        function toggleExtras(select, reciboId) {
            const extras = document.getElementById(`extras-${reciboId}`);
            const tiposAereos = ['A√©reo', 'A√©reo Facial', 'A+H', 'A+H+S'];
            const isAereo = tiposAereos.includes(select.value);
            
            if (extras) {
                extras.style.display = isAereo ? 'block' : 'none';
                debugLog(`Extras a√©reos: ${isAereo ? 'MOSTRADO' : 'OCULTO'}`, 'info');
            }
        }
        
        // ================================================================================
        // M√ÅSCARAS
        // ================================================================================
        function aplicarMascaras() {
            // CPF
            const cpf = document.getElementById('cpfCliente');
            if (cpf) {
                cpf.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
            }
            
            // WhatsApp
            const whats = document.getElementById('whatsappCliente');
            if (whats) {
                whats.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/^(\d{2})(\d)/g, '($1) $2');
                    value = value.replace(/(\d)(\d{4})$/, '$1-$2');
                    e.target.value = value;
                });
            }
        }
        
        // ================================================================================
        // VISUAL INTERATIVO
        // ================================================================================
        function configurarInteratividade() {
            document.addEventListener('change', function(e) {
                // Radio buttons
                if (e.target.type === 'radio') {
                    const grupo = e.target.name;
                    document.querySelectorAll(`input[name="${grupo}"]`).forEach(radio => {
                        const item = radio.closest('.radio-item');
                        if (item) item.classList.remove('selected');
                    });
                    
                    const itemSelecionado = e.target.closest('.radio-item');
                    if (itemSelecionado) itemSelecionado.classList.add('selected');
                }
                
                // Checkboxes
                if (e.target.type === 'checkbox') {
                    const item = e.target.closest('.checkbox-item');
                    if (item) {
                        if (e.target.checked) {
                            item.classList.add('selected');
                        } else {
                            item.classList.remove('selected');
                        }
                    }
                }
            });
        }
        
        // ================================================================================
        // MOSTRAR/ESCONDER LOADING
        // ================================================================================
        function mostrarLoading(texto = 'Cadastrando venda...') {
            const overlay = document.getElementById('loadingOverlay');
            const loadingText = document.getElementById('loadingText');
            if (loadingText) loadingText.textContent = texto;
            if (overlay) overlay.classList.add('show');
        }
        
        function esconderLoading() {
            const overlay = document.getElementById('loadingOverlay');
            if (overlay) overlay.classList.remove('show');
        }
        
        // ================================================================================
        // MOSTRAR MENSAGEM DE STATUS
        // ================================================================================
        function mostrarStatus(mensagem, tipo = 'success') {
            const statusEl = document.getElementById('statusMessage');
            if (statusEl) {
                statusEl.className = `status-message ${tipo}`;
                statusEl.innerHTML = `<i class="fas fa-${tipo === 'success' ? 'check-circle' : 'exclamation-circle'}"></i> ${mensagem}`;
                statusEl.style.display = 'block';
                
                // Scroll para ver a mensagem
                statusEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
                
                // Auto-hide ap√≥s 10 segundos
                setTimeout(() => {
                    statusEl.style.display = 'none';
                }, 10000);
            }
        }
        
        // ================================================================================
        // COLETAR DADOS DO FORMUL√ÅRIO
        // ================================================================================
        function coletarDadosFormulario() {
            const form = document.getElementById('formVendaCompleta');
            const formData = new FormData(form);
            
            // Dados gerais
            const dados = {
                action: 'cadastrar_venda',
                numeroInforme: formData.get('nInforme') || '',
                filial: formData.get('filial') || '6220',
                vendedor: formData.get('vendedor'),
                tipoPacote: formData.getAll('pacote').join(', ') || 'Nacional',
                cpfCliente: formData.get('cpfCliente'),
                nomeCliente: formData.get('nomeCliente'),
                whatsappCliente: formData.get('whatsappCliente') || '',
                clienteAle: formData.get('clienteAle') || 'N√£o',
                seguro: formData.get('seguro') || 'nao_oferecido',
                recibos: []
            };
            
            // Coletar recibos
            const recibosElements = document.querySelectorAll('.recibo-container');
            recibosElements.forEach((reciboEl, index) => {
                const reciboId = reciboEl.id.replace('recibo-', '');
                
                const recibo = {
                    numero: formData.getAll('recibo[]')[index] || '',
                    pedido: formData.getAll('pedido[]')[index] || '',
                    reserva: formData.getAll('reserva[]')[index] || '',
                    tipo: formData.getAll('tipo[]')[index] || '',
                    dataIda: formData.getAll('dataIda[]')[index] || '',
                    dataVolta: formData.getAll('dataVolta[]')[index] || '',
                    cia: formData.getAll('cia[]')[index] || '',
                    locGds: formData.getAll('locGds[]')[index] || '',
                    locCia: formData.getAll('locCia[]')[index] || '',
                    temBagagem: document.querySelector(`input[name="temBagagem_${reciboId}"]`)?.checked ? 'Sim' : 'N√£o',
                    temAssento: document.querySelector(`input[name="temAssento_${reciboId}"]`)?.checked ? 'Sim' : 'N√£o',
                    observacoes: formData.getAll('observacoes[]')[index] || ''
                };
                
                dados.recibos.push(recibo);
            });
            
            return dados;
        }
        
        // ================================================================================
        // ENVIAR PARA API (JSONP)
        // ================================================================================
        function enviarParaAPI(dados) {
            return new Promise((resolve, reject) => {
                // Criar callback √∫nico
                const callbackName = 'jsonpCallback_' + Date.now();
                
                // Registrar callback global
                window[callbackName] = function(response) {
                    // Limpar
                    delete window[callbackName];
                    document.head.removeChild(script);
                    
                    debugLog(`üì• Resposta da API: ${JSON.stringify(response)}`, 'info');
                    resolve(response);
                };
                
                // Montar URL com par√¢metros
                const params = new URLSearchParams();
                params.append('callback', callbackName);
                params.append('action', 'cadastrar_venda');
                params.append('dados', JSON.stringify(dados));
                
                const url = `${API_URL}?${params.toString()}`;
                
                debugLog(`üì§ Enviando para: ${API_URL}`, 'info');
                debugLog(`üì¶ Dados: ${JSON.stringify(dados, null, 2)}`, 'info');
                
                // Criar script JSONP
                const script = document.createElement('script');
                script.src = url;
                script.onerror = function() {
                    delete window[callbackName];
                    document.head.removeChild(script);
                    reject(new Error('Erro de conex√£o com a API'));
                };
                
                // Timeout de 30 segundos
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script.parentNode) {
                            document.head.removeChild(script);
                        }
                        reject(new Error('Timeout: API n√£o respondeu'));
                    }
                }, 30000);
                
                document.head.appendChild(script);
            });
        }
        
        // ================================================================================
        // VALIDAR FORMUL√ÅRIO
        // ================================================================================
        function validarFormulario(dados) {
            const erros = [];
            
            if (!dados.vendedor) {
                erros.push('Selecione um vendedor');
            }
            
            if (!dados.cpfCliente || dados.cpfCliente.length < 14) {
                erros.push('CPF inv√°lido');
            }
            
            if (!dados.nomeCliente) {
                erros.push('Nome do cliente √© obrigat√≥rio');
            }
            
            if (dados.recibos.length === 0) {
                erros.push('Adicione pelo menos um recibo');
            }
            
            dados.recibos.forEach((recibo, index) => {
                if (!recibo.tipo) {
                    erros.push(`Recibo ${index + 1}: Selecione o tipo de servi√ßo`);
                }
                if (!recibo.dataIda) {
                    erros.push(`Recibo ${index + 1}: Data de ida √© obrigat√≥ria`);
                }
            });
            
            return erros;
        }
        
        // ================================================================================
        // CONFIGURAR ENVIO DO FORMUL√ÅRIO
        // ================================================================================
        function configurarFormulario() {
            const form = document.getElementById('formVendaCompleta');
            
            form.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                debugLog('üìù Iniciando envio da venda...', 'info');
                
                // Coletar dados
                const dados = coletarDadosFormulario();
                
                // Validar
                const erros = validarFormulario(dados);
                if (erros.length > 0) {
                    mostrarStatus('Erros encontrados:<br>‚Ä¢ ' + erros.join('<br>‚Ä¢ '), 'error');
                    return;
                }
                
                // Mostrar loading
                mostrarLoading('Cadastrando venda na planilha...');
                
                try {
                    // Enviar para API
                    const response = await enviarParaAPI(dados);
                    
                    esconderLoading();
                    
                    if (response && response.success) {
                        const totalVoos = response.data?.total_voos || dados.recibos.length;
                        const informe = response.data?.numeroInforme || 'Gerado';
                        
                        mostrarStatus(
                            `‚úÖ Venda cadastrada com sucesso!<br>` +
                            `<strong>Informe:</strong> ${informe}<br>` +
                            `<strong>Total de embarques criados:</strong> ${totalVoos}`,
                            'success'
                        );
                        
                        debugLog(`‚úÖ Venda cadastrada! Informe: ${informe}, Voos: ${totalVoos}`, 'success');
                        
                        // Limpar formul√°rio ap√≥s 2 segundos
                        setTimeout(() => {
                            if (confirm('Deseja cadastrar outra venda?')) {
                                form.reset();
                                document.getElementById('recibosContainer').innerHTML = '';
                                contadorRecibos = 0;
                                adicionarRecibo();
                                popularVendedores();
                            }
                        }, 2000);
                        
                    } else {
                        const erro = response?.error || response?.message || 'Erro desconhecido';
                        mostrarStatus(`Erro ao cadastrar venda: ${erro}`, 'error');
                        debugLog(`‚ùå Erro: ${erro}`, 'error');
                    }
                    
                } catch (error) {
                    esconderLoading();
                    mostrarStatus(`Erro de conex√£o: ${error.message}`, 'error');
                    debugLog(`‚ùå Erro de conex√£o: ${error.message}`, 'error');
                }
            });
        }
        
        // ================================================================================
        // INICIALIZA√á√ÉO
        // ================================================================================
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üìÑ DOM carregado!', 'info');
            
            setTimeout(function() {
                debugLog('üéØ Inicializando sistema FUNCIONAL...', 'info');
                
                // Configurar tudo
                popularVendedores();
                aplicarMascaras();
                configurarInteratividade();
                configurarFormulario();
                
                // Adicionar primeiro recibo
                adicionarRecibo();
                
                debugLog('‚úÖ Sistema v12.0 inicializado com SUCESSO!', 'success');
                debugLog('üîß Funcionalidades ativas:', 'info');
                debugLog('   ‚úÖ Vendedores carregados do config.js', 'info');
                debugLog('   ‚úÖ Integra√ß√£o com API Google Apps Script', 'info');
                debugLog('   ‚úÖ Valida√ß√£o de formul√°rio', 'info');
                debugLog('   ‚úÖ Envio JSONP para cadastrar_venda', 'info');
                debugLog('   ‚úÖ Feedback visual de status', 'info');
                debugLog(`üåê API URL: ${API_URL}`, 'info');
                debugLog('üöÄ SISTEMA FUNCIONAL PRONTO!', 'success');
                
            }, 100);
        });
        
        // Log final
        debugLog('‚úÖ JavaScript carregado!', 'success');
    </script>
</body>
</html>