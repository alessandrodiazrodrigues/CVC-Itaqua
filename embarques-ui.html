<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC Portal Itaquรก - Controle de Embarques</title>
    
    <meta name="description" content="CVC Portal Itaquรก - Sistema Integrado de Gestรฃo para a filial de Itaquaquecetuba">
    <meta name="keywords" content="CVC, Itaquaquecetuba, gestรฃo, viagens, turismo, sistema">
    <meta name="author" content="CVC Itaquaquecetuba">
    <meta name="robots" content="noindex, nofollow">
    
    <meta property="og:type" content="website">
    <meta property="og:title" content="CVC Portal Itaquรก - Sistema Integrado de Gestรฃo">
    <meta property="og:description" content="Sistema de gestรฃo integrado da CVC Itaquaquecetuba">
    <meta property="og:image" content="assets/images/cvc-logo.png">
    
    <link rel="icon" type="image/x-icon" href="assets/images/cvc-favicon.ico">
    <link rel="apple-touch-icon" href="assets/images/cvc-apple-icon.png">
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/cvc-styles.css" rel="stylesheet">
    
    <style>
        /* Estilos especรญficos do controle de embarques - usando variรกveis do cvc-styles.css */
        .main-container {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            box-shadow: var(--cvc-sombra-forte);
            margin: 20px auto;
            max-width: 1800px;
            overflow: hidden;
        }
        
        .content-section {
            padding: 30px;
            background: var(--cvc-cinza-claro);
        }
        
        /* Estatรญsticas com tema CVC */
        .stats-container {
            background: var(--cvc-azul);
            padding: 30px;
            margin: 0;
            color: var(--cvc-branco);
            border-radius: 0;
        }
        
        .stat-card.embarques-stat {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            margin-bottom: 0;
        }
        
        .stat-card.embarques-stat:hover {
            transform: translateY(-5px);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .stat-card.embarques-stat .stat-number {
            font-size: 3rem;
            font-weight: 900;
            color: var(--cvc-amarelo);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        /* Filtros */
        .filters-section {
            background: var(--cvc-fundo-card);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 25px;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
        }
        
        .filter-group {
            margin-bottom: 15px;
        }
        
        .filter-label {
            font-weight: 600;
            color: var(--cvc-azul);
            margin-bottom: 8px;
            font-size: 0.9rem;
        }
        
        /* Cards de embarque com alertas por urgรชncia */
        .embarque-card {
            background: var(--cvc-fundo-card);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
            transition: all 0.3s ease;
            position: relative;
        }
        
        .embarque-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }
        
        .embarque-card.conferido {
            opacity: 0.7;
            border-left-color: #28a745;
            background: var(--cvc-cinza-claro);
        }
        
        /* Sistema de alertas por urgรชncia */
        .embarque-card.urgente {
            border-left-color: #dc3545;
            background: #fff5f5;
        }
        
        .embarque-card.alerta {
            border-left-color: #ffc107;
            background: #fffbf0;
        }
        
        .embarque-card.normal {
            border-left-color: #28a745;
        }
        
        .led-urgencia {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            box-shadow: 0 0 8px rgba(0,0,0,0.3);
        }
        
        .led-urgencia.verde {
            background: #28a745;
            animation: pulse-green 2s infinite;
        }
        
        .led-urgencia.amarelo {
            background: #ffc107;
            animation: pulse-yellow 2s infinite;
        }
        
        .led-urgencia.vermelho {
            background: #dc3545;
            animation: pulse-red 1s infinite;
        }
        
        @keyframes pulse-green {
            0% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0.7); }
            70% { box-shadow: 0 0 0 8px rgba(40, 167, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(40, 167, 69, 0); }
        }
        
        @keyframes pulse-yellow {
            0% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0.7); }
            70% { box-shadow: 0 0 0 8px rgba(255, 193, 7, 0); }
            100% { box-shadow: 0 0 0 0 rgba(255, 193, 7, 0); }
        }
        
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(220, 53, 69, 0); }
            100% { box-shadow: 0 0 0 0 rgba(220, 53, 69, 0); }
        }
        
        /* Cliente informaรงรตes */
        .embarque-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .cliente-info {
            flex: 1;
        }
        
        .cliente-nome {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--cvc-azul);
            margin: 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .cliente-cpf {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        /* Badges de status */
        .status-badge {
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .badge-conferencia {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #333;
        }
        
        .badge-checkin {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
            color: white;
        }
        
        .badge-pos-venda {
            background: linear-gradient(135deg, #dc3545 0%, #e83e8c 100%);
            color: white;
        }
        
        .badge-conferido {
            background: linear-gradient(135deg, #28a745 0%, #007C42 100%);
            color: white;
        }
        
        /* Tag Cliente Ale */
        .cliente-ale-tag {
            background: var(--cvc-azul);
            color: var(--cvc-branco);
            font-weight: 600;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 8px;
        }
        
        /* Detalhes do embarque */
        .embarque-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 12px;
            margin: 15px 0;
        }
        
        .detail-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
        }
        
        .detail-icon {
            color: var(--cvc-azul);
            width: 16px;
        }
        
        .detail-label {
            font-weight: 600;
            color: #495057;
            margin-right: 5px;
        }
        
        .detail-value {
            color: #212529;
        }
        
        .copy-button {
            background: none;
            border: none;
            color: var(--cvc-azul);
            font-size: 0.8rem;
            padding: 2px 6px;
            border-radius: 4px;
            margin-left: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .copy-button:hover {
            background: var(--cvc-azul);
            color: var(--cvc-branco);
        }
        
        /* Extras e observaรงรตes */
        .embarque-extras {
            background: var(--cvc-cinza-claro);
            border-radius: 10px;
            padding: 15px;
            margin: 15px 0;
        }
        
        .extras-title {
            font-weight: 600;
            color: var(--cvc-azul);
            margin-bottom: 10px;
            font-size: 0.9rem;
        }
        
        /* Aรงรตes do embarque */
        .embarque-actions {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            flex-wrap: wrap;
            margin-top: 15px;
        }
        
        /* Abas de navegaรงรฃo */
        .nav-tabs {
            border-bottom: 2px solid var(--cvc-azul);
            margin-bottom: 25px;
        }
        
        .nav-tabs .nav-link {
            color: var(--cvc-azul);
            font-weight: 600;
            border: none;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            padding: 15px 20px;
        }
        
        .nav-tabs .nav-link:hover {
            border-bottom-color: var(--cvc-amarelo);
            color: var(--cvc-azul);
        }
        
        .nav-tabs .nav-link.active {
            border-bottom-color: var(--cvc-amarelo);
            color: var(--cvc-azul);
            background: rgba(255, 230, 0, 0.1);
        }
        
        .nav-tabs .nav-link .badge {
            margin-left: 8px;
        }
        
        /* Loading overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 0, 180, 0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top: 4px solid var(--cvc-branco);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6c757d;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
            color: var(--cvc-azul);
        }
        
        /* Badges de urgรชncia */
        .urgencia-badge {
            font-size: 0.7rem;
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 600;
            margin-left: 5px;
        }
        
        .urgencia-normal {
            background: #28a745;
            color: var(--cvc-branco);
        }
        
        .urgencia-alerta {
            background: #ffc107;
            color: #333;
        }
        
        .urgencia-urgente {
            background: #dc3545;
            color: var(--cvc-branco);
        }
        
        /* Notificaรงรตes */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 10000;
            min-width: 300px;
            max-width: 400px;
            border-radius: 10px;
            padding: 15px 20px;
            color: var(--cvc-branco);
            font-weight: 600;
            box-shadow: var(--cvc-sombra-media);
            animation: slideIn 0.3s ease-out;
        }
        
        .notification.success {
            background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
        }
        
        .notification.error {
            background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
        }
        
        .notification.warning {
            background: linear-gradient(135deg, #ffc107 0%, #fd7e14 100%);
            color: #333;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
        }
        
        /* Modal customizado */
        .modal-cvc .modal-content {
            border-radius: 15px;
            border: none;
            box-shadow: var(--cvc-sombra-forte);
        }
        
        .modal-cvc .modal-header {
            background: var(--cvc-azul);
            color: var(--cvc-branco);
            border-radius: 15px 15px 0 0;
            border-bottom: none;
        }
        
        .modal-cvc .modal-title {
            font-weight: 700;
        }
        
        /* Info seรงรตes no modal */
        .cliente-header {
            background: var(--cvc-cinza-claro);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .recibo-box {
            border: 2px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            background: var(--cvc-fundo-card);
        }
        
        .recibo-titulo {
            font-weight: 600;
            color: var(--cvc-azul);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .info-section {
            background: var(--cvc-cinza-claro);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }
ย ย ย ยย
ย ย ย ย .info-title {
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย color: var(--cvc-azul);
ย ย ย ย ย ย margin-bottom: 15px;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 10px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .info-grid {
ย ย ย ย ย ย display: grid;
ย ย ย ย ย ย grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
ย ย ย ย ย ย gap: 15px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .info-item {
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย flex-direction: column;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .info-label {
ย ย ย ย ย ย font-size: 0.85rem;
ย ย ย ย ย ย color: #6c757d;
ย ย ย ย ย ย font-weight: 600;
ย ย ย ย ย ย margin-bottom: 5px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .info-value {
ย ย ย ย ย ย font-size: 1rem;
ย ย ย ย ย ย color: #212529;
ย ย ย ย ย ย font-weight: 500;
ย ย ย ย ย ย display: flex;
ย ย ย ย ย ย align-items: center;
ย ย ย ย ย ย gap: 8px;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Campos editรกveis */
ย ย ย ย .editable-field {
ย ย ย ย ย ย background: var(--cvc-fundo-card);
ย ย ย ย ย ย border: 2px solid #e9ecef;
ย ย ย ย ย ย border-radius: 8px;
ย ย ย ย ย ย padding: 8px 12px;
ย ย ย ย ย ย font-size: 0.9rem;
ย ย ย ย ย ย width: 100%;
ย ย ย ย ย ย transition: all 0.3s ease;
ย ย ย ย ย ย font-family: 'Nunito', sans-serif;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .editable-field:focus {
ย ย ย ย ย ย border-color: var(--cvc-amarelo);
ย ย ย ย ย ย box-shadow: 0 0 0 0.2rem rgba(255, 230, 0, 0.25);
ย ย ย ย ย ย outline: none;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย .editable-label {
ย ย ย ย ย ย color: var(--cvc-azul) !important;
ย ย ย ย ย ย font-weight: 600 !important;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย /* Responsividade */
ย ย ย ย @media (max-width: 768px) {
ย ย ย ย ย ย .main-container {
ย ย ย ย ย ย ย ย margin: 10px;
ย ย ย ย ย ย ย ย border-radius: 15px;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .embarque-details {
ย ย ย ย ย ย ย ย grid-template-columns: 1fr;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .embarque-actions {
ย ย ย ย ย ย ย ย justify-content: center;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .filters-section .row {
ย ย ย ย ย ย ย ย margin: 0;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .filters-section .col-md-2 {
ย ย ย ย ย ย ย ย margin-bottom: 10px;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย .stat-card.embarques-stat .stat-number {
ย ย ย ย ย ย ย ย font-size: 2rem;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย </style>
</head>
<body>
ย ย ย ย <div class="loading-overlay" id="loadingOverlay">
ย ย ย ย <div class="text-center text-white">
ย ย ย ย ย ย <div class="loading-spinner"></div>
ย ย ย ย ย ย <div class="mt-3">Carregando embarques v8.05...</div>
ย ย ย ย </div>
ย ย </div>

ย ย <div class="container-fluid">
ย ย ย ย <div class="main-container">
ย ย ย ย ย ย ย ย ย ย ย ย <header class="cvc-header">
ย ย ย ย ย ย ย ย <div class="container-fluid">
ย ย ย ย ย ย ย ย ย ย <div class="row align-items-center py-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-4">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="cvc-logo">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="cvc-logo-symbol">CVC</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="cvc-logo-text">CVC Portal Itaquรก</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="cvc-subtitle">Sistema Integrado de Gestรฃo</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-4 text-center">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h1 class="page-title mb-0" style="border: none; padding: 0; color: var(--cvc-azul);">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-plane-departure"></i> Controle de Embarques
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </h1>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-4 text-end">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="d-flex align-items-center justify-content-end">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="me-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small class="text-muted">Sistema v8.05 - Gestรฃo de check-ins e conferรชncias de viagem</small><br>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small class="text-success" id="statusSistema">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-check-circle"></i> Sistema Online
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </small>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </header>

ย ย ย ย ย ย ย ย ย ย ย ย <nav class="cvc-nav">
ย ย ย ย ย ย ย ย <div class="container-fluid">
ย ย ย ย ย ย ย ย ย ย <ul class="nav nav-pills justify-content-center mb-0">
ย ย ย ย ย ย ย ย ย ย ย ย <li class="nav-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <a class="nav-link" href="index.html">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-tachometer-alt"></i> Dashboard
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย ย ย </li>
ย ย ย ย ย ย ย ย ย ย ย ย <li class="nav-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <a class="nav-link" href="orcamentos.html">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-calculator"></i> Padronizador de Orรงamentos
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย ย ย </li>
ย ย ย ย ย ย ย ย ย ย ย ย <li class="nav-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <a class="nav-link" href="vendas.html">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-chart-line"></i> Informe de Vendas
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย ย ย </li>
ย ย ย ย ย ย ย ย ย ย ย ย <li class="nav-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <a class="nav-link active" href="embarques.html">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-plane-departure"></i> Controle de Embarques
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย ย ย </li>
ย ย ย ย ย ย ย ย ย ย ย ย <li class="nav-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <a class="nav-link" href="orbiuns.html">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-clipboard-list"></i> Controle de Orbiuns
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย ย ย </li>
ย ย ย ย ย ย ย ย ย ย </ul>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </nav>

ย ย ย ย ย ย ย ย ย ย ย ย <div class="stats-container">
ย ย ย ย ย ย ย ย <div class="row g-3">
ย ย ย ย ย ย ย ย ย ย <div class="col-md-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-card embarques-stat">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-number" id="statConferencias">0</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-label">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-clipboard-check"></i> Conferรชncias
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="col-md-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-card embarques-stat">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-number" id="statCheckins">0</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-label">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-plane"></i> Check-ins
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="col-md-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-card embarques-stat">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-number" id="statPosVendas">0</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-label">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-phone"></i> Pรณs-vendas
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="col-md-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-card embarques-stat">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-number" id="statTotal">0</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="stat-label">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-chart-bar"></i> Total
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="content-section">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filters-section">
ย ย ย ย ย ย ย ย ย ย <h5 class="mb-3"><i class="fas fa-filter"></i> Filtros Avanรงados v8.05</h5>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="row g-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">Vendedor</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select class="form-select" id="filtroVendedor">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Todos os Vendedores</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">Status</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select class="form-select" id="filtroStatus">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Todos os Status</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="conferencia">Conferรชncias</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="checkin">Check-ins</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="pos-venda">Pรณs-vendas</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="conferido">Conferidos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">Cliente Ale</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select class="form-select" id="filtroClienteAle">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Todos</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Sim">Apenas Cliente Ale</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Nรฃo">Nรฃo Cliente Ale</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">CPF</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" class="form-control" id="filtroCPF" placeholder="Digite o CPF" maxlength="14">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">WhatsApp</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" class="form-control" id="filtroWhatsApp" placeholder="Digite o WhatsApp">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">Recibo</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" class="form-control" id="filtroRecibo" placeholder="Nรบmero do recibo">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="row g-3 mt-2">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">Reserva</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" class="form-control" id="filtroReserva" placeholder="Cรณdigo da reserva">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">LOC GDS</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" class="form-control" id="filtroLocGds" placeholder="Localizador GDS">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">LOC CIA</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" class="form-control" id="filtroLocCia" placeholder="Localizador CIA">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">Data Inรญcio</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="date" class="form-control" id="filtroDataInicio">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">Data Check-in</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="date" class="form-control" id="filtroDataCheckin">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="filter-group">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="filter-label">&nbsp;</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="d-flex gap-2">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn btn-cvc-primary" id="btnAplicarFiltros">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-filter"></i> Aplicar
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn btn-cvc-secondary" id="btnLimparFiltros">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-times"></i> Limpar
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="mt-3 text-center">
ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn btn-success me-2" id="btnRecarregar">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-sync-alt"></i> Recarregar Dados
ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="nav nav-tabs" id="navTabs" role="tablist">
ย ย ย ย ย ย ย ย ย ย <button class="nav-link active" id="tab-conferencias" data-bs-toggle="tab" data-bs-target="#tabConferencias" type="button" role="tab">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-clipboard-check"></i> Conferรชncias <span class="badge bg-warning" id="badgeConferencias">0</span>
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button class="nav-link" id="tab-checkins" data-bs-toggle="tab" data-bs-target="#tabCheckins" type="button" role="tab">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-plane"></i> Check-ins <span class="badge bg-success" id="badgeCheckins">0</span>
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button class="nav-link" id="tab-pos-vendas" data-bs-toggle="tab" data-bs-target="#tabPosVendas" type="button" role="tab">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-phone"></i> Pรณs-vendas <span class="badge bg-danger" id="badgePosVendas">0</span>
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-content" id="tabContent">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-pane fade show active" id="tabConferencias" role="tabpanel">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h5><i class="fas fa-clipboard-check"></i> Conferรชncias por Nรบmero de Informe</h5>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-muted">12-8 dias: Verde | 7-5 dias: Amarelo | 4-0 dias: Vermelho (ATRASO) | Mรกximo 12 dias</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div id="listaConferencias">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="empty-state">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-clipboard-check"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h5>Carregando conferรชncias...</h5>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Aguarde enquanto buscamos os dados</small>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-pane fade" id="tabCheckins" role="tabpanel">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h5><i class="fas fa-plane"></i> Check-ins por Voo Individual</h5>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-muted">ATRASO (passados): Vermelho | 3 dias: Verde | 2 dias: Amarelo | 1-0 dias: Vermelho</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div id="listaCheckins">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="empty-state">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-plane"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h5>Nenhum check-in prรณximo</h5>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Voos nos prรณximos 3 dias aparecerรฃo aqui</small>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>

ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="tab-pane fade" id="tabPosVendas" role="tabpanel">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h5><i class="fas fa-phone"></i> Pรณs-vendas (1 dia apรณs retorno)</h5>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <p class="text-muted">1-5 dias: Verde | 6-10 dias: Amarelo | 11+ dias: Vermelho</p>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div id="listaPosVendas">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="empty-state">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-phone"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <h5>Nenhum pรณs-venda pendente</h5>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <small>Clientes que retornaram apรณs 21/08 aparecerรฃo aqui</small>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย ย ย <div class="modal fade modal-cvc" id="modalDetalhes" tabindex="-1">
ย ย ย ย <div class="modal-dialog modal-xl">
ย ย ย ย ย ย <div class="modal-content">
ย ย ย ย ย ย ย ย <div class="modal-header">
ย ย ย ย ย ย ย ย ย ย <h5 class="modal-title">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-info-circle"></i> Detalhes Agrupados por Recibo
ย ย ย ย ย ย ย ย ย ย </h5>
ย ย ย ย ย ย ย ย ย ย <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="modal-body" id="modalBody">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย <div class="modal-footer">
ย ย ย ย ย ย ย ย ย ย <button type="button" class="btn btn-cvc-secondary" data-bs-dismiss="modal">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-times"></i> Fechar
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button type="button" class="btn btn-info" id="btnBuscarOrbiuns">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-search"></i> Buscar Orbiuns
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button type="button" class="btn btn-success" id="btnMarcarConferido">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-check"></i> Marcar como Conferido
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย <button type="button" class="btn btn-cvc-primary" id="btnSalvarAlteracoes">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-save"></i> Salvar Alteraรงรตes
ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย </div>
ย ย ย ย </div>
ย ย </div>

ย ย ย ย <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
ย ยย
ย ย ย ย <script src="config.js"></script>
ย ยย
ย ย <script>
ย ย ย ย console.log('๐ CVC Portal Itaquรก - Controle de Embarques v8.05 CORRIGIDO');
ย ย ย ยย
ย ย ย ย // ================================================================================
ย ย ย ย // ๐ง CONFIGURAรรO SEGURA v8.05
ย ย ย ย // ================================================================================
ย ย ย ยย
ย ย ย ย let API_URL = null;
ย ย ย ย let VENDEDORES = [];
ย ย ย ย let TIPOS_SERVICO = [];
ย ย ย ย let COMPANHIAS_AEREAS = [];
ย ย ย ยย
ย ย ย ย function obterConfiguracao() {
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย // Tentar obter via funรงรฃo getApiUrl
ย ย ย ย ย ย ย ย if (typeof getApiUrl === 'function') {
ย ย ย ย ย ย ย ย ย ย API_URL = getApiUrl();
ย ย ย ย ย ย ย ย ย ย console.log('โ Config.js carregado via funรงรฃo getApiUrl()');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย // Tentar obter via CVC_CONFIG global
ย ย ย ย ย ย ย ย else if (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG) {
ย ย ย ย ย ย ย ย ย ย API_URL = CVC_CONFIG.API_URL;
ย ย ย ย ย ย ย ย ย ย VENDEDORES = CVC_CONFIG.VENDEDORES || [];
ย ย ย ย ย ย ย ย ย ย TIPOS_SERVICO = CVC_CONFIG.TIPOS_SERVICO || [];
ย ย ย ย ย ย ย ย ย ย COMPANHIAS_AEREAS = CVC_CONFIG.COMPANHIAS_AEREAS || [];
ย ย ย ย ย ย ย ย ย ย console.log('โ Config.js carregado via CVC_CONFIG');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย // Tentar obter via window.CVC_CONFIG
ย ย ย ย ย ย ย ย else if (window.CVC_CONFIG) {
ย ย ย ย ย ย ย ย ย ย API_URL = window.CVC_CONFIG.API_URL;
ย ย ย ย ย ย ย ย ย ย VENDEDORES = window.CVC_CONFIG.VENDEDORES || [];
ย ย ย ย ย ย ย ย ย ย console.log('โ Config.js carregado via window.CVC_CONFIG');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Fallback com listas padrรฃo se config.js nรฃo carregar
ย ย ย ย ย ย ย ย if (!API_URL) {
ย ย ย ย ย ย ย ย ย ย console.warn('โ๏ธ Config.js nรฃo encontrado, usando configuraรงรฃo fallback');
ย ย ย ย ย ย ย ย ย ย API_URL = 'https://script.google.com/macros/s/AKfycbwSpsWw4eskLgAGPCWQ7X0q1emDfSyzWbS6nAT-7nHZHB63Hd4Q1IKWWeTsEQUnwVi3zQ/exec';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Fallback para vendedores se nรฃo tiver no config
ย ย ย ย ย ย ย ย if (!VENDEDORES || VENDEDORES.length === 0) {
ย ย ย ย ย ย ย ย ย ย VENDEDORES = ['Alessandro', 'Ana Paula', 'Adriana', 'Adrielly', 'Bia', 'Conceiรงรฃo', 'Jhully'];
ย ย ย ย ย ย ย ย ย ย console.log('๐ Usando lista de vendedores fallback');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Fallback para tipos de serviรงo
ย ย ย ย ย ย ย ย if (!TIPOS_SERVICO || TIPOS_SERVICO.length === 0) {
ย ย ย ย ย ย ย ย ย ย TIPOS_SERVICO = ['Aรฉreo', 'A+H', 'A+H+S', 'Terrestre', 'Marรญtimo', 'Seguro', 'Outros'];
ย ย ย ย ย ย ย ย ย ย console.log('๐ Usando lista de tipos de serviรงo fallback');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย console.log('๐ API URL configurada:', API_URL);
ย ย ย ย ย ย ย ย console.log('๐ฅ Vendedores carregados:', VENDEDORES.length);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error('โ Erro ao obter configuraรงรฃo:', error);
ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // ================================================================================
ย ย ย ย // ๐ VARIรVEIS GLOBAIS v8.05
ย ย ย ย // ================================================================================
ย ย ย ยย
ย ย ย ย let embarquesData = [];
ย ย ย ย let embarquesFiltrados = [];
ย ย ย ย let vendedoresUnicos = new Set();
ย ย ย ย let informesAgrupados = new Map();
ย ย ย ย let embarquesRelacionados = [];

ย ย ย ย let stats = {
ย ย ย ย ย ย checkins: 0,
ย ย ย ย ย ย conferencias: 0,
ย ย ย ย ย ย posVendas: 0,
ย ย ย ย ย ย total: 0
ย ย ย ย };

ย ย ย ย const DATA_HOJE = new Date('2025-09-07');
ย ย ย ยย
ย ย ย ย // ================================================================================
ย ย ย ย // ๐ PROCESSAMENTO DE DADOS v8.05 COM VERIFICAรรO ROBUSTA
ย ย ย ย // ================================================================================
ย ย ย ยย
ย ย ย ย function processarDadosEmbarques(dados) {
ย ย ย ย ย ย console.log(`๐ Processando ${dados.length} registros v8.05...`);
ย ย ย ย ย ยย
ย ย ย ย ย ย const embarquesProcessados = [];
ย ย ย ย ย ย let rejeitados = 0;
ย ย ย ย ย ยย
ย ย ย ย ย ย informesAgrupados.clear();
ย ย ย ย ย ยย
ย ย ย ย ย ย dados.forEach((embarque, index) => {
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย // CORREรรO v8.05: Verificar se o embarque nรฃo รฉ null/undefined
ย ย ย ย ย ย ย ย ย ย if (!embarque || typeof embarque !== 'object') {
ย ย ย ย ย ย ย ย ย ย ย ย console.warn(`โ๏ธ Registro ${index + 1} รฉ null/undefined, ignorando`);
ย ย ย ย ย ย ย ย ย ย ย ย rejeitados++;
ย ย ย ย ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (validarEmbarque(embarque)) {
ย ย ย ย ย ย ย ย ย ย ย ย embarque.id = embarque.id || `embarque_${index}`;
ย ย ย ย ย ย ย ย ย ย ย ย embarque.diasParaVoo = calcularDiasParaVoo(embarque.dataIda);
ย ย ย ย ย ย ย ย ย ย ย ย embarque.diasNumericos = calcularDiasNumericos(embarque.dataIda);
ย ย ย ย ย ย ย ย ย ย ย ย embarque.conferido = localStorage.getItem(`conferencia_${embarque.id}`) === 'true';
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย const classificacao = classificarEmbarqueCorrigido(embarque);
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย // CORREรรO v8.05: Verificar se classificaรงรฃo nรฃo รฉ null
ย ย ย ย ย ย ย ย ย ย ย ย if (classificacao && classificacao.categoria) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย embarque.categoria = classificacao.categoria;
ย ย ย ย ย ย ย ย ย ย ย ย ย ย embarque.urgencia = classificacao.urgencia;
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (embarque.numeroInforme && embarque.categoria === 'conferencia') {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (!informesAgrupados.has(embarque.numeroInforme)) {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย informesAgrupados.set(embarque.numeroInforme, []);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย informesAgrupados.get(embarque.numeroInforme).push(embarque);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย embarquesProcessados.push(embarque);
ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย if (embarque.vendedor) vendedoresUnicos.add(embarque.vendedor);
ย ย ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย ย ย console.warn(`โ๏ธ Registro ${index + 1} nรฃo pรดde ser classificado, ignorando`);
ย ย ย ย ย ย ย ย ย ย ย ย ย ย rejeitados++;
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย ย ย rejeitados++;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย ย ย console.warn(`โ Erro processando registro ${index + 1}: ${error.message}`);
ย ย ย ย ย ย ย ย ย ย rejeitados++;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย const taxaProcessamento = dados.length > 0 ? ((embarquesProcessados.length / dados.length) * 100).toFixed(1) : 0;
ย ย ย ย ย ย console.log(`โ Processamento v8.05: ${embarquesProcessados.length}/${dados.length} (${taxaProcessamento}%)`);
ย ย ย ย ย ย console.log(`๐ Informes agrupados: ${informesAgrupados.size}`);
ย ย ย ย ย ย console.log(`โ Registros rejeitados: ${rejeitados}`);
ย ย ย ย ย ยย
ย ย ย ย ย ย return embarquesProcessados;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function validarEmbarque(embarque) {
ย ย ย ย ย ย // Verificaรงรตes bรกsicas de seguranรงa
ย ย ย ย ย ย if (!embarque || typeof embarque !== 'object') return false;
ย ย ย ย ย ย if (!embarque.nomeCliente || embarque.nomeCliente.length < 3) return false;
ย ย ย ย ย ย if (!embarque.cpfCliente || embarque.cpfCliente.replace(/\D/g, '').length < 8) return false;
ย ย ย ย ย ยย
ย ย ย ย ย ย const vendedoresValidos = [
ย ย ย ย ย ย ย ย 'ADRIELLY', 'ALESSANDRO', 'ANA PAULA', 'CAROL', 'CAROLINY',
ย ย ย ย ย ย ย ย 'JHULY', 'DAINA', 'ELAINE', 'ILANA', 'BIA', 'CONCEIรรO',
ย ย ย ย ย ย ย ย 'CONCEICAO', 'ADRIANA', 'BEATRIZ', 'TESTE'
ย ย ย ย ย ย ];
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!embarque.vendedor) return false;
ย ย ย ย ย ยย
ย ย ย ย ย ย const vendedorNorm = embarque.vendedor.toString().trim().toUpperCase();
ย ย ย ย ย ย const vendedorValido = vendedoresValidos.some(v =>ย
ย ย ย ย ย ย ย ย vendedorNorm.includes(v) || v.includes(vendedorNorm)
ย ย ย ย ย ย );
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!vendedorValido) return false;
ย ย ย ย ย ย if (!embarque.dataIda) return false;
ย ย ย ย ย ย if (embarque.situacao && embarque.situacao.toLowerCase().includes('cancelado')) return false;
ย ย ย ย ย ยย
ย ย ย ย ย ย return true;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // ================================================================================
ย ย ย ย // ๐ฏ CLASSIFICAรรO CORRIGIDA v8.05 COM LIMITE DE 12 DIAS
ย ย ย ย // ================================================================================
ย ย ย ยย
ย ย ย ย function classificarEmbarqueCorrigido(embarque) {
ย ย ย ย ย ย if (!embarque || !embarque.dataIda) return { categoria: 'conferencia', urgencia: 'normal' };
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย let dataVoo = parseData(embarque.dataIda);
ย ย ย ย ย ย ย ย let dataVolta = embarque.dataVolta ? parseData(embarque.dataVolta) : null;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (!dataVoo || isNaN(dataVoo.getTime())) {
ย ย ย ย ย ย ย ย ย ย return { categoria: 'conferencia', urgencia: 'normal' };
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const hoje = new Date(DATA_HOJE);
ย ย ย ย ย ย ย ย hoje.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ย dataVoo.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const diffTime = dataVoo.getTime() - hoje.getTime();
ย ย ย ย ย ย ย ย const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // PรS-VENDA: 1 dia apรณs retorno da viagem
ย ย ย ย ย ย ย ย if (dataVolta) {
ย ย ย ย ย ย ย ย ย ย dataVolta.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ย ย ย const diffRetorno = hoje.getTime() - dataVolta.getTime();
ย ย ย ย ย ย ย ย ย ย const diasAposRetorno = Math.ceil(diffRetorno / (1000 * 60 * 60 * 24));
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย if (diasAposRetorno >= 1) {
ย ย ย ย ย ย ย ย ย ย ย ย let urgencia = 'normal';
ย ย ย ย ย ย ย ย ย ย ย ย if (diasAposRetorno >= 1 && diasAposRetorno <= 5) urgencia = 'normal';
ย ย ย ย ย ย ย ย ย ย ย ย else if (diasAposRetorno >= 6 && diasAposRetorno <= 10) urgencia = 'alerta';
ย ย ย ย ย ย ย ย ย ย ย ย else if (diasAposRetorno >= 11) urgencia = 'urgente';
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย return { categoria: 'pos-venda', urgencia };
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // CHECK-IN: 3 dias antes de cada voo (incluindo datas passadas como ATRASO)
ย ย ย ย ย ย ย ย if (diffDays >= -365 && diffDays <= 3) {
ย ย ย ย ย ย ย ย ย ย let urgencia = 'normal';
ย ย ย ย ย ย ย ย ย ย if (diffDays < 0) urgencia = 'urgente'; // ATRASO - qualquer voo passado
ย ย ย ย ย ย ย ย ย ย else if (diffDays === 3) urgencia = 'normal';
ย ย ย ย ย ย ย ย ย ย else if (diffDays === 2) urgencia = 'alerta';
ย ย ย ย ย ย ย ย ย ย else if (diffDays <= 1) urgencia = 'urgente';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย return { categoria: 'checkin', urgencia };
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // CONFERรNCIA: 4 a 12 dias antes (LIMITE DE 12 DIAS)
ย ย ย ย ย ย ย ย if (diffDays >= 4 && diffDays <= 12) {
ย ย ย ย ย ย ย ย ย ย let urgencia = 'normal';
ย ย ย ย ย ย ย ย ย ย if (diffDays >= 8 && diffDays <= 12) urgencia = 'normal';
ย ย ย ย ย ย ย ย ย ย else if (diffDays >= 5 && diffDays <= 7) urgencia = 'alerta';
ย ย ย ย ย ย ย ย ย ย else if (diffDays === 4) urgencia = 'urgente';
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย return { categoria: 'conferencia', urgencia };
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // CORREรรO v8.05: Retornar null para voos muito distantes
ย ย ย ย ย ย ย ย return null;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.warn('Erro na classificaรงรฃo do embarque:', error);
ย ย ย ย ย ย ย ย return { categoria: 'conferencia', urgencia: 'normal' };
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function parseData(dataStr) {
ย ย ย ย ย ย if (!dataStr) return null;
ย ย ย ย ย ย if (dataStr instanceof Date) return dataStr;
ย ย ย ย ย ยย
ย ย ย ย ย ย const str = dataStr.toString();
ย ย ย ย ย ยย
ย ย ย ย ย ย if (str.includes('/')) {
ย ย ย ย ย ย ย ย const partes = str.split('/');
ย ย ย ย ย ย ย ย if (partes.length === 3) {
ย ย ย ย ย ย ย ย ย ย return new Date(partes[2], partes[1] - 1, partes[0]);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย return new Date(str);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function calcularDiasParaVoo(dataIda) {
ย ย ย ย ย ย if (!dataIda) return 'N/A';
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const dataVoo = parseData(dataIda);
ย ย ย ย ย ย ย ย if (!dataVoo || isNaN(dataVoo.getTime())) return 'N/A';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const hoje = new Date(DATA_HOJE);
ย ย ย ย ย ย ย ย hoje.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ย dataVoo.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const diffTime = dataVoo.getTime() - hoje.getTime();
ย ย ย ย ย ย ย ย const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (diffDays === 0) return 'Hoje';
ย ย ย ย ย ย ย ย if (diffDays === 1) return 'Amanhรฃ';
ย ย ย ย ย ย ย ย if (diffDays === -1) return 'Ontem';
ย ย ย ย ย ย ย ย if (diffDays > 0) return `${diffDays} dias`;
ย ย ย ย ย ย ย ย return `${Math.abs(diffDays)} dias atrรกs`;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย return 'N/A';
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย function calcularDiasNumericos(dataIda) {
ย ย ย ย ย ย if (!dataIda) return 999;
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const dataVoo = parseData(dataIda);
ย ย ย ย ย ย ย ย if (!dataVoo || isNaN(dataVoo.getTime())) return 999;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const hoje = new Date(DATA_HOJE);
ย ย ย ย ย ย ย ย hoje.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ย dataVoo.setHours(0, 0, 0, 0);
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย const diffTime = dataVoo.getTime() - hoje.getTime();
ย ย ย ย ย ย ย ย const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return diffDays;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย return 999;
ย ย ย ย ย ย }
ย ย ย ย }

ย ย ย ย // ================================================================================
ย ย ย ย // ๐ RENDERIZAรรO DA INTERFACE v8.05 COM VERIFICAรรES ROBUSTAS
ย ย ย ย // ================================================================================
ย ย ย ยย
ย ย ย ย function renderizarEmbarques() {
ย ย ย ย ย ย const filtroStatus = document.getElementById('filtroStatus').value;
ย ย ย ย ย ยย
ย ย ย ย ย ย // CORREรรO v8.05: Filtrar itens null/undefined ANTES de processar
ย ย ย ย ย ย let embarquesParaRender = embarquesFiltrados.filter(e => e && typeof e === 'object');
ย ย ย ย ย ยย
ย ย ย ย ย ย if (filtroStatus === 'conferido') {
ย ย ย ย ย ย ย ย embarquesParaRender = embarquesParaRender.filter(e => e.conferido);
ย ย ย ย ย ย } else if (filtroStatus && filtroStatus !== 'conferido') {
ย ย ย ย ย ย ย ย embarquesParaRender = embarquesParaRender.filter(e => e.categoria === filtroStatus && !e.conferido);
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย const conferencias = embarquesParaRender.filter(e => e.categoria === 'conferencia' && !e.conferido);
ย ย ย ย ย ย const checkins = embarquesParaRender.filter(e => e.categoria === 'checkin' && !e.conferido);
ย ย ย ย ย ย const posVendas = embarquesParaRender.filter(e => e.categoria === 'pos-venda' && !e.conferido);
ย ย ย ย ย ยย
ย ย ย ย ย ย renderizarListaEmbarques('listaConferencias', conferencias, 'conferencia');
ย ย ย ย ย ย renderizarListaEmbarques('listaCheckins', checkins, 'checkin');
ย ย ย ย ย ย renderizarListaEmbarques('listaPosVendas', posVendas, 'pos-venda');
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('badgeConferencias').textContent = conferencias.length;
ย ย ย ย ย ย document.getElementById('badgeCheckins').textContent = checkins.length;
ย ย ย ย ย ย document.getElementById('badgePosVendas').textContent = posVendas.length;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function renderizarListaEmbarques(containerId, embarques, categoria) {
ย ย ย ย ย ย const container = document.getElementById(containerId);
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!container) {
ย ย ย ย ย ย ย ย console.error(`Container ${containerId} nรฃo encontrado`);
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย if (embarques.length === 0) {
ย ย ย ย ย ย ย ย const emptyMessage = {
ย ย ย ย ย ย ย ย ย ย 'conferencia': 'Nenhuma conferรชncia pendente (mรกximo 12 dias)',
ย ย ย ย ย ย ย ย ย ย 'checkin': 'Nenhum check-in prรณximo',
ย ย ย ย ย ย ย ย ย ย 'pos-venda': 'Nenhum pรณs-venda pendente'
ย ย ย ย ย ย ย ย };
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย container.innerHTML = `
ย ย ย ย ย ย ย ย ย ย <div class="empty-state">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-${categoria === 'conferencia' ? 'clipboard-check' : categoria === 'checkin' ? 'plane' : 'phone'}"></i>
ย ย ย ย ย ย ย ย ย ย ย ย <h5>${emptyMessage[categoria]}</h5>
ย ย ย ย ย ย ย ย ย ย ย ย <small>Sistema v8.05 - Total processados: ${stats.total} embarques</small>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `;
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย // ================================================================================
ย ย ย ย ย ย // ๐ ORDENAรรO CORRIGIDA v8.05 - CHECK-IN ESPECIAL
ย ย ย ย ย ย // ================================================================================
ย ย ย ย ย ยย
ย ย ย ย ย ย // CORREรรO v8.05: Verificar se embarques existem antes de ordenar
ย ย ย ย ย ย const embarquesValidos = embarques.filter(e => e && typeof e === 'object');
ย ย ย ย ย ยย
ย ย ย ย ย ย embarquesValidos.sort((a, b) => {
ย ย ย ย ย ย ย ย // Usar diasNumericos para ordenaรงรฃo correta
ย ย ย ย ย ย ย ย const diasA = (a && a.diasNumericos !== undefined) ? a.diasNumericos : 999;
ย ย ย ย ย ย ย ย const diasB = (b && b.diasNumericos !== undefined) ? b.diasNumericos : 999;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (categoria === 'checkin') {
ย ย ย ย ย ย ย ย ย ย // CHECK-IN: Ordenaรงรฃo especial
ย ย ย ย ย ย ย ย ย ย // ATRASO (mais antigos primeiro) โ Hoje โ Amanhรฃ โ 2 dias โ 3 dias
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Se ambos sรฃo atraso (< 0)
ย ย ย ย ย ย ย ย ย ย if (diasA < 0 && diasB < 0) {
ย ย ย ย ย ย ย ย ย ย ย ย return diasA - diasB; // Mais antigo primeiro (-5, -4, -3, -2, -1)
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Se apenas A รฉ atraso
ย ย ย ย ย ย ย ย ย ย if (diasA < 0 && diasB >= 0) {
ย ย ย ย ย ย ย ย ย ย ย ย return -1; // A vem primeiro
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Se apenas B รฉ atraso
ย ย ย ย ย ย ย ย ย ย if (diasA >= 0 && diasB < 0) {
ย ย ย ย ย ย ย ย ย ย ย ย return 1; // B vem primeiro
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย // Se ambos sรฃo futuros (>= 0), ordem crescente normal
ย ย ย ย ย ย ย ย ย ย return diasA - diasB; // 0 (hoje), 1 (amanhรฃ), 2, 3...
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย // CONFERENCIA e POS-VENDA: ordem crescente normal
ย ย ย ย ย ย ย ย ย ย return diasA - diasB;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย container.innerHTML = embarquesValidos.map(embarque => criarCardEmbarqueCorrigido(embarque, categoria)).join('');
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function criarCardEmbarqueCorrigido(embarque, categoria) {
ย ย ย ย ย ย // CORREรรO v8.05: Verificar se embarque existe
ย ย ย ย ย ย if (!embarque || typeof embarque !== 'object') {
ย ย ย ย ย ย ย ย console.warn('Tentativa de criar card para embarque invรกlido');
ย ย ย ย ย ย ย ย return '';
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย const badgeClass = {
ย ย ย ย ย ย ย ย 'conferencia': 'badge-conferencia',
ย ย ย ย ย ย ย ย 'checkin': 'badge-checkin',
ย ย ย ย ย ย ย ย 'pos-venda': 'badge-pos-venda'
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย const badgeText = {
ย ย ย ย ย ย ย ย 'conferencia': 'Conferรชncia',
ย ย ย ย ย ย ย ย 'checkin': 'Check-in',
ย ย ย ย ย ย ย ย 'pos-venda': 'Pรณs-venda'
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย const urgenciaClass = embarque.urgencia || 'normal';
ย ย ย ย ย ย const ledClass = urgenciaClass === 'normal' ? 'verde' : urgenciaClass === 'alerta' ? 'amarelo' : 'vermelho';
ย ย ย ย ย ยย
ย ย ย ย ย ย const whatsappLink = embarque.whatsappCliente ?ย
ย ย ย ย ย ย ย ย `https://wa.me/55${embarque.whatsappCliente.replace(/\D/g, '')}` : '#';
ย ย ย ย ย ยย
ย ย ย ย ย ย const clienteAleTag = embarque.clienteAle === 'Sim' ?ย
ย ย ย ย ย ย ย ย '<span class="cliente-ale-tag">Cliente Ale</span>' : '';
ย ย ย ย ย ยย
ย ย ย ย ย ย // Texto de urgรชncia personalizado para check-ins com atraso
ย ย ย ย ย ย let urgenciaTexto = urgenciaClass === 'normal' ? 'Normal' : urgenciaClass === 'alerta' ? 'Cuidado' : 'URGENTE';
ย ย ย ย ย ย if (categoria === 'checkin' && embarque.diasNumericos < 0) {
ย ย ย ย ย ย ย ย urgenciaTexto = 'ATRASO';
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย return `
ย ย ย ย ย ย ย ย <div class="embarque-card ${embarque.conferido ? 'conferido' : urgenciaClass}" data-embarque-id="${embarque.id}">
ย ย ย ย ย ย ย ย ย ย <div class="led-urgencia ${ledClass}"></div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="embarque-header">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="cliente-info">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="cliente-nome">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.nomeCliente || 'Nome nรฃo informado'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${clienteAleTag}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="cliente-cpf">CPF: ${embarque.cpfCliente || 'Nรฃo informado'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="status-badge ${badgeClass[categoria]}">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.conferido ? 'Conferido' : badgeText[categoria]}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="urgencia-badge urgencia-${urgenciaClass}">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${urgenciaTexto}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="embarque-details">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-user-tie detail-icon"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-label">Vendedor:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-value">${embarque.vendedor || 'Nรฃo informado'}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-calendar detail-icon"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-label">Data do Voo:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-value">${formatarData(embarque.dataIda)}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-clock detail-icon"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-label">Dias para Voo:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-value">${embarque.diasParaVoo}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-receipt detail-icon"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-label">Recibo:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-value">${embarque.recibo || 'N/A'}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.recibo ? `<button class="copy-button" onclick="copiarTexto('${embarque.recibo}', this)"><i class="fas fa-copy"></i></button>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-building detail-icon"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-label">Nยบ Informe:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-value">${embarque.numeroInforme || 'N/A'}</span>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fab fa-whatsapp detail-icon"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-label">WhatsApp:</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="detail-value">${embarque.whatsappCliente || 'N/A'}</span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.whatsappCliente ? `<button class="copy-button" onclick="copiarTexto('${embarque.whatsappCliente}', this)"><i class="fas fa-copy"></i></button>` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ${embarque.observacoes ? `
ย ย ย ย ย ย ย ย ย ย ย ย <div class="embarque-extras">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="extras-title">Observaรงรตes</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="detail-value">${embarque.observacoes.substring(0, 150)}${embarque.observacoes.length > 150 ? '...' : ''}</div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="embarque-actions">
ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.whatsappCliente ? `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <a href="${whatsappLink}" target="_blank" class="btn btn-success btn-sm">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fab fa-whatsapp"></i> WhatsApp
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </a>
ย ย ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย <button class="btn btn-cvc-primary btn-sm" onclick="abrirDetalhesAgrupados('${embarque.numeroInforme || embarque.id}')">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-eye"></i> Ver Detalhes
ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function atualizarEstatisticas(embarques) {
ย ย ย ย ย ย // CORREรรO v8.05: Filtrar itens vรกlidos antes de contar
ย ย ย ย ย ย const embarquesValidos = embarques.filter(e => e && typeof e === 'object');
ย ย ย ย ย ยย
ย ย ย ย ย ย stats = {
ย ย ย ย ย ย ย ย checkins: embarquesValidos.filter(e => e.categoria === 'checkin' && !e.conferido).length,
ย ย ย ย ย ย ย ย conferencias: embarquesValidos.filter(e => e.categoria === 'conferencia' && !e.conferido).length,
ย ย ย ย ย ย ย ย posVendas: embarquesValidos.filter(e => e.categoria === 'pos-venda' && !e.conferido).length,
ย ย ย ย ย ย ย ย total: embarquesValidos.length
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย document.getElementById('statCheckins').textContent = stats.checkins;
ย ย ย ย ย ย document.getElementById('statConferencias').textContent = stats.conferencias;
ย ย ย ย ย ย document.getElementById('statPosVendas').textContent = stats.posVendas;
ย ย ย ย ย ย document.getElementById('statTotal').textContent = stats.total;
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function preencherFiltros() {
ย ย ย ย ย ย const filtroVendedor = document.getElementById('filtroVendedor');
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!filtroVendedor) {
ย ย ย ย ย ย ย ย console.error('Elemento filtroVendedor nรฃo encontrado');
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย filtroVendedor.innerHTML = '<option value="">Todos os Vendedores</option>';
ย ย ย ย ย ยย
ย ย ย ย ย ย // Usar vendedores รบnicos coletados dos dados OU fallback
ย ย ย ย ย ย const vendedoresParaUsar = vendedoresUnicos.size > 0 ? Array.from(vendedoresUnicos) : VENDEDORES;
ย ย ย ย ย ยย
ย ย ย ย ย ย vendedoresParaUsar.sort().forEach(vendedor => {
ย ย ย ย ย ย ย ย const option = document.createElement('option');
ย ย ย ย ย ย ย ย option.value = vendedor;
ย ย ย ย ย ย ย ย option.textContent = vendedor;
ย ย ย ย ย ย ย ย filtroVendedor.appendChild(option);
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย console.log(`โ Filtro de vendedores preenchido com ${vendedoresParaUsar.length} opรงรตes`);
ย ย ย ย }

ย ย ย ย // ================================================================================
ย ย ย ย // ๐ MODAL AGRUPADO POR RECIBO v8.05 - CORRIGIDO
ย ย ย ย // ================================================================================
ย ย ย ยย
ย ย ย ย function abrirDetalhesAgrupados(numeroInforme) {
ย ย ย ย ย ย embarquesRelacionados = [];
ย ย ย ย ย ยย
ย ย ย ย ย ย if (numeroInforme && numeroInforme !== 'undefined') {
ย ย ย ย ย ย ย ย // CORREรรO v8.05: Filtrar embarques vรกlidos antes de buscar
ย ย ย ย ย ย ย ย embarquesRelacionados = embarquesData.filter(e =>ย
ย ย ย ย ย ย ย ย ย ย e && typeof e === 'object' && (
ย ย ย ย ย ย ย ย ย ย ย ย e.numeroInforme === numeroInforme ||ย
ย ย ย ย ย ย ย ย ย ย ย ย (e.cpfCliente && embarquesData.find(ref => ref && ref.numeroInforme === numeroInforme && ref.cpfCliente === e.cpfCliente))
ย ย ย ย ย ย ย ย ย ย )
ย ย ย ย ย ย ย ย );
ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย const embarqueUnico = embarquesData.find(e => e && e.id === numeroInforme);
ย ย ย ย ย ย ย ย if (embarqueUnico) {
ย ย ย ย ย ย ย ย ย ย embarquesRelacionados = [embarqueUnico];
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย if (embarquesRelacionados.length === 0) {
ย ย ย ย ย ย ย ย mostrarNotificacao('Nenhum embarque encontrado para exibir detalhes.', 'warning');
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย const modalBody = document.getElementById('modalBody');
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!modalBody) {
ย ย ย ย ย ย ย ย console.error('Modal body nรฃo encontrado');
ย ย ย ย ย ย ย ย return;
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย // Agrupar por recibo
ย ย ย ย ย ย const embarquesPorRecibo = new Map();
ย ย ย ย ย ย embarquesRelacionados.forEach(embarque => {
ย ย ย ย ย ย ย ย if (embarque && typeof embarque === 'object') {
ย ย ย ย ย ย ย ย ย ย const recibo = embarque.recibo || 'Sem Recibo';
ย ย ย ย ย ย ย ย ย ย if (!embarquesPorRecibo.has(recibo)) {
ย ย ย ย ย ย ย ย ย ย ย ย embarquesPorRecibo.set(recibo, []);
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย embarquesPorRecibo.get(recibo).push(embarque);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย const clientePrincipal = embarquesRelacionados[0];
ย ย ย ย ย ย const whatsappLink = clientePrincipal.whatsappCliente ?ย
ย ย ย ย ย ย ย ย `https://wa.me/55${clientePrincipal.whatsappCliente.replace(/\D/g, '')}` : '#';
ย ย ย ย ย ยย
ย ย ย ย ย ย modalBody.innerHTML = `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="cliente-header">
ย ย ย ย ย ย ย ย ย ย <div class="info-title">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-user"></i> Dados do Cliente
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="info-grid">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Nome Completo</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${clientePrincipal.nomeCliente || 'Nรฃo informado'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">CPF</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${clientePrincipal.cpfCliente || 'Nรฃo informado'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${clientePrincipal.cpfCliente ? `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="copy-button" onclick="copiarTexto('${clientePrincipal.cpfCliente}', this)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-copy"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">WhatsApp</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${clientePrincipal.whatsappCliente ?ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย `<a href="${whatsappLink}" target="_blank" class="text-success">${clientePrincipal.whatsappCliente}</a>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย<button class="copy-button" onclick="copiarTexto('${clientePrincipal.whatsappCliente}', this)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย<i class="fas fa-copy"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย</button>` :ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย 'Nรฃo informado'
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Vendedor</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${clientePrincipal.vendedor || 'Nรฃo informado'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Cliente Ale</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <span class="badge ${clientePrincipal.clienteAle === 'Sim' ? 'bg-primary' : 'bg-secondary'}">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${clientePrincipal.clienteAle || 'Nรฃo'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </span>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${Array.from(embarquesPorRecibo.entries()).map(([recibo, embarques]) => `
ย ย ย ย ย ย ย ย ย ย <div class="recibo-box">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="recibo-titulo">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-receipt"></i>ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย Recibo: ${recibo}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${recibo !== 'Sem Recibo' ? `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="copy-button" onclick="copiarTexto('${recibo}', this)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-copy"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ${embarques.map((embarque, index) => `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-section">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-title">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-plane"></i> Voo ${index + 1} - ${formatarData(embarque.dataIda)}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-grid">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Data de Ida</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${formatarData(embarque.dataIda)}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Data de Volta</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${formatarData(embarque.dataVolta) || 'N/A'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Tipo de Serviรงo</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.tipo || embarque.tipoAereo || 'N/A'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Companhia Aรฉrea</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.cia || 'N/A'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Reserva</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.reserva || 'N/A'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.reserva ? `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="copy-button" onclick="copiarTexto('${embarque.reserva}', this)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-copy"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">LOC GDS</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.locGds || 'N/A'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.locGds ? `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="copy-button" onclick="copiarTexto('${embarque.locGds}', this)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-copy"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">LOC CIA</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.locCia || 'N/A'}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.locCia ? `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <button class="copy-button" onclick="copiarTexto('${embarque.locCia}', this)">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-copy"></i>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </button>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Nรบmero do Pedido</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.numeroPedido || 'N/A'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Bagagem</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.temBagagem || 'Nรฃo informado'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Assento</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.temAssento || 'Nรฃo informado'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Multi Trecho</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.multiTrecho || 'Nรฃo'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Seguro</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.seguro || 'Nรฃo informado'}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ${embarque.observacoes ? `
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-label">Observaรงรตes</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-value">${embarque.observacoes}</div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ` : ''}
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย `).join('')}
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย `).join('')}
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <div class="info-section">
ย ย ย ย ย ย ย ย ย ย <div class="info-title">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-edit"></i> Observaรงรตes Editรกveis
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย <label class="editable-label">Observaรงรตes</label>
ย ย ย ย ย ย ย ย ย ย ย ย <textarea class="editable-field" id="observacoesEditaveis" rows="3"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย placeholder="Digite observaรงรตes sobre a conferรชncia...">
ย ย ย ย ย ย ย ย ย ย ย ย </textarea>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="row mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="editable-label">Grupo Ofertas WhatsApp</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select class="editable-field" id="grupoOfertas">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Selecione...</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Sim">Sim</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Nรฃo">Nรฃo</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="editable-label">Postou no Instagram</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select class="editable-field" id="postouInsta">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Selecione...</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Sim">Sim</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Nรฃo">Nรฃo</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย <div class="row mt-3">
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="editable-label">Avaliaรงรฃo Google</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <select class="editable-field" id="avaliacaoGoogle">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="">Selecione...</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Sim">Sim</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย <option value="Nรฃo">Nรฃo</option>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย </select>
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย ย ย <div class="col-md-6">
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <label class="editable-label">SAC</label>
ย ย ย ย ย ย ย ย ย ย ย ย ย ย <input type="text" class="editable-field" id="sacPosVenda"ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ย ยplaceholder="Nรบmero do SAC">
ย ย ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย <div class="info-section">
ย ย ย ย ย ย ย ย ย ย <div class="info-title">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-check-circle"></i> Status da Conferรชncia
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย ${clientePrincipal.conferido ?ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย '<span class="badge bg-success">Conferรชncia Concluรญda</span>' :ย
ย ย ย ย ย ย ย ย ย ย ย ย ย ย '<span class="badge bg-warning">Aguardando Conferรชncia</span>'
ย ย ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย ย ยย
ย ย ย ย ย ย // Atualizar botรตes do modal baseado no status
ย ย ย ย ย ย const btnMarcarConferido = document.getElementById('btnMarcarConferido');
ย ย ย ย ย ยย
ย ย ย ย ย ย if (btnMarcarConferido) {
ย ย ย ย ย ย ย ย if (clientePrincipal.conferido) {
ย ย ย ย ย ย ย ย ย ย btnMarcarConferido.innerHTML = '<i class="fas fa-undo"></i> Desfazer Conferรชncia';
ย ย ย ย ย ย ย ย ย ย btnMarcarConferido.className = 'btn btn-warning';
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย btnMarcarConferido.innerHTML = '<i class="fas fa-check"></i> Marcar como Conferido';
ย ย ย ย ย ย ย ย ย ย btnMarcarConferido.className = 'btn btn-success';
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย const modal = new bootstrap.Modal(document.getElementById('modalDetalhes'));
ย ย ย ย ย ย modal.show();
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // ================================================================================
ย ย ย ย // ๐๏ธ FUNรรES DO MODAL v8.05
ย ย ย ย // ================================================================================
ย ย ย ยย
async function marcarComoConferido() {
ย ย console.log('๐ฏ marcarComoConferido() iniciada');
ย ยย
ย ย if (embarquesRelacionados.length === 0) {
ย ย ย ย console.log('โ Nenhum embarque relacionado encontrado');
ย ย ย ย return;
ย ย }
ย ยย
ย ย const clientePrincipal = embarquesRelacionados[0];
ย ย const novoStatus = !clientePrincipal.conferido;
ย ยย
ย ย console.log('๐ Estado atual:', {
ย ย ย ย cliente: clientePrincipal.nomeCliente,
ย ย ย ย cpf: clientePrincipal.cpfCliente,
ย ย ย ย recibo: clientePrincipal.recibo,
ย ย ย ย numeroInforme: clientePrincipal.numeroInforme,
ย ย ย ย conferidoAtual: clientePrincipal.conferido,
ย ย ย ย novoStatus: novoStatus
ย ย });
ย ยย
ย ย const confirmMessage = novoStatus ?ย
ย ย ย ย `Marcar conferรชncia de ${clientePrincipal.nomeCliente} como concluรญda?` :
ย ย ย ย `Desfazer conferรชncia de ${clientePrincipal.nomeCliente}?`;
ย ยย
ย ย if (!confirm(confirmMessage)) {
ย ย ย ย console.log('โ Usuรกrio cancelou a operaรงรฃo');
ย ย ย ย return;
ย ย }
ย ยย
ย ย const btnMarcarConferido = document.getElementById('btnMarcarConferido');
ย ย const originalText = btnMarcarConferido.innerHTML;
ย ยย
ย ย try {
ย ย ย ย btnMarcarConferido.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
ย ย ย ย btnMarcarConferido.disabled = true;
ย ย ย ยย
ย ย ย ย console.log('๐ Iniciando chamada da API...');
ย ย ย ยย
ย ย ย ย // IMPORTANTE: Atualizar a planilha PRIMEIRO
ย ย ย ย if (novoStatus) {
ย ย ย ย ย ย console.log('๐ก Chamando API marcar_conferencia...');
ย ย ย ย ย ยย
ย ย ย ย ย ย const payloadAPI = {
ย ย ย ย ย ย ย ย cpf: clientePrincipal.cpfCliente,
ย ย ย ย ย ย ย ย recibo: clientePrincipal.recibo,
ย ย ย ย ย ย ย ย numeroInforme: clientePrincipal.numeroInforme
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย console.log('๐ค Payload enviado:', payloadAPI);
ย ย ย ย ย ยย
ย ย ย ย ย ย const resultado = await chamarAPI('marcar_conferencia', payloadAPI);
ย ย ย ย ย ยย
ย ย ย ย ย ย console.log('๐ฅ Resposta da API:', resultado);
ย ย ย ย ย ยย
ย ย ย ย ย ย if (!resultado.success) {
ย ย ย ย ย ย ย ย console.error('โ API retornou erro:', resultado.message);
ย ย ย ย ย ย ย ย throw new Error(resultado.message || 'Erro ao atualizar planilha');
ย ย ย ย ย ย }
ย ย ย ย ย ยย
ย ย ย ย ย ย console.log('โ API executada com sucesso:', resultado);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย // Depois atualizar localmente
ย ย ย ย console.log('๐ Atualizando dados localmente...');
ย ย ย ย embarquesRelacionados.forEach(embarque => {
ย ย ย ย ย ย if (embarque && typeof embarque === 'object') {
ย ย ย ย ย ย ย ย embarque.conferido = novoStatus;
ย ย ย ย ย ย ย ย embarque.dataConferencia = novoStatus ? new Date().toLocaleString('pt-BR') : '';
ย ย ย ย ย ย ย ย embarque.responsavelConferencia = novoStatus ? 'Dashboard v8.05' : '';
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Atualizar nos dados principais
ย ย ย ย ย ย ย ย const embarqueOriginal = embarquesData.find(e => e.id === embarque.id);
ย ย ย ย ย ย ย ย if (embarqueOriginal) {
ย ย ย ย ย ย ย ย ย ย embarqueOriginal.conferido = novoStatus;
ย ย ย ย ย ย ย ย ย ย embarqueOriginal.dataConferencia = embarque.dataConferencia;
ย ย ย ย ย ย ย ย ย ย embarqueOriginal.responsavelConferencia = embarque.responsavelConferencia;
ย ย ย ย ย ย ย ย ย ย console.log('๐ Embarque atualizado localmente:', embarqueOriginal.id);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Salvar no localStorage como backup
ย ย ย ย ย ย ย ย if (novoStatus) {
ย ย ย ย ย ย ย ย ย ย localStorage.setItem(`conferencia_${embarque.id}`, 'true');
ย ย ย ย ย ย ย ย ย ย console.log('๐พ Salvo no localStorage:', `conferencia_${embarque.id}`);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย localStorage.removeItem(`conferencia_${embarque.id}`);
ย ย ย ย ย ย ย ย ย ย console.log('๐๏ธ Removido do localStorage:', `conferencia_${embarque.id}`);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย }
ย ย ย ย });
ย ย ย ยย
ย ย ย ย // Atualizar interface
ย ย ย ย console.log('๐ฅ๏ธ Atualizando interface...');
ย ย ย ย atualizarEstatisticas(embarquesData);
ย ย ย ย renderizarEmbarques();
ย ย ย ยย
ย ย ย ย const modal = bootstrap.Modal.getInstance(document.getElementById('modalDetalhes'));
ย ย ย ย modal.hide();
ย ย ย ยย
ย ย ย ย const statusText = novoStatus ? 'concluรญda' : 'desfeita';
ย ย ย ย mostrarNotificacao(`โ Conferรชncia ${statusText} e salva na planilha com sucesso!`, 'success');
ย ย ย ยย
ย ย ย ย console.log('โ Operaรงรฃo concluรญda com sucesso');
ย ย ย ยย
ย ย ย ย // Recarregar dados apรณs 2 segundos para garantir sincronizaรงรฃo
ย ย ย ย setTimeout(() => {
ย ย ย ย ย ย console.log('๐ Recarregando dados para sincronizaรงรฃo...');
ย ย ย ย ย ย carregarEmbarques();
ย ย ย ย }, 2000);
ย ย ย ยย
ย ย } catch (error) {
ย ย ย ย console.error('โ Erro completo:', {
ย ย ย ย ย ย message: error.message,
ย ย ย ย ย ย stack: error.stack,
ย ย ย ย ย ย error: error
ย ย ย ย });
ย ย ย ยย
ย ย ย ย mostrarNotificacao('โ Erro ao salvar conferรชncia: ' + error.message, 'error');
ย ย ย ยย
ย ย ย ย // Reverter alteraรงรตes locais em caso de erro
ย ย ย ย embarquesRelacionados.forEach(embarque => {
ย ย ย ย ย ย if (embarque) {
ย ย ย ย ย ย ย ย embarque.conferido = !novoStatus;
ย ย ย ย ย ย ย ย localStorage.removeItem(`conferencia_${embarque.id}`);
ย ย ย ย ย ย ย ย console.log('๐ Revertido embarque:', embarque.id);
ย ย ย ย ย ย }
ย ย ย ย });
ย ย } finally {
ย ย ย ย btnMarcarConferido.innerHTML = originalText;
ย ย ย ย btnMarcarConferido.disabled = false;
ย ย ย ย console.log('๐ Funรงรฃo marcarComoConferido() finalizada');
ย ย }
}
ย ย ย ยย
ย ย ย ย async function salvarAlteracoes() {
ย ย ย ย ย ย if (embarquesRelacionados.length === 0) return;
ย ย ย ย ย ยย
ย ย ย ย ย ย const clientePrincipal = embarquesRelacionados[0];
ย ย ย ย ย ยย
ย ย ย ย ย ย // Coletar dados editรกveis
ย ย ย ย ย ย const dadosEditaveis = {
ย ย ย ย ย ย ย ย observacoes: document.getElementById('observacoesEditaveis').value,
ย ย ย ย ย ย ย ย grupoOfertas: document.getElementById('grupoOfertas').value,
ย ย ย ย ย ย ย ย postouInsta: document.getElementById('postouInsta').value,
ย ย ย ย ย ย ย ย avaliacaoGoogle: document.getElementById('avaliacaoGoogle').value,
ย ย ย ย ย ย ย ย sac: document.getElementById('sacPosVenda').value
ย ย ย ย ย ย };
ย ย ย ย ย ยย
ย ย ย ย ย ย const btnSalvar = document.getElementById('btnSalvarAlteracoes');
ย ย ย ย ย ย const originalText = btnSalvar.innerHTML;
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย btnSalvar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
ย ย ย ย ย ย ย ย btnSalvar.disabled = true;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Salvar localmente
ย ย ย ย ย ย ย ย embarquesRelacionados.forEach(embarque => {
ย ย ย ย ย ย ย ย ย ย if (embarque && typeof embarque === 'object') {
ย ย ย ย ย ย ย ย ย ย ย ย Object.assign(embarque, dadosEditaveis);
ย ย ย ย ย ย ย ย ย ย ย ย localStorage.setItem(`embarque_${embarque.id}`, JSON.stringify(embarque));
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย // Tentar sincronizar com a API
ย ย ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย ย ย await chamarAPI('marcar_pos_venda', {
ย ย ย ย ย ย ย ย ย ย ย ย cpf: clientePrincipal.cpfCliente,
ย ย ย ย ย ย ย ย ย ย ย ย recibo: clientePrincipal.recibo,
ย ย ย ย ย ย ย ย ย ย ย ย numeroInforme: clientePrincipal.numeroInforme,
ย ย ย ย ย ย ย ย ย ย ย ย dadosEditaveis: dadosEditaveis
ย ย ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ย } catch (apiError) {
ย ย ย ย ย ย ย ย ย ย console.warn('Erro na sincronizaรงรฃo com API:', apiError);
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย mostrarNotificacao('Alteraรงรตes salvas com sucesso!', 'success');
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error('Erro ao salvar:', error);
ย ย ย ย ย ย ย ย mostrarNotificacao('Erro ao salvar: ' + error.message, 'error');
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย btnSalvar.innerHTML = originalText;
ย ย ย ย ย ย ย ย btnSalvar.disabled = false;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย async function buscarOrbiunsCliente() {
ย ย ย ย ย ย if (embarquesRelacionados.length === 0) return;
ย ย ย ย ย ยย
ย ย ย ย ย ย const clientePrincipal = embarquesRelacionados[0];
ย ย ย ย ย ย const btnBuscar = document.getElementById('btnBuscarOrbiuns');
ย ย ย ย ย ยย
ย ย ย ย ย ย btnBuscar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Buscando...';
ย ย ย ย ย ย btnBuscar.disabled = true;
ย ย ย ย ย ยย
ย ย ย ย ย ย try {
ย ย ย ย ย ย ย ย const result = await chamarAPI('buscar_orbiuns', {
ย ย ย ย ย ย ย ย ย ย cpf: clientePrincipal.cpfCliente
ย ย ย ย ย ย ย ย });
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (result.success && result.data.orbiuns.length > 0) {
ย ย ย ย ย ย ย ย ย ย mostrarOrbiunsEncontrados(result.data.orbiuns);
ย ย ย ย ย ย ย ย } else {
ย ย ย ย ย ย ย ย ย ย mostrarNotificacao('Nenhum Orbium encontrado para este cliente.', 'warning');
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย } catch (error) {
ย ย ย ย ย ย ย ย console.error('Erro ao buscar Orbiuns:', error);
ย ย ย ย ย ย ย ย mostrarNotificacao('Erro ao buscar Orbiuns: ' + error.message, 'error');
ย ย ย ย ย ย } finally {
ย ย ย ย ย ย ย ย btnBuscar.innerHTML = '<i class="fas fa-search"></i> Buscar Orbiuns';
ย ย ย ย ย ย ย ย btnBuscar.disabled = false;
ย ย ย ย ย ย }
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function mostrarOrbiunsEncontrados(orbiuns) {
ย ย ย ย ย ย const orbiunsHtml = orbiuns.map(orbium => `
ย ย ย ย ย ย ย ย <div class="info-item">
ย ย ย ย ย ย ย ย ย ย <div class="info-label">Orbium ${orbium.orbium}</div>
ย ย ย ย ย ย ย ย ย ย <div class="info-value">
ย ย ย ย ย ย ย ย ย ย ย ย Status: ${orbium.status}<br>
ย ย ย ย ย ย ย ย ย ย ย ย Vendedor: ${orbium.vendedor}<br>
ย ย ย ย ย ย ย ย ย ย ย ย ${orbium.observacoes ? 'Obs: ' + orbium.observacoes : ''}
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `).join('');
ย ย ย ย ย ยย
ย ย ย ย ย ย const modalBody = document.getElementById('modalBody');
ย ย ย ย ย ย modalBody.innerHTML += `
ย ย ย ย ย ย ย ย <div class="info-section">
ย ย ย ย ย ย ย ย ย ย <div class="info-title">
ย ย ย ย ย ย ย ย ย ย ย ย <i class="fas fa-clipboard-list"></i> Orbiuns Relacionados
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย ย ย <div class="info-grid">
ย ย ย ย ย ย ย ย ย ย ย ย ${orbiunsHtml}
ย ย ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย ย ย </div>
ย ย ย ย ย ย `;
ย ย ย ย }

ย ย ย ย // ================================================================================
ย ย ย ย // ๐ SISTEMA DE FILTROS v8.05
ย ย ย ย // ================================================================================
ย ย ย ยย
ย ย ย ย function aplicarFiltros() {
ย ย ย ย ย ย const filtroVendedor = document.getElementById('filtroVendedor').value;
ย ย ย ย ย ย const filtroStatus = document.getElementById('filtroStatus').value;
ย ย ย ย ย ย const filtroClienteAle = document.getElementById('filtroClienteAle').value;
ย ย ย ย ย ย const filtroCPF = document.getElementById('filtroCPF').value.replace(/\D/g, '');
ย ย ย ย ย ย const filtroWhatsApp = document.getElementById('filtroWhatsApp').value.replace(/\D/g, '');
ย ย ย ย ย ย const filtroRecibo = document.getElementById('filtroRecibo').value;
ย ย ย ย ย ย const filtroReserva = document.getElementById('filtroReserva').value;
ย ย ย ย ย ย const filtroLocGds = document.getElementById('filtroLocGds').value;
ย ย ย ย ย ย const filtroLocCia = document.getElementById('filtroLocCia').value;
ย ย ย ย ย ย const filtroDataInicio = document.getElementById('filtroDataInicio').value;
ย ย ย ย ย ย const filtroDataCheckin = document.getElementById('filtroDataCheckin').value;
ย ย ย ย ย ยย
ย ย ย ย ย ย // CORREรรO v8.05: Filtrar embarques vรกlidos antes de aplicar filtros
ย ย ย ย ย ย embarquesFiltrados = embarquesData.filter(embarque => {
ย ย ย ย ย ย ย ย if (!embarque || typeof embarque !== 'object') return false;
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroVendedor && !embarque.vendedor.includes(filtroVendedor)) {
ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroStatus) {
ย ย ย ย ย ย ย ย ย ย if (filtroStatus === 'conferido' && !embarque.conferido) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย } else if (filtroStatus !== 'conferido' && (embarque.categoria !== filtroStatus || embarque.conferido)) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroClienteAle && embarque.clienteAle !== filtroClienteAle) {
ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroCPF) {
ย ย ย ย ย ย ย ย ย ย const cpfEmbarque = embarque.cpfCliente ? embarque.cpfCliente.replace(/\D/g, '') : '';
ย ย ย ย ย ย ย ย ย ย if (!cpfEmbarque.includes(filtroCPF)) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroWhatsApp) {
ย ย ย ย ย ย ย ย ย ย const whatsappEmbarque = embarque.whatsappCliente ? embarque.whatsappCliente.replace(/\D/g, '') : '';
ย ย ย ย ย ย ย ย ย ย if (!whatsappEmbarque.includes(filtroWhatsApp)) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroRecibo) {
ย ย ย ย ย ย ย ย ย ย const reciboEmbarque = embarque.recibo ? embarque.recibo.toString() : '';
ย ย ย ย ย ย ย ย ย ย if (!reciboEmbarque.toLowerCase().includes(filtroRecibo.toLowerCase())) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroReserva) {
ย ย ย ย ย ย ย ย ย ย const reservaEmbarque = embarque.reserva ? embarque.reserva.toString() : '';
ย ย ย ย ย ย ย ย ย ย if (!reservaEmbarque.toLowerCase().includes(filtroReserva.toLowerCase())) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroLocGds) {
ย ย ย ย ย ย ย ย ย ย const locGdsEmbarque = embarque.locGds ? embarque.locGds.toString() : '';
ย ย ย ย ย ย ย ย ย ย if (!locGdsEmbarque.toLowerCase().includes(filtroLocGds.toLowerCase())) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroLocCia) {
ย ย ย ย ย ย ย ย ย ย const locCiaEmbarque = embarque.locCia ? embarque.locCia.toString() : '';
ย ย ย ย ย ย ย ย ย ย if (!locCiaEmbarque.toLowerCase().includes(filtroLocCia.toLowerCase())) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroDataInicio) {
ย ย ย ย ย ย ย ย ย ย const dataInicio = new Date(filtroDataInicio);
ย ย ย ย ย ย ย ย ย ย const dataEmbarque = parseData(embarque.dataIda);
ย ย ย ย ย ย ย ย ย ย if (!dataEmbarque || dataEmbarque.toDateString() !== dataInicio.toDateString()) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย if (filtroDataCheckin) {
ย ย ย ย ย ย ย ย ย ย const dataCheckin = new Date(filtroDataCheckin);
ย ย ย ย ย ย ย ย ย ย const dataEmbarque = parseData(embarque.dataIda);
ย ย ย ย ย ย ย ย ย ย if (!dataEmbarque) return false;
ย ย ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย ย ย const diffTime = dataEmbarque.getTime() - dataCheckin.getTime();
ย ย ย ย ย ย ย ย ย ย const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
ย ย ย ย ย ย ย ย ย ย if (diffDays !== 3) {
ย ย ย ย ย ย ย ย ย ย ย ย return false;
ย ย ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ย }
ย ย ย ย ย ย ย ยย
ย ย ย ย ย ย ย ย return true;
ย ย ย ย ย ย });
ย ย ย ย ย ยย
ย ย ย ย ย ย atualizarEstatisticas(embarquesFiltrados);
ย ย ย ย ย ย renderizarEmbarques();
ย ย ย ย ย ยย
ย ย ย ย ย ย console.log(`๐ Filtros aplicados: ${embarquesFiltrados.length} embarques`);
ย ย ย ย }
ย ย ย ยย
ย ย ย ย function limparFiltros() {
ย ย ย ย ย ย document.getElementById('filtroVendedor').value = '';
ย ย ย ย ย ย document.getElementById('filtroStatus').value = '';
ย ย ย ย ย ย document.getElementById('filtroClienteAle').value = '';
ย ย ย ย ย ย document.getElementById('filtroCPF').value = '';
ย ย ย ย ย ย document.getElementById('filtroWhatsApp').value = '';
ย ย ย ย ย ย document.getElementById('filtroRecibo').value = '';
ย ย ย ย ย ย document.getElementById('filtroReserva').value = '';
ย ย ย ย ย ย document.getElementById('filtroLocGds').value = '';
ย ย ย ย ย ย document.getElementById('filtroLocCia').value = '';
ย ย ย ย ย ย document.getElementById('filtroDataInicio').value = '';
ย ย ย ย ย ย document.getElementById('filtroDataCheckin').value = '';
ย ย ย ย ย ยย
ย ย ย ย ย ย // CORREรรO v8.05: Filtrar embarques vรกlidos
ย ย ย ย ย ย embarquesFiltrados = embarquesData.filter(e => e && typeof e === 'object');
ย ย ย ย ย ย atualizarEstatisticas(embarquesFiltrados);
ย ย ย ย ย ย renderizarEmbarques();
ย ย ย ย ย ยย
ย ย ย ย ย ย console.log('๐งน Todos os filtros limpos');
ย ย ย ย }
