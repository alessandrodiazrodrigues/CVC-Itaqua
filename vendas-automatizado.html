<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC Itaquá - Portal de Gestão da Loja - Sistema Completo de Vendas</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="CVC Itaquá - Sistema Completo de Vendas - Upload PDF + Completar Dados">
    <meta name="keywords" content="CVC, Itaquaquecetuba, vendas, automatizado, embarques, recibos, pdf">
    <meta name="author" content="CVC Itaquaquecetuba">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/cvc-styles.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/cvc-favicon.ico">
    
    <style>
        /* ===== ESTILOS ESPECÍFICOS DO SISTEMA COMPLETO v11.0 ===== */
        
        :root {
            --cvc-amarelo: #FFE600;
            --cvc-azul: #0A00B4;
            --cvc-branco: #FFFFFF;
            --cvc-verde: #00D4AA;
            --cvc-azul-escuro: #1B365D;
            --cvc-cinza: #6C757D;
            --cvc-fundo-card: #f8f9fa;
            --cvc-sombra-suave: 0 4px 6px rgba(0,0,0,0.1);
            --cvc-sombra-media: 0 8px 15px rgba(0,0,0,0.2);
        }
        
        .vendas-completo-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Dashboard Status */
        .status-dashboard {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-azul-escuro));
            border-radius: 20px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }

        .status-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 230, 0, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--cvc-amarelo);
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            counter-reset: count;
            animation: countUp 2s ease-out;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 500;
        }

        /* Loading e Error */
        .loading-container {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-amarelo));
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            color: white;
            margin: 50px 0;
            animation: pulse 2s infinite;
        }

        .error-container {
            background: linear-gradient(135deg, #dc3545, #ff6b6b);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            color: white;
            margin: 50px 0;
        }

        /* Filtros Section */
        .filtros-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-amarelo);
            animation: slideInLeft 0.8s ease-out;
        }

        .filtros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .filtro-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--cvc-sombra-suave);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .filtro-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            transition: left 0.6s;
        }

        .filtro-card:hover::before {
            left: 100%;
        }

        .filtro-card.active {
            border-color: var(--cvc-azul);
            background: linear-gradient(135deg, rgba(10, 0, 180, 0.05), rgba(255, 230, 0, 0.05));
            transform: scale(1.02);
        }

        .filtro-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }

        .filtro-titulo {
            font-weight: 700;
            color: var(--cvc-azul);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filtro-desc {
            font-size: 0.9rem;
            color: var(--cvc-cinza);
            margin-bottom: 15px;
        }

        .filtro-count {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--cvc-azul);
            animation: countUp 1.5s ease-out;
        }

        /* Seção de Vendedores */
        .vendedores-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-verde);
            animation: fadeIn 1s ease-out;
        }

        .vendedor-card {
            background: var(--cvc-branco);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--cvc-sombra-suave);
            margin-bottom: 20px;
            border-left: 5px solid var(--cvc-azul);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: slideInUp 0.6s ease-out;
        }

        .vendedor-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }

        .vendedor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .vendedor-nome {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--cvc-azul);
        }

        .vendedor-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .vendedor-status.pendente {
            background: #ffc107;
            color: #000;
        }

        .vendedor-status.ativo {
            background: #28a745;
            color: white;
        }

        .vendedor-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .vendedor-stat {
            text-align: center;
            min-width: 80px;
        }

        .vendedor-stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--cvc-azul);
            line-height: 1;
        }

        .vendedor-stat-label {
            font-size: 0.8rem;
            color: var(--cvc-cinza);
            margin-top: 2px;
        }

        /* Container de Recibos */
        .recibos-container {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            animation: fadeIn 1.2s ease-out;
        }

        .recibo-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
            transition: all 0.3s ease;
            animation: slideInUp 0.5s ease-out;
        }

        .recibo-card:hover {
            transform: translateX(5px);
            box-shadow: var(--cvc-sombra-media);
        }

        .recibo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .recibo-numero {
            font-weight: 700;
            color: var(--cvc-azul);
            font-size: 1.1rem;
        }

        .recibo-urgencia {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .recibo-urgencia.urgente {
            background: #dc3545;
            color: white;
        }

        .recibo-urgencia.normal {
            background: #28a745;
            color: white;
        }

        .recibo-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .recibo-campo {
            font-size: 0.9rem;
        }

        .recibo-label {
            font-weight: 600;
            color: var(--cvc-cinza);
        }

        .recibo-valor {
            color: var(--cvc-azul);
            font-weight: 500;
        }

        .recibo-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Modal de Complementação */
        .modal-complementar {
            backdrop-filter: blur(5px);
        }

        .modal-complementar .modal-dialog {
            max-width: 90%;
            width: 1200px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .step {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-radius: 25px;
            background: #f8f9fa;
            font-weight: 600;
            color: var(--cvc-cinza);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .step.active {
            background: var(--cvc-azul);
            color: white;
            border-color: var(--cvc-amarelo);
        }

        .step.completed {
            background: var(--cvc-verde);
            color: white;
        }

        .step i {
            margin-right: 8px;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--cvc-azul);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: var(--cvc-fundo-card);
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 20px 0;
        }

        .upload-area.dragover {
            border-color: var(--cvc-amarelo);
            background: rgba(255, 230, 0, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--cvc-azul);
            margin-bottom: 15px;
        }

        .upload-progress {
            margin-top: 20px;
        }

        /* Dados Extraídos */
        .dados-extraidos {
            background: var(--cvc-fundo-card);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--cvc-verde);
        }

        .dado-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .dado-item:last-child {
            border-bottom: none;
        }

        .dado-label {
            font-weight: 600;
            color: var(--cvc-azul);
        }

        .dado-valor {
            color: var(--cvc-cinza);
        }

        /* Formulário */
        .form-section {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
        }

        .form-section h5 {
            color: var(--cvc-azul);
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--cvc-azul);
            box-shadow: 0 0 0 3px rgba(10, 0, 180, 0.1);
        }

        .required-field {
            border-left: 3px solid #dc3545;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }

        .toast-notification {
            background: var(--cvc-branco);
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: var(--cvc-sombra-media);
            border-left: 4px solid var(--cvc-azul);
            min-width: 300px;
            animation: slideInRight 0.5s ease-out;
        }

        .toast-success {
            border-left-color: #28a745;
        }

        .toast-error {
            border-left-color: #dc3545;
        }

        .toast-warning {
            border-left-color: #ffc107;
        }

        /* Animações */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInRight {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes countUp {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .vendas-completo-container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .stat-number {
                font-size: 2rem;
            }

            .filtros-grid {
                grid-template-columns: 1fr;
            }

            .vendedor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .vendedor-stats {
                justify-content: space-around;
                width: 100%;
            }

            .recibo-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .recibo-info {
                grid-template-columns: 1fr;
            }

            .modal-complementar .modal-dialog {
                max-width: 95%;
                margin: 10px;
            }

            .step-indicator {
                flex-direction: column;
                gap: 10px;
            }

            .recibo-actions {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-number {
                font-size: 1.8rem;
            }

            .toast-notification {
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER CVC PADRÃO -->
    <header class="cvc-header">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <!-- Logo CVC -->
                <div class="col-md-4">
                    <div class="cvc-logo">
                        <div class="cvc-logo-symbol">CVC</div>
                        <div>
                            <div class="cvc-logo-text">CVC Itaquá</div>
                            <p class="cvc-subtitle">Portal de Gestão da Loja</p>
                        </div>
                    </div>
                </div>
                
                <!-- Título da Página -->
                <div class="col-md-4 text-center">
                    <h1 class="page-title mb-0" style="border: none; padding: 0; color: var(--cvc-branco); font-size: 1.8rem;">
                        <i class="fas fa-robot"></i> Sistema Completo
                    </h1>
                </div>
                
                <!-- Voltar ao Dashboard -->
                <div class="col-md-4 text-end">
                    <a href="index.html" class="btn btn-cvc-outline">
                        <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- NAVEGAÇÃO CVC PADRÃO -->
    <nav class="cvc-nav">
        <div class="container-fluid">
            <ul class="nav nav-pills justify-content-center mb-0">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="orcamentos.html">
                        <i class="fas fa-calculator"></i> Padronizador de Orçamentos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas.html">
                        <i class="fas fa-chart-line"></i> Informe de Vendas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas-automatizado.html">
                        <i class="fas fa-robot"></i> Informe Automatizado
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="vendas-automatizado-COMPLETO.html">
                        <i class="fas fa-upload"></i> Sistema Completo
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="embarques.html">
                        <i class="fas fa-plane-departure"></i> Controle de Embarques
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- CONTAINER PRINCIPAL -->
    <div class="vendas-completo-container">
        
        <!-- LOADING CONTAINER -->
        <div class="loading-container" id="loadingContainer">
            <div class="text-center">
                <div class="spinner-border text-white mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Carregando...</span>
                </div>
                <h3><i class="fas fa-robot"></i> CVC Portal Itaquá - Sistema Completo</h3>
                <p class="mb-0">Carregando vendas pendentes de complementação...</p>
                <div class="mt-3">
                    <small>✨ Sistema v11.0 - Upload PDF + Completar Dados</small>
                </div>
            </div>
        </div>

        <!-- ERROR CONTAINER -->
        <div class="error-container" id="errorContainer" style="display:none;">
            <div class="text-center">
                <div class="error-icon mb-3">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
                </div>
                <h3>Erro no Sistema</h3>
                <p id="errorMessage">Não foi possível conectar com a planilha</p>
                <button class="btn btn-light btn-lg" onclick="carregarDadosInicial()">
                    <i class="fas fa-redo"></i> Tentar Novamente
                </button>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div id="mainContent" style="display:none;">
            
            <!-- DASHBOARD STATUS -->
            <div class="status-dashboard" id="statusDashboard">
                <div class="text-center">
                    <h2><i class="fas fa-upload"></i> Sistema Completo de Vendas</h2>
                    <p class="mb-0">Upload de PDF + Completar dados pendentes de vendas importadas</p>
                    <small id="ultimaAtualizacao">Última atualização: Aguardando dados...</small>
                </div>
                
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-number" id="statTotal">0</div>
                        <div class="stat-label">Total de Vendas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statPendentes">0</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statCompletas">0</div>
                        <div class="stat-label">Completas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statVendedores">0</div>
                        <div class="stat-label">Vendedores</div>
                    </div>
                </div>
            </div>

            <!-- FILTROS INTELIGENTES -->
            <section class="filtros-section" id="filtrosSection">
                <h2><i class="fas fa-filter"></i> Filtros Inteligentes</h2>
                <p class="text-muted mb-3">Filtre as vendas por status ou busque por vendedor/recibo</p>
                
                <div class="search-container mb-4">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" id="searchInput" 
                               placeholder="Buscar por vendedor, recibo ou cliente...">
                    </div>
                </div>
                
                <div class="filtros-grid">
                    <div class="filtro-card active" data-filtro="todos" onclick="aplicarFiltro('todos')">
                        <div class="filtro-titulo">
                            <i class="fas fa-list"></i> Todas as Vendas
                        </div>
                        <div class="filtro-desc">Visualizar todas as vendas importadas</div>
                        <div class="filtro-count" id="filtroTodos">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="pendentes" onclick="aplicarFiltro('pendentes')">
                        <div class="filtro-titulo">
                            <i class="fas fa-clock"></i> Pendentes
                        </div>
                        <div class="filtro-desc">Vendas que precisam ser completadas</div>
                        <div class="filtro-count" id="filtroPendentes">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="completas" onclick="aplicarFiltro('completas')">
                        <div class="filtro-titulo">
                            <i class="fas fa-check-circle"></i> Completas
                        </div>
                        <div class="filtro-desc">Vendas já finalizadas</div>
                        <div class="filtro-count" id="filtroCompletas">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="urgentes" onclick="aplicarFiltro('urgentes')">
                        <div class="filtro-titulo">
                            <i class="fas fa-exclamation-triangle"></i> Urgentes
                        </div>
                        <div class="filtro-desc">Embarques próximos (≤3 dias)</div>
                        <div class="filtro-count" id="filtroUrgentes">0</div>
                    </div>
                </div>
            </section>

            <!-- SEÇÃO DE VENDEDORES -->
            <section class="vendedores-section" id="vendedoresSection">
                <h2><i class="fas fa-users"></i> Vendedores com Vendas Pendentes</h2>
                <p class="text-muted mb-3">Clique em um vendedor para ver suas vendas que precisam ser completadas</p>
                <div id="vendedoresList">
                    <!-- Vendedores serão inseridos aqui -->
                </div>
            </section>

            <!-- CONTAINER DE RECIBOS -->
            <div class="recibos-container" id="recibosContainer">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2><i class="fas fa-receipt"></i> Vendas para Completar</h2>
                    <div>
                        <button class="btn btn-outline-secondary btn-sm" onclick="voltarVendedores()" id="btnVoltar" style="display:none;">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="atualizarDados()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                </div>
                <div id="recibosList">
                    <!-- Recibos serão inseridos aqui -->
                </div>
            </div>

        </div>

    </div>

    <!-- MODAL DE COMPLEMENTAÇÃO DE DADOS -->
    <div class="modal fade modal-complementar" id="modalComplementar" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-upload"></i> Completar Dados da Venda
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    
                    <!-- Indicador de Passos -->
                    <div class="step-indicator">
                        <div class="step active" id="step1Indicator">
                            <i class="fas fa-info-circle"></i> Dados Básicos
                        </div>
                        <div class="step" id="step2Indicator">
                            <i class="fas fa-upload"></i> Upload PDF
                        </div>
                        <div class="step" id="step3Indicator">
                            <i class="fas fa-edit"></i> Completar
                        </div>
                        <div class="step" id="step4Indicator">
                            <i class="fas fa-check"></i> Finalizar
                        </div>
                    </div>
                    
                    <!-- PASSO 1: Dados Básicos -->
                    <div id="step1" class="step-content">
                        <h5><i class="fas fa-info-circle"></i> Dados Básicos da Venda</h5>
                        <div class="dados-extraidos">
                            <h6>Dados já importados:</h6>
                            <div id="dadosBasicos">
                                <!-- Dados básicos serão inseridos aqui -->
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-primary" onclick="proximoPasso(2)">
                                <i class="fas fa-arrow-right"></i> Fazer Upload do PDF
                            </button>
                        </div>
                    </div>

                    <!-- PASSO 2: Upload do PDF -->
                    <div id="step2" class="step-content" style="display:none;">
                        <h5><i class="fas fa-upload"></i> Upload do PDF da Reserva</h5>
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h5>Arraste o PDF aqui ou clique para selecionar</h5>
                            <p class="text-muted">Formatos aceitos: PDF (máx. 10MB)</p>
                            <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-folder-open"></i> Selecionar Arquivo
                            </button>
                        </div>
                        <div id="uploadProgress" class="upload-progress" style="display: none;">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Processando PDF...</span>
                                    <span id="uploadPercent">0%</span>
                                </div>
                                <div class="progress mt-2">
                                    <div class="progress-bar bg-primary" id="uploadProgressBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-secondary" onclick="voltarPasso(1)">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button class="btn btn-warning" onclick="proximoPasso(3)" id="btnPularUpload">
                                <i class="fas fa-forward"></i> Pular Upload
                            </button>
                        </div>
                    </div>

                    <!-- PASSO 3: Dados Extraídos -->
                    <div id="step3" class="step-content" style="display:none;">
                        <h5><i class="fas fa-check-circle"></i> Dados Extraídos do PDF</h5>
                        <div class="dados-extraidos" id="dadosExtraidos">
                            <h6>Dados encontrados no PDF:</h6>
                            <div id="dadosExtractedList">
                                <!-- Dados extraídos serão inseridos aqui -->
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-secondary" onclick="voltarPasso(2)">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button class="btn btn-success" onclick="proximoPasso(4)">
                                <i class="fas fa-arrow-right"></i> Completar Dados
                            </button>
                        </div>
                    </div>

                    <!-- PASSO 4: Formulário Completo -->
                    <div id="step4" class="step-content" style="display:none;">
                        <h5><i class="fas fa-edit"></i> Completar Dados da Venda</h5>
                        
                        <form id="formCompleto">
                            <!-- Dados do Cliente -->
                            <div class="form-section">
                                <h5><i class="fas fa-user"></i> Dados do Cliente</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Nome Completo *</label>
                                        <input type="text" class="form-control required-field" id="nomeCliente" required>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">CPF *</label>
                                        <input type="text" class="form-control required-field" id="cpfCliente" required maxlength="14">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Data Nascimento</label>
                                        <input type="date" class="form-control" id="dataNascimento">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">WhatsApp *</label>
                                        <input type="tel" class="form-control required-field" id="whatsappCliente" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="emailCliente">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">RG</label>
                                        <input type="text" class="form-control" id="rgCliente">
                                    </div>
                                </div>
                            </div>

                            <!-- Dados da Viagem -->
                            <div class="form-section">
                                <h5><i class="fas fa-plane"></i> Dados da Viagem</h5>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Destino</label>
                                        <input type="text" class="form-control" id="destino">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Data Ida</label>
                                        <input type="date" class="form-control" id="dataIda">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Data Volta</label>
                                        <input type="date" class="form-control" id="dataVolta">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Hotel/Hospedagem</label>
                                        <input type="text" class="form-control" id="hotel">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tipo Produto</label>
                                        <select class="form-select" id="tipoProduto">
                                            <option value="">Selecione...</option>
                                            <option value="AEREO">Aéreo</option>
                                            <option value="TERRESTRE">Terrestre</option>
                                            <option value="CRUZEIRO">Cruzeiro</option>
                                            <option value="HOTEL">Hotel</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Valor Total</label>
                                        <input type="text" class="form-control" id="valorTotal">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Forma Pagamento</label>
                                        <input type="text" class="form-control" id="formaPagamento">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Data Reserva</label>
                                        <input type="date" class="form-control" id="dataReserva">
                                    </div>
                                </div>
                            </div>

                            <!-- Localizadores -->
                            <div class="form-section">
                                <h5><i class="fas fa-barcode"></i> Localizadores e Reservas</h5>
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label">LOC GDS</label>
                                        <input type="text" class="form-control" id="locGds">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">LOC CIA</label>
                                        <input type="text" class="form-control" id="locCia">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Reserva Online</label>
                                        <input type="text" class="form-control" id="reservaOnline">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Número Reserva</label>
                                        <input type="text" class="form-control" id="numeroReserva">
                                    </div>
                                </div>
                            </div>

                            <!-- Configurações Específicas -->
                            <div class="form-section">
                                <h5><i class="fas fa-cogs"></i> Configurações</h5>
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label">Cliente Ale *</label>
                                        <select class="form-select required-field" id="clienteAle" required>
                                            <option value="">Selecione...</option>
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tipo Aéreo</label>
                                        <select class="form-select" id="tipoAereo">
                                            <option value="">Selecione...</option>
                                            <option value="OW">Só Ida (OW)</option>
                                            <option value="RT">Ida e Volta (RT)</option>
                                            <option value="HOTEL">Hotel</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tem Bagagem</label>
                                        <select class="form-select" id="temBagagem">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tem Assento</label>
                                        <select class="form-select" id="temAssento">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Observações</label>
                                        <textarea class="form-control" id="observacoes" rows="3" placeholder="Informações adicionais sobre a venda..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-secondary" onclick="voltarPasso(3)">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button class="btn btn-success btn-lg" onclick="salvarVendaCompleta()">
                                <i class="fas fa-save"></i> Salvar Venda Completa
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="config.js"></script>
    
    <script>
        // ================================================================================
        // 🚀 CVC PORTAL ITAQUÁ - SISTEMA COMPLETO DE VENDAS v11.0
        // Funcionalidade: Aproveitar vendas-automatizado + Upload PDF + Completar dados
        // ================================================================================
        
        console.log('🚀 CVC Portal Itaquá - Sistema Completo de Vendas v11.0');
        console.log('✨ Funcionalidades v11.0:');
        console.log('   • Listar vendas pendentes (do vendas-automatizado)');
        console.log('   • Filtro por vendedor específico');
        console.log('   • Upload e processamento de PDF');
        console.log('   • Extração automática de dados');
        console.log('   • Formulário completo para complementação');
        console.log('   • Salvamento na planilha EMBARQUES');
        console.log('   • Interface responsiva e moderna');
        
        // ================================================================================
        // VARIÁVEIS GLOBAIS
        // ================================================================================
        
        let vendasData = [];
        let vendasDataOriginal = [];
        let vendedoresData = {};
        let vendedorSelecionado = null;
        let vendaAtual = null;
        let dadosExtraidos = {};
        let passoAtual = 1;
        let API_URL = null;
        let filtroAtivo = 'todos';
        let termoBusca = '';

        // ================================================================================
        // SISTEMA DE TOAST NOTIFICATIONS
        // ================================================================================
        
        function showToast(message, type = 'info', duration = 4000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas ${icons[type]} me-2"></i>
                    <span>${message}</span>
                    <button class="btn-close btn-close-sm ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, duration);
        }

        // ================================================================================
        // INICIALIZAÇÃO DO SISTEMA
        // ================================================================================
        
        function inicializarSistema() {
            console.log('🚀 Iniciando Sistema Completo de Vendas v11.0...');
            
            // Verificar configuração da API
            if (typeof getApiUrl === 'function') {
                API_URL = getApiUrl();
                console.log(`🌐 API URL: ${API_URL}`);
            } else if (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.API_URL) {
                API_URL = CVC_CONFIG.API_URL;
                console.log(`🌐 API URL via config: ${API_URL}`);
            } else {
                API_URL = 'https://script.google.com/macros/s/AKfycbzqttRJjK4PbznHnEfviHZ9LPOITVm_pc0sswGUNVHpGpio5oCdaB2c68s6fVHuN6LL3w/exec';
                console.log('⚠️ Usando API URL fallback');
            }
            
            if (!API_URL || !API_URL.includes('script.google.com')) {
                console.error('❌ ERRO: API URL inválida!');
                mostrarErro('API URL inválida. Verifique a configuração.');
                return;
            }
            
            console.log('✅ Sistema inicializado com sucesso!');
            
            // Configurar eventos
            configurarEventos();
            
            // Carregar dados iniciais
            carregarDadosInicial();
        }

        // ================================================================================
        // CONFIGURAÇÃO DE EVENTOS
        // ================================================================================
        
        function configurarEventos() {
            // Search input com debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                let debounceTimer;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        termoBusca = e.target.value.toLowerCase();
                        filtrarEExibirVendas();
                    }, 300);
                });
            }

            // Upload de arquivo
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            if (fileInput) {
                fileInput.addEventListener('change', handleFileSelect);
            }
            
            if (uploadArea) {
                // Drag & Drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileSelect({ target: { files } });
                    }
                });
            }

            // Máscara para CPF
            const cpfInput = document.getElementById('cpfCliente');
            if (cpfInput) {
                cpfInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
            }

            console.log('✅ Eventos configurados');
        }

        // ================================================================================
        // CARREGAMENTO DE DADOS VIA JSONP
        // ================================================================================
        
        function carregarDadosInicial() {
            console.log('📊 Carregando vendas pendentes...');
            
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            
            // Simular carregamento - na implementação real, buscar vendas pendentes
            chamarAPIJsonp('listar_vendas_pendentes')
                .then(resultado => {
                    console.log('📡 Resposta recebida');
                    
                    if (resultado.success) {
                        if (resultado.data && resultado.data.vendas) {
                            // Usar dados reais da API
                            vendasDataOriginal = resultado.data.vendas.filter(venda => 
                                venda.status === 'pendente' || !venda.cpfCliente || !venda.whatsappCliente
                            );
                        } else {
                            // Dados simulados para demonstração
                            vendasDataOriginal = criarDadosSimulados();
                        }
                        
                        vendasData = [...vendasDataOriginal];
                        console.log(`✅ ${vendasData.length} vendas pendentes carregadas`);
                        
                        processarDadosVendedores();
                        atualizarDashboard();
                        exibirDados();
                        showToast(`${vendasData.length} vendas carregadas para complementação!`, 'success');
                        
                    } else {
                        throw new Error(resultado.message || 'Erro desconhecido na API');
                    }
                })
                .catch(error => {
                    console.error(`❌ Erro: ${error.message}`);
                    
                    // Usar dados simulados em caso de erro
                    vendasDataOriginal = criarDadosSimulados();
                    vendasData = [...vendasDataOriginal];
                    
                    processarDadosVendedores();
                    atualizarDashboard();
                    exibirDados();
                    showToast('Modo demonstração ativado - usando dados simulados', 'warning');
                });
        }

        function criarDadosSimulados() {
            return [
                {
                    recibo: '6220-0000128069',
                    vendedor: 'Alessandro',
                    status: 'pendente',
                    nomeCliente: '',
                    cpfCliente: '',
                    whatsappCliente: '',
                    dataImportacao: '2025-01-01',
                    dataIda: '2025-12-05',
                    destino: 'Panama City',
                    tipoProduto: 'AEREO',
                    valorTotal: 'R$ 842,77'
                },
                {
                    recibo: '6220-0000128138',
                    vendedor: 'Adrielly',
                    status: 'pendente',
                    nomeCliente: '',
                    cpfCliente: '',
                    whatsappCliente: '',
                    dataImportacao: '2025-01-01',
                    dataIda: '2025-12-08',
                    destino: 'Punta Cana',
                    tipoProduto: 'AEREO',
                    valorTotal: 'R$ 12.603,96'
                },
                {
                    recibo: '6220-0000128226',
                    vendedor: 'Ana Paula',
                    status: 'pendente',
                    nomeCliente: '',
                    cpfCliente: '',
                    whatsappCliente: '',
                    dataImportacao: '2025-01-01',
                    dataIda: '2025-12-15',
                    destino: 'Fortaleza',
                    tipoProduto: 'AEREO',
                    valorTotal: 'R$ 1.250,00'
                }
            ];
        }
        
        function chamarAPIJsonp(action, parametros = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = `vendas_completo_callback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                console.log(`🔗 JSONP: Criando callback ${callbackName}`);
                
                window[callbackName] = function(result) {
                    try {
                        script.remove();
                        delete window[callbackName];
                        
                        console.log(`📡 JSONP: Callback executado: ${result.success ? 'sucesso' : 'erro'}`);
                        resolve(result);
                        
                    } catch (error) {
                        delete window[callbackName];
                        reject(error);
                    }
                };
                
                const script = document.createElement('script');
                const params = new URLSearchParams({
                    callback: callbackName,
                    action: action,
                    ...parametros
                });
                
                const urlCompleta = `${API_URL}?${params.toString()}`;
                script.src = urlCompleta;
                
                console.log(`📡 JSONP: URL criada (${urlCompleta.length} chars)`);
                
                script.onerror = function(event) {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.remove();
                    }
                    
                    console.error('❌ JSONP: Erro ao carregar script');
                    reject(new Error('Erro ao carregar script JSONP. Verifique a configuração da API.'));
                };
                
                document.head.appendChild(script);
                
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script && script.parentNode) {
                            script.remove();
                        }
                        console.error('⏱️ JSONP: Timeout de 30 segundos');
                        reject(new Error('Timeout na requisição JSONP (30s). O servidor não respondeu.'));
                    }
                }, 30000);
            });
        }

        // ================================================================================
        // PROCESSAMENTO DE DADOS
        // ================================================================================
        
        function processarDadosVendedores() {
            vendedoresData = {};
            
            vendasData.forEach(venda => {
                const vendedor = venda.vendedor || 'Não Informado';
                
                if (!vendedoresData[vendedor]) {
                    vendedoresData[vendedor] = {
                        nome: vendedor,
                        totalPendentes: 0,
                        totalCompletas: 0,
                        vendas: []
                    };
                }
                
                if (venda.status === 'pendente' || !venda.cpfCliente || !venda.whatsappCliente) {
                    vendedoresData[vendedor].totalPendentes++;
                } else {
                    vendedoresData[vendedor].totalCompletas++;
                }
                
                vendedoresData[vendedor].vendas.push(venda);
            });
            
            console.log(`📊 Processados ${Object.keys(vendedoresData).length} vendedores`);
        }

        // ================================================================================
        // ATUALIZAÇÃO DA INTERFACE
        // ================================================================================
        
        function atualizarDashboard() {
            const stats = calcularEstatisticas();
            
            // Atualizar stats com animação
            animarContador('statTotal', stats.total);
            animarContador('statPendentes', stats.pendentes);
            animarContador('statCompletas', stats.completas);
            animarContador('statVendedores', stats.vendedores);
            
            // Atualizar contadores dos filtros
            document.getElementById('filtroTodos').textContent = stats.total;
            document.getElementById('filtroPendentes').textContent = stats.pendentes;
            document.getElementById('filtroCompletas').textContent = stats.completas;
            document.getElementById('filtroUrgentes').textContent = stats.urgentes;
            
            // Atualizar última atualização
            document.getElementById('ultimaAtualizacao').textContent = 
                `Última atualização: ${new Date().toLocaleString('pt-BR')}`;
            
            console.log('📊 Dashboard atualizado');
        }
        
        function animarContador(elementId, valorFinal) {
            const elemento = document.getElementById(elementId);
            if (!elemento) return;
            
            const valorInicial = 0;
            const duracao = 1500;
            const inicio = Date.now();
            
            function atualizar() {
                const agora = Date.now();
                const progresso = Math.min((agora - inicio) / duracao, 1);
                
                const easeOut = 1 - Math.pow(1 - progresso, 3);
                const valorAtual = Math.round(valorInicial + (valorFinal - valorInicial) * easeOut);
                
                elemento.textContent = valorAtual.toLocaleString('pt-BR');
                
                if (progresso < 1) {
                    requestAnimationFrame(atualizar);
                }
            }
            
            requestAnimationFrame(atualizar);
        }
        
        function calcularEstatisticas() {
            const total = vendasData.length;
            const pendentes = vendasData.filter(v => 
                v.status === 'pendente' || !v.cpfCliente || !v.whatsappCliente
            ).length;
            const completas = vendasData.filter(v => 
                v.status === 'completa' && v.cpfCliente && v.whatsappCliente
            ).length;
            const vendedores = Object.keys(vendedoresData).length;
            
            // Calcular urgentes (embarques em até 3 dias)
            const hoje = new Date();
            const urgentes = vendasData.filter(v => {
                if (!v.dataIda) return false;
                const dataEmbarque = new Date(v.dataIda);
                const diffTime = dataEmbarque - hoje;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                return diffDays <= 3 && diffDays >= 0;
            }).length;
            
            return { total, pendentes, completas, vendedores, urgentes };
        }

        // ================================================================================
        // EXIBIÇÃO DOS DADOS
        // ================================================================================
        
        function exibirDados() {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            exibirVendedores();
            filtrarEExibirVendas();
            
            console.log('✅ Interface atualizada e dados exibidos');
        }
        
        function exibirVendedores() {
            const vendedoresList = document.getElementById('vendedoresList');
            let html = '';
            
            Object.values(vendedoresData).forEach(vendedor => {
                if (vendedor.totalPendentes === 0) return; // Só mostrar vendedores com pendências
                
                const statusClass = vendedor.totalPendentes > 0 ? 'pendente' : 'ativo';
                
                html += `
                    <div class="vendedor-card" onclick="selecionarVendedor('${vendedor.nome}')">
                        <div class="vendedor-header">
                            <div class="vendedor-nome">
                                <i class="fas fa-user"></i> ${vendedor.nome}
                            </div>
                            <div class="vendedor-status ${statusClass}">
                                ${vendedor.totalPendentes} Pendente(s)
                            </div>
                        </div>
                        <div class="vendedor-stats">
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.totalPendentes}</div>
                                <div class="vendedor-stat-label">Pendentes</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.totalCompletas}</div>
                                <div class="vendedor-stat-label">Completas</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.vendas.length}</div>
                                <div class="vendedor-stat-label">Total</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (html === '') {
                html = `
                    <div class="text-center py-5">
                        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                        <h4>Nenhuma venda pendente!</h4>
                        <p class="text-muted">Todas as vendas foram completadas</p>
                    </div>
                `;
            }
            
            vendedoresList.innerHTML = html;
        }

        function filtrarEExibirVendas() {
            let vendasFiltradas = [...vendasData];
            
            // Aplicar filtro ativo
            switch (filtroAtivo) {
                case 'pendentes':
                    vendasFiltradas = vendasFiltradas.filter(v => 
                        v.status === 'pendente' || !v.cpfCliente || !v.whatsappCliente
                    );
                    break;
                case 'completas':
                    vendasFiltradas = vendasFiltradas.filter(v => 
                        v.status === 'completa' && v.cpfCliente && v.whatsappCliente
                    );
                    break;
                case 'urgentes':
                    const hoje = new Date();
                    vendasFiltradas = vendasFiltradas.filter(v => {
                        if (!v.dataIda) return false;
                        const dataEmbarque = new Date(v.dataIda);
                        const diffTime = dataEmbarque - hoje;
                        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                        return diffDays <= 3 && diffDays >= 0;
                    });
                    break;
            }
            
            // Aplicar busca por texto
            if (termoBusca) {
                vendasFiltradas = vendasFiltradas.filter(venda => 
                    (venda.nomeCliente || '').toLowerCase().includes(termoBusca) ||
                    (venda.recibo || '').toLowerCase().includes(termoBusca) ||
                    (venda.vendedor || '').toLowerCase().includes(termoBusca)
                );
            }
            
            // Filtrar por vendedor selecionado
            if (vendedorSelecionado) {
                vendasFiltradas = vendasFiltradas.filter(v => v.vendedor === vendedorSelecionado);
            }
            
            exibirRecibos(vendasFiltradas);
        }
        
        function exibirRecibos(vendas) {
            const recibosList = document.getElementById('recibosList');
            
            if (vendas.length === 0) {
                recibosList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h4>Nenhuma venda encontrada</h4>
                        <p class="text-muted">Tente ajustar os filtros ou termo de busca</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            vendas.forEach(venda => {
                const isPendente = venda.status === 'pendente' || !venda.cpfCliente || !venda.whatsappCliente;
                const isUrgente = calcularUrgencia(venda.dataIda);
                
                html += `
                    <div class="recibo-card">
                        <div class="recibo-header">
                            <div class="recibo-numero">📄 ${venda.recibo || 'N/A'}</div>
                            <div class="recibo-urgencia ${isUrgente ? 'urgente' : 'normal'}">
                                ${isUrgente ? 'Urgente' : 'Normal'}
                            </div>
                        </div>
                        <div class="recibo-info">
                            <div class="recibo-campo">
                                <span class="recibo-label">Vendedor:</span>
                                <span class="recibo-valor">${venda.vendedor || 'Não informado'}</span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">Cliente:</span>
                                <span class="recibo-valor">${venda.nomeCliente || 'Pendente'}</span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">CPF:</span>
                                <span class="recibo-valor ${!venda.cpfCliente ? 'text-danger' : 'text-success'}">
                                    ${venda.cpfCliente || '❌ Pendente'}
                                </span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">WhatsApp:</span>
                                <span class="recibo-valor ${!venda.whatsappCliente ? 'text-danger' : 'text-success'}">
                                    ${venda.whatsappCliente || '❌ Pendente'}
                                </span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">Embarque:</span>
                                <span class="recibo-valor">${venda.dataIda ? new Date(venda.dataIda).toLocaleDateString('pt-BR') : 'Não informado'}</span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">Destino:</span>
                                <span class="recibo-valor">${venda.destino || 'Não informado'}</span>
                            </div>
                        </div>
                        <div class="recibo-actions">
                            <button class="btn btn-primary btn-sm" onclick="completarDados('${venda.recibo}')">
                                <i class="fas fa-upload"></i> Completar Dados
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="visualizarVenda('${venda.recibo}')">
                                <i class="fas fa-eye"></i> Visualizar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            recibosList.innerHTML = html;
        }

        function calcularUrgencia(dataIda) {
            if (!dataIda) return false;
            const hoje = new Date();
            const dataEmbarque = new Date(dataIda);
            const diffTime = dataEmbarque - hoje;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return diffDays <= 3 && diffDays >= 0;
        }

        // ================================================================================
        // SELEÇÃO DE VENDEDOR
        // ================================================================================
        
        function selecionarVendedor(nomeVendedor) {
            vendedorSelecionado = nomeVendedor;
            
            // Atualizar interface
            document.getElementById('btnVoltar').style.display = 'inline-block';
            
            // Filtrar e exibir
            filtrarEExibirVendas();
            
            showToast(`Exibindo vendas pendentes de ${nomeVendedor}`, 'info');
        }
        
        function voltarVendedores() {
            vendedorSelecionado = null;
            document.getElementById('btnVoltar').style.display = 'none';
            filtrarEExibirVendas();
        }

        // ================================================================================
        // SISTEMA DE FILTROS
        // ================================================================================
        
        function aplicarFiltro(filtro) {
            // Remover classe active de todos os cards
            document.querySelectorAll('.filtro-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Adicionar classe active ao card clicado
            document.querySelector(`[data-filtro="${filtro}"]`).classList.add('active');
            
            filtroAtivo = filtro;
            filtrarEExibirVendas();
            
            showToast(`Filtro "${filtro}" aplicado`, 'info', 2000);
        }

        // ================================================================================
        // MODAL DE COMPLEMENTAÇÃO DE DADOS
        // ================================================================================
        
        function completarDados(recibo) {
            vendaAtual = vendasData.find(v => v.recibo === recibo);
            
            if (!vendaAtual) {
                showToast('Venda não encontrada', 'error');
                return;
            }
            
            console.log(`📋 Abrindo complementação para venda ${recibo}`);
            
            // Resetar modal
            resetarModal();
            
            // Preencher dados básicos
            preencherDadosBasicos();
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('modalComplementar'));
            modal.show();
        }
        
        function resetarModal() {
            passoAtual = 1;
            dadosExtraidos = {};
            
            // Resetar indicadores de passos
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            document.getElementById('step1Indicator').classList.add('active');
            
            // Mostrar apenas passo 1
            document.querySelectorAll('.step-content').forEach(step => {
                step.style.display = 'none';
            });
            document.getElementById('step1').style.display = 'block';
            
            // Resetar upload
            document.getElementById('fileInput').value = '';
            document.getElementById('uploadProgress').style.display = 'none';
            
            // Resetar formulário
            const form = document.getElementById('formCompleto');
            if (form) {
                form.reset();
            }
        }
        
        function preencherDadosBasicos() {
            const dadosBasicos = document.getElementById('dadosBasicos');
            
            dadosBasicos.innerHTML = `
                <div class="dado-item">
                    <span class="dado-label">Recibo:</span>
                    <span class="dado-valor">${vendaAtual.recibo || 'N/A'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Vendedor:</span>
                    <span class="dado-valor">${vendaAtual.vendedor || 'N/A'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Data Embarque:</span>
                    <span class="dado-valor">${vendaAtual.dataIda ? new Date(vendaAtual.dataIda).toLocaleDateString('pt-BR') : 'Não informado'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Destino:</span>
                    <span class="dado-valor">${vendaAtual.destino || 'Não informado'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Tipo Produto:</span>
                    <span class="dado-valor">${vendaAtual.tipoProduto || 'Não informado'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Valor:</span>
                    <span class="dado-valor">${vendaAtual.valorTotal || 'Não informado'}</span>
                </div>
            `;
        }

        // ================================================================================
        // NAVEGAÇÃO ENTRE PASSOS
        // ================================================================================
        
        function proximoPasso(passo) {
            // Atualizar indicadores
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            
            for (let i = 1; i < passo; i++) {
                document.getElementById(`step${i}Indicator`).classList.add('completed');
            }
            document.getElementById(`step${passo}Indicator`).classList.add('active');
            
            // Esconder passo atual
            document.getElementById(`step${passoAtual}`).style.display = 'none';
            
            // Mostrar próximo passo
            passoAtual = passo;
            document.getElementById(`step${passo}`).style.display = 'block';
            
            // Ações específicas por passo
            if (passo === 4) {
                preencherFormularioCompleto();
            }
            
            console.log(`📍 Avançou para passo ${passo}`);
        }
        
        function voltarPasso(passo) {
            proximoPasso(passo);
        }

        // ================================================================================
        // UPLOAD E PROCESSAMENTO DE PDF
        // ================================================================================
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
                showToast('Apenas arquivos PDF são aceitos', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) { // 10MB
                showToast('Arquivo muito grande. Máximo 10MB', 'error');
                return;
            }
            
            processarPDF(file);
        }
        
        function processarPDF(file) {
            console.log(`📄 Processando PDF: ${file.name}`);
            
            // Mostrar progress
            document.getElementById('uploadProgress').style.display = 'block';
            
            // Simular upload e extração
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                document.getElementById('uploadProgressBar').style.width = progress + '%';
                document.getElementById('uploadPercent').textContent = Math.round(progress) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    finalizarProcessamentoPDF(file);
                }
            }, 200);
        }
        
        function finalizarProcessamentoPDF(file) {
            console.log('✅ PDF processado com sucesso');
            
            // Simular dados extraídos
            dadosExtraidos = simularExtracaoPDF(file.name);
            
            // Mostrar dados extraídos
            mostrarDadosExtraidos();
            
            // Avançar para próximo passo
            setTimeout(() => {
                proximoPasso(3);
                showToast('Dados extraídos do PDF com sucesso!', 'success');
            }, 500);
        }
        
        function simularExtracaoPDF(fileName) {
            // Simular extração baseada no arquivo ou dados da venda atual
            return {
                nomeCliente: 'Cliente Extraído do PDF',
                cpfCliente: '123.456.789-00',
                dataNascimento: '1990-01-01',
                whatsappCliente: '(11) 99999-9999',
                emailCliente: 'cliente@email.com',
                destino: vendaAtual.destino || 'PUNTA CANA',
                dataIda: vendaAtual.dataIda || '2025-12-08',
                dataVolta: '2025-12-15',
                hotel: 'Hotel Paradise',
                valorTotal: vendaAtual.valorTotal || 'R$ 12.603,96',
                locGds: 'NDRFDI',
                locCia: 'NDRFDI',
                numeroReserva: '301946368',
                formaPagamento: 'PIX'
            };
        }
        
        function mostrarDadosExtraidos() {
            const container = document.getElementById('dadosExtractedList');
            let html = '';
            
            Object.entries(dadosExtraidos).forEach(([key, value]) => {
                if (value) {
                    html += `
                        <div class="dado-item">
                            <span class="dado-label">${formatarLabel(key)}:</span>
                            <span class="dado-valor">${value}</span>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        function formatarLabel(key) {
            const labels = {
                nomeCliente: 'Nome do Cliente',
                cpfCliente: 'CPF',
                dataNascimento: 'Data de Nascimento',
                whatsappCliente: 'WhatsApp',
                emailCliente: 'Email',
                destino: 'Destino',
                dataIda: 'Data de Ida',
                dataVolta: 'Data de Volta',
                hotel: 'Hotel',
                valorTotal: 'Valor Total',
                locGds: 'LOC GDS',
                locCia: 'LOC CIA',
                numeroReserva: 'Número da Reserva',
                formaPagamento: 'Forma de Pagamento'
            };
            
            return labels[key] || key;
        }

        // ================================================================================
        // FORMULÁRIO COMPLETO
        // ================================================================================
        
        function preencherFormularioCompleto() {
            // Preencher com dados da venda atual
            if (vendaAtual.destino) document.getElementById('destino').value = vendaAtual.destino;
            if (vendaAtual.dataIda) document.getElementById('dataIda').value = vendaAtual.dataIda;
            if (vendaAtual.tipoProduto) document.getElementById('tipoProduto').value = vendaAtual.tipoProduto;
            if (vendaAtual.valorTotal) document.getElementById('valorTotal').value = vendaAtual.valorTotal;
            
            // Preencher com dados extraídos do PDF
            Object.entries(dadosExtraidos).forEach(([key, value]) => {
                const campo = document.getElementById(key);
                if (campo && value) {
                    campo.value = value;
                }
            });
            
            console.log('📝 Formulário preenchido com dados disponíveis');
        }

        // ================================================================================
        // SALVAMENTO DA VENDA
        // ================================================================================
        
        function salvarVendaCompleta() {
            console.log('💾 Salvando venda completa...');
            
            // Coletar dados do formulário
            const dadosCompletos = coletarDadosFormulario();
            
            // Validar campos obrigatórios
            if (!validarDadosObrigatorios(dadosCompletos)) {
                return;
            }
            
            // Simular salvamento
            showToast('Salvando venda...', 'info');
            
            setTimeout(() => {
                // Atualizar venda local
                Object.assign(vendaAtual, dadosCompletos);
                vendaAtual.status = 'completa';
                
                // Fechar modal
                bootstrap.Modal.getInstance(document.getElementById('modalComplementar')).hide();
                
                // Atualizar interface
                processarDadosVendedores();
                atualizarDashboard();
                filtrarEExibirVendas();
                
                showToast('Venda salva com sucesso!', 'success');
                
            }, 2000);
        }
        
        function coletarDadosFormulario() {
            const dados = {};
            
            // Lista de campos do formulário
            const campos = [
                'nomeCliente', 'cpfCliente', 'dataNascimento', 'whatsappCliente', 'emailCliente', 'rgCliente',
                'destino', 'dataIda', 'dataVolta', 'hotel', 'tipoProduto', 'valorTotal', 'formaPagamento', 'dataReserva',
                'locGds', 'locCia', 'reservaOnline', 'numeroReserva',
                'clienteAle', 'tipoAereo', 'temBagagem', 'temAssento', 'observacoes'
            ];
            
            campos.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (elemento) {
                    dados[campo] = elemento.value.trim();
                }
            });
            
            // Adicionar dados fixos
            dados.recibo = vendaAtual.recibo;
            dados.vendedor = vendaAtual.vendedor;
            dados.dataComplementacao = new Date().toISOString();
            
            console.log('📊 Dados coletados:', dados);
            return dados;
        }
        
        function validarDadosObrigatorios(dados) {
            const obrigatorios = ['nomeCliente', 'cpfCliente', 'whatsappCliente', 'clienteAle'];
            const faltantes = [];
            
            obrigatorios.forEach(campo => {
                if (!dados[campo]) {
                    faltantes.push(formatarLabel(campo));
                }
            });
            
            if (faltantes.length > 0) {
                showToast(`Campos obrigatórios: ${faltantes.join(', ')}`, 'error');
                return false;
            }
            
            // Validar formato CPF
            if (dados.cpfCliente && !validarCPF(dados.cpfCliente)) {
                showToast('CPF inválido', 'error');
                return false;
            }
            
            return true;
        }
        
        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            return cpf.length === 11;
        }

        // ================================================================================
        // FUNÇÕES AUXILIARES
        // ================================================================================
        
        function visualizarVenda(recibo) {
            const venda = vendasData.find(v => v.recibo === recibo);
            if (venda) {
                showToast(`Visualizando venda ${recibo}`, 'info');
                // Implementar modal de visualização se necessário
            }
        }
        
        function atualizarDados() {
            showToast('Atualizando dados...', 'info');
            carregarDadosInicial();
        }
        
        function mostrarErro(mensagem) {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('errorMessage').textContent = mensagem;
            
            console.error(`❌ Erro exibido: ${mensagem}`);
        }

        // ================================================================================
        // INICIALIZAÇÃO DO SISTEMA
        // ================================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🎯 DOM carregado, inicializando sistema...');
            inicializarSistema();
        });
    </script>
</body>
</html>
