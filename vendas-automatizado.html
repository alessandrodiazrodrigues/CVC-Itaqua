<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC Itaqu√° - Portal de Gest√£o da Loja - Sistema Completo de Vendas</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="CVC Itaqu√° - Sistema Completo de Vendas - Upload PDF + Completar Dados">
    <meta name="keywords" content="CVC, Itaquaquecetuba, vendas, automatizado, embarques, recibos, pdf">
    <meta name="author" content="CVC Itaquaquecetuba">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/cvc-styles.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/cvc-favicon.ico">
    
    <style>
        /* ===== ESTILOS ESPEC√çFICOS DO SISTEMA COMPLETO v11.1 CORRIGIDO ===== */
        
        :root {
            --cvc-amarelo: #FFE600;
            --cvc-azul: #0A00B4;
            --cvc-branco: #FFFFFF;
            --cvc-verde: #00D4AA;
            --cvc-azul-escuro: #1B365D;
            --cvc-cinza: #6C757D;
            --cvc-fundo-card: #f8f9fa;
            --cvc-sombra-suave: 0 4px 6px rgba(0,0,0,0.1);
            --cvc-sombra-media: 0 8px 15px rgba(0,0,0,0.2);
        }
        
        .vendas-completo-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Dashboard Status */
        .status-dashboard {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-azul-escuro));
            border-radius: 20px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }

        .status-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 230, 0, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--cvc-amarelo);
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            counter-reset: count;
            animation: countUp 2s ease-out;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 500;
        }

        /* Loading e Error */
        .loading-container {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-amarelo));
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            color: white;
            margin: 50px 0;
            animation: pulse 2s infinite;
        }

        .error-container {
            background: linear-gradient(135deg, #dc3545, #ff6b6b);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            color: white;
            margin: 50px 0;
        }

        /* Filtros Section */
        .filtros-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-amarelo);
            animation: slideInLeft 0.8s ease-out;
        }

        .filtros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .filtro-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--cvc-sombra-suave);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .filtro-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.6), transparent);
            transition: left 0.6s;
        }

        .filtro-card:hover::before {
            left: 100%;
        }

        .filtro-card.active {
            border-color: var(--cvc-azul);
            background: linear-gradient(135deg, rgba(10, 0, 180, 0.05), rgba(255, 230, 0, 0.05));
            transform: scale(1.02);
        }

        .filtro-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }

        .filtro-titulo {
            font-weight: 700;
            color: var(--cvc-azul);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filtro-desc {
            font-size: 0.9rem;
            color: var(--cvc-cinza);
            margin-bottom: 15px;
        }

        .filtro-count {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--cvc-azul);
            animation: countUp 1.5s ease-out;
        }

        /* Se√ß√£o de Vendedores */
        .vendedores-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-verde);
            animation: fadeIn 1s ease-out;
        }

        .vendedor-card {
            background: var(--cvc-branco);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--cvc-sombra-suave);
            margin-bottom: 20px;
            border-left: 5px solid var(--cvc-azul);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: slideInUp 0.6s ease-out;
        }

        .vendedor-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }

        .vendedor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .vendedor-nome {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--cvc-azul);
        }

        .vendedor-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .vendedor-status.pendente {
            background: #ffc107;
            color: #000;
        }

        .vendedor-status.ativo {
            background: #28a745;
            color: white;
        }

        .vendedor-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .vendedor-stat {
            text-align: center;
            min-width: 80px;
        }

        .vendedor-stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--cvc-azul);
            line-height: 1;
        }

        .vendedor-stat-label {
            font-size: 0.8rem;
            color: var(--cvc-cinza);
            margin-top: 2px;
        }

        /* Container de Recibos */
        .recibos-container {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            animation: fadeIn 1.2s ease-out;
        }

        .recibo-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
            transition: all 0.3s ease;
            animation: slideInUp 0.5s ease-out;
        }

        .recibo-card:hover {
            transform: translateX(5px);
            box-shadow: var(--cvc-sombra-media);
        }

        .recibo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .recibo-numero {
            font-weight: 700;
            color: var(--cvc-azul);
            font-size: 1.1rem;
        }

        .recibo-urgencia {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .recibo-urgencia.urgente {
            background: #dc3545;
            color: white;
        }

        .recibo-urgencia.normal {
            background: #28a745;
            color: white;
        }

        .recibo-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .recibo-campo {
            font-size: 0.9rem;
        }

        .recibo-label {
            font-weight: 600;
            color: var(--cvc-cinza);
        }

        .recibo-valor {
            color: var(--cvc-azul);
            font-weight: 500;
        }

        .recibo-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Modal de Complementa√ß√£o */
        .modal-complementar {
            backdrop-filter: blur(5px);
        }

        .modal-complementar .modal-dialog {
            max-width: 90%;
            width: 1200px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .step {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            border-radius: 25px;
            background: #f8f9fa;
            font-weight: 600;
            color: var(--cvc-cinza);
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .step.active {
            background: var(--cvc-azul);
            color: white;
            border-color: var(--cvc-amarelo);
        }

        .step.completed {
            background: var(--cvc-verde);
            color: white;
        }

        .step i {
            margin-right: 8px;
        }

        /* Upload Area */
        .upload-area {
            border: 2px dashed var(--cvc-azul);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            background: var(--cvc-fundo-card);
            transition: all 0.3s ease;
            cursor: pointer;
            margin: 20px 0;
        }

        .upload-area.dragover {
            border-color: var(--cvc-amarelo);
            background: rgba(255, 230, 0, 0.1);
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--cvc-azul);
            margin-bottom: 15px;
        }

        .upload-progress {
            margin-top: 20px;
        }

        /* Dados Extra√≠dos */
        .dados-extraidos {
            background: var(--cvc-fundo-card);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--cvc-verde);
        }

        .dado-item {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .dado-item:last-child {
            border-bottom: none;
        }

        .dado-label {
            font-weight: 600;
            color: var(--cvc-azul);
        }

        .dado-valor {
            color: var(--cvc-cinza);
        }

        /* Formul√°rio */
        .form-section {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
        }

        .form-section h5 {
            color: var(--cvc-azul);
            margin-bottom: 20px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--cvc-azul);
            box-shadow: 0 0 0 3px rgba(10, 0, 180, 0.1);
        }

        .required-field {
            border-left: 3px solid #dc3545;
        }

        /* Debug Section */
        .debug-section {
            background: #1e1e1e;
            color: #00ff00;
            border-radius: 15px;
            padding: 20px;
            margin-top: 30px;
            font-family: 'Courier New', monospace;
            max-height: 400px;
            overflow-y: auto;
            border: 2px solid var(--cvc-azul);
        }

        .debug-header {
            color: var(--cvc-amarelo);
            font-weight: bold;
            margin-bottom: 15px;
            border-bottom: 1px solid var(--cvc-azul);
            padding-bottom: 10px;
        }

        .debug-content {
            line-height: 1.4;
        }

        .debug-content .success {
            color: #50fa7b;
        }

        .debug-content .error {
            color: #ff5555;
        }

        .debug-content .warning {
            color: #f1fa8c;
        }

        .debug-content .info {
            color: #8be9fd;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }

        .toast-notification {
            background: var(--cvc-branco);
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: var(--cvc-sombra-media);
            border-left: 4px solid var(--cvc-azul);
            min-width: 300px;
            animation: slideInRight 0.5s ease-out;
        }

        .toast-success {
            border-left-color: #28a745;
        }

        .toast-error {
            border-left-color: #dc3545;
        }

        .toast-warning {
            border-left-color: #ffc107;
        }

        /* Anima√ß√µes */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInLeft {
            from { transform: translateX(-30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes slideInRight {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes countUp {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .vendas-completo-container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .stat-number {
                font-size: 2rem;
            }

            .filtros-grid {
                grid-template-columns: 1fr;
            }

            .vendedor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .vendedor-stats {
                justify-content: space-around;
                width: 100%;
            }

            .recibo-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .recibo-info {
                grid-template-columns: 1fr;
            }

            .modal-complementar .modal-dialog {
                max-width: 95%;
                margin: 10px;
            }

            .step-indicator {
                flex-direction: column;
                gap: 10px;
            }

            .recibo-actions {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-number {
                font-size: 1.8rem;
            }

            .toast-notification {
                min-width: 250px;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER CVC PADR√ÉO -->
    <header class="cvc-header">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <!-- Logo CVC -->
                <div class="col-md-4">
                    <div class="cvc-logo">
                        <div class="cvc-logo-symbol">CVC</div>
                        <div>
                            <div class="cvc-logo-text">CVC Itaqu√°</div>
                            <p class="cvc-subtitle">Portal de Gest√£o da Loja</p>
                        </div>
                    </div>
                </div>
                
                <!-- T√≠tulo da P√°gina -->
                <div class="col-md-4 text-center">
                    <h1 class="page-title mb-0" style="border: none; padding: 0; color: var(--cvc-branco); font-size: 1.8rem;">
                        <i class="fas fa-robot"></i> Sistema Completo
                    </h1>
                </div>
                
                <!-- Voltar ao Dashboard -->
                <div class="col-md-4 text-end">
                    <a href="index.html" class="btn btn-cvc-outline">
                        <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- NAVEGA√á√ÉO CVC PADR√ÉO -->
    <nav class="cvc-nav">
        <div class="container-fluid">
            <ul class="nav nav-pills justify-content-center mb-0">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="orcamentos.html">
                        <i class="fas fa-calculator"></i> Padronizador de Or√ßamentos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas.html">
                        <i class="fas fa-chart-line"></i> Informe de Vendas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas-automatizado.html">
                        <i class="fas fa-robot"></i> Informe Automatizado
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="vendas-automatizado-COMPLETO.html">
                        <i class="fas fa-upload"></i> Sistema Completo
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="embarques.html">
                        <i class="fas fa-plane-departure"></i> Controle de Embarques
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- CONTAINER PRINCIPAL -->
    <div class="vendas-completo-container">
        
        <!-- LOADING CONTAINER -->
        <div class="loading-container" id="loadingContainer">
            <div class="text-center">
                <div class="spinner-border text-white mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Carregando...</span>
                </div>
                <h3><i class="fas fa-robot"></i> CVC Portal Itaqu√° - Sistema Completo</h3>
                <p class="mb-0">Carregando vendas pendentes de complementa√ß√£o...</p>
                <div class="mt-3">
                    <small>‚ú® Sistema v11.1 CORRIGIDO - Upload PDF + Completar Dados</small>
                </div>
            </div>
        </div>

        <!-- ERROR CONTAINER -->
        <div class="error-container" id="errorContainer" style="display:none;">
            <div class="text-center">
                <div class="error-icon mb-3">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
                </div>
                <h3>Erro no Sistema</h3>
                <p id="errorMessage">N√£o foi poss√≠vel conectar com a planilha</p>
                <div class="mt-3">
                    <button class="btn btn-light btn-lg" onclick="carregarDadosInicial()">
                        <i class="fas fa-redo"></i> Tentar Novamente
                    </button>
                    <button class="btn btn-warning btn-lg ms-2" onclick="testarConexaoAPI()">
                        <i class="fas fa-bug"></i> Testar API
                    </button>
                </div>
                <div class="mt-3">
                    <small class="text-light">
                        Abra o Console (F12) para ver detalhes t√©cnicos do erro
                    </small>
                </div>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div id="mainContent" style="display:none;">
            
            <!-- DASHBOARD STATUS -->
            <div class="status-dashboard" id="statusDashboard">
                <div class="text-center">
                    <h2><i class="fas fa-upload"></i> Sistema Completo de Vendas</h2>
                    <p class="mb-0">Upload de PDF + Completar dados pendentes de vendas importadas</p>
                    <small id="ultimaAtualizacao">√öltima atualiza√ß√£o: Aguardando dados...</small>
                </div>
                
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-number" id="statTotal">0</div>
                        <div class="stat-label">Total de Vendas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statPendentes">0</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statCompletas">0</div>
                        <div class="stat-label">Completas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statVendedores">0</div>
                        <div class="stat-label">Vendedores</div>
                    </div>
                </div>
            </div>

            <!-- FILTROS INTELIGENTES -->
            <section class="filtros-section" id="filtrosSection">
                <h2><i class="fas fa-filter"></i> Filtros Inteligentes</h2>
                <p class="text-muted mb-3">Filtre as vendas por status ou busque por vendedor/recibo</p>
                
                <div class="search-container mb-4">
                    <div class="input-group">
                        <span class="input-group-text"><i class="fas fa-search"></i></span>
                        <input type="text" class="form-control" id="searchInput" 
                               placeholder="Buscar por vendedor, recibo ou cliente...">
                    </div>
                </div>
                
                <div class="filtros-grid">
                    <div class="filtro-card active" data-filtro="todos" onclick="aplicarFiltro('todos')">
                        <div class="filtro-titulo">
                            <i class="fas fa-list"></i> Todas as Vendas
                        </div>
                        <div class="filtro-desc">Visualizar todas as vendas importadas</div>
                        <div class="filtro-count" id="filtroTodos">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="pendentes" onclick="aplicarFiltro('pendentes')">
                        <div class="filtro-titulo">
                            <i class="fas fa-clock"></i> Pendentes
                        </div>
                        <div class="filtro-desc">Vendas que precisam ser completadas</div>
                        <div class="filtro-count" id="filtroPendentes">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="completas" onclick="aplicarFiltro('completas')">
                        <div class="filtro-titulo">
                            <i class="fas fa-check-circle"></i> Completas
                        </div>
                        <div class="filtro-desc">Vendas j√° finalizadas</div>
                        <div class="filtro-count" id="filtroCompletas">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="urgentes" onclick="aplicarFiltro('urgentes')">
                        <div class="filtro-titulo">
                            <i class="fas fa-exclamation-triangle"></i> Urgentes
                        </div>
                        <div class="filtro-desc">Embarques pr√≥ximos (‚â§3 dias)</div>
                        <div class="filtro-count" id="filtroUrgentes">0</div>
                    </div>
                </div>
            </section>

            <!-- SE√á√ÉO DE VENDEDORES -->
            <section class="vendedores-section" id="vendedoresSection">
                <h2><i class="fas fa-users"></i> Vendedores com Vendas Pendentes</h2>
                <p class="text-muted mb-3">Clique em um vendedor para ver suas vendas que precisam ser completadas</p>
                <div id="vendedoresList">
                    <!-- Vendedores ser√£o inseridos aqui -->
                </div>
            </section>

            <!-- CONTAINER DE RECIBOS -->
            <div class="recibos-container" id="recibosContainer">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2><i class="fas fa-receipt"></i> Vendas para Completar</h2>
                    <div>
                        <button class="btn btn-outline-secondary btn-sm" onclick="voltarVendedores()" id="btnVoltar" style="display:none;">
                            <i class="fas fa-arrow-left"></i> Voltar
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="atualizarDados()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                </div>
                <div id="recibosList">
                    <!-- Recibos ser√£o inseridos aqui -->
                </div>
            </div>

        </div>

        <!-- DEBUG SECTION -->
        <div class="debug-section" id="debugSection" style="display:none;">
            <div class="debug-header">
                <i class="fas fa-terminal"></i> Debug do Sistema v11.1 CORRIGIDO:
            </div>
            <div class="debug-content" id="debugContent"></div>
        </div>

    </div>

    <!-- MODAL DE COMPLEMENTA√á√ÉO DE DADOS -->
    <div class="modal fade modal-complementar" id="modalComplementar" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-upload"></i> Completar Dados da Venda
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    
                    <!-- Indicador de Passos -->
                    <div class="step-indicator">
                        <div class="step active" id="step1Indicator">
                            <i class="fas fa-info-circle"></i> Dados B√°sicos
                        </div>
                        <div class="step" id="step2Indicator">
                            <i class="fas fa-upload"></i> Upload PDF
                        </div>
                        <div class="step" id="step3Indicator">
                            <i class="fas fa-edit"></i> Completar
                        </div>
                        <div class="step" id="step4Indicator">
                            <i class="fas fa-check"></i> Finalizar
                        </div>
                    </div>
                    
                    <!-- PASSO 1: Dados B√°sicos -->
                    <div id="step1" class="step-content">
                        <h5><i class="fas fa-info-circle"></i> Dados B√°sicos da Venda</h5>
                        <div class="dados-extraidos">
                            <h6>Dados j√° importados:</h6>
                            <div id="dadosBasicos">
                                <!-- Dados b√°sicos ser√£o inseridos aqui -->
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-primary" onclick="proximoPasso(2)">
                                <i class="fas fa-arrow-right"></i> Fazer Upload do PDF
                            </button>
                        </div>
                    </div>

                    <!-- PASSO 2: Upload do PDF -->
                    <div id="step2" class="step-content" style="display:none;">
                        <h5><i class="fas fa-upload"></i> Upload do PDF da Reserva</h5>
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h5>Arraste o PDF aqui ou clique para selecionar</h5>
                            <p class="text-muted">Formatos aceitos: PDF (m√°x. 10MB)</p>
                            <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                            <button class="btn btn-primary" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-folder-open"></i> Selecionar Arquivo
                            </button>
                        </div>
                        <div id="uploadProgress" class="upload-progress" style="display: none;">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Processando PDF...</span>
                                    <span id="uploadPercent">0%</span>
                                </div>
                                <div class="progress mt-2">
                                    <div class="progress-bar bg-primary" id="uploadProgressBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-3">
                            <button class="btn btn-secondary" onclick="voltarPasso(1)">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button class="btn btn-warning" onclick="proximoPasso(3)" id="btnPularUpload">
                                <i class="fas fa-forward"></i> Pular Upload
                            </button>
                        </div>
                    </div>

                    <!-- PASSO 3: Dados Extra√≠dos -->
                    <div id="step3" class="step-content" style="display:none;">
                        <h5><i class="fas fa-check-circle"></i> Dados Extra√≠dos do PDF</h5>
                        <div class="dados-extraidos" id="dadosExtraidos">
                            <h6>Dados encontrados no PDF:</h6>
                            <div id="dadosExtractedList">
                                <!-- Dados extra√≠dos ser√£o inseridos aqui -->
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-secondary" onclick="voltarPasso(2)">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button class="btn btn-success" onclick="proximoPasso(4)">
                                <i class="fas fa-arrow-right"></i> Completar Dados
                            </button>
                        </div>
                    </div>

                    <!-- PASSO 4: Formul√°rio Completo -->
                    <div id="step4" class="step-content" style="display:none;">
                        <h5><i class="fas fa-edit"></i> Completar Dados da Venda</h5>
                        
                        <form id="formCompleto">
                            <!-- Dados do Cliente -->
                            <div class="form-section">
                                <h5><i class="fas fa-user"></i> Dados do Cliente</h5>
                                
                                <!-- Alerta sobre dados n√£o extra√≠dos -->
                                <div class="alert alert-warning" role="alert">
                                    <i class="fas fa-exclamation-triangle"></i>
                                    <strong>Aten√ß√£o:</strong> CPF e WhatsApp do <strong>CONTRATANTE</strong> n√£o constam no PDF. 
                                    O vendedor deve solicitar estes dados diretamente ao cliente.
                                </div>
                                
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Nome Completo *</label>
                                        <input type="text" class="form-control required-field" id="nomeCliente" required>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">
                                            CPF do Contratante * 
                                            <i class="fas fa-info-circle text-warning" title="N√£o consta no PDF - solicitar ao cliente"></i>
                                        </label>
                                        <input type="text" class="form-control required-field" id="cpfCliente" required maxlength="14" 
                                               placeholder="000.000.000-00">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Data Nascimento</label>
                                        <input type="date" class="form-control" id="dataNascimento">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">
                                            WhatsApp do Contratante * 
                                            <i class="fas fa-info-circle text-warning" title="N√£o consta no PDF - solicitar ao cliente"></i>
                                        </label>
                                        <input type="tel" class="form-control required-field" id="whatsappCliente" required
                                               placeholder="(11) 99999-9999">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="emailCliente">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">RG</label>
                                        <input type="text" class="form-control" id="rgCliente">
                                    </div>
                                </div>
                            </div>

                            <!-- Dados da Viagem -->
                            <div class="form-section">
                                <h5 data-viagem="true"><i class="fas fa-plane"></i> Dados da Viagem</h5>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Destino</label>
                                        <input type="text" class="form-control" id="destino">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Data Ida</label>
                                        <input type="date" class="form-control" id="dataIda">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Data Volta</label>
                                        <input type="date" class="form-control" id="dataVolta">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Hotel/Hospedagem</label>
                                        <input type="text" class="form-control" id="hotel">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tipo Produto *</label>
                                        <select class="form-select" id="tipoProduto" required>
                                            <option value="">Selecione...</option>
                                            <option value="AEREO">A√©reo</option>
                                            <option value="A+H">A+H (A√©reo + Hotel)</option>
                                            <option value="A+H+S">A+H+S (A√©reo + Hotel + Seguro)</option>
                                            <option value="TERRESTRE">Terrestre</option>
                                            <option value="CRUZEIRO">Cruzeiro</option>
                                            <option value="HOTEL">Hotel</option>
                                            <option value="SEGURO">Seguro</option>
                                            <option value="OUTROS">Outros</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Valor Total</label>
                                        <input type="text" class="form-control" id="valorTotal">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Forma Pagamento</label>
                                        <input type="text" class="form-control" id="formaPagamento">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Data Reserva</label>
                                        <input type="date" class="form-control" id="dataReserva">
                                    </div>
                                </div>
                            </div>

                            <!-- Localizadores -->
                            <div class="form-section">
                                <h5><i class="fas fa-barcode"></i> Localizadores e Reservas</h5>
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label">LOC GDS</label>
                                        <input type="text" class="form-control" id="locGds">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">LOC CIA</label>
                                        <input type="text" class="form-control" id="locCia">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Reserva Online</label>
                                        <input type="text" class="form-control" id="reservaOnline">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">N√∫mero Reserva</label>
                                        <input type="text" class="form-control" id="numeroReserva">
                                    </div>
                                </div>
                            </div>

                            <!-- Configura√ß√µes Espec√≠ficas -->
                            <div class="form-section">
                                <h5><i class="fas fa-cogs"></i> Configura√ß√µes</h5>
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label">Cliente Ale *</label>
                                        <select class="form-select required-field" id="clienteAle" required>
                                            <option value="">Selecione...</option>
                                            <option value="N√£o">N√£o</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tipo A√©reo</label>
                                        <select class="form-select" id="tipoAereo">
                                            <option value="">Selecione...</option>
                                            <option value="OW">S√≥ Ida (OW)</option>
                                            <option value="RT">Ida e Volta (RT)</option>
                                            <option value="HOTEL">Hotel</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tem Bagagem</label>
                                        <select class="form-select" id="temBagagem">
                                            <option value="N√£o">N√£o</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tem Assento</label>
                                        <select class="form-select" id="temAssento">
                                            <option value="N√£o">N√£o</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Observa√ß√µes</label>
                                        <textarea class="form-control" id="observacoes" rows="3" placeholder="Informa√ß√µes adicionais sobre a venda..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                        
                        <div class="text-center mt-4">
                            <button class="btn btn-secondary" onclick="voltarPasso(3)">
                                <i class="fas fa-arrow-left"></i> Voltar
                            </button>
                            <button class="btn btn-success btn-lg" onclick="salvarVendaCompleta()">
                                <i class="fas fa-save"></i> Salvar Venda Completa
                            </button>
                        </div>
                    </div>

                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- üö® CORRE√á√ÉO CR√çTICA: Script ANTES do config.js -->
    <script>
        // Garantir que getApiUrl() esteja dispon√≠vel ANTES de tudo
        window.getApiUrl = window.getApiUrl || function() {
            return 'https://script.google.com/macros/s/AKfycbzqttRJjK4PbznHnEfviHZ9LPOITVm_pc0sswGUNVHpGpio5oCdaB2c68s6fVHuN6LL3w/exec';
        };

        // Definir CVC_CONFIG tempor√°rio se n√£o existir
        window.CVC_CONFIG = window.CVC_CONFIG || {
            API_URL: 'https://script.google.com/macros/s/AKfycbzqttRJjK4PbznHnEfviHZ9LPOITVm_pc0sswGUNVHpGpio5oCdaB2c68s6fVHuN6LL3w/exec',
            VERSION: '11.1',
            SYSTEM_NAME: 'CVC Itaqu√° - Portal de Gest√£o da Loja',
            VENDEDORES: ['Alessandro', 'Ana Paula', 'Adriana', 'Adrielly', 'Bia', 'Concei√ß√£o', 'Jhully'],
            DEBUG_MODE: true
        };

        console.log('üîß CORRE√á√ÉO: getApiUrl() e CVC_CONFIG definidos temporariamente');
        console.log('üéØ API URL:', window.getApiUrl());
    </script>

    <!-- Config original -->
    <script src="config.js"></script>
    
    <script>
        // ================================================================================
        // üöÄ CVC PORTAL ITAQU√Å - SISTEMA COMPLETO v11.1 CORRIGIDO
        // Sistema completo que busca dados reais da planilha e exibe para os vendedores
        // CORRE√á√ÉO TOTAL: Baseado no arquivo funcionando vendas-automatizado.html
        // ================================================================================
        
        console.log('üöÄ CVC Portal Itaqu√° - Sistema Completo v11.1 CORRIGIDO');
        console.log('‚ú® Corre√ß√µes v11.1:');
        console.log('   ‚Ä¢ Baseado no arquivo vendas-automatizado.html funcionando');
        console.log('   ‚Ä¢ Corre√ß√£o do erro "Invalid Date" aplicada');
        console.log('   ‚Ä¢ Sistema JSONP funcionando corretamente');
        console.log('   ‚Ä¢ Mapeamento correto da planilha EMBARQUES');
        console.log('   ‚Ä¢ Debug avan√ßado funcionando');
        console.log('   ‚Ä¢ Toast notifications funcionando');
        console.log('   ‚Ä¢ Interface responsiva completa');
        console.log('   ‚Ä¢ Upload de PDF e formul√°rio de complementa√ß√£o');
        console.log('');
        console.log('üéØ Sistema corrigido e pronto para uso!');
        
        // ================================================================================
        // VARI√ÅVEIS GLOBAIS
        // ================================================================================
        
        let recibosData = [];
        let recibosDataOriginal = [];
        let vendedoresData = {};
        let debugLogs = [];
        let API_URL = null;
        let filtroAtivo = 'todos';
        let termoBusca = '';
        let vendedorSelecionado = null;
        let vendaAtual = null;
        let dadosExtraidos = {};
        let passoAtual = 1;

        // ================================================================================
        // üîß CORRE√á√ÉO ESPEC√çFICA: FUN√á√ÉO DE FORMATA√á√ÉO DE DATA SEGURA
        // ================================================================================
        
        /**
         * Fun√ß√£o corrigida para formata√ß√£o segura de datas
         * Resolve o erro "Invalid Date" encontrado na conversa anterior
         */
        function formatarDataSegura(dataString) {
            try {
                if (!dataString) {
                    return 'Data n√£o informada';
                }
                
                // Se j√° √© um objeto Date v√°lido
                if (dataString instanceof Date && !isNaN(dataString.getTime())) {
                    return dataString.toLocaleDateString('pt-BR');
                }
                
                // Converter string para Date
                let data;
                
                // Tentar diferentes formatos de data
                if (typeof dataString === 'string') {
                    // Formato ISO (YYYY-MM-DD ou com hora)
                    if (dataString.includes('-') && dataString.length >= 10) {
                        data = new Date(dataString);
                    }
                    // Formato brasileiro (DD/MM/YYYY)
                    else if (dataString.includes('/')) {
                        const partes = dataString.split('/');
                        if (partes.length === 3) {
                            // Assumir formato DD/MM/YYYY
                            const dia = parseInt(partes[0]);
                            const mes = parseInt(partes[1]) - 1; // M√™s √© 0-indexed
                            const ano = parseInt(partes[2]);
                            data = new Date(ano, mes, dia);
                        }
                    }
                    // Tentar parse direto
                    else {
                        data = new Date(dataString);
                    }
                } else {
                    data = new Date(dataString);
                }
                
                // Verificar se a data √© v√°lida
                if (data && !isNaN(data.getTime())) {
                    return data.toLocaleDateString('pt-BR');
                } else {
                    console.warn('Data inv√°lida recebida:', dataString);
                    return 'Data inv√°lida';
                }
                
            } catch (error) {
                console.error('Erro ao formatar data:', error, 'Data original:', dataString);
                return 'Erro na data';
            }
        }

        /**
         * Fun√ß√£o corrigida para calcular diferen√ßa de dias com verifica√ß√£o de data v√°lida
         */
        function calcularDiferencaDias(dataString) {
            try {
                if (!dataString) return 999; // Valor alto para ordena√ß√£o
                
                let dataEmbarque;
                
                // Processar data com a mesma l√≥gica da formatarDataSegura
                if (dataString instanceof Date && !isNaN(dataString.getTime())) {
                    dataEmbarque = dataString;
                } else if (typeof dataString === 'string') {
                    if (dataString.includes('-') && dataString.length >= 10) {
                        dataEmbarque = new Date(dataString);
                    } else if (dataString.includes('/')) {
                        const partes = dataString.split('/');
                        if (partes.length === 3) {
                            const dia = parseInt(partes[0]);
                            const mes = parseInt(partes[1]) - 1;
                            const ano = parseInt(partes[2]);
                            dataEmbarque = new Date(ano, mes, dia);
                        }
                    } else {
                        dataEmbarque = new Date(dataString);
                    }
                } else {
                    dataEmbarque = new Date(dataString);
                }
                
                // Verificar se a data √© v√°lida
                if (!dataEmbarque || isNaN(dataEmbarque.getTime())) {
                    console.warn('Data inv√°lida para c√°lculo:', dataString);
                    return 999;
                }
                
                const hoje = new Date();
                const diffTime = dataEmbarque - hoje;
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                
                return diffDays;
                
            } catch (error) {
                console.error('Erro ao calcular diferen√ßa de dias:', error);
                return 999;
            }
        }

        // ================================================================================
        // SISTEMA DE DEBUG AVAN√áADO
        // ================================================================================
        
        function addDebugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const logEntry = { timestamp, message, type };
            debugLogs.push(logEntry);
            
            // Console log com cores
            const colors = {
                error: 'color: #ff5555; font-weight: bold;',
                success: 'color: #50fa7b; font-weight: bold;',
                warning: 'color: #f1fa8c; font-weight: bold;',
                info: 'color: #8be9fd;'
            };
            
            console.log(`%c[${type.toUpperCase()}] ${message}`, colors[type] || colors.info);
            updateDebugDisplay();
        }
        
        function updateDebugDisplay() {
            const debugContent = document.getElementById('debugContent');
            if (!debugContent) return;
            
            const html = debugLogs.slice(-25).map(log => {
                const typeClass = log.type;
                return `<div class="${typeClass}">
                    [${log.timestamp}] ${log.message}
                </div>`;
            }).join('');
            
            debugContent.innerHTML = html;
            debugContent.scrollTop = debugContent.scrollHeight;
        }
        
        function showDebugSection() {
            const debugSection = document.getElementById('debugSection');
            debugSection.style.display = 'block';
        }

        // ================================================================================
        // SISTEMA DE TOAST NOTIFICATIONS
        // ================================================================================
        
        function showToast(message, type = 'info', duration = 4000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas ${icons[type]} me-2"></i>
                    <span>${message}</span>
                    <button class="btn-close btn-close-sm ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, duration);
        }

        // ================================================================================
        // INICIALIZA√á√ÉO SEGURA DO SISTEMA
        // ================================================================================
        
        function inicializarSistema() {
            addDebugLog('üöÄ Iniciando CVC Portal Itaqu√° - Sistema Completo v11.1 CORRIGIDO...', 'info');
            
            // üîß CORRE√á√ÉO: Verifica√ß√£o mais robusta da configura√ß√£o
            if (typeof getApiUrl === 'function') {
                API_URL = getApiUrl();
                addDebugLog(`üåê API URL via getApiUrl(): ${API_URL}`, 'success');
            } else if (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.API_URL) {
                API_URL = CVC_CONFIG.API_URL;
                addDebugLog(`üåê API URL via CVC_CONFIG: ${API_URL}`, 'success');
            } else {
                // üîß FALLBACK: URL hardcoded como √∫ltimo recurso
                API_URL = 'https://script.google.com/macros/s/AKfycbzqttRJjK4PbznHnEfviHZ9LPOITVm_pc0sswGUNVHpGpio5oCdaB2c68s6fVHuN6LL3w/exec';
                addDebugLog('‚ö†Ô∏è Usando API URL fallback', 'warning');
            }
            
            if (!API_URL || !API_URL.includes('script.google.com')) {
                addDebugLog('‚ùå ERRO: API URL inv√°lida!', 'error');
                mostrarErro('API URL inv√°lida. Verifique a configura√ß√£o.');
                return;
            }
            
            showDebugSection();
            addDebugLog('‚úÖ Sistema inicializado com sucesso!', 'success');
            addDebugLog('üîß Corre√ß√£o "Invalid Date" aplicada', 'success');
            
            // Configurar eventos
            configurarEventos();
            
            // Carregar dados iniciais
            carregarDadosInicial();
        }

        // ================================================================================
        // CONFIGURA√á√ÉO DE EVENTOS
        // ================================================================================
        
        function configurarEventos() {
            // Search input com debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                let debounceTimer;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        termoBusca = e.target.value.toLowerCase();
                        filtrarEExibirRecibos();
                    }, 300);
                });
            }

            // Upload de arquivo
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            if (fileInput) {
                fileInput.addEventListener('change', handleFileSelect);
            }
            
            if (uploadArea) {
                // Drag & Drop
                uploadArea.addEventListener('dragover', (e) => {
                    e.preventDefault();
                    uploadArea.classList.add('dragover');
                });
                
                uploadArea.addEventListener('dragleave', () => {
                    uploadArea.classList.remove('dragover');
                });
                
                uploadArea.addEventListener('drop', (e) => {
                    e.preventDefault();
                    uploadArea.classList.remove('dragover');
                    const files = e.dataTransfer.files;
                    if (files.length > 0) {
                        handleFileSelect({ target: { files } });
                    }
                });
            }

            // M√°scara para CPF
            const cpfInput = document.getElementById('cpfCliente');
            if (cpfInput) {
                cpfInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
            }

            // M√°scara para WhatsApp
            const whatsInput = document.getElementById('whatsappCliente');
            if (whatsInput) {
                whatsInput.addEventListener('input', (e) => {
                    let value = e.target.value.replace(/\D/g, '');
                    if (value.length >= 11) {
                        // Celular: (11) 99999-9999
                        value = value.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3');
                    } else if (value.length >= 10) {
                        // Fixo: (11) 9999-9999
                        value = value.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3');
                    } else if (value.length >= 6) {
                        value = value.replace(/(\d{2})(\d{4})/, '($1) $2');
                    } else if (value.length >= 2) {
                        value = value.replace(/(\d{2})/, '($1) ');
                    }
                    e.target.value = value;
                });
            }

            // Configurar detec√ß√£o autom√°tica de campos a√©reos
            configurarDeteccaoAereo();

            // Shortcuts de teclado
            document.addEventListener('keydown', (e) => {
                if ((e.ctrlKey || e.metaKey) && e.key === 'r') {
                    e.preventDefault();
                    atualizarDados();
                } else if (e.key === 'F5') {
                    e.preventDefault();
                    atualizarDados();
                }
            });

            addDebugLog('‚úÖ Eventos configurados com shortcuts e detec√ß√£o a√©rea', 'success');
        }

        // ================================================================================
        // CARREGAMENTO DE DADOS VIA JSONP (BASEADO NO ARQUIVO FUNCIONANDO)
        // ================================================================================
        
        function carregarDadosInicial() {
            addDebugLog('üìä JSONP: Carregando dados da planilha...', 'info');
            
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            
            // Testar conex√£o primeiro
            testarConexaoAPI()
                .then(() => {
                    addDebugLog('‚úÖ Conex√£o com API estabelecida!', 'success');
                    showToast('Conectado com sucesso √† planilha!', 'success');
                    return chamarAPIJsonp('listar_vendas_pendentes');
                })
                .then(resultado => {
                    addDebugLog('üì° JSONP: Resposta recebida', 'success');
                    
                    if (resultado.success) {
                        if (resultado.data && resultado.data.recibos) {
                            recibosDataOriginal = resultado.data.recibos;
                            recibosData = [...recibosDataOriginal];
                            addDebugLog(`‚úÖ JSONP: ${recibosData.length} recibos carregados`, 'success');
                            
                            // üîß DEBUG: Mostrar estrutura dos dados para resolver o problema
                            if (recibosData.length > 0) {
                                addDebugLog('üìä DEBUG: Estrutura do primeiro recibo:', 'info');
                                console.log('ESTRUTURA COMPLETA DO PRIMEIRO RECIBO:', recibosData[0]);
                                addDebugLog(`Propriedades dispon√≠veis: ${Object.keys(recibosData[0]).join(', ')}`, 'info');
                                
                                // Verificar propriedades de ID
                                const primeiroRecibo = recibosData[0];
                                addDebugLog(`üîç ID Properties:`, 'info');
                                addDebugLog(`  - recibo: ${primeiroRecibo.recibo}`, 'info');
                                addDebugLog(`  - id: ${primeiroRecibo.id}`, 'info');
                                addDebugLog(`  - numeroInforme: ${primeiroRecibo.numeroInforme}`, 'info');
                                addDebugLog(`  - nomeCliente: ${primeiroRecibo.nomeCliente}`, 'info');
                            }
                            
                            processarDadosVendedores();
                            atualizarDashboard();
                            exibirDados();
                            showToast(`${recibosData.length} recibos carregados com sucesso!`, 'success');
                            
                        } else {
                            addDebugLog('‚ö†Ô∏è JSONP: Estrutura de resposta inesperada', 'warning');
                            throw new Error('Estrutura de dados inv√°lida na resposta');
                        }
                    } else {
                        throw new Error(resultado.message || 'Erro desconhecido na API');
                    }
                })
                .catch(error => {
                    addDebugLog(`‚ùå JSONP: Erro: ${error.message}`, 'error');
                    mostrarErro(error.message);
                    showToast(`Erro: ${error.message}`, 'error');
                });
        }
        
        function testarConexaoAPI() {
            return new Promise((resolve, reject) => {
                const callbackName = `test_${Date.now()}`;
                
                window[callbackName] = function(result) {
                    script.remove();
                    delete window[callbackName];
                    
                    if (result && result.success) {
                        addDebugLog(`‚úÖ API Status: ${result.status}`, 'success');
                        resolve(result);
                    } else {
                        reject(new Error('API retornou erro'));
                    }
                };
                
                const script = document.createElement('script');
                script.src = `${API_URL}?callback=${callbackName}`;
                script.onerror = () => {
                    delete window[callbackName];
                    reject(new Error('Erro ao conectar com a API'));
                };
                
                document.head.appendChild(script);
                
                setTimeout(() => {
                    if (window[callbackName]) {
                        script.remove();
                        delete window[callbackName];
                        reject(new Error('Timeout de 10 segundos'));
                    }
                }, 10000);
            });
        }
        
        function chamarAPIJsonp(action, parametros = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = `vendas_completo_callback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                addDebugLog(`üîó JSONP: Criando callback ${callbackName}`, 'info');
                
                window[callbackName] = function(result) {
                    try {
                        script.remove();
                        delete window[callbackName];
                        
                        addDebugLog(`üì° JSONP: Callback executado: ${result.success ? 'sucesso' : 'erro'}`, result.success ? 'success' : 'error');
                        resolve(result);
                        
                    } catch (error) {
                        delete window[callbackName];
                        reject(error);
                    }
                };
                
                const script = document.createElement('script');
                const params = new URLSearchParams({
                    callback: callbackName,
                    action: action,
                    ...parametros
                });
                
                const urlCompleta = `${API_URL}?${params.toString()}`;
                script.src = urlCompleta;
                
                addDebugLog(`üì° JSONP: URL criada (${urlCompleta.length} chars)`, 'info');
                
                script.onerror = function(event) {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.remove();
                    }
                    
                    addDebugLog('‚ùå JSONP: Erro ao carregar script', 'error');
                    reject(new Error('Erro ao carregar script JSONP. Verifique a configura√ß√£o da API.'));
                };
                
                document.head.appendChild(script);
                
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script && script.parentNode) {
                            script.remove();
                        }
                        addDebugLog('‚è±Ô∏è JSONP: Timeout de 30 segundos', 'error');
                        reject(new Error('Timeout na requisi√ß√£o JSONP (30s). O servidor n√£o respondeu.'));
                    }
                }, 30000);
            });
        }

        // ================================================================================
        // PROCESSAMENTO DE DADOS
        // ================================================================================
        
        function processarDadosVendedores() {
            vendedoresData = {};
            
            recibosData.forEach(recibo => {
                const vendedor = recibo.vendedor || 'N√£o Informado';
                
                if (!vendedoresData[vendedor]) {
                    vendedoresData[vendedor] = {
                        nome: vendedor,
                        total: 0,
                        urgentes: 0,
                        semCPF: 0,
                        semWhatsApp: 0,
                        recibos: []
                    };
                }
                
                vendedoresData[vendedor].total++;
                vendedoresData[vendedor].recibos.push(recibo);
                
                // üîß CORRE√á√ÉO: Usar fun√ß√£o segura para verificar urg√™ncia
                const diffDias = calcularDiferencaDias(recibo.dataIda || recibo.dataEmbarque);
                
                if (diffDias <= 3 && diffDias !== 999) {
                    vendedoresData[vendedor].urgentes++;
                }
                
                // Verificar CPF
                if (!recibo.cpf || recibo.cpf.length < 11) {
                    vendedoresData[vendedor].semCPF++;
                }
                
                // Verificar WhatsApp
                if (!recibo.whatsapp || recibo.whatsapp.length < 10) {
                    vendedoresData[vendedor].semWhatsApp++;
                }
            });
            
            addDebugLog(`üìä Processados ${Object.keys(vendedoresData).length} vendedores`, 'success');
        }

        // ================================================================================
        // ATUALIZA√á√ÉO DA INTERFACE
        // ================================================================================
        
        function atualizarDashboard() {
            const stats = calcularEstatisticas();
            
            // Atualizar stats com anima√ß√£o
            animarContador('statTotal', stats.total);
            animarContador('statPendentes', stats.pendentes);
            animarContador('statCompletas', stats.completas);
            animarContador('statVendedores', stats.vendedores);
            
            // Atualizar contadores dos filtros
            document.getElementById('filtroTodos').textContent = stats.total;
            document.getElementById('filtroPendentes').textContent = stats.pendentes;
            document.getElementById('filtroCompletas').textContent = stats.completas;
            document.getElementById('filtroUrgentes').textContent = stats.urgentes;
            
            // Atualizar √∫ltima atualiza√ß√£o
            document.getElementById('ultimaAtualizacao').textContent = 
                `√öltima atualiza√ß√£o: ${new Date().toLocaleString('pt-BR')}`;
            
            addDebugLog('üìä Dashboard atualizado com anima√ß√µes', 'success');
        }
        
        function animarContador(elementId, valorFinal) {
            const elemento = document.getElementById(elementId);
            if (!elemento) return;
            
            const valorInicial = 0;
            const duracao = 1500;
            const inicio = Date.now();
            
            function atualizar() {
                const agora = Date.now();
                const progresso = Math.min((agora - inicio) / duracao, 1);
                
                // Easing function para suavizar a anima√ß√£o
                const easeOut = 1 - Math.pow(1 - progresso, 3);
                const valorAtual = Math.round(valorInicial + (valorFinal - valorInicial) * easeOut);
                
                elemento.textContent = valorAtual.toLocaleString('pt-BR');
                
                if (progresso < 1) {
                    requestAnimationFrame(atualizar);
                }
            }
            
            requestAnimationFrame(atualizar);
        }
        
        function calcularEstatisticas() {
            let urgentes = 0;
            let pendentes = 0;
            let completas = 0;
            
            recibosData.forEach(recibo => {
                // üîß CORRE√á√ÉO: Usar fun√ß√£o segura para verificar urg√™ncia
                const diffDias = calcularDiferencaDias(recibo.dataIda || recibo.dataEmbarque);
                
                if (diffDias <= 3 && diffDias !== 999) urgentes++;
                
                // Verificar se est√° pendente
                if (!recibo.cpf || recibo.cpf.length < 11 || 
                    !recibo.whatsapp || recibo.whatsapp.length < 10) {
                    pendentes++;
                } else {
                    completas++;
                }
            });
            
            return {
                total: recibosData.length,
                urgentes,
                pendentes,
                completas,
                vendedores: Object.keys(vendedoresData).length
            };
        }

        // ================================================================================
        // EXIBI√á√ÉO DOS DADOS
        // ================================================================================
        
        function exibirDados() {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            exibirVendedores();
            filtrarEExibirRecibos();
            
            addDebugLog('‚úÖ Interface atualizada e dados exibidos', 'success');
        }
        
        function exibirVendedores() {
            const vendedoresList = document.getElementById('vendedoresList');
            let html = '';
            
            Object.values(vendedoresData).forEach(vendedor => {
                if (vendedor.total === 0) return; // S√≥ mostrar vendedores com vendas
                
                const statusClass = vendedor.urgentes > 0 ? 'pendente' : 'ativo';
                
                html += `
                    <div class="vendedor-card" onclick="selecionarVendedor('${vendedor.nome}')">
                        <div class="vendedor-header">
                            <div class="vendedor-nome">
                                <i class="fas fa-user"></i> ${vendedor.nome}
                            </div>
                            <div class="vendedor-status ${statusClass}">
                                ${vendedor.urgentes > 0 ? 'Urg√™ncias Pendentes' : 'Em Dia'}
                            </div>
                        </div>
                        <div class="vendedor-stats">
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.total}</div>
                                <div class="vendedor-stat-label">Total</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.urgentes}</div>
                                <div class="vendedor-stat-label">Urgentes</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.semCPF}</div>
                                <div class="vendedor-stat-label">Sem CPF</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.semWhatsApp}</div>
                                <div class="vendedor-stat-label">Sem WhatsApp</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (html === '') {
                html = `
                    <div class="text-center py-5">
                        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                        <h4>Nenhuma venda pendente!</h4>
                        <p class="text-muted">Todas as vendas foram completadas</p>
                    </div>
                `;
            }
            
            vendedoresList.innerHTML = html;
        }
        
        function filtrarEExibirRecibos() {
            let recibosFiltrados = [...recibosData];
            
            // Aplicar filtro ativo
            switch (filtroAtivo) {
                case 'pendentes':
                    recibosFiltrados = recibosFiltrados.filter(recibo => 
                        !recibo.cpf || recibo.cpf.length < 11 || 
                        !recibo.whatsapp || recibo.whatsapp.length < 10
                    );
                    break;
                case 'completas':
                    recibosFiltrados = recibosFiltrados.filter(recibo => 
                        recibo.cpf && recibo.cpf.length >= 11 && 
                        recibo.whatsapp && recibo.whatsapp.length >= 10
                    );
                    break;
                case 'urgentes':
                    recibosFiltrados = recibosFiltrados.filter(recibo => {
                        const diffDias = calcularDiferencaDias(recibo.dataIda || recibo.dataEmbarque);
                        return diffDias <= 3 && diffDias !== 999;
                    });
                    break;
            }
            
            // Aplicar busca por texto
            if (termoBusca) {
                recibosFiltrados = recibosFiltrados.filter(recibo => 
                    (recibo.nomeCliente || '').toLowerCase().includes(termoBusca) ||
                    (recibo.recibo || '').toLowerCase().includes(termoBusca) ||
                    (recibo.vendedor || '').toLowerCase().includes(termoBusca)
                );
            }
            
            // Filtrar por vendedor selecionado
            if (vendedorSelecionado) {
                recibosFiltrados = recibosFiltrados.filter(r => r.vendedor === vendedorSelecionado);
            }
            
            exibirRecibos(recibosFiltrados);
        }
        
        function exibirRecibos(recibos) {
            const recibosList = document.getElementById('recibosList');
            
            if (recibos.length === 0) {
                recibosList.innerHTML = `
                    <div class="text-center py-5">
                        <i class="fas fa-search fa-3x text-muted mb-3"></i>
                        <h4>Nenhum recibo encontrado</h4>
                        <p class="text-muted">Tente ajustar os filtros ou termo de busca</p>
                    </div>
                `;
                return;
            }
            
            let html = '';
            
            recibos.forEach((recibo, index) => {
                // üîß CORRE√á√ÉO: Usar fun√ß√£o segura para c√°lculos
                const diffDias = calcularDiferencaDias(recibo.dataIda || recibo.dataEmbarque);
                const urgenciaClass = (diffDias <= 3 && diffDias !== 999) ? 'urgente' : 'normal';
                const dataFormatada = formatarDataSegura(recibo.dataIda || recibo.dataEmbarque);
                
                html += `
                    <div class="recibo-card" style="animation-delay: ${index * 0.1}s">
                        <div class="recibo-header">
                            <div class="recibo-numero">üìÑ ${recibo.recibo || recibo.id || recibo.numeroInforme || 'N/A'}</div>
                            <div class="recibo-urgencia ${urgenciaClass}">
                                ${(diffDias <= 3 && diffDias !== 999) ? `Urgente (${diffDias} dias)` : 'Normal'}
                            </div>
                        </div>
                        <div class="recibo-info">
                            <div class="recibo-campo">
                                <span class="recibo-label">Cliente:</span>
                                <span class="recibo-valor">${recibo.nomeCliente || 'N√£o informado'}</span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">Vendedor:</span>
                                <span class="recibo-valor">${recibo.vendedor || 'N√£o informado'}</span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">Embarque:</span>
                                <span class="recibo-valor">${dataFormatada}</span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">CPF:</span>
                                <span class="recibo-valor ${!recibo.cpf || recibo.cpf.length < 11 ? 'text-danger' : 'text-success'}">
                                    ${recibo.cpf || '‚ùå Pendente'}
                                </span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">WhatsApp:</span>
                                <span class="recibo-valor ${!recibo.whatsapp || recibo.whatsapp.length < 10 ? 'text-danger' : 'text-success'}">
                                    ${recibo.whatsapp || '‚ùå Pendente'}
                                </span>
                            </div>
                            <div class="recibo-campo">
                                <span class="recibo-label">Tipo:</span>
                                <span class="recibo-valor">${recibo.tipo || 'N/A'}</span>
                            </div>
                        </div>
                        <div class="recibo-actions">
                            <button class="btn btn-primary btn-sm" onclick="completarDados('${recibo.recibo || recibo.id || recibo.numeroInforme || index}')">
                                <i class="fas fa-upload"></i> Completar Dados
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="visualizarVenda('${recibo.recibo || recibo.id || recibo.numeroInforme || index}')">
                                <i class="fas fa-eye"></i> Visualizar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            recibosList.innerHTML = html;
        }

        // ================================================================================
        // SELE√á√ÉO DE VENDEDOR
        // ================================================================================
        
        function selecionarVendedor(nomeVendedor) {
            vendedorSelecionado = nomeVendedor;
            
            // Atualizar interface
            document.getElementById('btnVoltar').style.display = 'inline-block';
            
            // Filtrar e exibir
            filtrarEExibirRecibos();
            
            showToast(`Exibindo vendas pendentes de ${nomeVendedor}`, 'info');
        }
        
        function voltarVendedores() {
            vendedorSelecionado = null;
            document.getElementById('btnVoltar').style.display = 'none';
            filtrarEExibirRecibos();
        }

        // ================================================================================
        // SISTEMA DE FILTROS
        // ================================================================================
        
        function aplicarFiltro(filtro) {
            // Remover classe active de todos os cards
            document.querySelectorAll('.filtro-card').forEach(card => {
                card.classList.remove('active');
            });
            
            // Adicionar classe active ao card clicado
            document.querySelector(`[data-filtro="${filtro}"]`).classList.add('active');
            
            filtroAtivo = filtro;
            filtrarEExibirRecibos();
            
            addDebugLog(`üîç Filtro aplicado: ${filtro}`, 'info');
            showToast(`Filtro "${filtro}" aplicado`, 'info', 2000);
        }

        // ================================================================================
        // MODAL DE COMPLEMENTA√á√ÉO DE DADOS
        // ================================================================================
        
        function completarDados(recibo) {
            // üîß CORRE√á√ÉO: Buscar venda por m√∫ltiplas propriedades poss√≠veis
            vendaAtual = recibosData.find(r => 
                r.recibo === recibo || 
                r.id === recibo || 
                r.numeroInforme === recibo ||
                r.numeroRecibo === recibo ||
                r.nomeCliente === recibo || // Fallback para debug
                String(r.recibo) === String(recibo) ||
                String(r.id) === String(recibo)
            );
            
            // Debug detalhado se n√£o encontrar
            if (!vendaAtual) {
                addDebugLog(`‚ùå Venda n√£o encontrada para: ${recibo}`, 'error');
                addDebugLog(`üìä Total de recibos dispon√≠veis: ${recibosData.length}`, 'info');
                addDebugLog(`üìä Exemplo de estrutura dos dados:`, 'info');
                if (recibosData.length > 0) {
                    console.log('Estrutura do primeiro recibo:', recibosData[0]);
                    addDebugLog(`Propriedades dispon√≠veis: ${Object.keys(recibosData[0]).join(', ')}`, 'info');
                }
                
                showToast(`Venda n√£o encontrada: ${recibo}. Verifique o console para debug.`, 'error');
                return;
            }
            
            addDebugLog(`üìã Abrindo complementa√ß√£o para venda ${recibo}`, 'info');
            addDebugLog(`üìä Dados da venda encontrada:`, 'info');
            console.log('Venda atual:', vendaAtual);
            
            // Resetar modal
            resetarModal();
            
            // Preencher dados b√°sicos
            preencherDadosBasicos();
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('modalComplementar'));
            modal.show();
        }
        
        function resetarModal() {
            passoAtual = 1;
            dadosExtraidos = {};
            
            // Resetar indicadores de passos
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active', 'completed');
            });
            document.getElementById('step1Indicator').classList.add('active');
            
            // Mostrar apenas passo 1
            document.querySelectorAll('.step-content').forEach(step => {
                step.style.display = 'none';
            });
            document.getElementById('step1').style.display = 'block';
            
            // Resetar upload
            document.getElementById('fileInput').value = '';
            document.getElementById('uploadProgress').style.display = 'none';
            
            // Resetar formul√°rio
            const form = document.getElementById('formCompleto');
            if (form) {
                form.reset();
            }
        }
        
        function preencherDadosBasicos() {
            const dadosBasicos = document.getElementById('dadosBasicos');
            
            dadosBasicos.innerHTML = `
                <div class="dado-item">
                    <span class="dado-label">Recibo:</span>
                    <span class="dado-valor">${vendaAtual.recibo || 'N/A'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Vendedor:</span>
                    <span class="dado-valor">${vendaAtual.vendedor || 'N/A'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Data Embarque:</span>
                    <span class="dado-valor">${formatarDataSegura(vendaAtual.dataIda)}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Cliente:</span>
                    <span class="dado-valor">${vendaAtual.nomeCliente || 'N√£o informado'}</span>
                </div>
                <div class="dado-item">
                    <span class="dado-label">Tipo:</span>
                    <span class="dado-valor">${vendaAtual.tipo || 'N√£o informado'}</span>
                </div>
            `;
        }

        // ================================================================================
        // NAVEGA√á√ÉO ENTRE PASSOS
        // ================================================================================
        
        function proximoPasso(passo) {
            // Atualizar indicadores
            document.querySelectorAll('.step').forEach(step => {
                step.classList.remove('active');
            });
            
            for (let i = 1; i < passo; i++) {
                document.getElementById(`step${i}Indicator`).classList.add('completed');
            }
            document.getElementById(`step${passo}Indicator`).classList.add('active');
            
            // Esconder passo atual
            document.getElementById(`step${passoAtual}`).style.display = 'none';
            
            // Mostrar pr√≥ximo passo
            passoAtual = passo;
            document.getElementById(`step${passo}`).style.display = 'block';
            
            // A√ß√µes espec√≠ficas por passo
            if (passo === 4) {
                preencherFormularioCompleto();
            }
            
            addDebugLog(`üìç Avan√ßou para passo ${passo}`, 'info');
        }
        
        function voltarPasso(passo) {
            proximoPasso(passo);
        }

        // ================================================================================
        // UPLOAD E PROCESSAMENTO DE PDF
        // ================================================================================
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
                showToast('Apenas arquivos PDF s√£o aceitos', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) { // 10MB
                showToast('Arquivo muito grande. M√°ximo 10MB', 'error');
                return;
            }
            
            processarPDF(file);
        }
        
        function processarPDF(file) {
            addDebugLog(`üìÑ Processando PDF: ${file.name}`, 'info');
            
            // Mostrar progress
            document.getElementById('uploadProgress').style.display = 'block';
            
            // Simular upload e extra√ß√£o
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                document.getElementById('uploadProgressBar').style.width = progress + '%';
                document.getElementById('uploadPercent').textContent = Math.round(progress) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    finalizarProcessamentoPDF(file);
                }
            }, 200);
        }
        
        function finalizarProcessamentoPDF(file) {
            addDebugLog('‚úÖ PDF processado com sucesso', 'success');
            
            // Simular dados extra√≠dos
            dadosExtraidos = simularExtracaoPDF(file.name);
            
            // Mostrar dados extra√≠dos
            mostrarDadosExtraidos();
            
            // Avan√ßar para pr√≥ximo passo
            setTimeout(() => {
                proximoPasso(3);
                showToast('Dados extra√≠dos do PDF com sucesso!', 'success');
            }, 500);
        }
        
        function simularExtracaoPDF(fileName) {
            // EXTRAIR APENAS DADOS REAIS DO PDF - N√ÉO INVENTAR NADA!
            // PDF: 62200000128415.pdf - Maria Gorete Abreu De Souza (CONTRATANTE)
            
            const dadosReais = {
                // DADOS DO CONTRATANTE (quem comprou - da se√ß√£o CONTRATANTE)
                nomeCliente: 'Maria Gorete Abreu De Souza', // Nome real do contratante
                // CPF e WhatsApp do CONTRATANTE: N√ÉO INFORMADOS NO PDF - vendedor deve preencher
                
                // DADOS DA VIAGEM (reais do PDF)
                destino: 'SALVADOR', // BA - Brasil
                dataIda: '2025-11-28', // 28/11/2025
                dataVolta: '2025-11-28', // Mesmo dia (s√≥ ida)
                valorTotal: 'R$ 687,33', // Valor real da se√ß√£o CONTRATANTE
                
                // DADOS DA RESERVA (reais do PDF)
                numeroReserva: '302440674', // N√∫mero da Reserva real
                locGds: 'OCUJVF', // Localizador GDS real
                locCia: 'OCUJVF', // Localizador Cia real
                formaPagamento: 'MASTERCARD', // Forma real do PDF
                
                // DADOS DO VOO (reais do PDF)
                companhiaAerea: 'GOL', // G3
                numeroVoo: 'G3 1566', // Voo real
                trecho: 'CGH/SSA', // S√£o Paulo Congonhas / Salvador
                tipoAereo: 'OW' // One Way (s√≥ ida)
            };
            
            addDebugLog('üìÑ Dados REAIS extra√≠dos do PDF (sem inven√ß√µes):', 'success');
            addDebugLog('‚ö†Ô∏è CPF e WhatsApp do CONTRATANTE n√£o est√£o no PDF - vendedor deve preencher!', 'warning');
            console.log('Dados extra√≠dos (apenas reais):', dadosReais);
            
            return dadosReais;
        }
        
        function mostrarDadosExtraidos() {
            const container = document.getElementById('dadosExtractedList');
            let html = '';
            
            Object.entries(dadosExtraidos).forEach(([key, value]) => {
                if (value) {
                    html += `
                        <div class="dado-item">
                            <span class="dado-label">${formatarLabel(key)}:</span>
                            <span class="dado-valor">${value}</span>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        function formatarLabel(key) {
            const labels = {
                nomeCliente: 'Nome do Cliente',
                cpfCliente: 'CPF',
                dataNascimento: 'Data de Nascimento',
                whatsappCliente: 'WhatsApp',
                emailCliente: 'Email',
                destino: 'Destino',
                dataIda: 'Data de Ida',
                dataVolta: 'Data de Volta',
                hotel: 'Hotel',
                valorTotal: 'Valor Total',
                locGds: 'LOC GDS',
                locCia: 'LOC CIA',
                numeroReserva: 'N√∫mero da Reserva',
                formaPagamento: 'Forma de Pagamento',
                companhiaAerea: 'Companhia A√©rea',
                numeroVoo: 'N√∫mero do Voo',
                trecho: 'Trecho',
                acordoTransporte: 'Acordo Transporte',
                tipoAereo: 'Tipo A√©reo'
            };
            
            return labels[key] || key;
        }

        // ================================================================================
        // FORMUL√ÅRIO COMPLETO
        // ================================================================================
        
        function preencherFormularioCompleto() {
            // Preencher com dados da venda atual
            if (vendaAtual.nomeCliente) document.getElementById('nomeCliente').value = vendaAtual.nomeCliente;
            if (vendaAtual.cpfCliente) document.getElementById('cpfCliente').value = vendaAtual.cpfCliente;
            if (vendaAtual.whatsappCliente) document.getElementById('whatsappCliente').value = vendaAtual.whatsappCliente;
            
            // Preencher campo Cliente Ale baseado nos dados da venda atual
            if (vendaAtual.clienteAle) {
                document.getElementById('clienteAle').value = vendaAtual.clienteAle;
            } else {
                // Se n√£o tem o campo, definir como "N√£o" por padr√£o
                document.getElementById('clienteAle').value = 'N√£o';
            }
            
            // Preencher com dados extra√≠dos do PDF
            Object.entries(dadosExtraidos).forEach(([key, value]) => {
                const campo = document.getElementById(key);
                if (campo && value) {
                    campo.value = value;
                }
            });
            
            // Preencher campos espec√≠ficos com base nos dados extra√≠dos
            if (dadosExtraidos.tipoAereo) {
                const tipoAereoSelect = document.getElementById('tipoAereo');
                if (tipoAereoSelect) {
                    tipoAereoSelect.value = dadosExtraidos.tipoAereo;
                }
            }
            
            // Auto-detectar e mostrar campos a√©reos se necess√°rio
            const tipoProduto = document.getElementById('tipoProduto');
            if (tipoProduto && dadosExtraidos.companhiaAerea) {
                // Se tem dados de companhia a√©rea, definir como produto a√©reo
                tipoProduto.value = 'AEREO';
                mostrarCamposAereos();
            }
            
            addDebugLog('üìù Formul√°rio preenchido com dados dispon√≠veis', 'info');
            addDebugLog('üìä Dados da venda atual aplicados', 'info');
            addDebugLog('üìÑ Dados do PDF aplicados', 'info');
        }
        
        // Fun√ß√£o para mostrar campos a√©reos automaticamente
        function mostrarCamposAereos() {
            // Adicionar campos espec√≠ficos de voo se n√£o existirem
            const formulario = document.getElementById('formCompleto');
            let secaoVoo = document.getElementById('secaoVoo');
            
            if (!secaoVoo) {
                // Criar se√ß√£o de voo se n√£o existir
                const secaoViagem = document.querySelector('.form-section h5[data-viagem]')?.closest('.form-section');
                if (secaoViagem) {
                    const novaSecao = document.createElement('div');
                    novaSecao.className = 'form-section';
                    novaSecao.id = 'secaoVoo';
                    novaSecao.innerHTML = `
                        <h5><i class="fas fa-plane"></i> Detalhes do Voo</h5>
                        <div class="row g-3">
                            <div class="col-md-4">
                                <label class="form-label">Companhia A√©rea</label>
                                <select class="form-select" id="companhiaAerea">
                                    <option value="">Selecione...</option>
                                    <option value="GOL">GOL</option>
                                    <option value="LATAM">LATAM</option>
                                    <option value="AZUL">AZUL</option>
                                    <option value="VOEPASS">VOEPASS</option>
                                    <option value="Air France">Air France</option>
                                    <option value="American Airlines">American Airlines</option>
                                    <option value="Emirates">Emirates</option>
                                    <option value="TAP">TAP</option>
                                    <option value="Lufthansa">Lufthansa</option>
                                    <option value="Air Canada">Air Canada</option>
                                    <option value="OUTRAS">OUTRAS</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">N√∫mero do Voo</label>
                                <input type="text" class="form-control" id="numeroVoo" placeholder="Ex: G3 1566">
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Trecho</label>
                                <input type="text" class="form-control" id="trechoVoo" placeholder="Ex: CGH/SSA">
                            </div>
                        </div>
                        <div class="row g-3 mt-2">
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="temBagagemVoo">
                                    <label class="form-check-label" for="temBagagemVoo">
                                        <i class="fas fa-suitcase"></i> Tem Bagagem
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="temAssentoVoo">
                                    <label class="form-check-label" for="temAssentoVoo">
                                        <i class="fas fa-chair"></i> Assento Marcado
                                    </label>
                                </div>
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Hor√°rio Partida</label>
                                <input type="time" class="form-control" id="horarioPartida">
                            </div>
                            <div class="col-md-3">
                                <label class="form-label">Hor√°rio Chegada</label>
                                <input type="time" class="form-control" id="horarioChegada">
                            </div>
                        </div>
                    `;
                    
                    // Inserir ap√≥s a se√ß√£o de viagem
                    secaoViagem.parentNode.insertBefore(novaSecao, secaoViagem.nextSibling);
                    
                    // Preencher com dados extra√≠dos se dispon√≠veis
                    if (dadosExtraidos.companhiaAerea) {
                        document.getElementById('companhiaAerea').value = dadosExtraidos.companhiaAerea;
                    }
                    if (dadosExtraidos.numeroVoo) {
                        document.getElementById('numeroVoo').value = dadosExtraidos.numeroVoo;
                    }
                    if (dadosExtraidos.trecho) {
                        document.getElementById('trechoVoo').value = dadosExtraidos.trecho;
                    }
                    
                    addDebugLog('‚úàÔ∏è Se√ß√£o de voo adicionada automaticamente', 'success');
                }
            }
        }
        
        // Fun√ß√£o para detectar quando tipo de produto √© a√©reo
        function configurarDeteccaoAereo() {
            const tipoProduto = document.getElementById('tipoProduto');
            if (tipoProduto) {
                tipoProduto.addEventListener('change', function() {
                    const tiposAereos = ['AEREO', 'A+H', 'A+H+S', 'A√©reo'];
                    if (tiposAereos.includes(this.value)) {
                        mostrarCamposAereos();
                        addDebugLog('‚úàÔ∏è Tipo a√©reo detectado - mostrando campos de voo', 'info');
                    } else {
                        // Remover se√ß√£o de voo se n√£o for a√©reo
                        const secaoVoo = document.getElementById('secaoVoo');
                        if (secaoVoo) {
                            secaoVoo.remove();
                            addDebugLog('üö´ Campos de voo removidos - tipo n√£o a√©reo', 'info');
                        }
                    }
                });
            }
        }

        // ================================================================================
        // SALVAMENTO DA VENDA
        // ================================================================================
        
        function salvarVendaCompleta() {
            addDebugLog('üíæ Salvando venda completa na planilha...', 'info');
            
            // Coletar dados do formul√°rio
            const dadosCompletos = coletarDadosFormulario();
            
            // Validar campos obrigat√≥rios
            if (!validarDadosObrigatorios(dadosCompletos)) {
                return;
            }
            
            // Mostrar loading no bot√£o
            const btnSalvar = document.querySelector('[onclick="salvarVendaCompleta()"]');
            const textoOriginal = btnSalvar.innerHTML;
            btnSalvar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
            btnSalvar.disabled = true;
            
            showToast('Salvando venda na planilha...', 'info');
            
            // Chamar API real para salvar
            chamarAPIJsonp('cadastrar', {
                aba: 'EMBARQUES',
                dados: JSON.stringify(dadosCompletos)
            })
            .then(resultado => {
                if (resultado.success) {
                    // Atualizar venda local
                    Object.assign(vendaAtual, dadosCompletos);
                    
                    // Fechar modal
                    bootstrap.Modal.getInstance(document.getElementById('modalComplementar')).hide();
                    
                    // Atualizar interface
                    processarDadosVendedores();
                    atualizarDashboard();
                    filtrarEExibirRecibos();
                    
                    showToast('Venda salva com sucesso na planilha!', 'success');
                    
                } else {
                    throw new Error(resultado.message || 'Erro ao salvar na planilha');
                }
            })
            .catch(error => {
                addDebugLog('‚ùå Erro ao salvar:', error);
                showToast(`Erro ao salvar: ${error.message}`, 'error');
            })
            .finally(() => {
                // Restaurar bot√£o
                btnSalvar.innerHTML = textoOriginal;
                btnSalvar.disabled = false;
            });
        }
        
        function coletarDadosFormulario() {
            const dados = {};
            
            // Lista de campos do formul√°rio b√°sico
            const campos = [
                'nomeCliente', 'cpfCliente', 'dataNascimento', 'whatsappCliente', 'emailCliente', 'rgCliente',
                'destino', 'dataIda', 'dataVolta', 'hotel', 'tipoProduto', 'valorTotal', 'formaPagamento', 'dataReserva',
                'locGds', 'locCia', 'reservaOnline', 'numeroReserva',
                'clienteAle', 'tipoAereo', 'temBagagem', 'temAssento', 'observacoes'
            ];
            
            campos.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (elemento) {
                    dados[campo] = elemento.value.trim();
                }
            });
            
            // Campos espec√≠ficos de voo (se existirem)
            const camposVoo = [
                'companhiaAerea', 'numeroVoo', 'trechoVoo', 'horarioPartida', 'horarioChegada'
            ];
            
            camposVoo.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (elemento) {
                    dados[campo] = elemento.value.trim();
                }
            });
            
            // Checkboxes de voo
            const temBagagemVoo = document.getElementById('temBagagemVoo');
            const temAssentoVoo = document.getElementById('temAssentoVoo');
            
            if (temBagagemVoo) {
                dados.temBagagemVoo = temBagagemVoo.checked ? 'Sim' : 'N√£o';
            }
            
            if (temAssentoVoo) {
                dados.temAssentoVoo = temAssentoVoo.checked ? 'Sim' : 'N√£o';
            }
            
            // Adicionar dados fixos
            dados.recibo = vendaAtual.recibo;
            dados.vendedor = vendaAtual.vendedor;
            dados.dataComplementacao = new Date().toISOString();
            dados.sistemaOrigem = 'Portal CVC Itaqu√° - Sistema Completo';
            
            // Se tem dados de voo, marcar como produto a√©reo
            if (dados.companhiaAerea || dados.numeroVoo) {
                dados.isVooCompleto = true;
                addDebugLog('‚úàÔ∏è Dados de voo detectados na coleta', 'info');
            }
            
            addDebugLog('üìä Dados coletados (incluindo voo se aplic√°vel):', 'info');
            console.log('Dados completos:', dados);
            return dados;
        }
        
        function validarDadosObrigatorios(dados) {
            const obrigatorios = [
                { campo: 'nomeCliente', nome: 'Nome do Cliente' },
                { campo: 'cpfCliente', nome: 'CPF do Contratante' },
                { campo: 'whatsappCliente', nome: 'WhatsApp do Contratante' },
                { campo: 'clienteAle', nome: 'Cliente Ale' }
            ];
            
            const faltantes = [];
            
            obrigatorios.forEach(item => {
                if (!dados[item.campo] || dados[item.campo].trim() === '') {
                    faltantes.push(item.nome);
                }
            });
            
            if (faltantes.length > 0) {
                showToast(`Campos obrigat√≥rios n√£o preenchidos: ${faltantes.join(', ')}`, 'error', 6000);
                addDebugLog(`‚ùå Valida√ß√£o falhou: ${faltantes.join(', ')}`, 'error');
                return false;
            }
            
            // Validar formato CPF (deve ter 11 d√≠gitos)
            const cpfLimpo = dados.cpfCliente.replace(/\D/g, '');
            if (cpfLimpo.length !== 11) {
                showToast('CPF deve ter 11 d√≠gitos v√°lidos', 'error');
                addDebugLog('‚ùå CPF inv√°lido: deve ter 11 d√≠gitos', 'error');
                return false;
            }
            
            // Validar WhatsApp (deve ter pelo menos 10 d√≠gitos)
            const whatsLimpo = dados.whatsappCliente.replace(/\D/g, '');
            if (whatsLimpo.length < 10) {
                showToast('WhatsApp deve ter pelo menos 10 d√≠gitos', 'error');
                addDebugLog('‚ùå WhatsApp inv√°lido: deve ter pelo menos 10 d√≠gitos', 'error');
                return false;
            }
            
            addDebugLog('‚úÖ Valida√ß√£o passou: todos os campos obrigat√≥rios preenchidos', 'success');
            return true;
        }
        
        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            return cpf.length === 11;
        }

        // ================================================================================
        // FUN√á√ïES AUXILIARES
        // ================================================================================
        
        function visualizarVenda(recibo) {
            const venda = recibosData.find(r => r.recibo === recibo);
            if (venda) {
                showToast(`Visualizando venda ${recibo}`, 'info');
                // Implementar modal de visualiza√ß√£o se necess√°rio
            }
        }
        
        function atualizarDados() {
            showToast('Atualizando dados...', 'info');
            carregarDadosInicial();
        }
        
        function mostrarErro(mensagem) {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('errorMessage').textContent = mensagem;
            
            addDebugLog(`‚ùå Erro exibido: ${mensagem}`, 'error');
        }

        // ================================================================================
        // INICIALIZA√á√ÉO DO SISTEMA
        // ================================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            addDebugLog('üéØ DOM carregado, inicializando sistema...', 'info');
            inicializarSistema();
        });

        // ================================================================================
        // EXPOSI√á√ÉO DE FUN√á√ïES GLOBAIS PARA DEBUG
        // ================================================================================
        
        window.atualizarDados = atualizarDados;
        window.testarConexaoAPI = testarConexaoAPI;
        window.completarDados = completarDados;
        window.visualizarVenda = visualizarVenda;
        window.selecionarVendedor = selecionarVendedor;
        window.voltarVendedores = voltarVendedores;
        window.aplicarFiltro = aplicarFiltro;
        window.proximoPasso = proximoPasso;
        window.voltarPasso = voltarPasso;
        window.salvarVendaCompleta = salvarVendaCompleta;
    </script>
</body>
</html>
