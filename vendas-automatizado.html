<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC Itaquá - Portal de Gestão da Loja - Sistema Completo de Vendas</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="CVC Itaquá - Sistema Completo de Vendas - Dados Reais da Planilha com Upload de PDF">
    <meta name="keywords" content="CVC, Itaquaquecetuba, vendas, automatizado, embarques, recibos, pdf">
    <meta name="author" content="CVC Itaquaquecetuba">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/cvc-styles.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/cvc-favicon.ico">
    
    <style>
        /* ===== ESTILOS ESPECÍFICOS DA PÁGINA VENDAS COMPLETO v11.0 ===== */
        
        :root {
            --cvc-amarelo: #FFE600;
            --cvc-azul: #0A00B4;
            --cvc-branco: #FFFFFF;
            --cvc-verde: #00D4AA;
            --cvc-azul-escuro: #1B365D;
            --cvc-cinza: #6C757D;
            --cvc-fundo-card: #f8f9fa;
            --cvc-sombra-suave: 0 4px 6px rgba(0,0,0,0.1);
            --cvc-sombra-media: 0 8px 15px rgba(0,0,0,0.2);
        }
        
        .vendas-completo-container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Dashboard Status */
        .status-dashboard {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-azul-escuro));
            border-radius: 20px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            animation: fadeIn 0.8s ease-out;
        }

        .status-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 230, 0, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            animation: slideInUp 0.6s ease-out;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--cvc-amarelo);
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            counter-reset: count;
            animation: countUp 2s ease-out;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 500;
        }

        /* Seção de Vendedores */
        .vendedores-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-verde);
            animation: fadeIn 1s ease-out;
        }

        .vendedor-card {
            background: var(--cvc-branco);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--cvc-sombra-suave);
            margin-bottom: 20px;
            border-left: 5px solid var(--cvc-azul);
            transition: all 0.3s ease;
            cursor: pointer;
            animation: slideInUp 0.6s ease-out;
            position: relative;
        }

        .vendedor-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }

        .vendedor-card.selected {
            background: linear-gradient(135deg, rgba(10, 0, 180, 0.1), rgba(255, 230, 0, 0.1));
            border-left-color: var(--cvc-amarelo);
        }

        .vendedor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .vendedor-nome {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--cvc-azul);
        }

        .vendedor-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .vendedor-status.pendente {
            background: #ffc107;
            color: #000;
        }

        .vendedor-status.em-dia {
            background: #28a745;
            color: white;
        }

        .vendedor-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .vendedor-stat {
            text-align: center;
            min-width: 80px;
        }

        .vendedor-stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--cvc-azul);
            line-height: 1;
        }

        .vendedor-stat-label {
            font-size: 0.8rem;
            color: var(--cvc-cinza);
            margin-top: 2px;
        }

        /* Container de Vendas */
        .vendas-container {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            animation: fadeIn 1.2s ease-out;
        }

        .venda-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
            transition: all 0.3s ease;
            animation: slideInUp 0.5s ease-out;
        }

        .venda-card:hover {
            transform: translateX(5px);
            box-shadow: var(--cvc-sombra-media);
        }

        .venda-card.pendente {
            border-left-color: #ffc107;
        }

        .venda-card.completa {
            border-left-color: #28a745;
        }

        .venda-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .venda-numero {
            font-weight: 700;
            color: var(--cvc-azul);
            font-size: 1.1rem;
        }

        .venda-status {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .venda-status.pendente {
            background: #ffc107;
            color: #000;
        }

        .venda-status.completa {
            background: #28a745;
            color: white;
        }

        .venda-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .venda-campo {
            font-size: 0.9rem;
        }

        .venda-label {
            font-weight: 600;
            color: var(--cvc-cinza);
        }

        .venda-valor {
            color: var(--cvc-azul);
            font-weight: 500;
        }

        .venda-actions {
            margin-top: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        /* Modal de Upload */
        .modal-upload {
            backdrop-filter: blur(5px);
        }

        .upload-area {
            border: 2px dashed var(--cvc-azul);
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: var(--cvc-fundo-card);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-area.dragover {
            border-color: var(--cvc-amarelo);
            background: rgba(255, 230, 0, 0.1);
        }

        .upload-icon {
            font-size: 3rem;
            color: var(--cvc-azul);
            margin-bottom: 15px;
        }

        /* Formulário de Dados */
        .form-section {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-verde);
        }

        .form-section h5 {
            color: var(--cvc-azul);
            margin-bottom: 20px;
            font-weight: 700;
        }

        .form-control, .form-select {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 10px 15px;
            transition: all 0.3s ease;
        }

        .form-control:focus, .form-select:focus {
            border-color: var(--cvc-azul);
            box-shadow: 0 0 0 3px rgba(10, 0, 180, 0.1);
        }

        .btn-upload {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-azul-escuro));
            border: none;
            color: white;
            padding: 12px 25px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-upload:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(10, 0, 180, 0.3);
            color: white;
        }

        /* Loading e Error */
        .loading-container {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-amarelo));
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            color: white;
            margin: 50px 0;
            animation: pulse 2s infinite;
        }

        .error-container {
            background: linear-gradient(135deg, #dc3545, #ff6b6b);
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            color: white;
            margin: 50px 0;
        }

        /* Toast Notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }

        .toast-notification {
            background: var(--cvc-branco);
            border-radius: 10px;
            padding: 15px 20px;
            margin-bottom: 10px;
            box-shadow: var(--cvc-sombra-media);
            border-left: 4px solid var(--cvc-azul);
            min-width: 300px;
            animation: slideInRight 0.5s ease-out;
        }

        .toast-success {
            border-left-color: #28a745;
        }

        .toast-error {
            border-left-color: #dc3545;
        }

        .toast-warning {
            border-left-color: #ffc107;
        }

        /* Dados Extraídos */
        .dados-extraidos {
            background: var(--cvc-fundo-card);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid var(--cvc-verde);
        }

        .dado-extraido {
            padding: 8px 12px;
            margin: 5px 0;
            background: var(--cvc-branco);
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .dado-label {
            font-weight: 600;
            color: var(--cvc-azul);
        }

        .dado-valor {
            color: var(--cvc-cinza);
        }

        /* Animações */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes slideInRight {
            from { transform: translateX(30px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes countUp {
            from { opacity: 0; transform: scale(0.8); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .vendas-completo-container {
                padding: 10px;
            }

            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }

            .stat-number {
                font-size: 2rem;
            }

            .vendedor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .vendedor-stats {
                justify-content: space-around;
                width: 100%;
            }

            .venda-header {
                flex-direction: column;
                align-items: flex-start;
            }

            .venda-info {
                grid-template-columns: 1fr;
            }

            .venda-actions {
                justify-content: center;
            }
        }

        @media (max-width: 480px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }

            .stat-card {
                padding: 20px;
            }

            .stat-number {
                font-size: 1.8rem;
            }

            .toast-notification {
                min-width: 250px;
            }
        }

        /* Progress Bar */
        .progress-bar-custom {
            background: linear-gradient(90deg, var(--cvc-azul), var(--cvc-amarelo));
            transition: width 0.3s ease;
        }

        /* Status Indicators */
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .status-indicator.pendente {
            background: #ffc107;
        }

        .status-indicator.completo {
            background: #28a745;
        }

        .status-indicator.erro {
            background: #dc3545;
        }
    </style>
</head>
<body>
    <!-- HEADER CVC PADRÃO -->
    <header class="cvc-header">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <!-- Logo CVC -->
                <div class="col-md-4">
                    <div class="cvc-logo">
                        <div class="cvc-logo-symbol">CVC</div>
                        <div>
                            <div class="cvc-logo-text">CVC Itaquá</div>
                            <p class="cvc-subtitle">Portal de Gestão da Loja</p>
                        </div>
                    </div>
                </div>
                
                <!-- Título da Página -->
                <div class="col-md-4 text-center">
                    <h1 class="page-title mb-0" style="border: none; padding: 0; color: var(--cvc-branco); font-size: 1.8rem;">
                        <i class="fas fa-upload"></i> Sistema Completo de Vendas
                    </h1>
                </div>
                
                <!-- Voltar ao Dashboard -->
                <div class="col-md-4 text-end">
                    <a href="index.html" class="btn btn-cvc-outline">
                        <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- NAVEGAÇÃO CVC PADRÃO -->
    <nav class="cvc-nav">
        <div class="container-fluid">
            <ul class="nav nav-pills justify-content-center mb-0">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="orcamentos.html">
                        <i class="fas fa-calculator"></i> Padronizador de Orçamentos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas.html">
                        <i class="fas fa-chart-line"></i> Informe de Vendas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas-automatizado.html">
                        <i class="fas fa-robot"></i> Informe Automatizado
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="vendas-automatizado-COMPLETO.html">
                        <i class="fas fa-upload"></i> Sistema Completo
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="embarques.html">
                        <i class="fas fa-plane-departure"></i> Controle de Embarques
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="orbiuns.html">
                        <i class="fas fa-clipboard-list"></i> Controle de Orbiuns
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- CONTAINER PRINCIPAL -->
    <div class="vendas-completo-container">
        
        <!-- LOADING CONTAINER -->
        <div class="loading-container" id="loadingContainer">
            <div class="text-center">
                <div class="spinner-border text-white mb-3" role="status" style="width: 3rem; height: 3rem;">
                    <span class="visually-hidden">Carregando...</span>
                </div>
                <h3><i class="fas fa-upload"></i> CVC Portal Itaquá - Sistema Completo de Vendas</h3>
                <p class="mb-0">Carregando vendas pendentes de complementação...</p>
                <div class="mt-3">
                    <small>✨ Sistema v11.0 - Upload de PDF + Extração Automática</small>
                </div>
            </div>
        </div>

        <!-- ERROR CONTAINER -->
        <div class="error-container" id="errorContainer" style="display:none;">
            <div class="text-center">
                <div class="error-icon mb-3">
                    <i class="fas fa-exclamation-triangle" style="font-size: 3rem;"></i>
                </div>
                <h3>Erro no Sistema</h3>
                <p id="errorMessage">Não foi possível conectar com a planilha</p>
                <button class="btn btn-light btn-lg" onclick="carregarDadosInicial()">
                    <i class="fas fa-redo"></i> Tentar Novamente
                </button>
            </div>
        </div>

        <!-- MAIN CONTENT -->
        <div id="mainContent" style="display:none;">
            
            <!-- DASHBOARD STATUS -->
            <div class="status-dashboard" id="statusDashboard">
                <div class="text-center">
                    <h2><i class="fas fa-upload"></i> Sistema Completo de Vendas</h2>
                    <p class="mb-0">Finalização de cadastro de vendas com upload de PDF e extração automática</p>
                    <small id="ultimaAtualizacao">Última atualização: Aguardando dados...</small>
                </div>
                
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-number" id="statTotal">0</div>
                        <div class="stat-label">Total de Vendas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statPendentes">0</div>
                        <div class="stat-label">Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statCompletas">0</div>
                        <div class="stat-label">Completas</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="statVendedores">0</div>
                        <div class="stat-label">Vendedores</div>
                    </div>
                </div>
            </div>

            <!-- SEÇÃO DE VENDEDORES -->
            <section class="vendedores-section" id="vendedoresSection">
                <h2><i class="fas fa-users"></i> Vendedores com Vendas Pendentes</h2>
                <p class="text-muted mb-3">Clique em um vendedor para ver suas vendas pendentes de complementação</p>
                <div id="vendedoresList">
                    <!-- Vendedores serão inseridos aqui -->
                </div>
            </section>

            <!-- CONTAINER DE VENDAS -->
            <div class="vendas-container" id="vendasContainer" style="display:none;">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h2><i class="fas fa-list"></i> Vendas Pendentes</h2>
                    <div>
                        <button class="btn btn-outline-secondary btn-sm" onclick="voltarVendedores()">
                            <i class="fas fa-arrow-left"></i> Voltar aos Vendedores
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="atualizarDados()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                    </div>
                </div>
                <div id="vendasList">
                    <!-- Vendas serão inseridas aqui -->
                </div>
            </div>

        </div>

    </div>

    <!-- MODAL DE UPLOAD E COMPLEMENTAÇÃO -->
    <div class="modal fade modal-upload" id="modalComplementar" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-upload"></i> Complementar Dados da Venda
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    
                    <!-- Progress Bar -->
                    <div class="progress mb-4" style="height: 8px;">
                        <div class="progress-bar progress-bar-custom" id="progressBar" style="width: 25%"></div>
                    </div>
                    
                    <!-- Step 1: Upload PDF -->
                    <div class="step-content" id="step1">
                        <h6><span class="status-indicator pendente"></span> Passo 1: Upload do PDF da Reserva</h6>
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <h5>Arraste o PDF aqui ou clique para selecionar</h5>
                            <p class="text-muted">Formatos aceitos: PDF (máx. 10MB)</p>
                            <input type="file" id="fileInput" accept=".pdf" style="display: none;">
                            <button class="btn btn-upload" onclick="document.getElementById('fileInput').click()">
                                <i class="fas fa-folder-open"></i> Selecionar Arquivo
                            </button>
                        </div>
                        <div id="uploadProgress" style="display: none;">
                            <div class="mt-3">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Processando PDF...</span>
                                    <span id="uploadPercent">0%</span>
                                </div>
                                <div class="progress mt-2">
                                    <div class="progress-bar" id="uploadProgressBar" style="width: 0%"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Step 2: Dados Extraídos -->
                    <div class="step-content" id="step2" style="display: none;">
                        <h6><span class="status-indicator completo"></span> Passo 2: Dados Extraídos do PDF</h6>
                        <div class="dados-extraidos" id="dadosExtraidos">
                            <h6>Dados encontrados no PDF:</h6>
                            <div id="dadosExtaidosList">
                                <!-- Dados extraídos serão inseridos aqui -->
                            </div>
                        </div>
                        <div class="text-center">
                            <button class="btn btn-success" onclick="proximoPasso(3)">
                                <i class="fas fa-arrow-right"></i> Prosseguir para Complementação
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Formulário Completo -->
                    <div class="step-content" id="step3" style="display: none;">
                        <h6><span class="status-indicator pendente"></span> Passo 3: Complementar Dados</h6>
                        
                        <form id="formComplementar">
                            <!-- Dados do Cliente -->
                            <div class="form-section">
                                <h5><i class="fas fa-user"></i> Dados do Cliente</h5>
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <label class="form-label">Nome Completo *</label>
                                        <input type="text" class="form-control" id="nomeCliente" required>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">CPF *</label>
                                        <input type="text" class="form-control" id="cpfCliente" required maxlength="14">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Data Nascimento</label>
                                        <input type="date" class="form-control" id="dataNascimento">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">WhatsApp *</label>
                                        <input type="tel" class="form-control" id="whatsappCliente" required>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Email</label>
                                        <input type="email" class="form-control" id="emailCliente">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">RG</label>
                                        <input type="text" class="form-control" id="rgCliente">
                                    </div>
                                </div>
                            </div>

                            <!-- Dados da Viagem -->
                            <div class="form-section">
                                <h5><i class="fas fa-plane"></i> Dados da Viagem</h5>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Destino</label>
                                        <input type="text" class="form-control" id="destino">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Data Ida</label>
                                        <input type="date" class="form-control" id="dataIda">
                                    </div>
                                    <div class="col-md-2">
                                        <label class="form-label">Data Volta</label>
                                        <input type="date" class="form-control" id="dataVolta">
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Hotel/Hospedagem</label>
                                        <input type="text" class="form-control" id="hotel">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Tipo Produto</label>
                                        <select class="form-select" id="tipoProduto">
                                            <option value="">Selecione...</option>
                                            <option value="PRODUTO FÁCIL">Produto Fácil</option>
                                            <option value="FRETAMENTO">Fretamento</option>
                                            <option value="TERRESTRE">Terrestre</option>
                                            <option value="AÉREO">Aéreo</option>
                                            <option value="CRUZEIRO">Cruzeiro</option>
                                        </select>
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Valor Total</label>
                                        <input type="text" class="form-control" id="valorTotal">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Forma Pagamento</label>
                                        <input type="text" class="form-control" id="formaPagamento">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Data Reserva</label>
                                        <input type="date" class="form-control" id="dataReserva">
                                    </div>
                                </div>
                            </div>

                            <!-- Localizadores -->
                            <div class="form-section">
                                <h5><i class="fas fa-barcode"></i> Localizadores</h5>
                                <div class="row g-3">
                                    <div class="col-md-3">
                                        <label class="form-label">LOC GDS</label>
                                        <input type="text" class="form-control" id="locGds">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">LOC CIA</label>
                                        <input type="text" class="form-control" id="locCia">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Reserva Online</label>
                                        <input type="text" class="form-control" id="reservaOnline">
                                    </div>
                                    <div class="col-md-3">
                                        <label class="form-label">Número Reserva</label>
                                        <input type="text" class="form-control" id="numeroReserva">
                                    </div>
                                </div>
                            </div>

                            <!-- Campos do Sistema Embarques -->
                            <div class="form-section">
                                <h5><i class="fas fa-cogs"></i> Configurações do Sistema</h5>
                                <div class="row g-3">
                                    <div class="col-md-4">
                                        <label class="form-label">Cliente Ale</label>
                                        <select class="form-select" id="clienteAle">
                                            <option value="Não">Não</option>
                                            <option value="Sim">Sim</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Status</label>
                                        <select class="form-select" id="statusSistema">
                                            <option value="conferencia">Conferência</option>
                                            <option value="checkin">Check-in</option>
                                            <option value="pos-venda">Pós-venda</option>
                                        </select>
                                    </div>
                                    <div class="col-md-4">
                                        <label class="form-label">Prioridade</label>
                                        <select class="form-select" id="prioridade">
                                            <option value="normal">Normal</option>
                                            <option value="urgente">Urgente</option>
                                            <option value="muito-urgente">Muito Urgente</option>
                                        </select>
                                    </div>
                                    <div class="col-12">
                                        <label class="form-label">Observações</label>
                                        <textarea class="form-control" id="observacoes" rows="3" placeholder="Informações adicionais sobre a venda..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times"></i> Cancelar
                    </button>
                    <button type="button" class="btn btn-primary" id="btnVoltar" onclick="voltarPasso()" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Voltar
                    </button>
                    <button type="button" class="btn btn-success" id="btnSalvar" onclick="salvarVenda()" style="display: none;">
                        <i class="fas fa-save"></i> Salvar Venda Completa
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- 🚨 CORREÇÃO CRÍTICA: Script ANTES do config.js -->
    <script>
        // Garantir que getApiUrl() esteja disponível ANTES de tudo
        window.getApiUrl = window.getApiUrl || function() {
            return 'https://script.google.com/macros/s/AKfycbzqttRJjK4PbznHnEfviHZ9LPOITVm_pc0sswGUNVHpGpio5oCdaB2c68s6fVHuN6LL3w/exec';
        };

        // Definir CVC_CONFIG temporário se não existir
        window.CVC_CONFIG = window.CVC_CONFIG || {
            API_URL: 'https://script.google.com/macros/s/AKfycbzqttRJjK4PbznHnEfviHZ9LPOITVm_pc0sswGUNVHpGpio5oCdaB2c68s6fVHuN6LL3w/exec',
            VERSION: '11.0',
            SYSTEM_NAME: 'CVC Itaquá - Portal de Gestão da Loja',
            VENDEDORES: ['Alessandro', 'Ana Paula', 'Adriana', 'Adrielly', 'Bia', 'Conceição', 'Jhully'],
            DEBUG_MODE: true
        };

        console.log('🔧 CORREÇÃO: getApiUrl() e CVC_CONFIG definidos temporariamente');
        console.log('🎯 API URL:', window.getApiUrl());
    </script>

    <!-- Config original -->
    <script src="config.js"></script>
    
    <script>
        // ================================================================================
        // 🚀 CVC PORTAL ITAQUÁ - SISTEMA COMPLETO DE VENDAS v11.0
        // Sistema completo para finalização de cadastro de vendas com upload de PDF
        // FUNCIONALIDADES: Upload PDF + Extração Automática + Formulário Completo
        // ================================================================================
        
        console.log('🚀 CVC Portal Itaquá - Sistema Completo de Vendas v11.0');
        console.log('✨ Funcionalidades v11.0:');
        console.log('   • Filtro por vendedor com vendas pendentes');
        console.log('   • Upload de PDF com drag & drop');
        console.log('   • Extração automática de dados do PDF');
        console.log('   • Formulário completo para complementação');
        console.log('   • Integração com sistema de embarques');
        console.log('   • Validação e salvamento na planilha');
        console.log('   • Interface responsiva e moderna');
        console.log('');
        console.log('🎯 Sistema pronto para uso completo!');
        
        // ================================================================================
        // VARIÁVEIS GLOBAIS
        // ================================================================================
        
        let vendasData = [];
        let vendedoresData = {};
        let vendedorSelecionado = null;
        let vendaAtual = null;
        let dadosExtraidos = {};
        let passoAtual = 1;
        let API_URL = null;

        // ================================================================================
        // SISTEMA DE TOAST NOTIFICATIONS
        // ================================================================================
        
        function showToast(message, type = 'info', duration = 4000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${type}`;
            
            const icons = {
                success: 'fa-check-circle',
                error: 'fa-exclamation-circle',
                warning: 'fa-exclamation-triangle',
                info: 'fa-info-circle'
            };
            
            toast.innerHTML = `
                <div class="d-flex align-items-center">
                    <i class="fas ${icons[type]} me-2"></i>
                    <span>${message}</span>
                    <button class="btn-close btn-close-sm ms-auto" onclick="this.parentElement.parentElement.remove()"></button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.remove();
                }
            }, duration);
        }

        // ================================================================================
        // INICIALIZAÇÃO SEGURA DO SISTEMA
        // ================================================================================
        
        function inicializarSistema() {
            console.log('🚀 Iniciando Sistema Completo de Vendas v11.0...');
            
            // 🔧 CORREÇÃO: Verificação robusta da configuração
            if (typeof getApiUrl === 'function') {
                API_URL = getApiUrl();
                console.log(`🌐 API URL via getApiUrl(): ${API_URL}`);
            } else if (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.API_URL) {
                API_URL = CVC_CONFIG.API_URL;
                console.log(`🌐 API URL via CVC_CONFIG: ${API_URL}`);
            } else {
                API_URL = 'https://script.google.com/macros/s/AKfycbzqttRJjK4PbznHnEfviHZ9LPOITVm_pc0sswGUNVHpGpio5oCdaB2c68s6fVHuN6LL3w/exec';
                console.log('⚠️ Usando API URL fallback');
            }
            
            if (!API_URL || !API_URL.includes('script.google.com')) {
                console.error('❌ ERRO: API URL inválida!');
                mostrarErro('API URL inválida. Verifique a configuração.');
                return;
            }
            
            console.log('✅ Sistema inicializado com sucesso!');
            
            // Configurar eventos
            configurarEventos();
            
            // Carregar dados iniciais
            carregarDadosInicial();
        }

        // ================================================================================
        // CONFIGURAÇÃO DE EVENTOS
        // ================================================================================
        
        function configurarEventos() {
            // Upload de arquivo
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.getElementById('uploadArea');
            
            fileInput.addEventListener('change', handleFileSelect);
            
            // Drag & Drop
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect({ target: { files } });
                }
            });

            // Máscara para CPF
            document.getElementById('cpfCliente').addEventListener('input', (e) => {
                let value = e.target.value.replace(/\D/g, '');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d)/, '$1.$2');
                value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                e.target.value = value;
            });

            console.log('✅ Eventos configurados');
        }

        // ================================================================================
        // CARREGAMENTO DE DADOS VIA JSONP
        // ================================================================================
        
        function carregarDadosInicial() {
            console.log('📊 Carregando vendas pendentes...');
            
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'none';
            
            // Simular carregamento de vendas pendentes
            // Na implementação real, chamar API para buscar vendas com status "pendente"
            chamarAPIJsonp('listar_vendas_pendentes')
                .then(resultado => {
                    console.log('📡 Resposta recebida');
                    
                    if (resultado.success) {
                        if (resultado.data && resultado.data.vendas) {
                            vendasData = resultado.data.vendas.filter(venda => venda.status === 'pendente');
                            console.log(`✅ ${vendasData.length} vendas pendentes carregadas`);
                            
                            processarDadosVendedores();
                            atualizarDashboard();
                            exibirDados();
                            showToast(`${vendasData.length} vendas pendentes carregadas!`, 'success');
                            
                        } else {
                            // Dados simulados para demonstração
                            vendasData = [
                                {
                                    recibo: '6220-0000128069',
                                    vendedor: 'Alessandro',
                                    status: 'pendente',
                                    nomeCliente: '',
                                    cpf: '',
                                    whatsapp: '',
                                    dataImportacao: '2025-01-01'
                                },
                                {
                                    recibo: '6220-0000128138',
                                    vendedor: 'Adrielly',
                                    status: 'pendente',
                                    nomeCliente: '',
                                    cpf: '',
                                    whatsapp: '',
                                    dataImportacao: '2025-01-01'
                                },
                                {
                                    recibo: '6220-0000128226',
                                    vendedor: 'Ana Paula',
                                    status: 'pendente',
                                    nomeCliente: '',
                                    cpf: '',
                                    whatsapp: '',
                                    dataImportacao: '2025-01-01'
                                }
                            ];
                            
                            processarDadosVendedores();
                            atualizarDashboard();
                            exibirDados();
                            showToast('Dados simulados carregados para demonstração', 'warning');
                        }
                    } else {
                        throw new Error(resultado.message || 'Erro desconhecido na API');
                    }
                })
                .catch(error => {
                    console.error(`❌ Erro: ${error.message}`);
                    
                    // Dados simulados em caso de erro
                    vendasData = [
                        {
                            recibo: '6220-0000128069',
                            vendedor: 'Alessandro',
                            status: 'pendente',
                            nomeCliente: '',
                            cpf: '',
                            whatsapp: '',
                            dataImportacao: '2025-01-01'
                        },
                        {
                            recibo: '6220-0000128138',
                            vendedor: 'Adrielly',
                            status: 'pendente',
                            nomeCliente: '',
                            cpf: '',
                            whatsapp: '',
                            dataImportacao: '2025-01-01'
                        },
                        {
                            recibo: '6220-0000128226',
                            vendedor: 'Ana Paula',
                            status: 'pendente',
                            nomeCliente: '',
                            cpf: '',
                            whatsapp: '',
                            dataImportacao: '2025-01-01'
                        }
                    ];
                    
                    processarDadosVendedores();
                    atualizarDashboard();
                    exibirDados();
                    showToast('Modo demonstração ativado - usando dados simulados', 'warning');
                });
        }
        
        function chamarAPIJsonp(action, parametros = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = `vendas_completo_callback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                console.log(`🔗 JSONP: Criando callback ${callbackName}`);
                
                window[callbackName] = function(result) {
                    try {
                        script.remove();
                        delete window[callbackName];
                        
                        console.log(`📡 JSONP: Callback executado: ${result.success ? 'sucesso' : 'erro'}`);
                        resolve(result);
                        
                    } catch (error) {
                        delete window[callbackName];
                        reject(error);
                    }
                };
                
                const script = document.createElement('script');
                const params = new URLSearchParams({
                    callback: callbackName,
                    action: action,
                    ...parametros
                });
                
                const urlCompleta = `${API_URL}?${params.toString()}`;
                script.src = urlCompleta;
                
                console.log(`📡 JSONP: URL criada (${urlCompleta.length} chars)`);
                
                script.onerror = function(event) {
                    delete window[callbackName];
                    if (script.parentNode) {
                        script.remove();
                    }
                    
                    console.error('❌ JSONP: Erro ao carregar script');
                    reject(new Error('Erro ao carregar script JSONP. Verifique a configuração da API.'));
                };
                
                document.head.appendChild(script);
                
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script && script.parentNode) {
                            script.remove();
                        }
                        console.error('⏱️ JSONP: Timeout de 30 segundos');
                        reject(new Error('Timeout na requisição JSONP (30s). O servidor não respondeu.'));
                    }
                }, 30000);
            });
        }

        // ================================================================================
        // PROCESSAMENTO DE DADOS
        // ================================================================================
        
        function processarDadosVendedores() {
            vendedoresData = {};
            
            vendasData.forEach(venda => {
                const vendedor = venda.vendedor || 'Não Informado';
                
                if (!vendedoresData[vendedor]) {
                    vendedoresData[vendedor] = {
                        nome: vendedor,
                        totalPendentes: 0,
                        totalCompletas: 0,
                        vendas: []
                    };
                }
                
                if (venda.status === 'pendente') {
                    vendedoresData[vendedor].totalPendentes++;
                } else {
                    vendedoresData[vendedor].totalCompletas++;
                }
                
                vendedoresData[vendedor].vendas.push(venda);
            });
            
            console.log(`📊 Processados ${Object.keys(vendedoresData).length} vendedores`);
        }

        // ================================================================================
        // ATUALIZAÇÃO DA INTERFACE
        // ================================================================================
        
        function atualizarDashboard() {
            const stats = calcularEstatisticas();
            
            // Atualizar stats com animação
            animarContador('statTotal', stats.total);
            animarContador('statPendentes', stats.pendentes);
            animarContador('statCompletas', stats.completas);
            animarContador('statVendedores', stats.vendedores);
            
            // Atualizar última atualização
            document.getElementById('ultimaAtualizacao').textContent = 
                `Última atualização: ${new Date().toLocaleString('pt-BR')}`;
            
            console.log('📊 Dashboard atualizado');
        }
        
        function animarContador(elementId, valorFinal) {
            const elemento = document.getElementById(elementId);
            if (!elemento) return;
            
            const valorInicial = 0;
            const duracao = 1500;
            const inicio = Date.now();
            
            function atualizar() {
                const agora = Date.now();
                const progresso = Math.min((agora - inicio) / duracao, 1);
                
                // Easing function para suavizar a animação
                const easeOut = 1 - Math.pow(1 - progresso, 3);
                const valorAtual = Math.round(valorInicial + (valorFinal - valorInicial) * easeOut);
                
                elemento.textContent = valorAtual.toLocaleString('pt-BR');
                
                if (progresso < 1) {
                    requestAnimationFrame(atualizar);
                }
            }
            
            requestAnimationFrame(atualizar);
        }
        
        function calcularEstatisticas() {
            const total = vendasData.length;
            const pendentes = vendasData.filter(v => v.status === 'pendente').length;
            const completas = vendasData.filter(v => v.status === 'completa').length;
            const vendedores = Object.keys(vendedoresData).length;
            
            return { total, pendentes, completas, vendedores };
        }

        // ================================================================================
        // EXIBIÇÃO DOS DADOS
        // ================================================================================
        
        function exibirDados() {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            
            exibirVendedores();
            
            console.log('✅ Interface atualizada e dados exibidos');
        }
        
        function exibirVendedores() {
            const vendedoresList = document.getElementById('vendedoresList');
            let html = '';
            
            Object.values(vendedoresData).forEach(vendedor => {
                if (vendedor.totalPendentes === 0) return; // Só mostrar vendedores com pendências
                
                const statusClass = vendedor.totalPendentes > 0 ? 'pendente' : 'em-dia';
                
                html += `
                    <div class="vendedor-card" onclick="selecionarVendedor('${vendedor.nome}')">
                        <div class="vendedor-header">
                            <div class="vendedor-nome">${vendedor.nome}</div>
                            <div class="vendedor-status ${statusClass}">
                                ${vendedor.totalPendentes} Pendente(s)
                            </div>
                        </div>
                        <div class="vendedor-stats">
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.totalPendentes}</div>
                                <div class="vendedor-stat-label">Pendentes</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.totalCompletas}</div>
                                <div class="vendedor-stat-label">Completas</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.vendas.length}</div>
                                <div class="vendedor-stat-label">Total</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            if (html === '') {
                html = `
                    <div class="text-center py-5">
                        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                        <h4>Nenhuma venda pendente!</h4>
                        <p class="text-muted">Todas as vendas foram completadas</p>
                    </div>
                `;
            }
            
            vendedoresList.innerHTML = html;
        }

        // ================================================================================
        // SELEÇÃO DE VENDEDOR E EXIBIÇÃO DE VENDAS
        // ================================================================================
        
        function selecionarVendedor(nomeVendedor) {
            vendedorSelecionado = nomeVendedor;
            
            // Marcar vendedor como selecionado
            document.querySelectorAll('.vendedor-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Mostrar vendas do vendedor
            exibirVendasVendedor(nomeVendedor);
            
            // Mostrar container de vendas
            document.getElementById('vendedoresSection').style.display = 'none';
            document.getElementById('vendasContainer').style.display = 'block';
            
            showToast(`Exibindo vendas pendentes de ${nomeVendedor}`, 'info');
        }
        
        function exibirVendasVendedor(nomeVendedor) {
            const vendasVendedor = vendedoresData[nomeVendedor].vendas.filter(v => v.status === 'pendente');
            const vendasList = document.getElementById('vendasList');
            
            let html = '';
            
            vendasVendedor.forEach(venda => {
                const statusClass = venda.status === 'pendente' ? 'pendente' : 'completa';
                const statusText = venda.status === 'pendente' ? 'Pendente' : 'Completa';
                
                html += `
                    <div class="venda-card ${statusClass}">
                        <div class="venda-header">
                            <div class="venda-numero">📄 ${venda.recibo}</div>
                            <div class="venda-status ${statusClass}">${statusText}</div>
                        </div>
                        <div class="venda-info">
                            <div class="venda-campo">
                                <span class="venda-label">Cliente:</span>
                                <span class="venda-valor">${venda.nomeCliente || 'Não informado'}</span>
                            </div>
                            <div class="venda-campo">
                                <span class="venda-label">CPF:</span>
                                <span class="venda-valor">${venda.cpf || 'Pendente'}</span>
                            </div>
                            <div class="venda-campo">
                                <span class="venda-label">WhatsApp:</span>
                                <span class="venda-valor">${venda.whatsapp || 'Pendente'}</span>
                            </div>
                            <div class="venda-campo">
                                <span class="venda-label">Importação:</span>
                                <span class="venda-valor">${new Date(venda.dataImportacao).toLocaleDateString('pt-BR')}</span>
                            </div>
                        </div>
                        <div class="venda-actions">
                            <button class="btn btn-primary btn-sm" onclick="complementarVenda('${venda.recibo}')">
                                <i class="fas fa-upload"></i> Complementar Dados
                            </button>
                            <button class="btn btn-outline-info btn-sm" onclick="visualizarVenda('${venda.recibo}')">
                                <i class="fas fa-eye"></i> Visualizar
                            </button>
                        </div>
                    </div>
                `;
            });
            
            if (html === '') {
                html = `
                    <div class="text-center py-5">
                        <i class="fas fa-check-circle fa-3x text-success mb-3"></i>
                        <h4>Nenhuma venda pendente!</h4>
                        <p class="text-muted">Todas as vendas deste vendedor foram completadas</p>
                    </div>
                `;
            }
            
            vendasList.innerHTML = html;
        }
        
        function voltarVendedores() {
            vendedorSelecionado = null;
            
            document.getElementById('vendedoresSection').style.display = 'block';
            document.getElementById('vendasContainer').style.display = 'none';
            
            // Remover seleção
            document.querySelectorAll('.vendedor-card').forEach(card => {
                card.classList.remove('selected');
            });
        }

        // ================================================================================
        // MODAL DE COMPLEMENTAÇÃO
        // ================================================================================
        
        function complementarVenda(recibo) {
            vendaAtual = vendasData.find(v => v.recibo === recibo);
            
            if (!vendaAtual) {
                showToast('Venda não encontrada', 'error');
                return;
            }
            
            // Resetar modal
            resetarModal();
            
            // Mostrar modal
            const modal = new bootstrap.Modal(document.getElementById('modalComplementar'));
            modal.show();
            
            console.log(`📋 Abrindo complementação para venda ${recibo}`);
        }
        
        function resetarModal() {
            passoAtual = 1;
            dadosExtraidos = {};
            
            // Resetar steps
            document.querySelectorAll('.step-content').forEach(step => {
                step.style.display = 'none';
            });
            document.getElementById('step1').style.display = 'block';
            
            // Resetar progress bar
            document.getElementById('progressBar').style.width = '25%';
            
            // Resetar botões
            document.getElementById('btnVoltar').style.display = 'none';
            document.getElementById('btnSalvar').style.display = 'none';
            
            // Resetar upload
            document.getElementById('fileInput').value = '';
            document.getElementById('uploadProgress').style.display = 'none';
            
            // Resetar formulário
            document.getElementById('formComplementar').reset();
        }

        // ================================================================================
        // UPLOAD E PROCESSAMENTO DE PDF
        // ================================================================================
        
        function handleFileSelect(event) {
            const file = event.target.files[0];
            
            if (!file) return;
            
            if (file.type !== 'application/pdf') {
                showToast('Apenas arquivos PDF são aceitos', 'error');
                return;
            }
            
            if (file.size > 10 * 1024 * 1024) { // 10MB
                showToast('Arquivo muito grande. Máximo 10MB', 'error');
                return;
            }
            
            processarPDF(file);
        }
        
        function processarPDF(file) {
            console.log(`📄 Processando PDF: ${file.name}`);
            
            // Mostrar progress
            document.getElementById('uploadProgress').style.display = 'block';
            
            // Simular upload e extração
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) progress = 100;
                
                document.getElementById('uploadProgressBar').style.width = progress + '%';
                document.getElementById('uploadPercent').textContent = Math.round(progress) + '%';
                
                if (progress >= 100) {
                    clearInterval(interval);
                    finalizarProcessamentoPDF(file);
                }
            }, 200);
        }
        
        function finalizarProcessamentoPDF(file) {
            console.log('✅ PDF processado com sucesso');
            
            // Simular dados extraídos (na implementação real, usar biblioteca de PDF)
            dadosExtraidos = extrairDadosSimulados(file.name);
            
            // Avançar para próximo passo
            setTimeout(() => {
                proximoPasso(2);
                showToast('Dados extraídos do PDF com sucesso!', 'success');
            }, 500);
        }
        
        function extrairDadosSimulados(fileName) {
            // Simular extração baseada no nome do arquivo ou conteúdo
            const dados = {
                nomeCliente: 'Cliente Extraído do PDF',
                cpf: '123.456.789-00',
                dataNascimento: '1990-01-01',
                whatsapp: '(11) 99999-9999',
                email: 'cliente@email.com',
                destino: 'PUNTA CANA',
                dataIda: '2025-12-08',
                dataVolta: '2025-12-15',
                hotel: 'Hotel Extraído',
                valorTotal: 'R$ 12.603,96',
                locGds: 'NDRFDI',
                locCia: 'NDRFDI',
                numeroReserva: '301946368',
                tipoProduto: 'PRODUTO FÁCIL',
                formaPagamento: 'PIX'
            };
            
            console.log('📊 Dados extraídos:', dados);
            return dados;
        }

        // ================================================================================
        // NAVEGAÇÃO ENTRE PASSOS
        // ================================================================================
        
        function proximoPasso(passo) {
            // Esconder passo atual
            document.getElementById(`step${passoAtual}`).style.display = 'none';
            
            // Mostrar próximo passo
            passoAtual = passo;
            document.getElementById(`step${passo}`).style.display = 'block';
            
            // Atualizar progress bar
            const progressos = { 1: 25, 2: 50, 3: 100 };
            document.getElementById('progressBar').style.width = progressos[passo] + '%';
            
            // Atualizar status indicators
            for (let i = 1; i <= passo; i++) {
                const indicator = document.querySelector(`#step${i} .status-indicator`);
                if (indicator) {
                    indicator.className = 'status-indicator completo';
                }
            }
            
            // Mostrar/esconder botões
            if (passo === 2) {
                exibirDadosExtraidos();
            } else if (passo === 3) {
                preencherFormulario();
                document.getElementById('btnVoltar').style.display = 'inline-block';
                document.getElementById('btnSalvar').style.display = 'inline-block';
            }
            
            console.log(`📍 Avançou para passo ${passo}`);
        }
        
        function voltarPasso() {
            if (passoAtual > 1) {
                proximoPasso(passoAtual - 1);
            }
        }
        
        function exibirDadosExtraidos() {
            const container = document.getElementById('dadosExtaidosList');
            let html = '';
            
            Object.entries(dadosExtraidos).forEach(([key, value]) => {
                if (value) {
                    html += `
                        <div class="dado-extraido">
                            <span class="dado-label">${formatarLabel(key)}:</span>
                            <span class="dado-valor">${value}</span>
                        </div>
                    `;
                }
            });
            
            container.innerHTML = html;
        }
        
        function formatarLabel(key) {
            const labels = {
                nomeCliente: 'Nome do Cliente',
                cpf: 'CPF',
                dataNascimento: 'Data de Nascimento',
                whatsapp: 'WhatsApp',
                email: 'Email',
                destino: 'Destino',
                dataIda: 'Data de Ida',
                dataVolta: 'Data de Volta',
                hotel: 'Hotel',
                valorTotal: 'Valor Total',
                locGds: 'LOC GDS',
                locCia: 'LOC CIA',
                numeroReserva: 'Número da Reserva',
                tipoProduto: 'Tipo do Produto',
                formaPagamento: 'Forma de Pagamento'
            };
            
            return labels[key] || key;
        }
        
        function preencherFormulario() {
            // Preencher campos com dados extraídos
            Object.entries(dadosExtraidos).forEach(([key, value]) => {
                const campo = document.getElementById(key);
                if (campo && value) {
                    campo.value = value;
                }
            });
            
            console.log('📝 Formulário preenchido com dados extraídos');
        }

        // ================================================================================
        // SALVAMENTO DA VENDA
        // ================================================================================
        
        function salvarVenda() {
            console.log('💾 Salvando venda completa...');
            
            // Coletar dados do formulário
            const dadosCompletos = coletarDadosFormulario();
            
            // Validar campos obrigatórios
            if (!validarDadosObrigatorios(dadosCompletos)) {
                return;
            }
            
            // Mostrar loading
            document.getElementById('btnSalvar').innerHTML = '<i class="fas fa-spinner fa-spin"></i> Salvando...';
            document.getElementById('btnSalvar').disabled = true;
            
            // Simular salvamento na API
            chamarAPIJsonp('salvar_venda_completa', {
                recibo: vendaAtual.recibo,
                dadosCompletos: JSON.stringify(dadosCompletos)
            })
            .then(resultado => {
                if (resultado.success) {
                    showToast('Venda salva com sucesso!', 'success');
                    
                    // Atualizar venda local
                    Object.assign(vendaAtual, dadosCompletos);
                    vendaAtual.status = 'completa';
                    
                    // Fechar modal
                    bootstrap.Modal.getInstance(document.getElementById('modalComplementar')).hide();
                    
                    // Atualizar interface
                    processarDadosVendedores();
                    atualizarDashboard();
                    
                    if (vendedorSelecionado) {
                        exibirVendasVendedor(vendedorSelecionado);
                    } else {
                        exibirVendedores();
                    }
                    
                } else {
                    throw new Error(resultado.message || 'Erro ao salvar venda');
                }
            })
            .catch(error => {
                console.error('❌ Erro ao salvar:', error);
                showToast(`Erro ao salvar: ${error.message}`, 'error');
            })
            .finally(() => {
                document.getElementById('btnSalvar').innerHTML = '<i class="fas fa-save"></i> Salvar Venda Completa';
                document.getElementById('btnSalvar').disabled = false;
            });
        }
        
        function coletarDadosFormulario() {
            const form = document.getElementById('formComplementar');
            const formData = new FormData(form);
            const dados = {};
            
            // Coletar todos os campos
            const campos = [
                'nomeCliente', 'cpfCliente', 'dataNascimento', 'whatsappCliente', 'emailCliente', 'rgCliente',
                'destino', 'dataIda', 'dataVolta', 'hotel', 'tipoProduto', 'valorTotal', 'formaPagamento', 'dataReserva',
                'locGds', 'locCia', 'reservaOnline', 'numeroReserva',
                'clienteAle', 'statusSistema', 'prioridade', 'observacoes'
            ];
            
            campos.forEach(campo => {
                const elemento = document.getElementById(campo);
                if (elemento) {
                    dados[campo] = elemento.value.trim();
                }
            });
            
            // Adicionar dados do recibo
            dados.recibo = vendaAtual.recibo;
            dados.vendedor = vendaAtual.vendedor;
            dados.dataComplementacao = new Date().toISOString();
            
            console.log('📊 Dados coletados:', dados);
            return dados;
        }
        
        function validarDadosObrigatorios(dados) {
            const obrigatorios = ['nomeCliente', 'cpfCliente', 'whatsappCliente'];
            const faltantes = [];
            
            obrigatorios.forEach(campo => {
                if (!dados[campo]) {
                    faltantes.push(formatarLabel(campo));
                }
            });
            
            if (faltantes.length > 0) {
                showToast(`Campos obrigatórios: ${faltantes.join(', ')}`, 'error');
                return false;
            }
            
            // Validar formato CPF
            if (dados.cpfCliente && !validarCPF(dados.cpfCliente)) {
                showToast('CPF inválido', 'error');
                return false;
            }
            
            return true;
        }
        
        function validarCPF(cpf) {
            cpf = cpf.replace(/\D/g, '');
            return cpf.length === 11;
        }

        // ================================================================================
        // FUNÇÕES AUXILIARES
        // ================================================================================
        
        function visualizarVenda(recibo) {
            const venda = vendasData.find(v => v.recibo === recibo);
            if (venda) {
                showToast(`Visualizando venda ${recibo}`, 'info');
                // Implementar modal de visualização
            }
        }
        
        function atualizarDados() {
            showToast('Atualizando dados...', 'info');
            carregarDadosInicial();
        }
        
        function mostrarErro(mensagem) {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('errorMessage').textContent = mensagem;
            
            console.error(`❌ Erro exibido: ${mensagem}`);
        }

        // ================================================================================
        // INICIALIZAÇÃO DO SISTEMA
        // ================================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            inicializarSistema();
        });
    </script>
</body>
</html>
