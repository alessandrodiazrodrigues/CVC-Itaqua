<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SYSTELOS TUR - Controle de Embarques</title>

    <!-- Meta Tags -->
    <meta name="description" content="SYSTELOS TUR - Sistemas com prop√≥sito">
    <meta name="keywords" content="SYSTELOS, TUR, Itaquaquecetuba, gest√£o, viagens, turismo, sistema, embarques">
    <meta name="author" content="SYSTELOS TUR">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:title" content="SYSTELOS TUR - Controle de Embarques">
    <meta property="og:description" content="Sistema de controle de embarques da CVC Itaquaquecetuba">
    <meta property="og:image" content="assets/images/systelos-logo.png">
    
    <!-- Favicons -->
    <link rel="icon" type="image/x-icon" href="assets/images/systelos-favicon.ico">
    <link rel="apple-touch-icon" href="assets/images/systelos-apple-icon.png">
    
    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/systelos-styles.css" rel="stylesheet">
    
    <!-- Configura√ß√£o -->
    <script src="config.js"></script>
    
    <style>
        /* ============================================================================
           HEADER SYSTELOS - PADR√ÉO UNIFICADO
           ============================================================================ */

        body {
            padding-top: 70px;
        }

        .systelos-header {
            background: linear-gradient(135deg, #0F1B3D 0%, #1a2642 100%);
            height: 70px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        .menu-toggle {
            background: none;
            border: none;
            color: #FFB800;
            font-size: 24px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 8px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .menu-toggle:hover {
            background: rgba(255, 184, 0, 0.1);
            transform: scale(1.1);
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-left: 20px;
            flex-shrink: 0;
        }

        .logo-icon {
            background: linear-gradient(135deg, #FFB800 0%, #ff8800 100%);
            color: #0F1B3D;
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: 800;
            font-family: 'Poppins', sans-serif;
            box-shadow: 0 4px 12px rgba(255, 184, 0, 0.3);
        }

        .logo-text {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .logo-title {
            color: #FFFFFF;
            font-size: 24px;
            font-weight: 600;
            font-family: 'Poppins', sans-serif;
            line-height: 1;
            letter-spacing: -0.5px;
        }

        .logo-subtitle {
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
            letter-spacing: 0.3px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 16px;
            margin-left: auto;
        }

        .user-avatar {
            width: 44px;
            height: 44px;
            border-radius: 50%;
            background: linear-gradient(135deg, #FFB800 0%, #ff8800 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
            z-index: 2;
            box-shadow: 0 2px 8px rgba(255, 184, 0, 0.4);
        }

        .user-avatar span {
            color: #0F1B3D;
            font-weight: bold;
            font-size: 16px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .user-name {
            color: #FFFFFF;
            font-size: 14px;
            font-weight: 600;
            font-family: 'Inter', sans-serif;
            line-height: 1.2;
        }

        .user-email {
            color: #14B8A6;
            font-size: 12px;
            font-weight: 400;
            font-family: 'Inter', sans-serif;
            line-height: 1.2;
        }

        .btn-gestor {
            background: linear-gradient(135deg, #14B8A6 0%, #0d9488 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
            white-space: nowrap;
        }

        .btn-gestor:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(20, 184, 166, 0.4);
        }

        .btn-sair {
            background: linear-gradient(135deg, #FFB800 0%, #ff8800 100%);
            color: #0F1B3D;
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .btn-sair:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(255, 184, 0, 0.4);
        }

        @media (max-width: 768px) {
            .systelos-header {
                padding: 0 16px;
                height: 60px;
            }

            body {
                padding-top: 60px;
            }

            .logo-title {
                font-size: 18px;
            }

            .logo-subtitle {
                font-size: 9px;
            }

            .logo-icon {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .user-name,
            .user-email {
                display: none;
            }

            .user-avatar {
                width: 36px;
                height: 36px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .logo-container {
                margin-left: 8px;
            }

            .btn-sair span {
                display: none;
            }

            .btn-gestor {
                padding: 8px 12px;
                font-size: 0;
            }

            .btn-gestor i {
                font-size: 16px;
                margin: 0;
            }
        }

        /* ============================================================================
           SIDEBAR MENU LATERAL
           ============================================================================ */

        .sidebar-menu {
            position: fixed;
            left: -340px;
            top: 0;
            width: 320px;
            height: 100vh;
            background: #0F1B3D;
            transition: left 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 9999;
            box-shadow: 2px 0 20px rgba(0,0,0,0.5);
            overflow-y: auto;
        }

        .sidebar-menu.show {
            left: 0;
        }

        .sidebar-menu::-webkit-scrollbar {
            width: 6px;
        }

        .sidebar-menu::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.05);
        }

        .sidebar-menu::-webkit-scrollbar-thumb {
            background: rgba(255,184,0,0.5);
            border-radius: 3px;
        }

        .sidebar-menu::-webkit-scrollbar-thumb:hover {
            background: rgba(255,184,0,0.7);
        }

        .sidebar-menu ul li a:hover {
            background: rgba(255,184,0,0.1) !important;
            color: #FFB800 !important;
            padding-left: 30px !important;
        }

        #closeSidebar:hover {
            background: rgba(255,184,0,0.2) !important;
            transform: rotate(90deg);
        }

        #sidebarOverlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            z-index: 9998;
            opacity: 0;
            transition: opacity 0.3s;
        }

        /* CSS espec√≠fico do embarques continua aqui */
        /* ================================================================================
         * ESTILOS ESPEC√çFICOS PARA EMBARQUES v12.5 - RESET DE BOT√ïES DOS MODAIS
         * ================================================================================ */
        
        .main-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: var(--systelos-sombra-forte);
            backdrop-filter: blur(10px);
            margin: 20px auto;
            max-width: 1400px;
            overflow: hidden;
        }
        
        .content-section {
            padding: 30px;
        }
        
        /* DASHBOARDS */
        .dashboard-container {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        
        .dashboard-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            min-height: 600px;
        }
        
        .dashboard-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--systelos-azul-principal);
        }
        
        .dashboard-title {
            font-size: 1.3rem;
            font-weight: bold;
            color: var(--systelos-azul-principal);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .dashboard-counter {
            background: var(--systelos-azul-principal);
            color: white;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
        }
        
        /* CARDS DE EMBARQUES */
        .embarque-card {
            background: white;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid var(--systelos-success);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .embarque-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(0,0,0,0.15);
        }
        
        /* PRIORIDADES */
        .priority-ATRASADO {
            border-left-color: var(--systelos-error);
            background: #fff;
        }
        
        .priority-URGENTE {
            border-left-color: var(--systelos-orange);
            background: #fff;
        }
        
        .priority-PROXIMO {
            border-left-color: var(--systelos-warning);
            background: #fff;
        }
        
        .priority-NORMAL {
            border-left-color: var(--systelos-success);
            background: #fff;
        }
        
        .card-header-custom {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .priority-badge {
            padding: 4px 8px;
            border-radius: 20px;
            font-size: 0.7rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .priority-badge.ATRASADO {
            background: var(--systelos-error);
            color: white;
        }
        
        .priority-badge.URGENTE {
            background: var(--systelos-orange);
            color: white;
        }
        
        .priority-badge.PROXIMO {
            background: var(--systelos-warning);
            color: #000;
        }
        
        .priority-badge.NORMAL {
            background: var(--systelos-success);
            color: white;
        }
        
        .days-remaining {
            font-size: 0.8rem;
            font-weight: bold;
            color: #666;
        }
        
        .card-info {
            margin: 8px 0;
        }
        
        .card-info strong {
            color: var(--systelos-azul-principal);
        }
        
        .card-actions {
            margin-top: 15px;
            display: flex;
            gap: 8px;
        }
        
        .btn-action {
            padding: 6px 12px;
            border: none;
            border-radius: 6px;
            font-size: 0.8rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .btn-conferencia {
            background: var(--systelos-azul-principal);
            color: white;
        }
        
        .btn-checkin {
            background: var(--systelos-laranja);
            color: white;
        }
        
        .btn-pos-venda {
            background: var(--systelos-verde);
            color: white;
        }
        
        .btn-action:hover {
            transform: scale(1.05);
            opacity: 0.9;
        }
        
        /* ESTADOS DE BOT√ïES - NOVA FUNCIONALIDADE */
        .btn-loading {
            position: relative;
            pointer-events: none;
            animation: pulse 1.5s infinite;
        }
        
        .btn-loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid transparent;
            border-top: 2px solid currentColor;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .btn-success-feedback {
            background: var(--systelos-success) !important;
            border-color: var(--systelos-success) !important;
            animation: successPulse 0.6s ease-out;
        }
        
        .btn-error-feedback {
            background: var(--systelos-error) !important;
            border-color: var(--systelos-error) !important;
            animation: errorShake 0.6s ease-out;
        }
        
        @keyframes successPulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @keyframes errorShake {
            0%, 20%, 40%, 60%, 80% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-2px); }
        }
        
        /* CONTROLES SUPERIORES */
        .controls-section {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            align-items: center;
        }
        
        .filter-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .filter-group label {
            font-weight: bold;
            color: var(--systelos-azul-principal);
            font-size: 0.9rem;
        }
        
        .form-select, .form-control {
            border-radius: 8px;
            border: 1px solid rgba(0,0,0,0.1);
            padding: 6px 12px;
            font-size: 0.9rem;
        }
        
        /* STATUS E M√âTRICAS */
        .status-section {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
        }
        
        .status-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .auto-refresh {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: #666;
        }
        
        .status-light {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            background: var(--systelos-success);
            animation: pulse 2s infinite;
        }
        
        /* LOADING */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top: 4px solid white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        /* EMPTY STATES */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #666;
        }
        
        .empty-state i {
            font-size: 3rem;
            margin-bottom: 15px;
            opacity: 0.3;
        }
        
        /* RESPONSIVE */
        @media (max-width: 1200px) {
            .dashboard-container {
                grid-template-columns: 1fr 1fr;
            }
        }
        
        @media (max-width: 768px) {
            .dashboard-container {
                grid-template-columns: 1fr;
            }
            
            .controls-section {
                flex-direction: column;
                align-items: stretch;
            }
            
            .filter-group {
                justify-content: space-between;
            }
            
            .status-section {
                flex-direction: column;
                gap: 10px;
            }
        }
        
        /* MODAL ESTILOS */
        .modal-content {
            border-radius: 15px;
            border: none;
        }
        
        .modal-header {
            background: var(--systelos-azul-principal);
            color: white;
            border-radius: 15px 15px 0 0;
        }
        
        .form-floating label {
            color: #666;
        }
        
        /* SUCCESS/ERROR ALERTS */
        .alert-custom {
            border-radius: 10px;
            border: none;
            padding: 12px 20px;
            margin-bottom: 15px;
        }
        
        .alert-success-custom {
            background: var(--systelos-bg-success);
            color: var(--systelos-text-success);
        }
        
        .alert-danger-custom {
            background: var(--systelos-bg-error);
            color: var(--systelos-text-error);
        }
        
        /* HEADER ATUALIZADO CONFORME PADR√ÉO */
        .cvc-page-title {
            color: var(--systelos-branco);
            font-weight: 700;
            font-size: 1.8rem;
            margin: 0;
            border: none;
            padding: 0;
        }
        
        .cvc-subtitle-page {
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            margin: 0;
            font-weight: 500;
        }
            /* Layout principal - ocupar toda a largura */
        body {
            margin: 0;
            padding: 0;
        }
        
        body > .container-fluid {
            padding: 0;
            margin: 0;
            max-width: 100%;
        }
        
        /* Conte√∫do centralizado */
        .content-section {
            max-width: 1400px;
            margin: 30px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

    </style>
</head>
<body class="cvc-background">
    <!-- ============================================================================
         HEADER SYSTELOS - PADR√ÉO UNIFICADO
         ============================================================================ -->
    <header class="systelos-header">
        <!-- Bot√£o Menu Hamb√∫rguer (Esquerda) -->
        <button class="menu-toggle" onclick="toggleSidebar()" aria-label="Menu">
            <i class="fas fa-bars"></i>
        </button>

        <!-- Logo SYSTELOS (Centro-Esquerda) -->
        <div class="logo-container">
            <div class="logo-icon">[S]</div>
            <div class="logo-text">
                <div class="logo-title">SYSTELOS TUR</div>
                <div class="logo-subtitle">Sistemas com prop√≥sito</div>
            </div>
        </div>

        <!-- Informa√ß√µes do Usu√°rio (Direita) -->
        <div class="user-info" id="userInfoHeader">
            <div class="user-avatar" id="userAvatar">
                <span id="userInitials">AR</span>
            </div>
            <div class="user-details">
                <div class="user-name" id="userName">Alessandro Diaz Rodrigues</div>
                <div class="user-email" id="userEmail">alessandrorodrigues@cvc.com.br</div>
            </div>
            <button class="btn-gestor" id="adminBadgeHeader" style="display: none;">
                <i class="fas fa-crown"></i> Gestor
            </button>
            <button class="btn-sair" onclick="logout()">
                <i class="fas fa-sign-out-alt"></i> <span>Sair</span>
            </button>
        </div>
    </header>

    <!-- ============================================================================
         SIDEBAR MENU LATERAL
         ============================================================================ -->
    <nav id="sidebarMenu" class="sidebar-menu">
        <div class="sidebar-header" style="position: relative; border-bottom: 1px solid rgba(255,184,0,0.3); padding: 20px;">
            <h3 style="color: #FFB800; font-family: Poppins, sans-serif; margin: 0; font-size: 1.2rem; font-weight: 700;">[S] SYSTELOS TUR</h3>
            <button id="closeSidebar" onclick="toggleSidebar()" style="position: absolute; top: 15px; right: 15px; background: transparent; border: none; color: white; font-size: 32px; cursor: pointer; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 50%; transition: 0.3s;">&times;</button>
        </div>
        <ul style="list-style: none; padding: 0; margin: 0;">
            <li><a href="index.html" style="display: block; padding: 18px 25px; color: white; text-decoration: none; transition: 0.3s; font-family: Inter, sans-serif; font-size: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);">In√≠cio</a></li>
            <li><a href="orcamentos.html" style="display: block; padding: 18px 25px; color: white; text-decoration: none; transition: 0.3s; font-family: Inter, sans-serif; font-size: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);">Padronizador de Or√ßamentos</a></li>
            <li><a href="embarques.html" style="display: block; padding: 18px 25px; color: #FFB800; text-decoration: none; transition: 0.3s; font-family: Inter, sans-serif; font-size: 15px; background: rgba(255,184,0,0.2); border-left: 4px solid #FFB800; font-weight: 600;">Controle de Embarques</a></li>
            <li><a href="vendas.html" style="display: block; padding: 18px 25px; color: white; text-decoration: none; transition: 0.3s; font-family: Inter, sans-serif; font-size: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);">Informe de Vendas</a></li>
            <li><a href="orbiuns.html" style="display: block; padding: 18px 25px; color: white; text-decoration: none; transition: 0.3s; font-family: Inter, sans-serif; font-size: 15px; border-bottom: 1px solid rgba(255,255,255,0.1);">Orbiuns (Processos)</a></li>
            <li><a href="importacao.html" style="display: block; padding: 18px 25px; color: white; text-decoration: none; transition: 0.3s; font-family: Inter, sans-serif; font-size: 15px;">Importa√ß√£o de Dados</a></li>
        </ul>
    </nav>

    <div class="container-fluid">

        <!-- NAVEGA√á√ÉO SYSTELOS -->
        <nav class="systelos-nav">
            <div class="container-fluid">
                <ul class="nav nav-pills justify-content-center mb-0">
                    <li class="nav-item">
                        <a class="nav-link " href="index.html">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="orcamentos.html">
                            <i class="fas fa-calculator"></i> Padronizador de Or√ßamentos
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="vendas.html">
                            <i class="fas fa-chart-line"></i> Informe de Vendas
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="vendas-automatizado.html">
                            <i class="fas fa-robot"></i> Informe Automatizado
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="embarques.html">
                            <i class="fas fa-plane-departure"></i> Controle de Embarques
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link " href="orbiuns.html">
                            <i class="fas fa-clipboard-list"></i> Controle de Orbiuns
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="importacao.html">
                            <i class="fas fa-cloud-upload-alt"></i> Importa√ß√£o
                        </a>
                    </li>
                </ul>
            </div>
        </nav>

        
        <!-- Main Content -->
        <div class="content-section">
<!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="text-center text-white">
            <div class="loading-spinner"></div>
            <div class="mt-3">Carregando embarques v12.5...</div>
        </div>
    </div>

    
        <div class="main-container">
            <!-- Header CVC Padr√£o -->
            

            <!-- Navega√ß√£o Principal - Igual ao Index -->
            

            <!-- Conte√∫do Principal -->
            <main class="content-section">
                <!-- Status e M√©tricas -->
                <div class="status-section">
                    <div class="status-info">
                        <div class="status-light"></div>
                        <span><strong>Sistema Online</strong> | √öltima atualiza√ß√£o: <span id="ultimaAtualizacao">Carregando...</span></span>
                    </div>
                    <div class="auto-refresh">
                        <i class="fas fa-clock"></i>
                        <span>Auto-refresh: 5min</span>
                    </div>
                </div>

                <!-- Controles e Filtros -->
                <div class="controls-section">
                    <div class="filter-group">
                        <label for="filtroVendedor">Vendedor:</label>
                        <select class="form-select" id="filtroVendedor" onchange="aplicarFiltros()">
                            <option value="">Todos</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="filtroPrioridade">Prioridade:</label>
                        <select class="form-select" id="filtroPrioridade" onchange="aplicarFiltros()">
                            <option value="">Todas</option>
                            <option value="ATRASADO">Atrasados</option>
                            <option value="URGENTE">Urgentes</option>
                            <option value="PROXIMO">Pr√≥ximos</option>
                            <option value="NORMAL">Normais</option>
                        </select>
                    </div>
                    
                    <div class="filter-group">
                        <label for="buscaCliente">Cliente:</label>
                        <input type="text" class="form-control" id="buscaCliente" placeholder="Nome ou CPF" 
                               onkeyup="aplicarFiltros()" style="width: 200px;">
                    </div>
                    
                    <div class="filter-group ms-auto">
                        <button class="btn btn-outline-primary btn-sm" onclick="exportarRelatorio()">
                            <i class="fas fa-download"></i> Exportar
                        </button>
                        <button class="btn btn-outline-success btn-sm" onclick="recarregarEmbarques()">
                            <i class="fas fa-sync-alt"></i> Atualizar
                        </button>
                        <button class="btn btn-outline-warning btn-sm" onclick="testarConectividade()">
                            <i class="fas fa-wifi"></i> Testar API
                        </button>
                    </div>
                </div>

                <!-- Alert para mensagens -->
                <div id="alertContainer"></div>

                <!-- Dashboards dos Embarques -->
                <div class="dashboard-container" id="dashboardContainer">
                    <!-- Dashboard de Confer√™ncias -->
                    <div class="dashboard-section" id="conferenciasSection">
                        <div class="dashboard-header">
                            <div class="dashboard-title">
                                <i class="fas fa-clipboard-check"></i>
                                <span>Confer√™ncias</span>
                            </div>
                            <div class="dashboard-counter" id="contadorConferencias">0</div>
                        </div>
                        <div class="dashboard-content" id="conferenciasContent">
                            <div class="empty-state">
                                <i class="fas fa-clipboard-check"></i>
                                <p>Carregando confer√™ncias...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard de Check-ins -->
                    <div class="dashboard-section" id="checkinsSection">
                        <div class="dashboard-header">
                            <div class="dashboard-title">
                                <i class="fas fa-plane-departure"></i>
                                <span>Check-ins</span>
                            </div>
                            <div class="dashboard-counter" id="contadorCheckins">0</div>
                        </div>
                        <div class="dashboard-content" id="checkinsContent">
                            <div class="empty-state">
                                <i class="fas fa-plane-departure"></i>
                                <p>Carregando check-ins...</p>
                            </div>
                        </div>
                    </div>

                    <!-- Dashboard de P√≥s-vendas -->
                    <div class="dashboard-section" id="posVendasSection">
                        <div class="dashboard-header">
                            <div class="dashboard-title">
                                <i class="fas fa-star"></i>
                                <span>P√≥s-vendas</span>
                            </div>
                            <div class="dashboard-counter" id="contadorPosVendas">0</div>
                        </div>
                        <div class="dashboard-content" id="posVendasContent">
                            <div class="empty-state">
                                <i class="fas fa-star"></i>
                                <p>Carregando p√≥s-vendas...</p>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal de Confer√™ncia -->
    <div class="modal fade" id="modalConferencia" tabindex="-1">
        <div class="modal-dialog modal-xl" style="max-width: 95vw;">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-clipboard-check me-2"></i>
                        Confer√™ncia de Informe
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <div id="conferencia-info"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" onclick="salvarEdicoes('conferencia')">
                        <i class="fas fa-save"></i> Salvar Edi√ß√µes
                    </button>
                    <button type="button" class="btn btn-primary" onclick="confirmarConferencia()">
                        <i class="fas fa-check"></i> Conferir Informe
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Check-in -->
    <div class="modal fade" id="modalCheckin" tabindex="-1">
        <div class="modal-dialog modal-xl" style="max-width: 95vw;">
            <div class="modal-content">
                <div class="modal-header bg-warning text-dark">
                    <h5 class="modal-title">
                        <i class="fas fa-plane-departure me-2"></i>
                        Check-in de Voo
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <div id="checkin-info"></div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-warning" onclick="salvarEdicoes('checkin')">
                        <i class="fas fa-save"></i> Salvar Edi√ß√µes
                    </button>
                    <button type="button" class="btn btn-warning" onclick="confirmarCheckin()">
                        <i class="fas fa-check"></i> Fazer Check-in
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de P√≥s-venda -->
    <div class="modal fade" id="modalPosVenda" tabindex="-1">
        <div class="modal-dialog modal-xl" style="max-width: 95vw;">
            <div class="modal-content">
                <div class="modal-header bg-success text-white">
                    <h5 class="modal-title">
                        <i class="fas fa-star me-2"></i>
                        P√≥s-venda
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" style="max-height: 80vh; overflow-y: auto;">
                    <div id="pos-venda-info" class="mb-3"></div>
                    
                    <form id="formPosVenda">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <textarea class="form-control" id="observacoes" style="height: 100px"></textarea>
                                    <label for="observacoes">Observa√ß√µes da Viagem</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="grupoOfertas">
                                        <option value="">Selecione...</option>
                                        <option value="Sim">Sim</option>
                                        <option value="N√£o">N√£o</option>
                                    </select>
                                    <label for="grupoOfertas">Grupo Ofertas WhatsApp</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="postouInsta">
                                        <option value="">Selecione...</option>
                                        <option value="Sim">Sim</option>
                                        <option value="N√£o">N√£o</option>
                                    </select>
                                    <label for="postouInsta">Postou no Instagram</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="avaliacaoGoogle">
                                        <option value="">Selecione...</option>
                                        <option value="Solicitado">Solicitado</option>
                                        <option value="Recusou">Recusou</option>
                                        <option value="J√° tinha">J√° tinha</option>
                                    </select>
                                    <label for="avaliacaoGoogle">Avalia√ß√£o Google</label>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <select class="form-select" id="sac">
                                        <option value="">Selecione...</option>
                                        <option value="Sim">Sim</option>
                                        <option value="N√£o">N√£o</option>
                                    </select>
                                    <label for="sac">Teve algum problema (SAC)</label>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-floating mb-3">
                                    <input type="text" class="form-control" id="numeroSAC">
                                    <label for="numeroSAC">N√∫mero do SAC (se aplic√°vel)</label>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-success" onclick="confirmarPosVenda()">
                        <i class="fas fa-check"></i> Confirmar P√≥s-venda
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // ================================================================================
        // SYSTELOS TUR - EMBARQUES v12.5 - CORRE√á√ÉO MODALDATA E FORMATO DE DATAS
        // ================================================================================
        
        // Vari√°veis globais
        let dadosEmbarques = [];
        let dadosFiltrados = {
            conferencias: [],
            checkins: [],
            posVendas: []
        };
        let filtrosAtivos = {
            vendedor: '',
            prioridade: '',
            cliente: ''
        };
        
        // Dados tempor√°rios para modais
        let modalData = {};
        
        // Inicializa√ß√£o
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ SYSTELOS TUR - Embarques v12.4 iniciando...', 'info');
            inicializarSistema();
        });
        
        async function inicializarSistema() {
            try {
                debugLog('üöÄ SYSTELOS TUR - Embarques v12.4 iniciando...', 'info');
                debugLog('üîß API URL: ' + CVC_CONFIG.API_URL, 'info');
                debugLog('üè™ Filial: ' + CVC_CONFIG.FILIAL_PADRAO, 'info');
                
                mostrarLoading(true);
                
                // Verificar modo an√¥nimo
                const isIncognito = await detectarModoAnonimo();
                if (isIncognito) {
                    console.warn('üïµÔ∏è Modo an√¥nimo detectado - algumas funcionalidades podem n√£o funcionar');
                    mostrarAlerta('üïµÔ∏è Modo an√¥nimo detectado! Para acessar dados reais da planilha, use o navegador normal e fa√ßa login no Google.', 'info');
                }
                
                // Verificar se config est√° carregado
                if (typeof CVC_CONFIG === 'undefined' || !CVC_CONFIG.API_URL) {
                    throw new Error('Configura√ß√£o CVC_CONFIG n√£o encontrada. Verifique se config.js est√° carregado.');
                }
                
                // Carregar vendedores no filtro
                await carregarVendedores();
                debugLog('‚úÖ Vendedores carregados', 'success');
                
                // Carregar dados dos embarques
                await carregarEmbarques();
                debugLog('‚úÖ Embarques carregados', 'success');
                
                // Configurar auto-refresh
                configurarAutoRefresh();
                debugLog('‚úÖ Auto-refresh configurado', 'success');
                
                mostrarLoading(false);
                debugLog('‚úÖ Sistema inicializado com sucesso', 'success');
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o:', error);
                mostrarAlerta('Erro ao carregar o sistema: ' + error.message, 'danger');
                mostrarLoading(false);
                
                // Mostrar informa√ß√µes de debug
                console.error('üîç Debug Info:');
                console.error('- CVC_CONFIG existe:', typeof CVC_CONFIG !== 'undefined');
                console.error('- API_URL:', typeof CVC_CONFIG !== 'undefined' ? CVC_CONFIG.API_URL : 'undefined');
                console.error('- Erro completo:', error);
            }
        }
        
        // ================================================================================
        // CARREGAMENTO DE DADOS
        // ================================================================================
        
        async function carregarVendedores() {
            const select = document.getElementById('filtroVendedor');
            
            // Usar vendedores do config.js
            if (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.VENDEDORES) {
                CVC_CONFIG.VENDEDORES.forEach(vendedor => {
                    const option = document.createElement('option');
                    option.value = vendedor;
                    option.textContent = vendedor;
                    select.appendChild(option);
                });
            }
        }
        
        async function carregarEmbarques() {
            try {
                debugLog('üìä Carregando embarques da API...', 'info');
                mostrarAlerta('‚è≥ Carregando dados da planilha... Isso pode levar alguns segundos.', 'info');
                
                // Tentar diferentes m√©todos de requisi√ß√£o
                let dados = null;
                
                // M√©todo 1: JSONP (melhor para CORS)
                try {
                    dados = await fazerRequisicaoJSONP(CVC_CONFIG.API_URL, {
                        action: 'listarEmbarques',
                        t: Date.now()
                    });
                } catch (jsonpError) {
                    console.warn('‚ö†Ô∏è JSONP falhou:', jsonpError.message);
                    
                    // M√©todo 2: Fetch com CORS (backup)
                    try {
                        const response = await fetch(CVC_CONFIG.API_URL + '?action=listarEmbarques&t=' + Date.now(), {
                            method: 'GET',
                            mode: 'cors',
                            credentials: 'omit' // Importante para modo an√¥nimo
                        });
                        
                        if (response.ok) {
                            dados = await response.json();
                        } else {
                            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        }
                    } catch (fetchError) {
                        console.warn('‚ö†Ô∏è Fetch tamb√©m falhou:', fetchError.message);
                        throw new Error('Todos os m√©todos de requisi√ß√£o falharam');
                    }
                }
                
                if (!dados.success) {
                    throw new Error(dados.message || 'Erro desconhecido na API');
                }
                
                dadosEmbarques = dados.data.embarques || [];
                
                debugLog(`‚úÖ ${dadosEmbarques.length} embarques carregados da API`, 'success');
                
                // Mostrar sucesso se conectou com API real
                mostrarAlerta('‚úÖ Conectado com a planilha! Dados atualizados.', 'success');
                
            } catch (error) {
                console.error('‚ùå Erro ao carregar embarques da API:', error.message);
                
                // Verificar tipo de erro e mostrar mensagem espec√≠fica
                if (error.message.includes('401') || error.message.includes('403') || error.message.includes('Unauthorized')) {
                    mostrarAlerta('‚ùå Acesso negado √† API. Verifique as credenciais ou permiss√µes.', 'danger');
                } else if (error.message.includes('CORS') || error.message.includes('Network')) {
                    mostrarAlerta('‚ùå Erro de conex√£o com a API. Verifique a URL no config.js ou sua conex√£o de internet.', 'danger');
                } else {
                    mostrarAlerta('‚ùå Erro ao carregar dados: ' + error.message, 'danger');
                }
                
                // N√ÉO usar dados simulados - deixar vazio
                dadosEmbarques = [];
                debugLog('‚ùå Nenhum dado carregado - API n√£o dispon√≠vel', 'error');
            }
            
            // Processar e renderizar dashboards
            processarDashboards();
            
            // Atualizar timestamp
            document.getElementById('ultimaAtualizacao').textContent = 
                new Date().toLocaleString('pt-BR');
        }
        
        // Fun√ß√£o JSONP para compatibilidade com Google Apps Script
        function fazerRequisicaoJSONP(url, params) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_callback_' + Math.round(100000 * Math.random());
                let timeoutId;
                
                // Criar fun√ß√£o callback global tempor√°ria
                window[callbackName] = function(data) {
                    clearTimeout(timeoutId);
                    delete window[callbackName];
                    if (script.parentNode) {
                        document.body.removeChild(script);
                    }
                    resolve(data);
                };
                
                // Adicionar callback aos par√¢metros
                const urlParams = new URLSearchParams();
                Object.keys(params).forEach(key => {
                    urlParams.append(key, params[key]);
                });
                urlParams.append('callback', callbackName);
                
                // Criar script tag
                const script = document.createElement('script');
                script.src = url + '?' + urlParams.toString();
                
                script.onerror = () => {
                    clearTimeout(timeoutId);
                    delete window[callbackName];
                    if (script.parentNode) {
                        document.body.removeChild(script);
                    }
                    reject(new Error('Falha na requisi√ß√£o JSONP - Verifique se a API est√° funcionando'));
                };
                
                // Timeout de 60 segundos para APIs grandes (420+ embarques)
                timeoutId = setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script.parentNode) {
                            document.body.removeChild(script);
                        }
                        reject(new Error('Timeout na requisi√ß√£o JSONP (60s) - API pode estar lenta ou planilha muito grande'));
                    }
                }, 60000);
                
                document.body.appendChild(script);
            });
        }
        
        // ================================================================================
        // PROCESSAMENTO DE DASHBOARDS
        // ================================================================================
        
        function processarDashboards() {
            debugLog('‚öôÔ∏è Processando dashboards...', 'info');
            debugLog('üìä Total de embarques recebidos: ' + dadosEmbarques.length, 'info');
            
            // Verificar se h√° dados v√°lidos
            if (!Array.isArray(dadosEmbarques) || dadosEmbarques.length === 0) {
                console.warn('‚ö†Ô∏è Nenhum dado de embarque dispon√≠vel');
                mostrarEmptyStates();
                return;
            }
            
            // Resetar dados filtrados
            dadosFiltrados = {
                conferencias: [],
                checkins: [],
                posVendas: []
            };
            
            // Processar confer√™ncias (agrupadas por informe)
            processarConferencias();
            debugLog('‚úÖ Confer√™ncias processadas: ' + dadosFiltrados.conferencias.length, 'success');
            
            // Processar check-ins (individuais por voo)
            processarCheckins();
            debugLog('‚úÖ Check-ins processados: ' + dadosFiltrados.checkins.length, 'success');
            
            // Processar p√≥s-vendas (agrupadas, ativadas por data)
            processarPosVendas();
            debugLog('‚úÖ P√≥s-vendas processadas: ' + dadosFiltrados.posVendas.length, 'success');
            
            // Renderizar dashboards
            renderizarDashboards();
        }
        
        function mostrarEmptyStates() {
            // Mostrar estados vazios em todos os dashboards
            document.getElementById('conferenciasContent').innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-clipboard-check"></i>
                    <p>Conectando com a planilha...</p>
                    <small>Verifique sua conex√£o com a internet</small>
                </div>
            `;
            
            document.getElementById('checkinsContent').innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-plane-departure"></i>
                    <p>Conectando com a planilha...</p>
                    <small>Verifique sua conex√£o com a internet</small>
                </div>
            `;
            
            document.getElementById('posVendasContent').innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-star"></i>
                    <p>Conectando com a planilha...</p>
                    <small>Verifique sua conex√£o com a internet</small>
                </div>
            `;
            
            // Zerar contadores
            atualizarContadores();
        }
        
        function processarConferencias() {
            const informes = {};
            
            // Agrupar por n√∫mero do informe
            dadosEmbarques.forEach(embarque => {
                if (!embarque.numeroInforme || embarque.conferenciaFeita) return;
                
                if (!informes[embarque.numeroInforme]) {
                    informes[embarque.numeroInforme] = {
                        numeroInforme: embarque.numeroInforme,
                        vendedor: embarque.vendedor,
                        clientes: new Set(),
                        datas: [],
                        voos: [],
                        cpfPrincipal: embarque.cpfCliente
                    };
                }
                
                const informe = informes[embarque.numeroInforme];
                informe.clientes.add(embarque.nomeCliente);
                informe.datas.push(new Date(embarque.dataIda));
                informe.voos.push(embarque);
            });
            
            // Converter para array e calcular prioridades
            dadosFiltrados.conferencias = Object.values(informes).map(informe => {
                const primeiraData = new Date(Math.min(...informe.datas));
                const diasParaConferencia = calcularDiasRestantes(primeiraData) - 10;
                
                return {
                    ...informe,
                    clientes: Array.from(informe.clientes),
                    primeiraData: primeiraData,
                    diasParaConferencia: diasParaConferencia,
                    prioridade: calcularPrioridadeConferencia(diasParaConferencia),
                    totalVoos: informe.voos.length
                };
            });
            
            // Ordenar por prioridade E por data (vendas mais antigas primeiro)
            dadosFiltrados.conferencias.sort((a, b) => {
                const ordemPrioridade = { 'ATRASADO': 0, 'URGENTE': 1, 'PROXIMO': 2, 'NORMAL': 3 };
                const prioridadeDiff = ordemPrioridade[a.prioridade] - ordemPrioridade[b.prioridade];
                
                // Se mesma prioridade, ordenar por data (mais pr√≥xima primeiro = mais antiga)
                if (prioridadeDiff === 0) {
                    return new Date(a.primeiraData) - new Date(b.primeiraData);
                }
                
                return prioridadeDiff;
            });
        }
        
        function processarCheckins() {
            dadosFiltrados.checkins = dadosEmbarques.filter(embarque => {
                if (!embarque.dataIda || embarque.checkinFeito) return false;
                
                const dataVoo = new Date(embarque.dataIda);
                const diasParaVoo = calcularDiasRestantes(dataVoo) - 2;
                
                // S√≥ mostrar se est√° dentro da janela de check-in (2 dias antes ou menos)
                return diasParaVoo <= 0;
                
            }).map(embarque => {
                const dataVoo = new Date(embarque.dataIda);
                const diasParaCheckin = calcularDiasRestantes(dataVoo) - 2;
                
                return {
                    ...embarque,
                    diasParaCheckin: diasParaCheckin,
                    prioridade: calcularPrioridadeCheckin(diasParaCheckin)
                };
            });
            
            // Ordenar por prioridade E por data (mais urgentes primeiro)
            dadosFiltrados.checkins.sort((a, b) => {
                const ordemPrioridade = { 'ATRASADO': 0, 'URGENTE': 1, 'PROXIMO': 2, 'NORMAL': 3 };
                const prioridadeDiff = ordemPrioridade[a.prioridade] - ordemPrioridade[b.prioridade];
                
                // Se mesma prioridade, ordenar por data de voo (mais pr√≥xima primeiro)
                if (prioridadeDiff === 0) {
                    return new Date(a.dataIda) - new Date(b.dataIda);
                }
                
                return prioridadeDiff;
            });
        }
        
        function processarPosVendas() {
            const informes = {};
            
            // Agrupar por n√∫mero do informe
            dadosEmbarques.forEach(embarque => {
                if (!embarque.numeroInforme || embarque.posVendaFeita) return;
                
                if (!informes[embarque.numeroInforme]) {
                    informes[embarque.numeroInforme] = {
                        numeroInforme: embarque.numeroInforme,
                        vendedor: embarque.vendedor,
                        clientes: new Set(),
                        datasVolta: [],
                        voos: [],
                        cpfPrincipal: embarque.cpfCliente
                    };
                }
                
                const informe = informes[embarque.numeroInforme];
                informe.clientes.add(embarque.nomeCliente);
                
                // Considerar tanto data de volta quanto data de ida (para voos s√≥ de ida)
                if (embarque.dataVolta) {
                    informe.datasVolta.push(new Date(embarque.dataVolta));
                } else {
                    informe.datasVolta.push(new Date(embarque.dataIda));
                }
                
                informe.voos.push(embarque);
            });
            
            // Converter para array e filtrar por data
            dadosFiltrados.posVendas = Object.values(informes).filter(informe => {
                const ultimaData = new Date(Math.max(...informe.datasVolta));
                const diasAposRetorno = calcularDiasPassados(ultimaData);
                
                // Ativar p√≥s-venda 1 dia ap√≥s o retorno
                return diasAposRetorno >= 1;
                
            }).map(informe => {
                const ultimaData = new Date(Math.max(...informe.datasVolta));
                const diasAposRetorno = calcularDiasPassados(ultimaData);
                
                return {
                    ...informe,
                    clientes: Array.from(informe.clientes),
                    ultimaData: ultimaData,
                    diasAposRetorno: diasAposRetorno,
                    prioridade: 'NORMAL', // P√≥s-venda n√£o tem urg√™ncia cr√≠tica
                    totalVoos: informe.voos.length
                };
            });
            
            // Ordenar por data (retornos mais antigos primeiro = mais dias ap√≥s retorno)
            dadosFiltrados.posVendas.sort((a, b) => b.diasAposRetorno - a.diasAposRetorno);
        }
        
        // ================================================================================
        // C√ÅLCULO DE PRIORIDADES
        // ================================================================================
        
        function calcularPrioridadeConferencia(diasRestantes) {
            if (diasRestantes <= -1) return 'ATRASADO';
            if (diasRestantes <= 0) return 'URGENTE';
            if (diasRestantes <= 3) return 'PROXIMO';
            return 'NORMAL';
        }
        
        function calcularPrioridadeCheckin(diasRestantes) {
            if (diasRestantes <= -1) return 'ATRASADO';
            if (diasRestantes <= 0) return 'URGENTE';
            if (diasRestantes <= 1) return 'PROXIMO';
            return 'NORMAL';
        }
        
        function calcularDiasRestantes(dataFutura) {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const dataAlvo = new Date(dataFutura);
            dataAlvo.setHours(0, 0, 0, 0);
            
            const diffTime = dataAlvo.getTime() - hoje.getTime();
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }
        
        function calcularDiasPassados(dataPassada) {
            const hoje = new Date();
            hoje.setHours(0, 0, 0, 0);
            
            const dataAlvo = new Date(dataPassada);
            dataAlvo.setHours(0, 0, 0, 0);
            
            const diffTime = hoje.getTime() - dataAlvo.getTime();
            return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
        }
        
        // ================================================================================
        // RENDERIZA√á√ÉO DE DASHBOARDS
        // ================================================================================
        
        function renderizarDashboards() {
            renderizarConferencias();
            renderizarCheckins();
            renderizarPosVendas();
            atualizarContadores();
        }
        
        function renderizarConferencias() {
            const container = document.getElementById('conferenciasContent');
            const conferencias = aplicarFiltrosLista(dadosFiltrados.conferencias);
            
            if (conferencias.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-clipboard-check"></i>
                        <p>Nenhuma confer√™ncia pendente</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = conferencias.map(informe => `
                <div class="embarque-card priority-${informe.prioridade}" 
                     onclick="abrirModalConferencia('${informe.numeroInforme}')">
                    <div class="card-header-custom">
                        <span class="priority-badge ${informe.prioridade}">${informe.prioridade}</span>
                        <span class="days-remaining">${formatarDiasRestantes(informe.diasParaConferencia)}</span>
                    </div>
                    <div class="card-info">
                        <strong>Informe:</strong> ${informe.numeroInforme}
                    </div>
                    <div class="card-info">
                        <strong>Recibos:</strong> ${informe.voos.map(v => v.recibo || 'S/N').filter(r => r !== 'S/N').join(', ') || 'N√£o informado'}
                    </div>
                    <div class="card-info">
                        <strong>Vendedor:</strong> ${informe.vendedor}
                    </div>
                    <div class="card-info">
                        <strong>Cliente:</strong> ${informe.clientes[0]}
                        ${informe.clientes.length > 1 ? ` (+${informe.clientes.length - 1})` : ''}
                    </div>
                    <div class="card-info">
                        <strong>Primeira viagem:</strong> ${formatarData(informe.primeiraData)}
                    </div>
                    <div class="card-info">
                        <strong>Total de voos:</strong> ${informe.totalVoos}
                    </div>
                    <div class="card-actions">
                        <button class="btn-action btn-conferencia" onclick="event.stopPropagation(); abrirModalConferencia('${informe.numeroInforme}')">
                            <i class="fas fa-check"></i> Conferir
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function renderizarCheckins() {
            const container = document.getElementById('checkinsContent');
            const checkins = aplicarFiltrosLista(dadosFiltrados.checkins);
            
            if (checkins.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-plane-departure"></i>
                        <p>Nenhum check-in pendente</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = checkins.map(voo => `
                <div class="embarque-card priority-${voo.prioridade}" 
                     onclick="abrirModalCheckin('${voo.id}')">
                    <div class="card-header-custom">
                        <span class="priority-badge ${voo.prioridade}">${voo.prioridade}</span>
                        <span class="days-remaining">${formatarDiasRestantes(voo.diasParaCheckin)}</span>
                    </div>
                    <div class="card-info">
                        <strong>Recibo:</strong> ${voo.recibo || 'N√£o informado'}
                    </div>
                    <div class="card-info">
                        <strong>Cliente:</strong> ${voo.nomeCliente}
                    </div>
                    <div class="card-info">
                        <strong>Data do voo:</strong> ${formatarData(voo.dataIda)}
                    </div>
                    <div class="card-info">
                        <strong>Companhia:</strong> ${voo.cia || 'N/A'}
                    </div>
                    <div class="card-info">
                        <strong>Tipo:</strong> ${voo.tipoAereo || voo.tipo}
                    </div>
                    <div class="card-info">
                        <strong>Vendedor:</strong> ${voo.vendedor}
                    </div>
                    <div class="card-actions">
                        <button class="btn-action btn-checkin" onclick="event.stopPropagation(); abrirModalCheckin('${voo.id}')">
                            <i class="fas fa-plane-departure"></i> Check-in
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        function renderizarPosVendas() {
            const container = document.getElementById('posVendasContent');
            const posVendas = aplicarFiltrosLista(dadosFiltrados.posVendas);
            
            if (posVendas.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-star"></i>
                        <p>Nenhuma p√≥s-venda pendente</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = posVendas.map(informe => `
                <div class="embarque-card priority-${informe.prioridade}" 
                     onclick="abrirModalPosVenda('${informe.numeroInforme}')">
                    <div class="card-header-custom">
                        <span class="priority-badge ${informe.prioridade}">DISPON√çVEL</span>
                        <span class="days-remaining">+${informe.diasAposRetorno} dias</span>
                    </div>
                    <div class="card-info">
                        <strong>Informe:</strong> ${informe.numeroInforme}
                    </div>
                    <div class="card-info">
                        <strong>Recibos:</strong> ${informe.voos.map(v => v.recibo || 'S/N').filter(r => r !== 'S/N').join(', ') || 'N√£o informado'}
                    </div>
                    <div class="card-info">
                        <strong>Cliente:</strong> ${informe.clientes[0]}
                        ${informe.clientes.length > 1 ? ` (+${informe.clientes.length - 1})` : ''}
                    </div>
                    <div class="card-info">
                        <strong>Retorno:</strong> ${formatarData(informe.ultimaData)}
                    </div>
                    <div class="card-info">
                        <strong>Vendedor:</strong> ${informe.vendedor}
                    </div>
                    <div class="card-info">
                        <strong>Total de voos:</strong> ${informe.totalVoos}
                    </div>
                    <div class="card-actions">
                        <button class="btn-action btn-pos-venda" onclick="event.stopPropagation(); abrirModalPosVenda('${informe.numeroInforme}')">
                            <i class="fas fa-star"></i> P√≥s-venda
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // ================================================================================
        // FILTROS
        // ================================================================================
        
        function aplicarFiltros() {
            filtrosAtivos.vendedor = document.getElementById('filtroVendedor').value;
            filtrosAtivos.prioridade = document.getElementById('filtroPrioridade').value;
            filtrosAtivos.cliente = document.getElementById('buscaCliente').value.toLowerCase();
            
            renderizarDashboards();
        }
        
        function aplicarFiltrosLista(lista) {
            return lista.filter(item => {
                // Filtro por vendedor
                if (filtrosAtivos.vendedor && item.vendedor !== filtrosAtivos.vendedor) {
                    return false;
                }
                
                // Filtro por prioridade
                if (filtrosAtivos.prioridade && item.prioridade !== filtrosAtivos.prioridade) {
                    return false;
                }
                
                // Filtro por cliente
                if (filtrosAtivos.cliente) {
                    const clientes = Array.isArray(item.clientes) ? item.clientes : [item.nomeCliente];
                    const clienteMatch = clientes.some(cliente => 
                        cliente.toLowerCase().includes(filtrosAtivos.cliente)
                    );
                    
                    const cpfMatch = item.cpfPrincipal && 
                        item.cpfPrincipal.replace(/\D/g, '').includes(filtrosAtivos.cliente.replace(/\D/g, ''));
                    
                    if (!clienteMatch && !cpfMatch) {
                        return false;
                    }
                }
                
                return true;
            });
        }
        
        // ================================================================================
        // MODAIS E A√á√ïES COM FEEDBACK VISUAL
        // ================================================================================
        
        // Fun√ß√£o auxiliar para converter data ISO para formato yyyy-MM-dd
        function converterDataParaInput(dataISO) {
            if (!dataISO) return '';
            try {
                const data = new Date(dataISO);
                if (isNaN(data.getTime())) return '';
                
                const ano = data.getFullYear();
                const mes = String(data.getMonth() + 1).padStart(2, '0');
                const dia = String(data.getDate()).padStart(2, '0');
                
                return `${ano}-${mes}-${dia}`;
            } catch (error) {
                console.error('Erro ao converter data:', error);
                return '';
            }
        }
        
        function abrirModalConferencia(numeroInforme) {
            const informe = dadosFiltrados.conferencias.find(i => i.numeroInforme === numeroInforme);
            if (!informe) return;
            
            modalData.conferencia = informe;
            
            // ‚úÖ RESETAR BOT√ïES DO MODAL (corrige bug de bot√µes desabilitados)
            setTimeout(() => {
                const btnConfirmar = document.querySelector('button[onclick="confirmarConferencia()"]');
                const btnSalvar = document.querySelector('button[onclick="salvarEdicoes(\'conferencia\')"]');
                const btnCancelar = document.querySelector('.modal#modalConferencia .btn-secondary[data-bs-dismiss="modal"]');
                
                if (btnConfirmar) {
                    btnConfirmar.disabled = false;
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Conferir Informe';
                    btnConfirmar.classList.remove('btn-loading', 'btn-success-feedback', 'btn-error-feedback');
                }
                if (btnSalvar) {
                    btnSalvar.disabled = false;
                }
                if (btnCancelar) {
                    btnCancelar.disabled = false;
                }
            }, 100);
            
            document.getElementById('conferencia-info').innerHTML = `
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center mb-3">
                            <h5 class="text-primary mb-0 me-3">
                                <i class="fas fa-clipboard-check"></i> ${informe.numeroInforme}
                            </h5>
                            <span class="priority-badge ${informe.prioridade}">${informe.prioridade}</span>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-2"><strong>Vendedor:</strong> ${informe.vendedor}</p>
                                <p class="mb-2"><strong>Total de voos:</strong> ${informe.totalVoos}</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-2"><strong>Primeira viagem:</strong> ${formatarData(informe.primeiraData)}</p>
                                <p class="mb-2"><strong>Clientes:</strong> ${informe.clientes.join(', ')}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-info btn-sm mb-2" onclick="buscarOrbiuns('${informe.voos[0]?.whatsappCliente || ''}')">
                            <i class="fas fa-search"></i> Buscar Orbiuns
                        </button>
                    </div>
                </div>
                
                <hr>
                
                <h6 class="text-secondary mb-3">
                    <i class="fas fa-plane"></i> Detalhes dos Voos (${informe.totalVoos} voo${informe.totalVoos > 1 ? 's' : ''})
                </h6>
                
                ${informe.voos.map((voo, index) => `
                    <div class="card mb-4 border-start border-primary border-3">
                        <div class="card-header bg-light">
                            <div class="row align-items-center">
                                <div class="col-md-6">
                                    <h6 class="mb-0 text-dark">
                                        <i class="fas fa-user"></i> ${voo.nomeCliente}
                                    </h6>
                                    <small class="text-muted">Voo ${index + 1} - ID: ${voo.id}</small>
                                </div>
                                <div class="col-md-6 text-end">
                                    <span class="badge bg-info">${formatarData(voo.dataIda)}</span>
                                    ${voo.cia ? `<span class="badge bg-secondary ms-1">${voo.cia}</span>` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-body">
                            <div class="row g-3">
                                <!-- Linha 1: Dados pessoais -->
                                <div class="col-md-4">
                                    <label class="form-label"><strong>Nome Completo</strong></label>
                                    <input type="text" class="form-control" 
                                           value="${voo.nomeCliente || ''}" 
                                           data-voo-id="${voo.id}" data-campo="nomeCliente">
                                </div>
                                
                                <div class="col-md-4">
                                    <label class="form-label"><strong>CPF</strong></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" 
                                               value="${voo.cpfCliente || ''}" 
                                               data-voo-id="${voo.id}" data-campo="cpfCliente"
                                               placeholder="000.000.000-00">
                                        <button class="btn btn-outline-primary" type="button" 
                                                onclick="copiarTexto('${voo.cpfCliente || ''}', 'CPF')" title="Copiar CPF">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <label class="form-label"><strong>WhatsApp</strong></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" 
                                               value="${voo.whatsappCliente || ''}" 
                                               data-voo-id="${voo.id}" data-campo="whatsappCliente"
                                               placeholder="(11) 99999-9999">
                                        <button class="btn btn-outline-success" type="button" 
                                                onclick="copiarTexto('${voo.whatsappCliente || ''}', 'WhatsApp')" title="Copiar WhatsApp">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Linha 2: Datas e viagem -->
                                <div class="col-md-3">
                                    <label class="form-label"><strong>Data de Ida</strong></label>
                                    <input type="date" class="form-control" 
                                           value="${converterDataParaInput(voo.dataIda)}" 
                                           data-voo-id="${voo.id}" data-campo="dataIda">
                                </div>
                                
                                <div class="col-md-3">
                                    <label class="form-label"><strong>Data de Volta</strong></label>
                                    <input type="date" class="form-control" 
                                           value="${converterDataParaInput(voo.dataVolta)}" 
                                           data-voo-id="${voo.id}" data-campo="dataVolta">
                                </div>
                                
                                <div class="col-md-3">
                                    <label class="form-label"><strong>Companhia</strong></label>
                                    <input type="text" class="form-control" 
                                           value="${voo.cia || ''}" 
                                           data-voo-id="${voo.id}" data-campo="cia"
                                           placeholder="GOL, LATAM, AZUL...">
                                </div>
                                
                                <div class="col-md-3">
                                    <label class="form-label"><strong>Tipo de Servi√ßo</strong></label>
                                    <select class="form-select" data-voo-id="${voo.id}" data-campo="tipo">
                                        <option value="A√©reo" ${(voo.tipo || 'A√©reo') === 'A√©reo' ? 'selected' : ''}>A√©reo</option>
                                        <option value="A+H" ${voo.tipo === 'A+H' ? 'selected' : ''}>A+H</option>
                                        <option value="Hotel" ${voo.tipo === 'Hotel' ? 'selected' : ''}>Hotel</option>
                                        <option value="Cruzeiro" ${voo.tipo === 'Cruzeiro' ? 'selected' : ''}>Cruzeiro</option>
                                    </select>
                                </div>
                                
                                <!-- Linha 3: Recibo e localizadores -->
                                <div class="col-md-4">
                                    <label class="form-label"><strong>N√∫mero do Recibo</strong></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" 
                                               value="${voo.recibo || ''}" 
                                               data-voo-id="${voo.id}" data-campo="recibo"
                                               placeholder="N√∫mero do recibo">
                                        <button class="btn btn-outline-warning" type="button" 
                                                onclick="copiarTexto('${voo.recibo || ''}', 'Recibo')" title="Copiar Recibo">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <label class="form-label"><strong>LOC GDS</strong></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" 
                                               value="${voo.locGds || ''}" 
                                               data-voo-id="${voo.id}" data-campo="locGds"
                                               placeholder="Localizador GDS">
                                        <button class="btn btn-outline-info" type="button" 
                                                onclick="copiarTexto('${voo.locGds || ''}', 'LOC GDS')" title="Copiar LOC GDS">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <div class="col-md-4">
                                    <label class="form-label"><strong>LOC CIA</strong></label>
                                    <div class="input-group">
                                        <input type="text" class="form-control" 
                                               value="${voo.locCia || ''}" 
                                               data-voo-id="${voo.id}" data-campo="locCia"
                                               placeholder="Localizador CIA">
                                        <button class="btn btn-outline-info" type="button" 
                                                onclick="copiarTexto('${voo.locCia || ''}', 'LOC CIA')" title="Copiar LOC CIA">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                </div>
                                
                                <!-- Linha 4: Servi√ßos e op√ß√µes -->
                                <div class="col-md-2">
                                    <label class="form-label"><strong>Bagagem</strong></label>
                                    <select class="form-select" data-voo-id="${voo.id}" data-campo="temBagagem">
                                        <option value="N√£o informado" ${(voo.temBagagem || 'N√£o informado') === 'N√£o informado' ? 'selected' : ''}>N√£o informado</option>
                                        <option value="Sim" ${voo.temBagagem === 'Sim' ? 'selected' : ''}>Sim</option>
                                        <option value="N√£o" ${voo.temBagagem === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-2">
                                    <label class="form-label"><strong>Assento</strong></label>
                                    <select class="form-select" data-voo-id="${voo.id}" data-campo="temAssento">
                                        <option value="N√£o informado" ${(voo.temAssento || 'N√£o informado') === 'N√£o informado' ? 'selected' : ''}>N√£o informado</option>
                                        <option value="Sim" ${voo.temAssento === 'Sim' ? 'selected' : ''}>Sim</option>
                                        <option value="N√£o" ${voo.temAssento === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-2">
                                    <label class="form-label"><strong>Seguro</strong></label>
                                    <select class="form-select" data-voo-id="${voo.id}" data-campo="seguro">
                                        <option value="N√£o informado" ${(voo.seguro || 'N√£o informado') === 'N√£o informado' ? 'selected' : ''}>N√£o informado</option>
                                        <option value="Sim" ${voo.seguro === 'Sim' ? 'selected' : ''}>Sim</option>
                                        <option value="N√£o" ${voo.seguro === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                        <option value="Recusado" ${voo.seguro === 'Recusado' ? 'selected' : ''}>Recusado</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-3">
                                    <label class="form-label"><strong>Reserva</strong></label>
                                    <input type="text" class="form-control" 
                                           value="${voo.reserva || ''}" 
                                           data-voo-id="${voo.id}" data-campo="reserva"
                                           placeholder="C√≥digo da reserva">
                                </div>
                                
                                <div class="col-md-3">
                                    <label class="form-label"><strong>Cliente Ale</strong></label>
                                    <select class="form-select" data-voo-id="${voo.id}" data-campo="clienteAle">
                                        <option value="N√£o" ${(voo.clienteAle || 'N√£o') === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                        <option value="Sim" ${voo.clienteAle === 'Sim' ? 'selected' : ''}>Sim</option>
                                    </select>
                                </div>
                                
                                <!-- Linha 5: Observa√ß√µes -->
                                <div class="col-12">
                                    <label class="form-label"><strong>Observa√ß√µes</strong></label>
                                    <textarea class="form-control" rows="2" 
                                              data-voo-id="${voo.id}" data-campo="observacoes"
                                              placeholder="Observa√ß√µes espec√≠ficas do voo">${voo.observacoes || ''}</textarea>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('')}
            `;
            
            new bootstrap.Modal(document.getElementById('modalConferencia')).show();
        }
        
        // FUN√á√ÉO COM FEEDBACK VISUAL APRIMORADO
        async function confirmarConferencia() {
            const btnConfirmar = document.querySelector('button[onclick="confirmarConferencia()"]');
            const btnSalvar = document.querySelector('button[onclick="salvarEdicoes(\'conferencia\')"]');
            const btnCancelar = document.querySelector('.btn-secondary[data-bs-dismiss="modal"]');
            
            try {
                // Desabilitar todos os bot√µes e mostrar loading
                btnConfirmar.disabled = true;
                btnSalvar.disabled = true;
                btnCancelar.disabled = true;
                
                const iconOriginal = btnConfirmar.innerHTML;
                btnConfirmar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
                btnConfirmar.classList.add('btn-loading');
                
                const informe = modalData.conferencia;
                
                const dados = {
                    action: 'marcar_conferencia',
                    cpf: informe.cpfPrincipal,
                    numeroInforme: informe.numeroInforme,
                    desfazer: false
                };
                
                const response = await enviarAcao(dados);
                
                if (response.success) {
                    // Mostrar sucesso visual
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Salvo!';
                    btnConfirmar.classList.remove('btn-loading');
                    btnConfirmar.classList.add('btn-success-feedback');
                    
                    mostrarAlerta('Confer√™ncia marcada com sucesso!', 'success');
                    
                    // Limpar dados do modal
                    modalData.conferencia = null;
                    
                    // Aguardar um pouco antes de fechar para o usu√°rio ver o feedback
                    setTimeout(() => {
                        bootstrap.Modal.getInstance(document.getElementById('modalConferencia')).hide();
                    }, 1000);
                    
                    await carregarEmbarques();
                } else {
                    throw new Error(response.message);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao marcar confer√™ncia:', error);
                
                // Mostrar erro visual
                btnConfirmar.innerHTML = '<i class="fas fa-times"></i> Erro - Tente novamente';
                btnConfirmar.classList.remove('btn-loading');
                btnConfirmar.classList.add('btn-error-feedback');
                
                mostrarAlerta('Erro ao marcar confer√™ncia: ' + error.message, 'danger');
                
                // Reabilitar bot√µes ap√≥s erro
                setTimeout(() => {
                    btnConfirmar.disabled = false;
                    btnSalvar.disabled = false;
                    btnCancelar.disabled = false;
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Conferir Informe';
                    btnConfirmar.classList.remove('btn-error-feedback', 'btn-success-feedback');
                }, 3000);
            }
        }
        
        function abrirModalCheckin(vooId) {
            const voo = dadosFiltrados.checkins.find(v => v.id == vooId);
            if (!voo) return;
            
            modalData.checkin = voo;
            
            // ‚úÖ RESETAR BOT√ïES DO MODAL (corrige bug de bot√µes desabilitados)
            setTimeout(() => {
                const btnConfirmar = document.querySelector('button[onclick="confirmarCheckin()"]');
                const btnSalvar = document.querySelector('.modal#modalCheckin button[onclick="salvarEdicoes(\'checkin\')"]');
                const btnCancelar = document.querySelector('.modal#modalCheckin .btn-secondary[data-bs-dismiss="modal"]');
                
                if (btnConfirmar) {
                    btnConfirmar.disabled = false;
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Fazer Check-in';
                    btnConfirmar.classList.remove('btn-loading', 'btn-success-feedback', 'btn-error-feedback');
                }
                if (btnSalvar) {
                    btnSalvar.disabled = false;
                }
                if (btnCancelar) {
                    btnCancelar.disabled = false;
                }
            }, 100);
            
            document.getElementById('checkin-info').innerHTML = `
                <div class="row mb-4">
                    <div class="col-md-8">
                        <div class="d-flex align-items-center mb-3">
                            <h5 class="text-warning mb-0 me-3">
                                <i class="fas fa-plane-departure"></i> ${voo.nomeCliente}
                            </h5>
                            <span class="priority-badge ${voo.prioridade}">${voo.prioridade}</span>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <p class="mb-2"><strong>Data do voo:</strong> ${formatarData(voo.dataIda)}</p>
                                <p class="mb-2"><strong>Vendedor:</strong> ${voo.vendedor}</p>
                            </div>
                            <div class="col-md-6">
                                <p class="mb-2"><strong>Companhia:</strong> ${voo.cia || 'N/A'}</p>
                                <p class="mb-2"><strong>Tipo:</strong> ${voo.tipoAereo || voo.tipo}</p>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 text-end">
                        <button class="btn btn-info btn-sm mb-2" onclick="buscarOrbiuns('${voo.whatsappCliente || ''}')">
                            <i class="fas fa-search"></i> Buscar Orbiuns
                        </button>
                    </div>
                </div>
                
                <hr>
                
                <h6 class="text-secondary mb-3">
                    <i class="fas fa-edit"></i> Dados do Check-in (Todos Edit√°veis)
                </h6>
                
                <div class="card border-start border-warning border-3">
                    <div class="card-header bg-light">
                        <div class="row align-items-center">
                            <div class="col-md-6">
                                <h6 class="mb-0 text-dark">
                                    <i class="fas fa-plane-departure"></i> Check-in - ID: ${voo.id}
                                </h6>
                                <small class="text-muted">Todos os campos podem ser editados</small>
                            </div>
                            <div class="col-md-6 text-end">
                                <span class="badge bg-warning text-dark">${formatarData(voo.dataIda)}</span>
                                ${voo.cia ? `<span class="badge bg-secondary ms-1">${voo.cia}</span>` : ''}
                            </div>
                        </div>
                    </div>
                    
                    <div class="card-body">
                        <div class="row g-3">
                            <!-- Linha 1: Dados pessoais -->
                            <div class="col-md-4">
                                <label class="form-label"><strong>Nome Completo</strong></label>
                                <input type="text" class="form-control" 
                                       value="${voo.nomeCliente || ''}" 
                                       id="editNomeCliente">
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label"><strong>CPF</strong></label>
                                <div class="input-group">
                                    <input type="text" class="form-control" 
                                           value="${voo.cpfCliente || ''}" 
                                           id="editCpfCliente"
                                           placeholder="000.000.000-00">
                                    <button class="btn btn-outline-primary" type="button" 
                                            onclick="copiarTexto('${voo.cpfCliente || ''}', 'CPF')" title="Copiar CPF">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label"><strong>WhatsApp</strong></label>
                                <div class="input-group">
                                    <input type="text" class="form-control" 
                                           value="${voo.whatsappCliente || ''}" 
                                           id="editWhatsappCliente"
                                           placeholder="(11) 99999-9999">
                                    <button class="btn btn-outline-success" type="button" 
                                            onclick="copiarTexto('${voo.whatsappCliente || ''}', 'WhatsApp')" title="Copiar WhatsApp">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Linha 2: Datas e viagem -->
                            <div class="col-md-3">
                                <label class="form-label"><strong>Data de Ida</strong></label>
                                <input type="date" class="form-control" 
                                       value="${converterDataParaInput(voo.dataIda)}" 
                                       id="editDataIda">
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label"><strong>Data de Volta</strong></label>
                                <input type="date" class="form-control" 
                                       value="${converterDataParaInput(voo.dataVolta)}" 
                                       id="editDataVolta">
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label"><strong>Companhia</strong></label>
                                <input type="text" class="form-control" 
                                       value="${voo.cia || ''}" 
                                       id="editCia"
                                       placeholder="GOL, LATAM, AZUL...">
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label"><strong>Tipo de Servi√ßo</strong></label>
                                <select class="form-select" id="editTipo">
                                    <option value="A√©reo" ${(voo.tipo || 'A√©reo') === 'A√©reo' ? 'selected' : ''}>A√©reo</option>
                                    <option value="A+H" ${voo.tipo === 'A+H' ? 'selected' : ''}>A+H</option>
                                    <option value="Hotel" ${voo.tipo === 'Hotel' ? 'selected' : ''}>Hotel</option>
                                    <option value="Cruzeiro" ${voo.tipo === 'Cruzeiro' ? 'selected' : ''}>Cruzeiro</option>
                                </select>
                            </div>
                            
                            <!-- Linha 3: Recibo e localizadores -->
                            <div class="col-md-4">
                                <label class="form-label"><strong>N√∫mero do Recibo</strong></label>
                                <div class="input-group">
                                    <input type="text" class="form-control" 
                                           value="${voo.recibo || ''}" 
                                           id="editRecibo"
                                           placeholder="N√∫mero do recibo">
                                    <button class="btn btn-outline-warning" type="button" 
                                            onclick="copiarTexto(document.getElementById('editRecibo').value, 'Recibo')" title="Copiar Recibo">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label"><strong>LOC GDS</strong></label>
                                <div class="input-group">
                                    <input type="text" class="form-control" 
                                           value="${voo.locGds || ''}" 
                                           id="editLocGds"
                                           placeholder="Localizador GDS">
                                    <button class="btn btn-outline-info" type="button" 
                                            onclick="copiarTexto(document.getElementById('editLocGds').value, 'LOC GDS')" title="Copiar LOC GDS">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <div class="col-md-4">
                                <label class="form-label"><strong>LOC CIA</strong></label>
                                <div class="input-group">
                                    <input type="text" class="form-control" 
                                           value="${voo.locCia || ''}" 
                                           id="editLocCia"
                                           placeholder="Localizador CIA">
                                    <button class="btn btn-outline-info" type="button" 
                                            onclick="copiarTexto(document.getElementById('editLocCia').value, 'LOC CIA')" title="Copiar LOC CIA">
                                        <i class="fas fa-copy"></i>
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Linha 4: Servi√ßos e op√ß√µes -->
                            <div class="col-md-2">
                                <label class="form-label"><strong>Bagagem</strong></label>
                                <select class="form-select" id="editTemBagagem">
                                    <option value="N√£o informado" ${(voo.temBagagem || 'N√£o informado') === 'N√£o informado' ? 'selected' : ''}>N√£o informado</option>
                                    <option value="Sim" ${voo.temBagagem === 'Sim' ? 'selected' : ''}>Sim</option>
                                    <option value="N√£o" ${voo.temBagagem === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                </select>
                            </div>
                            
                            <div class="col-md-2">
                                <label class="form-label"><strong>Assento</strong></label>
                                <select class="form-select" id="editTemAssento">
                                    <option value="N√£o informado" ${(voo.temAssento || 'N√£o informado') === 'N√£o informado' ? 'selected' : ''}>N√£o informado</option>
                                    <option value="Sim" ${voo.temAssento === 'Sim' ? 'selected' : ''}>Sim</option>
                                    <option value="N√£o" ${voo.temAssento === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                </select>
                            </div>
                            
                            <div class="col-md-2">
                                <label class="form-label"><strong>Seguro</strong></label>
                                <select class="form-select" id="editSeguro">
                                    <option value="N√£o informado" ${(voo.seguro || 'N√£o informado') === 'N√£o informado' ? 'selected' : ''}>N√£o informado</option>
                                    <option value="Sim" ${voo.seguro === 'Sim' ? 'selected' : ''}>Sim</option>
                                    <option value="N√£o" ${voo.seguro === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                    <option value="Recusado" ${voo.seguro === 'Recusado' ? 'selected' : ''}>Recusado</option>
                                </select>
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label"><strong>Reserva</strong></label>
                                <input type="text" class="form-control" 
                                       value="${voo.reserva || ''}" 
                                       id="editReserva"
                                       placeholder="C√≥digo da reserva">
                            </div>
                            
                            <div class="col-md-3">
                                <label class="form-label"><strong>Cliente Ale</strong></label>
                                <select class="form-select" id="editClienteAle">
                                    <option value="N√£o" ${(voo.clienteAle || 'N√£o') === 'N√£o' ? 'selected' : ''}>N√£o</option>
                                    <option value="Sim" ${voo.clienteAle === 'Sim' ? 'selected' : ''}>Sim</option>
                                </select>
                            </div>
                            
                            <!-- Linha 5: Observa√ß√µes -->
                            <div class="col-12">
                                <label class="form-label"><strong>Observa√ß√µes do Check-in</strong></label>
                                <textarea class="form-control" rows="3" 
                                          id="editObservacoesCheckin"
                                          placeholder="Observa√ß√µes espec√≠ficas do check-in">${voo.observacoes || ''}</textarea>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            new bootstrap.Modal(document.getElementById('modalCheckin')).show();
        }
        
        // FUN√á√ÉO DO CHECK-IN COM FEEDBACK VISUAL
        async function confirmarCheckin() {
            const btnConfirmar = document.querySelector('button[onclick="confirmarCheckin()"]');
            const btnSalvar = document.querySelector('.modal#modalCheckin button[onclick="salvarEdicoes(\'checkin\')"]');
            const btnCancelar = document.querySelector('.modal#modalCheckin .btn-secondary[data-bs-dismiss="modal"]');
            
            try {
                // Desabilitar todos os bot√µes e mostrar loading
                btnConfirmar.disabled = true;
                if (btnSalvar) btnSalvar.disabled = true;
                if (btnCancelar) btnCancelar.disabled = true;
                
                const iconOriginal = btnConfirmar.innerHTML;
                btnConfirmar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
                btnConfirmar.classList.add('btn-loading');
                
                const voo = modalData.checkin;
                
                const dados = {
                    action: 'marcar_checkin',
                    cpf: voo.cpfCliente,
                    recibo: voo.recibo,
                    dataVoo: formatarDataAPI(voo.dataIda),
                    desfazer: false
                };
                
                const response = await enviarAcao(dados);
                
                if (response.success) {
                    // Mostrar sucesso visual
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Check-in OK!';
                    btnConfirmar.classList.remove('btn-loading');
                    btnConfirmar.classList.add('btn-success-feedback');
                    
                    mostrarAlerta('Check-in marcado com sucesso!', 'success');
                    
                    // Limpar dados do modal
                    modalData.checkin = null;
                    
                    // Aguardar um pouco antes de fechar
                    setTimeout(() => {
                        bootstrap.Modal.getInstance(document.getElementById('modalCheckin')).hide();
                    }, 1000);
                    
                    await carregarEmbarques();
                } else {
                    throw new Error(response.message);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao marcar check-in:', error);
                
                // Mostrar erro visual
                btnConfirmar.innerHTML = '<i class="fas fa-times"></i> Erro - Tente novamente';
                btnConfirmar.classList.remove('btn-loading');
                btnConfirmar.classList.add('btn-error-feedback');
                
                mostrarAlerta('Erro ao marcar check-in: ' + error.message, 'danger');
                
                // Reabilitar bot√µes ap√≥s erro
                setTimeout(() => {
                    btnConfirmar.disabled = false;
                    if (btnSalvar) btnSalvar.disabled = false;
                    if (btnCancelar) btnCancelar.disabled = false;
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Fazer Check-in';
                    btnConfirmar.classList.remove('btn-error-feedback', 'btn-success-feedback');
                }, 3000);
            }
        }
        
        function abrirModalPosVenda(numeroInforme) {
            const informe = dadosFiltrados.posVendas.find(i => i.numeroInforme === numeroInforme);
            if (!informe) return;
            
            modalData.posVenda = informe;
            
            // ‚úÖ RESETAR BOT√ïES DO MODAL (corrige bug de bot√µes desabilitados)
            setTimeout(() => {
                const btnConfirmar = document.querySelector('button[onclick="confirmarPosVenda()"]');
                const btnCancelar = document.querySelector('.modal#modalPosVenda .btn-secondary[data-bs-dismiss="modal"]');
                
                if (btnConfirmar) {
                    btnConfirmar.disabled = false;
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Confirmar P√≥s-venda';
                    btnConfirmar.classList.remove('btn-loading', 'btn-success-feedback', 'btn-error-feedback');
                }
                if (btnCancelar) {
                    btnCancelar.disabled = false;
                }
            }, 100);
            
            document.getElementById('pos-venda-info').innerHTML = `
                <div class="row">
                    <div class="col-md-6">
                        <p><strong>N√∫mero do Informe:</strong> ${informe.numeroInforme}</p>
                        <p><strong>Vendedor:</strong> ${informe.vendedor}</p>
                        <p><strong>Data de Retorno:</strong> ${formatarData(informe.ultimaData)}</p>
                    </div>
                    <div class="col-md-6">
                        <p><strong>Total de Voos:</strong> ${informe.totalVoos}</p>
                        <p><strong>Clientes:</strong> ${informe.clientes.join(', ')}</p>
                        <p><strong>Dias ap√≥s retorno:</strong> ${informe.diasAposRetorno}</p>
                    </div>
                </div>
            `;
            
            // Limpar formul√°rio
            document.getElementById('formPosVenda').reset();
            
            new bootstrap.Modal(document.getElementById('modalPosVenda')).show();
        }
        
        // FUN√á√ÉO DA P√ìS-VENDA COM FEEDBACK VISUAL
        async function confirmarPosVenda() {
            const btnConfirmar = document.querySelector('button[onclick="confirmarPosVenda()"]');
            const btnCancelar = document.querySelector('.modal#modalPosVenda .btn-secondary[data-bs-dismiss="modal"]');
            
            try {
                // Desabilitar bot√µes e mostrar loading
                btnConfirmar.disabled = true;
                if (btnCancelar) btnCancelar.disabled = true;
                
                const iconOriginal = btnConfirmar.innerHTML;
                btnConfirmar.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processando...';
                btnConfirmar.classList.add('btn-loading');
                
                const informe = modalData.posVenda;
                
                const dadosEditaveis = {
                    observacoes: document.getElementById('observacoes').value,
                    grupoOfertas: document.getElementById('grupoOfertas').value,
                    postouInsta: document.getElementById('postouInsta').value,
                    avaliacaoGoogle: document.getElementById('avaliacaoGoogle').value,
                    sac: document.getElementById('sac').value,
                    numeroSAC: document.getElementById('numeroSAC').value
                };
                
                const dados = {
                    action: 'marcar_pos_venda',
                    cpf: informe.cpfPrincipal,
                    numeroInforme: informe.numeroInforme,
                    dadosEditaveis: JSON.stringify(dadosEditaveis),
                    desfazer: false
                };
                
                const response = await enviarAcao(dados);
                
                if (response.success) {
                    // Mostrar sucesso visual
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> P√≥s-venda OK!';
                    btnConfirmar.classList.remove('btn-loading');
                    btnConfirmar.classList.add('btn-success-feedback');
                    
                    mostrarAlerta('P√≥s-venda marcada com sucesso!', 'success');
                    
                    // Limpar dados do modal
                    modalData.posVenda = null;
                    
                    // Aguardar um pouco antes de fechar
                    setTimeout(() => {
                        bootstrap.Modal.getInstance(document.getElementById('modalPosVenda')).hide();
                    }, 1000);
                    
                    await carregarEmbarques();
                } else {
                    throw new Error(response.message);
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao marcar p√≥s-venda:', error);
                
                // Mostrar erro visual
                btnConfirmar.innerHTML = '<i class="fas fa-times"></i> Erro - Tente novamente';
                btnConfirmar.classList.remove('btn-loading');
                btnConfirmar.classList.add('btn-error-feedback');
                
                mostrarAlerta('Erro ao marcar p√≥s-venda: ' + error.message, 'danger');
                
                // Reabilitar bot√µes ap√≥s erro
                setTimeout(() => {
                    btnConfirmar.disabled = false;
                    if (btnCancelar) btnCancelar.disabled = false;
                    btnConfirmar.innerHTML = '<i class="fas fa-check"></i> Confirmar P√≥s-venda';
                    btnConfirmar.classList.remove('btn-error-feedback', 'btn-success-feedback');
                }, 3000);
            }
        }
        
        // ================================================================================
        // UTILIT√ÅRIOS E API
        // ================================================================================
        
        async function enviarAcao(dados) {
            try {
                // Para a√ß√µes POST, usar formul√°rio oculto como o modelo antigo
                return await fazerRequisicaoPOST(CVC_CONFIG.API_URL, dados);
            } catch (error) {
                console.error('‚ùå Erro na a√ß√£o:', error);
                throw error;
            }
        }
        
        // Fun√ß√£o para enviar POST via formul√°rio (compat√≠vel com Google Apps Script)
        function fazerRequisicaoPOST(url, dados) {
            return new Promise((resolve, reject) => {
                const callbackName = 'jsonp_callback_post_' + Math.round(100000 * Math.random());
                
                // Criar fun√ß√£o callback global tempor√°ria
                window[callbackName] = function(data) {
                    delete window[callbackName];
                    resolve(data);
                };
                
                // Adicionar callback aos dados
                dados.callback = callbackName;
                
                // Usar JSONP para POST
                const script = document.createElement('script');
                const urlParams = new URLSearchParams();
                Object.keys(dados).forEach(key => {
                    urlParams.append(key, typeof dados[key] === 'object' ? JSON.stringify(dados[key]) : dados[key]);
                });
                script.src = url + '?' + urlParams.toString();
                
                script.onerror = () => {
                    delete window[callbackName];
                    document.body.removeChild(script);
                    reject(new Error('Falha na requisi√ß√£o POST'));
                };
                
                // Timeout
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script.parentNode) document.body.removeChild(script);
                        reject(new Error('Timeout na requisi√ß√£o POST'));
                    }
                }, 30000);
                
                document.body.appendChild(script);
            });
        }
        
        function atualizarContadores() {
            document.getElementById('contadorConferencias').textContent = 
                aplicarFiltrosLista(dadosFiltrados.conferencias).length;
            
            document.getElementById('contadorCheckins').textContent = 
                aplicarFiltrosLista(dadosFiltrados.checkins).length;
            
            document.getElementById('contadorPosVendas').textContent = 
                aplicarFiltrosLista(dadosFiltrados.posVendas).length;
        }
        
        function configurarAutoRefresh() {
            setInterval(async () => {
                try {
                    await carregarEmbarques();
                    debugLog('üîÑ Auto-refresh executado', 'info');
                } catch (error) {
                    console.error('‚ùå Erro no auto-refresh:', error);
                }
            }, 5 * 60 * 1000); // 5 minutos
        }
        
        // Fun√ß√µes de formata√ß√£o
        function formatarData(data) {
            if (!data) return 'N/A';
            return new Date(data).toLocaleDateString('pt-BR');
        }
        
        function formatarDataAPI(data) {
            if (!data) return '';
            return new Date(data).toISOString().split('T')[0];
        }
        
        function formatarDiasRestantes(dias) {
            if (dias < 0) {
                return `${Math.abs(dias)} dia(s) atr√°s`;
            } else if (dias === 0) {
                return 'Hoje';
            } else {
                return `${dias} dia(s)`;
            }
        }
        
        // Fun√ß√µes de interface
        function mostrarLoading(mostrar) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = mostrar ? 'flex' : 'none';
        }
        
        function mostrarAlerta(mensagem, tipo) {
            const container = document.getElementById('alertContainer');
            const alertClass = tipo === 'success' ? 'alert-success-custom' : 'alert-danger-custom';
            
            container.innerHTML = `
                <div class="alert alert-custom ${alertClass} alert-dismissible fade show" role="alert">
                    ${mensagem}
                    <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                </div>
            `;
            
            // Auto-remover ap√≥s 5 segundos
            setTimeout(() => {
                const alert = container.querySelector('.alert');
                if (alert) {
                    new bootstrap.Alert(alert).close();
                }
            }, 5000);
        }
        
        // Fun√ß√µes de navega√ß√£o e utilit√°rios
        async function recarregarEmbarques() {
            try {
                mostrarLoading(true);
                await carregarEmbarques();
                mostrarAlerta('Embarques atualizados com sucesso!', 'success');
            } catch (error) {
                mostrarAlerta('Erro ao atualizar embarques: ' + error.message, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }
        
        function exportarRelatorio() {
            // TODO: Implementar exporta√ß√£o para Excel/PDF
            mostrarAlerta('Funcionalidade de exporta√ß√£o em desenvolvimento', 'warning');
        }
        
        // Fun√ß√£o de teste de conectividade
        async function testarConectividade() {
            try {
                mostrarLoading(true);
                debugLog('üß™ Testando conectividade com a API...', 'info');
                
                let sucessoAlgumMetodo = false;
                const resultados = [];
                
                // Teste 1: JSONP
                try {
                    debugLog('üîó Testando JSONP...', 'info');
                    const dadosJSONP = await fazerRequisicaoJSONP(CVC_CONFIG.API_URL, {
                        action: 'ping',
                        teste: 'conectividade'
                    });
                    
                    if (dadosJSONP.success) {
                        resultados.push('‚úÖ JSONP: Funcionando');
                        sucessoAlgumMetodo = true;
                    } else {
                        resultados.push('‚ö†Ô∏è JSONP: Respondeu mas com erro');
                    }
                } catch (error) {
                    resultados.push('‚ùå JSONP: ' + error.message);
                }
                
                // Teste 2: Fetch CORS
                try {
                    debugLog('üîó Testando Fetch CORS...', 'info');
                    const response = await fetch(CVC_CONFIG.API_URL + '?action=ping&teste=conectividade&t=' + Date.now(), {
                        method: 'GET',
                        mode: 'cors',
                        credentials: 'omit'
                    });
                    
                    if (response.ok) {
                        const data = await response.json();
                        if (data.success) {
                            resultados.push('‚úÖ Fetch CORS: Funcionando');
                            sucessoAlgumMetodo = true;
                        } else {
                            resultados.push('‚ö†Ô∏è Fetch CORS: Respondeu mas com erro');
                        }
                    } else {
                        resultados.push(`‚ùå Fetch CORS: HTTP ${response.status}`);
                    }
                } catch (error) {
                    resultados.push('‚ùå Fetch CORS: ' + error.message);
                }
                
                // Teste 3: Verificar se est√° em modo an√¥nimo
                const isIncognito = await detectarModoAnonimo();
                if (isIncognito) {
                    resultados.push('üïµÔ∏è Modo an√¥nimo detectado');
                }
                
                // Mostrar resultados
                const mensagem = resultados.join('\n');
                
                if (sucessoAlgumMetodo) {
                    mostrarAlerta('üéâ Conectividade OK!\n\n' + mensagem, 'success');
                } else {
                    mostrarAlerta('‚ö†Ô∏è Problemas de conectividade:\n\n' + mensagem + '\n\nüí° Dicas:\n‚Ä¢ Fa√ßa login no Google\n‚Ä¢ Use navegador normal (n√£o an√¥nimo)\n‚Ä¢ Verifique sua conex√£o', 'warning');
                }
                
            } catch (error) {
                console.error('‚ùå Erro no teste de conectividade:', error);
                mostrarAlerta(`‚ùå Falha no teste: ${error.message}`, 'danger');
            } finally {
                mostrarLoading(false);
            }
        }
        
        // Detectar se est√° em modo an√¥nimo/privado
        async function detectarModoAnonimo() {
            try {
                // M√©todo 1: Tentar usar localStorage
                if (!window.localStorage) {
                    return true;
                }
                
                // M√©todo 2: Verificar se pode escrever no localStorage
                try {
                    // localStorage.setItem('test', 'test'); // Teste removido - usar ESTADO_CONFIG se necess√°rio
                    // localStorage.removeItem('test'); // Teste removido - usar ESTADO_CONFIG se necess√°rio
                } catch (e) {
                    return true;
                }
                
                // M√©todo 3: Verificar quotas de storage
                if ('storage' in navigator && 'estimate' in navigator.storage) {
                    const estimate = await navigator.storage.estimate();
                    return estimate.quota < 120000000; // Modo an√¥nimo tem quota menor
                }
                
                return false;
            } catch {
                return true; // Se der erro, provavelmente √© modo an√¥nimo
            }
        }
        
        // Fun√ß√£o para salvar edi√ß√µes dos modais
        async function salvarEdicoes(tipo) {
            try {
                if (tipo === 'conferencia') {
                    const informe = modalData.conferencia;
                    const edicoes = [];
                    
                    // Capturar edi√ß√µes de todos os voos do informe
                    informe.voos.forEach(voo => {
                        const cpfInput = document.querySelector(`[data-voo-id="${voo.id}"][data-campo="cpfCliente"]`);
                        const whatsappInput = document.querySelector(`[data-voo-id="${voo.id}"][data-campo="whatsappCliente"]`);
                        const obsInput = document.querySelector(`[data-voo-id="${voo.id}"][data-campo="observacoes"]`);
                        
                        if (cpfInput || whatsappInput || obsInput) {
                            edicoes.push({
                                id: voo.id,
                                cpfCliente: cpfInput ? cpfInput.value : voo.cpfCliente,
                                whatsappCliente: whatsappInput ? whatsappInput.value : voo.whatsappCliente,
                                observacoes: obsInput ? obsInput.value : voo.observacoes
                            });
                        }
                    });
                    
                    if (edicoes.length > 0) {
                        debugLog('üíæ Salvando edi√ß√µes da confer√™ncia: ' + edicoes, 'info');
                        // TODO: Implementar salvamento via API
                        mostrarAlerta('Edi√ß√µes salvas com sucesso! (Implementa√ß√£o pendente)', 'success');
                    }
                    
                } else if (tipo === 'checkin') {
                    const voo = modalData.checkin;
                    
                    const edicoes = {
                        id: voo.id,
                        locGds: document.getElementById('editLocGds').value,
                        locCia: document.getElementById('editLocCia').value,
                        temBagagem: document.getElementById('editTemBagagem').value,
                        temAssento: document.getElementById('editTemAssento').value,
                        observacoes: document.getElementById('editObservacoesCheckin').value
                    };
                    
                    debugLog('üíæ Salvando edi√ß√µes do check-in: ' + edicoes, 'info');
                    // TODO: Implementar salvamento via API
                    mostrarAlerta('Edi√ß√µes salvas com sucesso! (Implementa√ß√£o pendente)', 'success');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao salvar edi√ß√µes:', error);
                mostrarAlerta('Erro ao salvar edi√ß√µes: ' + error.message, 'danger');
            }
        }
        
        // Fun√ß√£o para copiar texto para √°rea de transfer√™ncia
        async function copiarTexto(texto, tipo) {
            try {
                if (!texto || texto.trim() === '') {
                    mostrarAlerta(`Nenhum ${tipo} para copiar`, 'warning');
                    return;
                }
                
                await navigator.clipboard.writeText(texto);
                mostrarAlerta(`${tipo} copiado: ${texto}`, 'success');
                
            } catch (error) {
                console.error('‚ùå Erro ao copiar:', error);
                
                // Fallback para navegadores mais antigos
                try {
                    const textArea = document.createElement('textarea');
                    textArea.value = texto;
                    document.body.appendChild(textArea);
                    textArea.select();
                    document.execCommand('copy');
                    document.body.removeChild(textArea);
                    mostrarAlerta(`${tipo} copiado: ${texto}`, 'success');
                } catch (fallbackError) {
                    mostrarAlerta('Erro ao copiar texto', 'danger');
                }
            }
        }
        
        // Fun√ß√£o para buscar orbiuns
        async function buscarOrbiuns(whatsapp) {
            try {
                if (!whatsapp || whatsapp.trim() === '') {
                    mostrarAlerta('WhatsApp n√£o informado para buscar orbiuns', 'warning');
                    return;
                }
                
                debugLog('üîç Buscando orbiuns para WhatsApp: ' + whatsapp, 'info');
                
                // Chamar API para buscar orbiuns
                const dados = await fazerRequisicaoJSONP(CVC_CONFIG.API_URL, {
                    action: 'buscarOrbiuns',
                    whatsapp: whatsapp,
                    t: Date.now()
                });
                
                if (dados.success && dados.data && dados.data.orbiuns) {
                    const orbiuns = dados.data.orbiuns;
                    
                    if (orbiuns.length > 0) {
                        mostrarModalOrbiuns(orbiuns, whatsapp);
                    } else {
                        mostrarAlerta(`Nenhum orbiun encontrado para ${whatsapp}`, 'info');
                    }
                } else {
                    mostrarAlerta('Erro ao buscar orbiuns: ' + (dados.message || 'Resposta inv√°lida'), 'danger');
                }
                
            } catch (error) {
                console.error('‚ùå Erro ao buscar orbiuns:', error);
                mostrarAlerta('‚ùå Erro ao buscar orbiuns: ' + error.message, 'danger');
            }
        }
        
        // Fun√ß√£o para mostrar modal com orbiuns encontrados
        function mostrarModalOrbiuns(orbiuns, whatsapp, simulado = false) {
            const modalHtml = `
                <div class="modal fade" id="modalOrbiuns" tabindex="-1">
                    <div class="modal-dialog modal-xl" style="max-width: 90vw;">
                        <div class="modal-content">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title">
                                    <i class="fas fa-search"></i> Orbiuns Encontrados
                                </h5>
                                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body" style="max-height: 70vh; overflow-y: auto;">
                                <div class="alert alert-info">
                                    <strong>WhatsApp pesquisado:</strong> ${whatsapp}
                                    ${simulado ? '<br><small class="text-muted">Dados simulados - conecte com a API real</small>' : ''}
                                </div>
                                
                                <div class="row">
                                    ${orbiuns.map(orbiun => `
                                        <div class="col-md-6 mb-3">
                                            <div class="card">
                                                <div class="card-header">
                                                    <h6 class="mb-0">${orbiun.titulo}</h6>
                                                </div>
                                                <div class="card-body">
                                                    <p class="mb-1"><strong>Departamento:</strong> ${orbiun.departamento}</p>
                                                    <p class="mb-1"><strong>Respons√°vel:</strong> ${orbiun.responsavel}</p>
                                                    <p class="mb-1"><strong>Status:</strong> 
                                                        <span class="badge ${orbiun.status === 'Em Andamento' ? 'bg-warning' : 'bg-secondary'}">${orbiun.status}</span>
                                                    </p>
                                                    <p class="mb-1"><strong>Data:</strong> ${formatarData(orbiun.dataAbertura)}</p>
                                                    <p class="mb-1"><strong>Prioridade:</strong> ${orbiun.prioridade}</p>
                                                    ${orbiun.observacoes ? `<p class="mb-0"><small class="text-muted">${orbiun.observacoes}</small></p>` : ''}
                                                </div>
                                            </div>
                                        </div>
                                    `).join('')}
                                </div>
                                
                                ${orbiuns.length === 0 ? `
                                    <div class="text-center py-4">
                                        <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
                                        <p class="text-muted">Nenhum orbiun encontrado para este WhatsApp</p>
                                    </div>
                                ` : ''}
                            </div>
                            <div class="modal-footer">
                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
                                <button type="button" class="btn btn-primary" onclick="abrirOrbiuns()">
                                    <i class="fas fa-external-link-alt"></i> Abrir Orbiuns
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Remover modal anterior se existir
            const modalExistente = document.getElementById('modalOrbiuns');
            if (modalExistente) {
                modalExistente.remove();
            }
            
            // Adicionar novo modal
            document.body.insertAdjacentHTML('beforeend', modalHtml);
            
            // Mostrar modal
            new bootstrap.Modal(document.getElementById('modalOrbiuns')).show();
        }
        
        // Fun√ß√£o para abrir p√°gina de orbiuns
        function abrirOrbiuns() {
            window.open('orbiuns.html', '_blank');
        }
    </script>

        // ================================================================================
        // üë§ CARREGAR INFORMA√á√ïES DO USU√ÅRIO
        // ================================================================================
        
        function loadUserInfo() {
            try {
                let savedUser;
                if (typeof ESTADO_CONFIG !== 'undefined' && ESTADO_CONFIG.carregar) {
                    savedUser = ESTADO_CONFIG.carregar('systelos_user');
                } else {
                    savedUser = localStorage.getItem('systelos_user');
                }
                
                if (savedUser) {
                    const userData = JSON.parse(savedUser);
                    
                    // Calcular iniciais
                    const initials = userData.nome
                        .split(' ')
                        .map(n => n[0])
                        .slice(0, 2)
                        .join('')
                        .toUpperCase();
                    
                    // Atualizar elementos do header
                    document.getElementById('userInitials').textContent = initials;
                    document.getElementById('userName').textContent = userData.nome;
                    document.getElementById('userEmail').textContent = userData.email;
                    
                    // Mostrar badge de gestor se for admin
                    if (userData.isAdmin) {
                        document.getElementById('adminBadgeHeader').style.display = 'flex';
                    }
                    
                    // Mostrar informa√ß√µes do usu√°rio
                    document.getElementById('userInfoHeader').style.display = 'flex';
                }
            } catch (error) {
                console.error('‚ùå Erro ao carregar informa√ß√µes do usu√°rio:', error);
            }
        }

        // ================================================================================
        // üö™ LOGOUT
        // ================================================================================
        
        function logout() {
            if (confirm('Deseja realmente sair do sistema?')) {
                if (typeof ESTADO_CONFIG !== 'undefined' && ESTADO_CONFIG.remover) {
                    ESTADO_CONFIG.remover('systelos_user');
                } else {
                    localStorage.removeItem('systelos_user');
                }
                window.location.href = 'index.html';
            }
        }

        // ================================================================================
        // üçî TOGGLE SIDEBAR
        // ================================================================================
        
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebarMenu');
            const overlay = document.getElementById('sidebarOverlay');
            
            if (sidebar) {
                sidebar.classList.toggle('show');
                
                // Criar overlay se n√£o existir
                if (!overlay) {
                    const newOverlay = document.createElement('div');
                    newOverlay.id = 'sidebarOverlay';
                    newOverlay.style.cssText = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0,0,0,0.7);
                        z-index: 9998;
                        opacity: 0;
                        transition: opacity 0.3s;
                    `;
                    document.body.appendChild(newOverlay);
                    
                    // Fechar ao clicar no overlay
                    newOverlay.addEventListener('click', function() {
                        sidebar.classList.remove('show');
                        newOverlay.style.opacity = '0';
                        setTimeout(() => newOverlay.remove(), 300);
                    });
                    
                    setTimeout(() => { newOverlay.style.opacity = '1'; }, 10);
                } else {
                    if (sidebar.classList.contains('show')) {
                        overlay.style.display = 'block';
                        setTimeout(() => { overlay.style.opacity = '1'; }, 10);
                    } else {
                        overlay.style.opacity = '0';
                        setTimeout(() => { overlay.style.display = 'none'; }, 300);
                    }
                }
            }
        }

        // Fechar sidebar com ESC
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const sidebar = document.getElementById('sidebarMenu');
                if (sidebar && sidebar.classList.contains('show')) {
                    sidebar.classList.remove('show');
                    const overlay = document.getElementById('sidebarOverlay');
                    if (overlay) {
                        overlay.style.opacity = '0';
                        setTimeout(() => { overlay.style.display = 'none'; }, 300);
                    }
                }
            }
        });

        // Carregar informa√ß√µes ao inicializar
        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
        });
        
    </script>
</body>
</html>