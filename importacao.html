<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC Portal Itaquá - Informe Automatizado de Vendas v10.0</title>
    
    <!-- Meta Tags CVC Padrão -->
    <meta name="description" content="CVC Portal Itaquá - Sistema Automatizado de Vendas com IA integrada">
    <meta name="keywords" content="CVC, Itaquaquecetuba, vendas, automatizado, embarques, recibos, IA">
    <meta name="author" content="CVC Itaquaquecetuba">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- Open Graph -->
    <meta property="og:title" content="CVC Portal Itaquá - Informe Automatizado">
    <meta property="og:description" content="Sistema automatizado de vendas com dados em tempo real">
    <meta property="og:type" content="website">
    
    <!-- CSS Dependencies -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/cvc-styles.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/cvc-favicon.ico">
    
    <style>
        /* ===== MELHORIAS v10.0 - VENDAS AUTOMATIZADO ===== */
        
        .vendas-auto-container {
            max-width: 1600px; /* MELHORIA: Container mais amplo */
            margin: 0 auto;
            padding: 20px;
            animation: fadeInContainer 0.8s ease-out;
        }

        @keyframes fadeInContainer {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* MELHORIA: Dashboard Status com gradiente modernizado */
        .status-dashboard {
            background: linear-gradient(135deg, var(--cvc-azul) 0%, var(--cvc-azul-escuro) 50%, var(--cvc-verde) 100%);
            border-radius: 25px;
            padding: 35px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
            box-shadow: var(--cvc-sombra-forte);
        }

        .status-dashboard::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -20%;
            width: 200px;
            height: 200px;
            background: radial-gradient(circle, rgba(255,230,0,0.15) 0%, transparent 70%);
            animation: float 6s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        /* MELHORIA: Stats Grid responsivo aprimorado */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.18);
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            backdrop-filter: blur(15px);
            border: 2px solid rgba(255, 255, 255, 0.25);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }

        .stat-number {
            font-size: 3rem;
            font-weight: 900;
            color: var(--cvc-amarelo);
            line-height: 1;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            animation: countUp 1.5s ease-out;
        }

        @keyframes countUp {
            from { transform: scale(0.5); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .stat-label {
            font-size: 1.1rem;
            font-weight: 600;
            opacity: 0.95;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* MELHORIA: Loading modernizado */
        .loading-container {
            background: linear-gradient(145deg, #f8f9fa, #e9ecef);
            border-radius: 20px;
            padding: 60px 40px;
            text-align: center;
            margin: 40px 0;
            box-shadow: var(--cvc-sombra-media);
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 6px solid var(--cvc-cinza-claro);
            border-top: 6px solid var(--cvc-azul);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 25px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* MELHORIA: Cards de vendedores aprimorados */
        .vendedor-card {
            background: var(--cvc-fundo-card);
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 5px solid var(--cvc-amarelo);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .vendedor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,230,0,0.1), transparent);
            transition: left 0.5s ease;
        }

        .vendedor-card:hover::before {
            left: 100%;
        }

        .vendedor-card:hover {
            transform: translateX(5px);
            box-shadow: var(--cvc-sombra-media);
            border-left-color: var(--cvc-azul);
        }

        .vendedor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .vendedor-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--cvc-azul);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .vendedor-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
        }

        .vendedor-stat {
            text-align: center;
            flex: 1;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--cvc-azul);
        }

        .stat-label-small {
            font-size: 0.9rem;
            color: var(--cvc-cinza);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* MELHORIA: Filtros e busca modernizados */
        .filters-section {
            background: var(--cvc-fundo-card);
            border-radius: 15px;
            padding: 25px;
            margin: 20px 0;
            box-shadow: var(--cvc-sombra-suave);
        }

        .search-input {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid var(--cvc-cinza-claro);
            border-radius: 10px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--cvc-azul);
            box-shadow: 0 0 0 3px rgba(10, 0, 180, 0.1);
        }

        .filter-tabs {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .filter-tab {
            padding: 12px 24px;
            border: 2px solid var(--cvc-cinza-claro);
            border-radius: 25px;
            background: white;
            color: var(--cvc-azul);
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .filter-tab:hover {
            border-color: var(--cvc-azul);
            background: var(--cvc-azul-claro);
        }

        .filter-tab.active {
            background: var(--cvc-gradiente-principal);
            border-color: var(--cvc-amarelo);
            color: var(--cvc-azul);
            transform: scale(1.05);
        }

        /* MELHORIA: Recibos grid modernizado */
        .recibos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
            margin-top: 30px;
        }

        .recibo-card {
            background: var(--cvc-fundo-card);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--cvc-sombra-suave);
            transition: all 0.3s ease;
            border: 1px solid var(--cvc-cinza-claro);
            position: relative;
            overflow: hidden;
        }

        .recibo-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--cvc-sombra-media);
        }

        .recibo-urgente {
            border-left: 5px solid #ff4757;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { border-left-color: #ff4757; }
            50% { border-left-color: #ff3742; }
        }

        .recibo-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .recibo-numero {
            font-size: 1.4rem;
            font-weight: 800;
            color: var(--cvc-azul);
        }

        .recibo-status {
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-pendente {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-urgente {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-completo {
            background: #d1f2eb;
            color: #0c5460;
            border: 1px solid #b7e4c7;
        }

        /* MELHORIA: Debug section aprimorada */
        .debug-section {
            background: #1e1e1e;
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: var(--cvc-sombra-media);
            font-family: 'Fira Code', 'Monaco', 'Consolas', monospace;
        }

        .debug-header {
            color: #61dafb;
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .debug-content {
            max-height: 400px;
            overflow-y: auto;
            background: #000;
            border-radius: 8px;
            padding: 15px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .debug-content::-webkit-scrollbar {
            width: 8px;
        }

        .debug-content::-webkit-scrollbar-track {
            background: #333;
            border-radius: 4px;
        }

        .debug-content::-webkit-scrollbar-thumb {
            background: var(--cvc-azul);
            border-radius: 4px;
        }

        .debug-content .info {
            color: #8be9fd;
        }

        .debug-content .success {
            color: #50fa7b;
        }

        .debug-content .warning {
            color: #f1fa8c;
        }

        .debug-content .error {
            color: #ff5555;
        }

        /* MELHORIA: Actions section */
        .actions-section {
            background: var(--cvc-fundo-card);
            border-radius: 15px;
            padding: 25px;
            margin: 30px 0;
            box-shadow: var(--cvc-sombra-suave);
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .action-btn {
            background: var(--cvc-gradiente-principal);
            border: none;
            border-radius: 12px;
            padding: 20px;
            color: var(--cvc-azul);
            font-weight: 700;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            text-decoration: none;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .action-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(10, 0, 180, 0.2);
            color: var(--cvc-azul);
        }

        .action-btn i {
            font-size: 1.3rem;
        }

        /* MELHORIA: Responsividade aprimorada */
        @media (max-width: 768px) {
            .vendas-auto-container {
                padding: 15px;
            }

            .status-dashboard {
                padding: 25px;
            }

            .stats-grid {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
                gap: 15px;
            }

            .stat-number {
                font-size: 2.2rem;
            }

            .recibos-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .actions-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            .filter-tabs {
                justify-content: center;
            }

            .vendedor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .vendedor-stats {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* MELHORIA: Animações de carregamento */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .fade-in-up {
            animation: fadeInUp 0.6s ease-out;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* MELHORIA: Toast notifications */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 9999;
        }

        .toast-notification {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 10px;
            box-shadow: var(--cvc-sombra-forte);
            border-left: 5px solid var(--cvc-amarelo);
            min-width: 300px;
            animation: slideInRight 0.4s ease-out;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast-success {
            border-left-color: #50fa7b;
        }

        .toast-error {
            border-left-color: #ff5555;
        }

        .toast-warning {
            border-left-color: #f1fa8c;
        }
    </style>
</head>

<body>
    <!-- HEADER CVC PADRÃO -->
    <header class="cvc-header">
        <div class="container-fluid">
            <div class="cvc-logo">
                <div class="cvc-logo-symbol">CVC</div>
                <div>
                    <div class="cvc-logo-text">Portal Itaquá</div>
                    <div class="cvc-subtitle">Informe Automatizado v10.0</div>
                </div>
            </div>
        </div>
    </header>

    <!-- NAVEGAÇÃO -->
    <nav class="cvc-nav">
        <div class="container-fluid">
            <ul class="nav justify-content-center">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas.html">
                        <i class="fas fa-chart-line"></i> Informe Manual
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="vendas-automatizado.html">
                        <i class="fas fa-robot"></i> Informe Automatizado
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="embarques.html">
                        <i class="fas fa-plane-departure"></i> Embarques
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="importacao.html">
                        <i class="fas fa-cloud-upload-alt"></i> Importação
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- ÁREA DE CONTEÚDO -->
    <div class="content-area">
        <div class="vendas-auto-container">
            
            <!-- STATUS DASHBOARD -->
            <section class="status-dashboard fade-in-up">
                <h1><i class="fas fa-robot"></i> Sistema Automatizado de Vendas</h1>
                <p class="mb-0 opacity-90">Análise inteligente em tempo real com dados da planilha de embarques</p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalRecibos">0</div>
                        <div class="stat-label">Recibos Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalVendedores">0</div>
                        <div class="stat-label">Vendedores Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="urgentesCount">0</div>
                        <div class="stat-label">Casos Urgentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="percentualCompleto">0%</div>
                        <div class="stat-label">Dados Completos</div>
                    </div>
                </div>
            </section>

            <!-- LOADING -->
            <div id="loadingContainer" class="loading-container">
                <div class="loading-spinner"></div>
                <h3>🔄 Carregando dados da planilha...</h3>
                <p class="text-muted">Conectando com Google Apps Script via JSONP v10.0</p>
                <div class="mt-3">
                    <small class="text-info">
                        <i class="fas fa-info-circle"></i>
                        Sistema otimizado para bypass total de CORS
                    </small>
                </div>
            </div>

            <!-- ERROR CONTAINER -->
            <div id="errorContainer" class="alert alert-danger" style="display:none;">
                <h4><i class="fas fa-exclamation-triangle"></i> Erro no Sistema</h4>
                <p id="errorMessage"></p>
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="atualizarDados()">
                        <i class="fas fa-sync-alt"></i> Tentar Novamente
                    </button>
                    <button class="btn btn-secondary" onclick="mostrarDebugSection()">
                        <i class="fas fa-bug"></i> Ver Debug
                    </button>
                </div>
            </div>

            <!-- FILTROS E BUSCA -->
            <section class="filters-section" id="filtersSection" style="display:none;">
                <h2><i class="fas fa-search"></i> Filtros e Busca</h2>
                <div class="row">
                    <div class="col-md-8">
                        <input type="text" class="search-input" id="searchInput" 
                               placeholder="🔍 Buscar por recibo, cliente, vendedor...">
                    </div>
                    <div class="col-md-4">
                        <div class="filter-tabs">
                            <div class="filter-tab active" data-filter="todos">Todos</div>
                            <div class="filter-tab" data-filter="urgentes">Urgentes</div>
                            <div class="filter-tab" data-filter="pendentes">Pendentes</div>
                            <div class="filter-tab" data-filter="completos">Completos</div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- RESUMO POR VENDEDORES -->
            <section id="vendedoresSection" style="display:none;">
                <h2><i class="fas fa-users"></i> Resumo por Vendedores</h2>
                <p class="text-muted">Clique em um vendedor para visualizar seus recibos pendentes</p>
                <div id="vendedoresList">
                    <!-- Vendedores serão inseridos dinamicamente -->
                </div>
            </section>

            <!-- GRID DE RECIBOS -->
            <section id="recibosSection" style="display:none;">
                <h2><i class="fas fa-receipt"></i> Recibos Pendentes</h2>
                <div id="recibosGrid" class="recibos-grid">
                    <!-- Recibos serão inseridos dinamicamente -->
                </div>
            </section>

            <!-- AÇÕES RÁPIDAS -->
            <section class="actions-section" id="actionsSection" style="display:none;">
                <h2><i class="fas fa-bolt"></i> Ações Rápidas</h2>
                <div class="actions-grid">
                    <a href="vendas.html" class="action-btn" target="_blank">
                        <i class="fas fa-plus-circle"></i>
                        Nova Venda
                    </a>
                    <a href="embarques.html" class="action-btn" target="_blank">
                        <i class="fas fa-edit"></i>
                        Editar Embarques
                    </a>
                    <button class="action-btn" onclick="exportarDados()">
                        <i class="fas fa-download"></i>
                        Exportar Dados
                    </button>
                    <button class="action-btn" onclick="atualizarDados()">
                        <i class="fas fa-sync-alt"></i>
                        Atualizar
                    </button>
                </div>
            </section>

            <!-- DEBUG SECTION -->
            <section class="debug-section" id="debugSection" style="display:none;">
                <div class="debug-header">
                    <i class="fas fa-terminal"></i>
                    Console de Debug v10.0
                </div>
                <div class="debug-content" id="debugContent">
                    <!-- Debug logs aparecerão aqui -->
                </div>
            </section>

        </div>
    </div>

    <!-- TOAST NOTIFICATIONS -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- JAVASCRIPT INCORPORADO v10.0 -->
    <script>
        // ================================================================================
        // 🚀 CVC PORTAL ITAQUÁ - VENDAS AUTOMATIZADO v10.0
        // Melhorias: UX/UI aprimorada, performance otimizada, debug avançado
        // ================================================================================
        
        let recibosDataOriginal = [];
        let recibosDataFiltrada = [];
        let vendedoresData = {};
        let debugLogs = [];
        let API_URL = null;
        let filtroAtivo = 'todos';
        let termoBusca = '';
        let isLoading = false;

        // ================================================================================
        // 🎨 SISTEMA DE TOAST NOTIFICATIONS (NOVO v10.0)
        // ================================================================================
        
        function showToast(message, type = 'info', duration = 4000) {
            const toastContainer = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${type}`;
            
            const icon = {
                success: 'fas fa-check-circle',
                error: 'fas fa-exclamation-circle',
                warning: 'fas fa-exclamation-triangle',
                info: 'fas fa-info-circle'
            }[type] || 'fas fa-info-circle';
            
            toast.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="${icon}" style="font-size: 1.2rem; color: var(--cvc-azul);"></i>
                    <span style="flex: 1; font-weight: 600;">${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" 
                            style="background: none; border: none; color: var(--cvc-cinza); cursor: pointer;">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            toastContainer.appendChild(toast);
            
            setTimeout(() => {
                if (toast.parentElement) {
                    toast.style.animation = 'slideOutRight 0.4s ease-out';
                    setTimeout(() => toast.remove(), 400);
                }
            }, duration);
        }

        // ================================================================================
        // 🐛 SISTEMA DE DEBUG AVANÇADO v10.0
        // ================================================================================
        
        function addDebugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const logEntry = { timestamp, message, type };
            debugLogs.push(logEntry);
            
            // Limitar logs (performance)
            if (debugLogs.length > 200) {
                debugLogs = debugLogs.slice(-150);
            }
            
            // Console log com cores
            const colors = {
                error: 'color: #ff5555; font-weight: bold;',
                success: 'color: #50fa7b; font-weight: bold;',
                warning: 'color: #f1fa8c; font-weight: bold;',
                info: 'color: #8be9fd;'
            };
            
            console.log(`%c[${type.toUpperCase()}] ${message}`, colors[type] || colors.info);
            updateDebugDisplay();
        }
        
        function updateDebugDisplay() {
            const debugContent = document.getElementById('debugContent');
            if (!debugContent) return;
            
            const html = debugLogs.slice(-50).map(log => {
                return `<div class="${log.type}">
                    [${log.timestamp}] ${log.message}
                </div>`;
            }).join('');
            
            debugContent.innerHTML = html;
            debugContent.scrollTop = debugContent.scrollHeight;
        }
        
        function mostrarDebugSection() {
            const debugSection = document.getElementById('debugSection');
            debugSection.style.display = 'block';
            debugSection.scrollIntoView({ behavior: 'smooth' });
        }

        // ================================================================================
        // ⚙️ INICIALIZAÇÃO SEGURA DO SISTEMA v10.0
        // ================================================================================
        
        function inicializarSistema() {
            addDebugLog('🚀 Iniciando CVC Portal Itaquá - Vendas Automatizado v10.0...', 'info');
            
            // Verificar configurações
            if (typeof getApiUrl === 'function') {
                API_URL = getApiUrl();
                addDebugLog(`🌐 API URL configurada via função: ${API_URL}`, 'success');
            } else if (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.API_URL) {
                API_URL = CVC_CONFIG.API_URL;
                addDebugLog(`🌐 API URL via config: ${API_URL}`, 'success');
            } else {
                addDebugLog('❌ ERRO: API URL não configurada!', 'error');
                mostrarErro('Configuração inválida. Verifique o arquivo config.js');
                showToast('Erro de configuração detectado', 'error');
                return;
            }
            
            addDebugLog('✅ Sistema inicializado com sucesso!', 'success');
            addDebugLog('🔧 Melhorias v10.0: UX aprimorada, toast notifications, performance otimizada', 'info');
            
            // Configurar eventos
            configurarEventos();
            
            // Carregar dados iniciais
            carregarDadosInicial();
        }

        // ================================================================================
        // 🎮 CONFIGURAÇÃO DE EVENTOS v10.0
        // ================================================================================
        
        function configurarEventos() {
            addDebugLog('🎮 Configurando eventos da interface...', 'info');
            
            // Search input com debounce
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                let debounceTimer;
                searchInput.addEventListener('input', (e) => {
                    clearTimeout(debounceTimer);
                    debounceTimer = setTimeout(() => {
                        termoBusca = e.target.value.toLowerCase();
                        filtrarEExibirRecibos();
                        addDebugLog(`🔍 Busca aplicada: "${termoBusca}"`, 'info');
                    }, 300);
                });
            }

            // Filter tabs
            document.querySelectorAll('.filter-tab').forEach(tab => {
                tab.addEventListener('click', () => {
                    document.querySelectorAll('.filter-tab').forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');
                    filtroAtivo = tab.dataset.filter;
                    filtrarEExibirRecibos();
                    addDebugLog(`🏷️ Filtro aplicado: ${filtroAtivo}`, 'info');
                });
            });

            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.ctrlKey && e.key === 'r') {
                    e.preventDefault();
                    atualizarDados();
                } else if (e.key === 'F5') {
                    e.preventDefault();
                    atualizarDados();
                }
            });

            addDebugLog('✅ Eventos configurados com sucesso', 'success');
        }

        // ================================================================================
        // 📊 CARREGAMENTO DE DADOS VIA JSONP v10.0
        // ================================================================================
        
        function carregarDadosInicial() {
            if (isLoading) {
                addDebugLog('⚠️ Carregamento já em andamento, ignorando...', 'warning');
                return;
            }
            
            isLoading = true;
            addDebugLog('📊 Iniciando carregamento de dados via JSONP v10.0...', 'info');
            
            // UI Feedback
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('errorContainer').style.display = 'none';
            ocultarTodasSecoes();
            
            if (!API_URL) {
                addDebugLog('❌ ERRO: API URL não configurada!', 'error');
                mostrarErro('Configuração inválida. Verifique config.js');
                isLoading = false;
                return;
            }
            
            // Fazer requisição JSONP
            fazerRequisicaoJSONP('listar_vendas_pendentes', {})
                .then(response => {
                    addDebugLog('✅ Dados recebidos via JSONP', 'success');
                    processarDadosRecebidos(response);
                    showToast('Dados atualizados com sucesso!', 'success');
                })
                .catch(error => {
                    addDebugLog(`❌ Erro no carregamento: ${error.message}`, 'error');
                    mostrarErro(error.message);
                    showToast('Erro ao carregar dados', 'error');
                })
                .finally(() => {
                    isLoading = false;
                    document.getElementById('loadingContainer').style.display = 'none';
                });
        }

        // ================================================================================
        // 🌐 SISTEMA JSONP OTIMIZADO v10.0
        // ================================================================================
        
        function fazerRequisicaoJSONP(action, parametros = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = `jsonp_callback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                const timeoutId = setTimeout(() => {
                    cleanup();
                    reject(new Error('Timeout da requisição JSONP (30s)'));
                }, 30000);
                
                function cleanup() {
                    clearTimeout(timeoutId);
                    delete window[callbackName];
                    if (script && script.parentNode) {
                        script.remove();
                    }
                }
                
                window[callbackName] = function(response) {
                    cleanup();
                    
                    if (response && response.success) {
                        addDebugLog(`✅ JSONP callback executado: ${response.success ? 'sucesso' : 'erro'}`, 'success');
                        resolve(response);
                    } else {
                        const errorMsg = response?.error || 'Resposta inválida do servidor';
                        addDebugLog(`❌ Erro na resposta: ${errorMsg}`, 'error');
                        reject(new Error(errorMsg));
                    }
                };
                
                const script = document.createElement('script');
                const params = new URLSearchParams({
                    callback: callbackName,
                    action: action,
                    ...parametros
                });
                
                const urlCompleta = `${API_URL}?${params.toString()}`;
                script.src = urlCompleta;
                
                addDebugLog(`📡 JSONP URL: ${urlCompleta.substring(0, 100)}...`, 'info');
                
                script.onerror = function() {
                    cleanup();
                    reject(new Error('Erro ao carregar script JSONP. Verifique a configuração.'));
                };
                
                document.head.appendChild(script);
            });
        }

        // ================================================================================
        // 📈 PROCESSAMENTO DE DADOS v10.0
        // ================================================================================
        
        function processarDadosRecebidos(response) {
            addDebugLog('📈 Processando dados recebidos...', 'info');
            
            if (!response.data || !Array.isArray(response.data)) {
                throw new Error('Dados inválidos recebidos do servidor');
            }
            
            recibosDataOriginal = response.data;
            
            // Processar estatísticas
            const stats = calcularEstatisticas(recibosDataOriginal);
            atualizarEstatisticas(stats);
            
            // Processar vendedores
            vendedoresData = processarVendedores(recibosDataOriginal);
            
            // Aplicar filtros iniciais
            filtrarEExibirRecibos();
            
            // Exibir seções
            exibirSecoes();
            
            addDebugLog(`✅ Processamento concluído: ${recibosDataOriginal.length} recibos`, 'success');
        }
        
        function calcularEstatisticas(dados) {
            const stats = {
                totalRecibos: dados.length,
                totalVendedores: new Set(dados.map(r => r.vendedor)).size,
                urgentesCount: dados.filter(r => r.urgencia === 'Urgente').length,
                percentualCompleto: 0
            };
            
            const completos = dados.filter(r => 
                r.cpfCliente && r.whatsappCliente && r.dataIda
            ).length;
            
            stats.percentualCompleto = dados.length > 0 
                ? Math.round((completos / dados.length) * 100) 
                : 0;
            
            return stats;
        }
        
        function atualizarEstatisticas(stats) {
            const elements = {
                'totalRecibos': stats.totalRecibos,
                'totalVendedores': stats.totalVendedores,
                'urgentesCount': stats.urgentesCount,
                'percentualCompleto': `${stats.percentualCompleto}%`
            };
            
            Object.entries(elements).forEach(([id, value]) => {
                const element = document.getElementById(id);
                if (element) {
                    // Animação de contagem
                    animateNumber(element, value);
                }
            });
        }
        
        function animateNumber(element, finalValue) {
            const isPercentage = typeof finalValue === 'string' && finalValue.includes('%');
            const numericValue = parseInt(finalValue);
            const start = parseInt(element.textContent) || 0;
            const duration = 1000;
            const stepTime = 16;
            const steps = duration / stepTime;
            const increment = (numericValue - start) / steps;
            
            let current = start;
            const timer = setInterval(() => {
                current += increment;
                const displayValue = Math.round(current);
                element.textContent = isPercentage ? `${displayValue}%` : displayValue;
                
                if ((increment > 0 && current >= numericValue) || 
                    (increment < 0 && current <= numericValue)) {
                    element.textContent = finalValue;
                    clearInterval(timer);
                }
            }, stepTime);
        }

        // ================================================================================
        // 🏷️ SISTEMA DE FILTROS v10.0
        // ================================================================================
        
        function filtrarEExibirRecibos() {
            addDebugLog(`🏷️ Aplicando filtros: ${filtroAtivo}, busca: "${termoBusca}"`, 'info');
            
            let dadosFiltrados = [...recibosDataOriginal];
            
            // Filtro por categoria
            switch (filtroAtivo) {
                case 'urgentes':
                    dadosFiltrados = dadosFiltrados.filter(r => r.urgencia === 'Urgente');
                    break;
                case 'pendentes':
                    dadosFiltrados = dadosFiltrados.filter(r => 
                        !r.cpfCliente || !r.whatsappCliente || !r.dataIda
                    );
                    break;
                case 'completos':
                    dadosFiltrados = dadosFiltrados.filter(r => 
                        r.cpfCliente && r.whatsappCliente && r.dataIda
                    );
                    break;
            }
            
            // Filtro por busca
            if (termoBusca) {
                dadosFiltrados = dadosFiltrados.filter(recibo => {
                    const searchFields = [
                        recibo.recibo,
                        recibo.nomeCliente,
                        recibo.vendedor,
                        recibo.cpfCliente,
                        recibo.whatsappCliente
                    ].map(field => (field || '').toLowerCase());
                    
                    return searchFields.some(field => field.includes(termoBusca));
                });
            }
            
            recibosDataFiltrada = dadosFiltrados;
            
            // Atualizar displays
            exibirVendedores(dadosFiltrados);
            exibirRecibos(dadosFiltrados);
            
            addDebugLog(`✅ Filtros aplicados: ${dadosFiltrados.length} recibos exibidos`, 'success');
        }

        // ================================================================================
        // 👥 EXIBIÇÃO DE VENDEDORES v10.0
        // ================================================================================
        
        function processarVendedores(dados) {
            const vendedores = {};
            
            dados.forEach(recibo => {
                const vendedor = recibo.vendedor || 'Sem Vendedor';
                
                if (!vendedores[vendedor]) {
                    vendedores[vendedor] = {
                        nome: vendedor,
                        recibos: [],
                        total: 0,
                        urgentes: 0,
                        completos: 0
                    };
                }
                
                vendedores[vendedor].recibos.push(recibo);
                vendedores[vendedor].total++;
                
                if (recibo.urgencia === 'Urgente') {
                    vendedores[vendedor].urgentes++;
                }
                
                if (recibo.cpfCliente && recibo.whatsappCliente && recibo.dataIda) {
                    vendedores[vendedor].completos++;
                }
            });
            
            return vendedores;
        }
        
        function exibirVendedores(dados) {
            const vendedoresContainer = document.getElementById('vendedoresList');
            if (!vendedoresContainer) return;
            
            const vendedoresFiltrados = processarVendedores(dados);
            
            const html = Object.values(vendedoresFiltrados)
                .sort((a, b) => b.total - a.total)
                .map(vendedor => {
                    const percentualCompleto = vendedor.total > 0 
                        ? Math.round((vendedor.completos / vendedor.total) * 100) 
                        : 0;
                    
                    return `
                        <div class="vendedor-card fade-in-up" onclick="filtrarPorVendedor('${vendedor.nome}')">
                            <div class="vendedor-header">
                                <div class="vendedor-name">
                                    <i class="fas fa-user"></i>
                                    ${vendedor.nome}
                                </div>
                                <div class="badge bg-primary">${vendedor.total} recibos</div>
                            </div>
                            <div class="vendedor-stats">
                                <div class="vendedor-stat">
                                    <div class="stat-value">${vendedor.urgentes}</div>
                                    <div class="stat-label-small">Urgentes</div>
                                </div>
                                <div class="vendedor-stat">
                                    <div class="stat-value">${vendedor.completos}</div>
                                    <div class="stat-label-small">Completos</div>
                                </div>
                                <div class="vendedor-stat">
                                    <div class="stat-value">${percentualCompleto}%</div>
                                    <div class="stat-label-small">Taxa Conclusão</div>
                                </div>
                            </div>
                        </div>
                    `;
                })
                .join('');
            
            vendedoresContainer.innerHTML = html;
        }

        // ================================================================================
        // 🧾 EXIBIÇÃO DE RECIBOS v10.0
        // ================================================================================
        
        function exibirRecibos(dados) {
            const recibosContainer = document.getElementById('recibosGrid');
            if (!recibosContainer) return;
            
            if (dados.length === 0) {
                recibosContainer.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <i class="fas fa-search" style="font-size: 3rem; color: var(--cvc-cinza); margin-bottom: 20px;"></i>
                        <h3>Nenhum recibo encontrado</h3>
                        <p class="text-muted">Tente ajustar os filtros ou o termo de busca</p>
                    </div>
                `;
                return;
            }
            
            const html = dados.map(recibo => {
                const isUrgente = recibo.urgencia === 'Urgente';
                const isCompleto = recibo.cpfCliente && recibo.whatsappCliente && recibo.dataIda;
                
                let statusClass = 'status-pendente';
                let statusText = 'Pendente';
                
                if (isUrgente) {
                    statusClass = 'status-urgente';
                    statusText = 'Urgente';
                } else if (isCompleto) {
                    statusClass = 'status-completo';
                    statusText = 'Completo';
                }
                
                return `
                    <div class="recibo-card fade-in-up ${isUrgente ? 'recibo-urgente' : ''}">
                        <div class="recibo-header">
                            <div class="recibo-numero">#${recibo.recibo || 'N/A'}</div>
                            <div class="recibo-status ${statusClass}">${statusText}</div>
                        </div>
                        
                        <div class="recibo-info">
                            <div class="mb-2">
                                <strong><i class="fas fa-user"></i> Cliente:</strong>
                                <span>${recibo.nomeCliente || 'Não informado'}</span>
                            </div>
                            
                            <div class="mb-2">
                                <strong><i class="fas fa-user-tie"></i> Vendedor:</strong>
                                <span>${recibo.vendedor || 'Não informado'}</span>
                            </div>
                            
                            <div class="mb-2">
                                <strong><i class="fas fa-calendar"></i> Data Ida:</strong>
                                <span>${recibo.dataIda || 'Não informada'}</span>
                            </div>
                            
                            <div class="mb-2">
                                <strong><i class="fas fa-plane"></i> Tipo:</strong>
                                <span class="badge bg-info">${recibo.tipo || 'N/A'}</span>
                            </div>
                            
                            ${recibo.cpfCliente ? `
                                <div class="mb-2">
                                    <strong><i class="fas fa-id-card"></i> CPF:</strong>
                                    <span>${recibo.cpfCliente}</span>
                                </div>
                            ` : ''}
                            
                            ${recibo.whatsappCliente ? `
                                <div class="mb-2">
                                    <strong><i class="fab fa-whatsapp"></i> WhatsApp:</strong>
                                    <span>${recibo.whatsappCliente}</span>
                                </div>
                            ` : ''}
                        </div>
                        
                        <div class="recibo-actions mt-3">
                            <button class="btn btn-sm btn-primary" onclick="editarRecibo('${recibo.recibo}')">
                                <i class="fas fa-edit"></i> Editar
                            </button>
                            <button class="btn btn-sm btn-success" onclick="marcarCompleto('${recibo.recibo}')">
                                <i class="fas fa-check"></i> Concluir
                            </button>
                        </div>
                    </div>
                `;
            }).join('');
            
            recibosContainer.innerHTML = html;
        }

        // ================================================================================
        // 🎛️ CONTROLES E AÇÕES v10.0
        // ================================================================================
        
        function filtrarPorVendedor(vendedor) {
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = vendedor;
                termoBusca = vendedor.toLowerCase();
                filtrarEExibirRecibos();
                
                // Scroll para recibos
                const recibosSection = document.getElementById('recibosSection');
                if (recibosSection) {
                    recibosSection.scrollIntoView({ behavior: 'smooth' });
                }
            }
            
            showToast(`Filtro aplicado: ${vendedor}`, 'info');
        }
        
        function editarRecibo(reciboId) {
            addDebugLog(`✏️ Solicitada edição do recibo: ${reciboId}`, 'info');
            showToast('Redirecionando para edição...', 'info');
            window.open(`embarques.html?recibo=${reciboId}`, '_blank');
        }
        
        function marcarCompleto(reciboId) {
            addDebugLog(`✅ Marcando recibo como completo: ${reciboId}`, 'info');
            showToast('Funcionalidade em desenvolvimento', 'warning');
        }
        
        function atualizarDados() {
            addDebugLog('🔄 Solicitada atualização manual dos dados', 'info');
            showToast('Atualizando dados...', 'info');
            carregarDadosInicial();
        }
        
        function exportarDados() {
            addDebugLog('📁 Iniciando exportação de dados...', 'info');
            
            const headers = ['Recibo', 'Cliente', 'Vendedor', 'Data Ida', 'Tipo', 'CPF', 'WhatsApp', 'Status'];
            const csvContent = [
                headers.join(','),
                ...recibosDataFiltrada.map(recibo => [
                    recibo.recibo || '',
                    `"${recibo.nomeCliente || ''}"`,
                    recibo.vendedor || '',
                    recibo.dataIda || '',
                    recibo.tipo || '',
                    recibo.cpfCliente || '',
                    recibo.whatsappCliente || '',
                    recibo.urgencia || 'Pendente'
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `vendas_automatizado_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addDebugLog(`✅ Arquivo CSV exportado com ${recibosDataFiltrada.length} registros`, 'success');
            showToast(`Dados exportados (${recibosDataFiltrada.length} registros)`, 'success');
        }

        // ================================================================================
        // 🎯 UTILITÁRIOS v10.0
        // ================================================================================
        
        function ocultarTodasSecoes() {
            const secoes = ['filtersSection', 'vendedoresSection', 'recibosSection', 'actionsSection'];
            secoes.forEach(id => {
                const element = document.getElementById(id);
                if (element) element.style.display = 'none';
            });
        }
        
        function exibirSecoes() {
            const secoes = ['filtersSection', 'vendedoresSection', 'recibosSection', 'actionsSection'];
            secoes.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'block';
                    element.classList.add('fade-in-up');
                }
            });
        }
        
        function mostrarErro(mensagem) {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
            document.getElementById('errorMessage').textContent = mensagem;
            
            addDebugLog(`❌ Erro exibido: ${mensagem}`, 'error');
        }

        // ================================================================================
        // 🚀 INICIALIZAÇÃO DO SISTEMA v10.0
        // ================================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('%c🚀 CVC Portal Itaquá - Vendas Automatizado v10.0', 'color: #0A00B4; font-size: 18px; font-weight: bold;');
            console.log('%c✨ Melhorias v10.0:', 'color: #FFE600; background: #0A00B4; padding: 4px 8px; font-weight: bold;');
            console.log('   • Interface modernizada com animações fluidas');
            console.log('   • Sistema de toast notifications');
            console.log('   • Performance otimizada e debug avançado');
            console.log('   • Filtros inteligentes e busca melhorada');
            console.log('   • UX/UI responsiva aprimorada');
            console.log('   • Shortcuts de teclado (Ctrl+R, F5)');
            console.log('   • Animações de contagem nos stats');
            console.log('   • Sistema de skeleton loading');
            
            // Inicializar sistema
            setTimeout(inicializarSistema, 300);
            
            console.log('%c🎯 Sistema pronto para uso!', 'color: #50fa7b; font-weight: bold;');
        });

        // ================================================================================
        // 🌍 EXPOSIÇÃO DE FUNÇÕES GLOBAIS
        // ================================================================================
        
        window.atualizarDados = atualizarDados;
        window.exportarDados = exportarDados;
        window.filtrarPorVendedor = filtrarPorVendedor;
        window.editarRecibo = editarRecibo;
        window.marcarCompleto = marcarCompleto;
        window.mostrarDebugSection = mostrarDebugSection;
        
    </script>
</body>
</html>
