<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CVC Itaquá - Portal de Gestão da Loja - Informe Automatizado</title>
    
    <!-- Meta Tags -->
    <meta name="description" content="CVC Itaquá - Informe Automatizado de Vendas - Dados Reais da Planilha">
    <meta name="keywords" content="CVC, Itaquaquecetuba, vendas, automatizado, embarques, recibos">
    <meta name="author" content="CVC Itaquaquecetuba">
    <meta name="robots" content="noindex, nofollow">
    
    <!-- CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="assets/css/cvc-styles.css" rel="stylesheet">
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/images/cvc-favicon.ico">
    
    <style>
        /* ===== ESTILOS ESPECÍFICOS DA PÁGINA VENDAS AUTOMATIZADO v9.0 ===== */
        
        .vendas-auto-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Dashboard Status */
        .status-dashboard {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-azul-escuro));
            border-radius: 20px;
            padding: 30px;
            color: white;
            margin-bottom: 30px;
            position: relative;
            overflow: hidden;
        }

        .status-dashboard::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 100px;
            height: 100px;
            background: rgba(255, 230, 0, 0.1);
            border-radius: 50%;
            transform: translate(30px, -30px);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .stat-number {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--cvc-amarelo);
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.95;
            font-weight: 500;
        }

        /* Filtros Section */
        .filtros-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-amarelo);
        }

        .filtros-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .filtro-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--cvc-sombra-suave);
            border: 2px solid transparent;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .filtro-card.active {
            border-color: var(--cvc-azul);
            background: linear-gradient(135deg, rgba(10, 0, 180, 0.05), rgba(255, 230, 0, 0.05));
        }

        .filtro-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }

        .filtro-titulo {
            font-weight: 700;
            color: var(--cvc-azul);
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filtro-desc {
            font-size: 0.9rem;
            color: var(--cvc-cinza);
            margin-bottom: 15px;
        }

        .filtro-count {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--cvc-azul);
        }

        /* Ações Rápidas */
        .acoes-rapidas {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-verde);
        }

        .acoes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .acao-card {
            background: var(--cvc-branco);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: var(--cvc-sombra-suave);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .acao-card:hover {
            transform: translateY(-3px);
            box-shadow: var(--cvc-sombra-media);
            border-color: var(--cvc-azul);
        }

        .acao-icon {
            font-size: 2.5rem;
            color: var(--cvc-azul);
            margin-bottom: 15px;
        }

        .acao-titulo {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--cvc-azul);
            margin-bottom: 8px;
        }

        .acao-desc {
            font-size: 0.9rem;
            color: var(--cvc-cinza);
        }

        /* Seção de Vendedores */
        .vendedores-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid var(--cvc-verde);
        }

        .vendedor-card {
            background: var(--cvc-branco);
            border-radius: 15px;
            padding: 25px;
            box-shadow: var(--cvc-sombra-suave);
            margin-bottom: 20px;
            border-left: 5px solid var(--cvc-azul);
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .vendedor-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--cvc-sombra-media);
        }

        .vendedor-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .vendedor-nome {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--cvc-azul);
        }

        .vendedor-status {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .vendedor-status.ativo {
            background: #28a745;
            color: white;
        }

        .vendedor-status.pendente {
            background: #ffc107;
            color: #000;
        }

        .vendedor-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .vendedor-stat {
            text-align: center;
            min-width: 80px;
        }

        .vendedor-stat-number {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--cvc-azul);
            line-height: 1;
        }

        .vendedor-stat-label {
            font-size: 0.8rem;
            color: var(--cvc-cinza);
            margin-top: 2px;
        }

        /* Progresso de Complementação */
        .progresso-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid #17a2b8;
        }

        .progresso-bar {
            background: #e9ecef;
            border-radius: 10px;
            height: 25px;
            margin: 15px 0;
            overflow: hidden;
            position: relative;
        }

        .progresso-fill {
            background: linear-gradient(135deg, var(--cvc-azul), var(--cvc-verde));
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progresso-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progresso-label {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            color: var(--cvc-azul);
        }

        /* Lista de Recibos */
        .recibos-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
        }

        .recibo-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
            box-shadow: var(--cvc-sombra-suave);
            border-left: 4px solid var(--cvc-azul);
            transition: all 0.3s ease;
        }

        .recibo-card:hover {
            transform: translateX(5px);
            box-shadow: var(--cvc-sombra-media);
        }

        .recibo-card.urgente {
            border-left-color: #dc3545;
            background: linear-gradient(135deg, #fff, #fff5f5);
        }

        .recibo-card.alto {
            border-left-color: #fd7e14;
            background: linear-gradient(135deg, #fff, #fff8f0);
        }

        .recibo-card.normal {
            border-left-color: #28a745;
            background: linear-gradient(135deg, #fff, #f8fff8);
        }

        .recibo-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .recibo-numero {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--cvc-azul);
        }

        .recibo-cliente {
            font-size: 1rem;
            color: #333;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .recibo-details {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 10px;
            font-size: 0.9rem;
            color: var(--cvc-cinza);
        }

        .recibo-detail {
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .urgencia-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            text-transform: uppercase;
        }

        .urgencia-urgente {
            background: #dc3545;
            color: white;
        }

        .urgencia-alto {
            background: #fd7e14;
            color: white;
        }

        .urgencia-normal {
            background: #28a745;
            color: white;
        }

        .urgencia-baixo {
            background: #6c757d;
            color: white;
        }

        /* Análise de Dados */
        .analise-section {
            background: var(--cvc-fundo-card);
            border-radius: 20px;
            padding: 30px;
            box-shadow: var(--cvc-sombra-media);
            margin-bottom: 30px;
            border-left: 5px solid #6f42c1;
        }

        .analise-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-top: 20px;
        }

        .analise-card {
            background: var(--cvc-branco);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--cvc-sombra-suave);
        }

        .analise-titulo {
            font-weight: 700;
            color: var(--cvc-azul);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .analise-lista {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .analise-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }

        .analise-item:last-child {
            border-bottom: none;
        }

        .analise-valor {
            font-weight: 700;
            color: var(--cvc-azul);
        }

        /* Loading e Estados */
        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(10, 0, 180, 0.1);
            border-top: 4px solid var(--cvc-azul);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-container {
            text-align: center;
            padding: 40px 20px;
            color: #dc3545;
        }

        .error-icon {
            font-size: 3rem;
            margin-bottom: 20px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--cvc-cinza);
        }

        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* Toolbar de Ações */
        .toolbar {
            background: var(--cvc-branco);
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: var(--cvc-sombra-suave);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .toolbar-actions {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .toolbar-search {
            flex: 1;
            min-width: 250px;
            max-width: 400px;
        }

        .search-input {
            width: 100%;
            padding: 10px 15px 10px 45px;
            border: 2px solid #e9ecef;
            border-radius: 25px;
            font-size: 0.9rem;
            background: url('data:image/svg+xml;charset=UTF-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="%23666" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>') no-repeat 15px center;
            background-size: 18px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--cvc-azul);
            box-shadow: 0 0 0 3px rgba(10, 0, 180, 0.1);
        }

        /* Debug Section */
        .debug-section {
            background: #1e1e1e;
            border: 1px solid #333;
            border-radius: 12px;
            padding: 20px;
            margin-top: 25px;
            font-family: 'Courier New', monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            color: #f8f8f2;
        }

        .debug-header {
            font-weight: bold;
            color: #50fa7b;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .debug-content .error {
            color: #ff5555;
        }

        .debug-content .success {
            color: #50fa7b;
        }

        .debug-content .info {
            color: #8be9fd;
        }

        .debug-content .warning {
            color: #f1fa8c;
        }

        /* Tabs */
        .tab-container {
            background: var(--cvc-branco);
            border-radius: 15px;
            overflow: hidden;
            box-shadow: var(--cvc-sombra-suave);
            margin-bottom: 20px;
        }

        .tab-header {
            display: flex;
            border-bottom: 2px solid #e9ecef;
            background: #f8f9fa;
        }

        .tab-button {
            flex: 1;
            padding: 15px 20px;
            border: none;
            background: none;
            font-weight: 600;
            color: var(--cvc-cinza);
            cursor: pointer;
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab-button.active {
            color: var(--cvc-azul);
            background: var(--cvc-branco);
            border-bottom-color: var(--cvc-azul);
        }

        .tab-button:hover:not(.active) {
            background: rgba(10, 0, 180, 0.05);
        }

        .tab-content {
            padding: 25px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .vendas-auto-container {
                padding: 15px;
            }
            
            .stats-grid {
                grid-template-columns: repeat(2, 1fr);
                gap: 15px;
            }
            
            .filtros-grid,
            .acoes-grid,
            .analise-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .vendedor-stats {
                justify-content: center;
            }
            
            .recibo-details {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .toolbar {
                flex-direction: column;
                align-items: stretch;
            }

            .toolbar-search {
                min-width: auto;
                max-width: none;
            }

            .tab-header {
                overflow-x: auto;
            }

            .tab-button {
                white-space: nowrap;
                min-width: 120px;
            }
        }

        @media (max-width: 480px) {
            .vendedor-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            .recibo-header {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>
<body>
    <!-- HEADER CVC PADRÃO -->
    <header class="cvc-header">
        <div class="container-fluid">
            <div class="row align-items-center py-3">
                <!-- Logo CVC -->
                <div class="col-md-4">
                    <div class="cvc-logo">
                        <div class="cvc-logo-symbol">CVC</div>
                        <div>
                            <div class="cvc-logo-text">CVC Itaquá</div>
                            <p class="cvc-subtitle">Portal de Gestão da Loja</p>
                        </div>
                    </div>
                </div>
                
                <!-- Título da Página -->
                <div class="col-md-4 text-center">
                    <h1 class="page-title mb-0" style="border: none; padding: 0; color: var(--cvc-branco); font-size: 1.8rem;">
                        <i class="fas fa-robot"></i> Informe Automatizado
                    </h1>
                </div>
                
                <!-- Voltar ao Dashboard -->
                <div class="col-md-4 text-end">
                    <a href="index.html" class="btn btn-cvc-outline">
                        <i class="fas fa-arrow-left"></i> Voltar ao Dashboard
                    </a>
                </div>
            </div>
        </div>
    </header>

    <!-- NAVEGAÇÃO CVC PADRÃO -->
    <nav class="cvc-nav">
        <div class="container-fluid">
            <ul class="nav nav-pills justify-content-center mb-0">
                <li class="nav-item">
                    <a class="nav-link" href="index.html">
                        <i class="fas fa-tachometer-alt"></i> Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="orcamentos.html">
                        <i class="fas fa-calculator"></i> Padronizador de Orçamentos
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="vendas.html">
                        <i class="fas fa-chart-line"></i> Informe de Vendas
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link active" href="vendas-automatizado.html">
                        <i class="fas fa-robot"></i> Informe Automatizado
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="embarques.html">
                        <i class="fas fa-plane-departure"></i> Controle de Embarques
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="orbiuns.html">
                        <i class="fas fa-clipboard-list"></i> Controle de Orbiuns
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="importacao.html">
                        <i class="fas fa-cloud-upload-alt"></i> Importação
                    </a>
                </li>
            </ul>
        </div>
    </nav>

    <!-- ÁREA DE CONTEÚDO -->
    <div class="content-area">
        <div class="vendas-auto-container">
            
            <!-- STATUS DASHBOARD -->
            <section class="status-dashboard fade-in-up">
                <h2><i class="fas fa-robot"></i> Informe Automatizado de Vendas</h2>
                <p class="mb-0 opacity-75">Dados em tempo real diretamente da planilha de embarques com análise inteligente</p>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number" id="totalRecibos">0</div>
                        <div class="stat-label">Recibos Pendentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="totalVendedores">0</div>
                        <div class="stat-label">Vendedores Ativos</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="urgentesCount">0</div>
                        <div class="stat-label">Urgentes</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number" id="percentualCompleto">0%</div>
                        <div class="stat-label">Dados Completos</div>
                    </div>
                </div>
            </section>

            <!-- ÁREA DE LOADING/ERROR -->
            <div id="loadingContainer" class="loading-container">
                <div class="loading-spinner"></div>
                <h3>Carregando dados da planilha...</h3>
                <p class="text-muted">Conectando com Google Apps Script via JSONP v9.0</p>
            </div>

            <div id="errorContainer" class="error-container" style="display:none;">
                <div class="error-icon">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                <h3>Erro ao carregar dados</h3>
                <p id="errorMessage">Não foi possível conectar com a planilha</p>
                <button class="btn btn-cvc-primary" onclick="carregarDadosInicial()">
                    <i class="fas fa-redo"></i> Tentar Novamente
                </button>
            </div>

            <!-- FILTROS INTELIGENTES -->
            <section class="filtros-section" id="filtrosSection" style="display:none;">
                <h2><i class="fas fa-filter"></i> Filtros Inteligentes</h2>
                <p class="text-muted mb-3">Filtre os dados por prioridade, vendedor ou status de complementação</p>
                <div class="filtros-grid">
                    <div class="filtro-card active" data-filtro="todos" onclick="aplicarFiltro('todos')">
                        <div class="filtro-titulo">
                            <i class="fas fa-list"></i> Todos os Recibos
                        </div>
                        <div class="filtro-desc">Visualizar todos os recibos pendentes</div>
                        <div class="filtro-count" id="filtroTodos">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="urgente" onclick="aplicarFiltro('urgente')">
                        <div class="filtro-titulo">
                            <i class="fas fa-exclamation-triangle"></i> Urgentes
                        </div>
                        <div class="filtro-desc">Embarques em até 3 dias</div>
                        <div class="filtro-count" id="filtroUrgente">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="semCPF" onclick="aplicarFiltro('semCPF')">
                        <div class="filtro-titulo">
                            <i class="fas fa-id-card"></i> Sem CPF
                        </div>
                        <div class="filtro-desc">Recibos que precisam de CPF</div>
                        <div class="filtro-count" id="filtroSemCPF">0</div>
                    </div>
                    <div class="filtro-card" data-filtro="semWhatsApp" onclick="aplicarFiltro('semWhatsApp')">
                        <div class="filtro-titulo">
                            <i class="fas fa-phone"></i> Sem WhatsApp
                        </div>
                        <div class="filtro-desc">Recibos que precisam de telefone</div>
                        <div class="filtro-count" id="filtroSemWhatsApp">0</div>
                    </div>
                </div>
            </section>

            <!-- AÇÕES RÁPIDAS -->
            <section class="acoes-rapidas" id="acoesSection" style="display:none;">
                <h2><i class="fas fa-bolt"></i> Ações Rápidas</h2>
                <p class="text-muted mb-3">Acesse funcionalidades relacionadas para completar os dados</p>
                <div class="acoes-grid">
                    <div class="acao-card" onclick="window.open('vendas.html', '_blank')">
                        <div class="acao-icon">
                            <i class="fas fa-plus-circle"></i>
                        </div>
                        <div class="acao-titulo">Cadastrar Nova Venda</div>
                        <div class="acao-desc">Adicionar novos recibos ao sistema</div>
                    </div>
                    <div class="acao-card" onclick="window.open('embarques.html', '_blank')">
                        <div class="acao-icon">
                            <i class="fas fa-edit"></i>
                        </div>
                        <div class="acao-titulo">Editar Embarques</div>
                        <div class="acao-desc">Completar dados diretamente na planilha</div>
                    </div>
                    <div class="acao-card" onclick="exportarDados()">
                        <div class="acao-icon">
                            <i class="fas fa-download"></i>
                        </div>
                        <div class="acao-titulo">Exportar Relatório</div>
                        <div class="acao-desc">Baixar lista de recibos pendentes</div>
                    </div>
                    <div class="acao-card" onclick="atualizarDados()">
                        <div class="acao-icon">
                            <i class="fas fa-sync-alt"></i>
                        </div>
                        <div class="acao-titulo">Atualizar Dados</div>
                        <div class="acao-desc">Recarregar informações da planilha</div>
                    </div>
                </div>
            </section>

            <!-- SEÇÃO DE VENDEDORES -->
            <section class="vendedores-section" id="vendedoresSection" style="display:none;">
                <h2><i class="fas fa-users"></i> Resumo por Vendedores</h2>
                <p class="text-muted mb-3">Clique em um vendedor para ver seus recibos pendentes</p>
                <div id="vendedoresList">
                    <!-- Vendedores serão inseridos aqui -->
                </div>
            </section>

            <!-- PROGRESSO DE COMPLEMENTAÇÃO -->
            <section class="progresso-section" id="progressoSection" style="display:none;">
                <h2><i class="fas fa-chart-line"></i> Progresso de Complementação</h2>
                <p class="text-muted mb-3">Acompanhe o progresso de preenchimento dos dados</p>
                
                <div class="row">
                    <div class="col-md-6">
                        <div class="progresso-label">
                            <span>CPF Preenchido</span>
                            <span id="progressoCPFTexto">0%</span>
                        </div>
                        <div class="progresso-bar">
                            <div class="progresso-fill" id="progressoCPF" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="progresso-label">
                            <span>WhatsApp Preenchido</span>
                            <span id="progressoWhatsAppTexto">0%</span>
                        </div>
                        <div class="progresso-bar">
                            <div class="progresso-fill" id="progressoWhatsApp" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- TABS DE CONTEÚDO -->
            <div class="tab-container" id="tabContainer" style="display:none;">
                <div class="tab-header">
                    <button class="tab-button active" data-tab="recibos">
                        <i class="fas fa-receipt"></i> Recibos Pendentes
                    </button>
                    <button class="tab-button" data-tab="analise">
                        <i class="fas fa-chart-pie"></i> Análise de Dados
                    </button>
                    <button class="tab-button" data-tab="relatorio">
                        <i class="fas fa-file-alt"></i> Relatório Detalhado
                    </button>
                </div>
                <div class="tab-content">
                    <!-- TAB: RECIBOS -->
                    <div class="tab-pane active" id="tabRecibos">
                        <!-- Toolbar de Busca -->
                        <div class="toolbar">
                            <div class="toolbar-search">
                                <input type="text" class="search-input" id="searchInput" 
                                       placeholder="Buscar por cliente, recibo ou vendedor...">
                            </div>
                            <div class="toolbar-actions">
                                <button class="btn btn-outline-secondary btn-sm" onclick="limparFiltros()">
                                    <i class="fas fa-times"></i> Limpar Filtros
                                </button>
                                <button class="btn btn-cvc-primary btn-sm" onclick="atualizarDados()">
                                    <i class="fas fa-sync-alt"></i> Atualizar
                                </button>
                            </div>
                        </div>

                        <!-- Lista de Recibos -->
                        <div id="recibosList">
                            <!-- Recibos serão inseridos aqui -->
                        </div>
                    </div>

                    <!-- TAB: ANÁLISE -->
                    <div class="tab-pane" id="tabAnalise">
                        <div class="analise-grid">
                            <div class="analise-card">
                                <div class="analise-titulo">
                                    <i class="fas fa-user-tie"></i> Top Vendedores
                                </div>
                                <ul class="analise-lista" id="topVendedores">
                                    <!-- Dados serão inseridos aqui -->
                                </ul>
                            </div>
                            <div class="analise-card">
                                <div class="analise-titulo">
                                    <i class="fas fa-plane"></i> Tipos de Serviço
                                </div>
                                <ul class="analise-lista" id="tiposServico">
                                    <!-- Dados serão inseridos aqui -->
                                </ul>
                            </div>
                            <div class="analise-card">
                                <div class="analise-titulo">
                                    <i class="fas fa-calendar"></i> Urgência por Data
                                </div>
                                <ul class="analise-lista" id="urgenciaDatas">
                                    <!-- Dados serão inseridos aqui -->
                                </ul>
                            </div>
                            <div class="analise-card">
                                <div class="analise-titulo">
                                    <i class="fas fa-building"></i> Companhias Aéreas
                                </div>
                                <ul class="analise-lista" id="companhias">
                                    <!-- Dados serão inseridos aqui -->
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- TAB: RELATÓRIO -->
                    <div class="tab-pane" id="tabRelatorio">
                        <div class="row">
                            <div class="col-md-8">
                                <h4>Relatório de Pendências</h4>
                                <div id="relatorioDetalhado">
                                    <!-- Relatório será inserido aqui -->
                                </div>
                            </div>
                            <div class="col-md-4">
                                <h4>Ações de Exportação</h4>
                                <div class="d-grid gap-2">
                                    <button class="btn btn-cvc-primary" onclick="exportarCSV()">
                                        <i class="fas fa-file-csv"></i> Exportar CSV
                                    </button>
                                    <button class="btn btn-cvc-secondary" onclick="exportarPDF()">
                                        <i class="fas fa-file-pdf"></i> Exportar PDF
                                    </button>
                                    <button class="btn btn-outline-secondary" onclick="imprimirRelatorio()">
                                        <i class="fas fa-print"></i> Imprimir
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- DEBUG SECTION -->
            <div class="debug-section" id="debugSection" style="display:none;">
                <div class="debug-header">
                    <i class="fas fa-terminal"></i> Debug do Sistema JSONP v9.0:
                </div>
                <div class="debug-content" id="debugContent"></div>
            </div>

        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="config.js"></script>
    
    <script>
        // ================================================================================
        // SISTEMA DE VENDAS AUTOMATIZADO CVC ITAQUÁ v9.0 - CORS CORRIGIDO COM JSONP
        // Sistema completo que busca dados reais da planilha e exibe para os vendedores
        // ANÁLISE COMPLETA: ZERO FETCH() - APENAS JSONP
        // ================================================================================
        
        console.log('🤖 CVC Portal Itaquá - Sistema de Vendas Automatizado v9.0 JSONP Iniciado');
        
        // ================================================================================
        // VARIÁVEIS GLOBAIS
        // ================================================================================
        
        let recibosData = [];
        let recibosDataOriginal = [];
        let vendedoresData = {};
        let debugLogs = [];
        let API_URL = null;
        let filtroAtivo = 'todos';
        let termoBusca = '';

        // ================================================================================
        // SISTEMA DE DEBUG AVANÇADO
        // ================================================================================
        
        function addDebugLog(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString('pt-BR');
            const logEntry = { timestamp, message, type };
            debugLogs.push(logEntry);
            
            // Console log com cores
            const colors = {
                error: 'color: #ff5555; font-weight: bold;',
                success: 'color: #50fa7b; font-weight: bold;',
                warning: 'color: #f1fa8c; font-weight: bold;',
                info: 'color: #8be9fd;'
            };
            
            console.log(`%c[${type.toUpperCase()}] ${message}`, colors[type] || colors.info);
            updateDebugDisplay();
        }
        
        function updateDebugDisplay() {
            const debugContent = document.getElementById('debugContent');
            if (!debugContent) return;
            
            const html = debugLogs.slice(-25).map(log => {
                const typeClass = log.type;
                return `<div class="${typeClass}">
                    [${log.timestamp}] ${log.message}
                </div>`;
            }).join('');
            
            debugContent.innerHTML = html;
            debugContent.scrollTop = debugContent.scrollHeight;
        }
        
        function showDebugSection() {
            const debugSection = document.getElementById('debugSection');
            debugSection.style.display = 'block';
        }

        // ================================================================================
        // INICIALIZAÇÃO SEGURA DO SISTEMA
        // ================================================================================
        
        function inicializarSistema() {
            addDebugLog('🚀 Iniciando sistema de vendas automatizado...', 'info');
            
            // Verificar configurações
            if (typeof getApiUrl === 'function') {
                API_URL = getApiUrl();
                addDebugLog(`🌐 API URL configurada: ${API_URL}`, 'success');
            } else if (typeof CVC_CONFIG !== 'undefined' && CVC_CONFIG.API_URL) {
                API_URL = CVC_CONFIG.API_URL;
                addDebugLog(`🌐 API URL do config: ${API_URL}`, 'success');
            } else {
                addDebugLog('❌ ERRO: API URL não configurada!', 'error');
                mostrarErro('Configuração inválida. Verifique o arquivo config.js');
                return;
            }
            
            showDebugSection();
            addDebugLog('✅ Sistema inicializado com sucesso!', 'success');
            addDebugLog('🔧 Utilizando bypass CORS com JSONP conforme v9.0', 'info');
            addDebugLog('🚫 ZERO fetch() - APENAS JSONP para total bypass CORS', 'info');
            
            // Configurar eventos
            configurarEventos();
            
            // Carregar dados iniciais
            carregarDadosInicial();
        }

        // ================================================================================
        // CONFIGURAÇÃO DE EVENTOS
        // ================================================================================
        
        function configurarEventos() {
            // Tab buttons
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', () => {
                    const tabName = button.dataset.tab;
                    ativarTab(tabName);
                });
            });

            // Search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', (e) => {
                    termoBusca = e.target.value.toLowerCase();
                    filtrarEExibirRecibos();
                });
            }

            addDebugLog('✅ Eventos configurados', 'success');
        }

        // ================================================================================
        // CARREGAMENTO DE DADOS VIA JSONP - CORREÇÃO CORS v9.0 - FUNÇÃO RENOMEADA
        // ================================================================================
        
        function carregarDadosInicial() {
            addDebugLog('📊 JSONP: Carregando recibos do servidor...', 'info');
            
            // Mostrar loading
            document.getElementById('loadingContainer').style.display = 'block';
            document.getElementById('errorContainer').style.display = 'none';
            ocultarTodasSecoes();
            
            if (!API_URL) {
                addDebugLog('❌ ERRO: API URL não configurada!', 'error');
                mostrarErro('Configuração inválida. Verifique o arquivo config.js');
                return;
            }
            
            addDebugLog(`🔗 JSONP: Conectando: ${API_URL}`, 'info');
            
            // CORREÇÃO CRÍTICA: Usar JSONP PURO - ZERO fetch()
            chamarAPIJsonp('listar_vendas_pendentes')
                .then(resultado => {
                    addDebugLog('📡 JSONP: Resposta recebida', 'success');
                    
                    if (resultado.success) {
                        if (resultado.data && resultado.data.recibos) {
                            recibosDataOriginal = resultado.data.recibos;
                            recibosData = [...recibosDataOriginal];
                            addDebugLog(`✅ JSONP: ${recibosData.length} recibos carregados`, 'success');
                            
                            processarDadosVendedores();
                            atualizarDashboard();
                            gerarAnalises();
                            exibirDados();
                            
                        } else {
                            addDebugLog('⚠️ JSONP: Estrutura de resposta inesperada', 'warning');
                            throw new Error('Estrutura de dados inválida na resposta');
                        }
                    } else {
                        throw new Error(resultado.message || 'Erro desconhecido na API');
                    }
                })
                .catch(error => {
                    addDebugLog(`❌ JSONP: Erro: ${error.message}`, 'error');
                    mostrarErro(error.message);
                });
        }
        
        // FUNÇÃO JSONP ESPECÍFICA PARA BYPASS CORS v9.0 - ZERO FETCH
        function chamarAPIJsonp(action, parametros = {}) {
            return new Promise((resolve, reject) => {
                const callbackName = `vendas_auto_callback_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;
                
                addDebugLog(`🔗 JSONP: Criando callback ${callbackName}`, 'info');
                
                // Definir callback global
                window[callbackName] = function(result) {
                    try {
                        // Limpar callback
                        delete window[callbackName];
                        
                        addDebugLog(`📡 JSONP: Callback executado: ${result.success ? 'sucesso' : 'erro'}`, result.success ? 'success' : 'error');
                        
                        resolve(result);
                        
                    } catch (error) {
                        delete window[callbackName];
                        reject(error);
                    }
                };
                
                // Criar script JSONP - ZERO fetch()
                const script = document.createElement('script');
                
                const params = new URLSearchParams({
                    callback: callbackName,
                    action: action,
                    ...parametros
                });
                
                const urlCompleta = `${API_URL}?${params.toString()}`;
                script.src = urlCompleta;
                
                addDebugLog(`📡 JSONP: URL criada (${urlCompleta.length} chars)`, 'info');
                
                script.onerror = function() {
                    delete window[callbackName];
                    script.remove();
                    reject(new Error('Erro ao carregar script JSONP. Verifique se o Google Apps Script está funcionando.'));
                };
                
                // Timeout específico
                setTimeout(() => {
                    if (window[callbackName]) {
                        delete window[callbackName];
                        if (script.parentNode) {
                            script.remove();
                        }
                        reject(new Error('Timeout na requisição JSONP (30s). Verifique a conexão.'));
                    }
                }, 30000);
                
                document.head.appendChild(script);
                
                addDebugLog(`🔗 JSONP: Script adicionado ao DOM`, 'info');
            });
        }

        // ================================================================================
        // PROCESSAMENTO DE DADOS
        // ================================================================================
        
        function processarDadosVendedores() {
            addDebugLog('👥 Processando dados por vendedores...', 'info');
            
            vendedoresData = {};
            
            recibosData.forEach(recibo => {
                const vendedor = recibo.vendedor || 'Não informado';
                
                if (!vendedoresData[vendedor]) {
                    vendedoresData[vendedor] = {
                        nome: vendedor,
                        recibos: [],
                        total: 0,
                        urgentes: 0,
                        normais: 0,
                        semCPF: 0,
                        semWhatsApp: 0
                    };
                }
                
                vendedoresData[vendedor].recibos.push(recibo);
                vendedoresData[vendedor].total++;
                
                if (recibo.urgencia === 'URGENTE' || recibo.urgencia === 'ALTO') {
                    vendedoresData[vendedor].urgentes++;
                } else {
                    vendedoresData[vendedor].normais++;
                }

                if (!recibo.cpfCliente || recibo.cpfCliente.trim() === '') {
                    vendedoresData[vendedor].semCPF++;
                }

                if (!recibo.whatsappCliente || recibo.whatsappCliente.trim() === '') {
                    vendedoresData[vendedor].semWhatsApp++;
                }
            });
            
            addDebugLog(`📊 Dados processados para ${Object.keys(vendedoresData).length} vendedores`, 'success');
        }
        
        function atualizarDashboard() {
            const totalRecibos = recibosData.length;
            const totalVendedores = Object.keys(vendedoresData).length;
            const urgentesCount = recibosData.filter(r => r.urgencia === 'URGENTE' || r.urgencia === 'ALTO').length;
            const completosCount = recibosData.filter(r => r.cpfCliente && r.whatsappCliente).length;
            const percentualCompleto = totalRecibos > 0 ? Math.round((completosCount / totalRecibos) * 100) : 0;
            
            document.getElementById('totalRecibos').textContent = totalRecibos;
            document.getElementById('totalVendedores').textContent = totalVendedores;
            document.getElementById('urgentesCount').textContent = urgentesCount;
            document.getElementById('percentualCompleto').textContent = percentualCompleto + '%';

            // Atualizar contadores de filtros
            document.getElementById('filtroTodos').textContent = totalRecibos;
            document.getElementById('filtroUrgente').textContent = urgentesCount;
            document.getElementById('filtroSemCPF').textContent = recibosData.filter(r => !r.cpfCliente || r.cpfCliente.trim() === '').length;
            document.getElementById('filtroSemWhatsApp').textContent = recibosData.filter(r => !r.whatsappCliente || r.whatsappCliente.trim() === '').length;

            // Atualizar progresso
            atualizarProgresso();
            
            addDebugLog(`📊 Dashboard atualizado: ${totalRecibos} recibos, ${totalVendedores} vendedores`, 'info');
        }

        function atualizarProgresso() {
            const totalRecibos = recibosData.length;
            if (totalRecibos === 0) return;

            const comCPF = recibosData.filter(r => r.cpfCliente && r.cpfCliente.trim() !== '').length;
            const comWhatsApp = recibosData.filter(r => r.whatsappCliente && r.whatsappCliente.trim() !== '').length;

            const percentualCPF = Math.round((comCPF / totalRecibos) * 100);
            const percentualWhatsApp = Math.round((comWhatsApp / totalRecibos) * 100);

            document.getElementById('progressoCPF').style.width = percentualCPF + '%';
            document.getElementById('progressoCPFTexto').textContent = percentualCPF + '%';
            
            document.getElementById('progressoWhatsApp').style.width = percentualWhatsApp + '%';
            document.getElementById('progressoWhatsAppTexto').textContent = percentualWhatsApp + '%';
        }

        // ================================================================================
        // SISTEMA DE FILTROS
        // ================================================================================
        
        function aplicarFiltro(tipo) {
            addDebugLog(`🔍 Aplicando filtro: ${tipo}`, 'info');
            
            filtroAtivo = tipo;
            
            // Atualizar visual dos filtros
            document.querySelectorAll('.filtro-card').forEach(card => {
                card.classList.remove('active');
            });
            
            document.querySelector(`[data-filtro="${tipo}"]`).classList.add('active');
            
            filtrarEExibirRecibos();
        }

        function filtrarEExibirRecibos() {
            let recibosParaExibir = [...recibosDataOriginal];
            
            // Aplicar filtro por tipo
            switch (filtroAtivo) {
                case 'urgente':
                    recibosParaExibir = recibosParaExibir.filter(r => 
                        r.urgencia === 'URGENTE' || r.urgencia === 'ALTO'
                    );
                    break;
                case 'semCPF':
                    recibosParaExibir = recibosParaExibir.filter(r => 
                        !r.cpfCliente || r.cpfCliente.trim() === ''
                    );
                    break;
                case 'semWhatsApp':
                    recibosParaExibir = recibosParaExibir.filter(r => 
                        !r.whatsappCliente || r.whatsappCliente.trim() === ''
                    );
                    break;
                default:
                    // 'todos' - não filtra
                    break;
            }
            
            // Aplicar filtro por busca
            if (termoBusca) {
                recibosParaExibir = recibosParaExibir.filter(r => 
                    (r.nomeCliente && r.nomeCliente.toLowerCase().includes(termoBusca)) ||
                    (r.recibo && r.recibo.toLowerCase().includes(termoBusca)) ||
                    (r.vendedor && r.vendedor.toLowerCase().includes(termoBusca))
                );
            }
            
            recibosData = recibosParaExibir;
            exibirRecibos();
            
            addDebugLog(`📋 ${recibosData.length} recibos após filtros`, 'info');
        }

        function limparFiltros() {
            filtroAtivo = 'todos';
            termoBusca = '';
            document.getElementById('searchInput').value = '';
            
            document.querySelectorAll('.filtro-card').forEach(card => {
                card.classList.remove('active');
            });
            document.querySelector('[data-filtro="todos"]').classList.add('active');
            
            recibosData = [...recibosDataOriginal];
            exibirRecibos();
            
            addDebugLog('🧹 Filtros limpos', 'info');
        }

        // ================================================================================
        // EXIBIÇÃO DOS DADOS
        // ================================================================================
        
        function exibirDados() {
            document.getElementById('loadingContainer').style.display = 'none';
            mostrarTodasSecoes();
            
            exibirVendedores();
            exibirRecibos();
            
            addDebugLog('✅ Interface atualizada com dados reais', 'success');
        }
        
        function mostrarTodasSecoes() {
            document.getElementById('filtrosSection').style.display = 'block';
            document.getElementById('acoesSection').style.display = 'block';
            document.getElementById('vendedoresSection').style.display = 'block';
            document.getElementById('progressoSection').style.display = 'block';
            document.getElementById('tabContainer').style.display = 'block';
        }

        function ocultarTodasSecoes() {
            document.getElementById('filtrosSection').style.display = 'none';
            document.getElementById('acoesSection').style.display = 'none';
            document.getElementById('vendedoresSection').style.display = 'none';
            document.getElementById('progressoSection').style.display = 'none';
            document.getElementById('tabContainer').style.display = 'none';
        }
        
        function exibirVendedores() {
            const vendedoresList = document.getElementById('vendedoresList');
            let html = '';
            
            Object.values(vendedoresData).forEach(vendedor => {
                const status = vendedor.urgentes > 0 ? 'pendente' : 'ativo';
                const statusText = vendedor.urgentes > 0 ? 'Pendências' : 'OK';
                
                html += `
                    <div class="vendedor-card" onclick="filtrarPorVendedor('${vendedor.nome}')">
                        <div class="vendedor-header">
                            <div class="vendedor-nome">
                                <i class="fas fa-user"></i> ${vendedor.nome}
                            </div>
                            <div class="vendedor-status ${status}">${statusText}</div>
                        </div>
                        <div class="vendedor-stats">
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number">${vendedor.total}</div>
                                <div class="vendedor-stat-label">Total</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number" style="color: #dc3545;">${vendedor.urgentes}</div>
                                <div class="vendedor-stat-label">Urgentes</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number" style="color: #28a745;">${vendedor.normais}</div>
                                <div class="vendedor-stat-label">Normais</div>
                            </div>
                            <div class="vendedor-stat">
                                <div class="vendedor-stat-number" style="color: #17a2b8;">${vendedor.semCPF}</div>
                                <div class="vendedor-stat-label">Sem CPF</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            vendedoresList.innerHTML = html;
        }
        
        function exibirRecibos() {
            const recibosList = document.getElementById('recibosList');
            let html = '';
            
            if (recibosData.length === 0) {
                html = `
                    <div class="empty-state">
                        <div class="empty-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <h3>Nenhum recibo encontrado!</h3>
                        <p>Todos os dados estão completos ou não há recibos com os filtros aplicados.</p>
                    </div>
                `;
            } else {
                recibosData.forEach(recibo => {
                    const urgenciaClass = `urgencia-${recibo.urgencia.toLowerCase()}`;
                    const cardClass = recibo.urgencia.toLowerCase();
                    
                    html += `
                        <div class="recibo-card ${cardClass}">
                            <div class="recibo-header">
                                <div class="recibo-numero">
                                    <i class="fas fa-receipt"></i> ${recibo.recibo}
                                </div>
                                <span class="urgencia-badge ${urgenciaClass}">${recibo.urgencia}</span>
                            </div>
                            <div class="recibo-cliente">
                                <strong>${recibo.nomeCliente}</strong>
                            </div>
                            <div class="recibo-details">
                                <div class="recibo-detail">
                                    <i class="fas fa-user"></i> <strong>Vendedor:</strong> ${recibo.vendedor}
                                </div>
                                <div class="recibo-detail">
                                    <i class="fas fa-calendar"></i> <strong>Data:</strong> ${recibo.dataIda || 'N/A'}
                                </div>
                                <div class="recibo-detail">
                                    <i class="fas fa-plane"></i> <strong>Tipo:</strong> ${recibo.tipo}
                                </div>
                                <div class="recibo-detail">
                                    <i class="fas fa-building"></i> <strong>CIA:</strong> ${recibo.cia || 'N/A'}
                                </div>
                                <div class="recibo-detail">
                                    <i class="fas fa-id-card"></i> <strong>CPF:</strong> 
                                    ${recibo.cpfCliente ? recibo.cpfCliente : '<span style="color: #dc3545;">❌ Faltando</span>'}
                                </div>
                                <div class="recibo-detail">
                                    <i class="fas fa-phone"></i> <strong>WhatsApp:</strong> 
                                    ${recibo.whatsappCliente ? recibo.whatsappCliente : '<span style="color: #dc3545;">❌ Faltando</span>'}
                                </div>
                            </div>
                        </div>
                    `;
                });
            }
            
            recibosList.innerHTML = html;
        }

        // ================================================================================
        // SISTEMA DE TABS
        // ================================================================================
        
        function ativarTab(tabName) {
            // Atualizar botões
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.querySelector(`[data-tab="${tabName}"]`).classList.add('active');
            
            // Atualizar conteúdo
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById(`tab${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`).classList.add('active');
            
            // Carregar conteúdo específico da tab
            if (tabName === 'analise') {
                gerarAnalises();
            } else if (tabName === 'relatorio') {
                gerarRelatorio();
            }
            
            addDebugLog(`📋 Tab ativada: ${tabName}`, 'info');
        }

        // ================================================================================
        // ANÁLISE DE DADOS
        // ================================================================================
        
        function gerarAnalises() {
            gerarTopVendedores();
            gerarTiposServico();
            gerarUrgenciaDatas();
            gerarCompanhias();
        }
        
        function gerarTopVendedores() {
            const vendedoresOrdenados = Object.values(vendedoresData)
                .sort((a, b) => b.total - a.total)
                .slice(0, 5);
            
            let html = '';
            vendedoresOrdenados.forEach(vendedor => {
                html += `
                    <li class="analise-item">
                        <span>${vendedor.nome}</span>
                        <span class="analise-valor">${vendedor.total}</span>
                    </li>
                `;
            });
            
            document.getElementById('topVendedores').innerHTML = html;
        }
        
        function gerarTiposServico() {
            const tipos = {};
            recibosDataOriginal.forEach(recibo => {
                const tipo = recibo.tipo || 'Não informado';
                tipos[tipo] = (tipos[tipo] || 0) + 1;
            });
            
            let html = '';
            Object.entries(tipos)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .forEach(([tipo, count]) => {
                    html += `
                        <li class="analise-item">
                            <span>${tipo}</span>
                            <span class="analise-valor">${count}</span>
                        </li>
                    `;
                });
            
            document.getElementById('tiposServico').innerHTML = html;
        }
        
        function gerarUrgenciaDatas() {
            const urgencias = {};
            recibosDataOriginal.forEach(recibo => {
                const urgencia = recibo.urgencia || 'Indefinido';
                urgencias[urgencia] = (urgencias[urgencia] || 0) + 1;
            });
            
            let html = '';
            Object.entries(urgencias)
                .sort((a, b) => b[1] - a[1])
                .forEach(([urgencia, count]) => {
                    html += `
                        <li class="analise-item">
                            <span>${urgencia}</span>
                            <span class="analise-valor">${count}</span>
                        </li>
                    `;
                });
            
            document.getElementById('urgenciaDatas').innerHTML = html;
        }
        
        function gerarCompanhias() {
            const companhias = {};
            recibosDataOriginal.forEach(recibo => {
                const cia = recibo.cia || 'Não informado';
                companhias[cia] = (companhias[cia] || 0) + 1;
            });
            
            let html = '';
            Object.entries(companhias)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5)
                .forEach(([cia, count]) => {
                    html += `
                        <li class="analise-item">
                            <span>${cia}</span>
                            <span class="analise-valor">${count}</span>
                        </li>
                    `;
                });
            
            document.getElementById('companhias').innerHTML = html;
        }

        // ================================================================================
        // RELATÓRIO DETALHADO
        // ================================================================================
        
        function gerarRelatorio() {
            const totalRecibos = recibosDataOriginal.length;
            const comCPF = recibosDataOriginal.filter(r => r.cpfCliente && r.cpfCliente.trim() !== '').length;
            const comWhatsApp = recibosDataOriginal.filter(r => r.whatsappCliente && r.whatsappCliente.trim() !== '').length;
            const urgentes = recibosDataOriginal.filter(r => r.urgencia === 'URGENTE').length;
            const altos = recibosDataOriginal.filter(r => r.urgencia === 'ALTO').length;
            
            const html = `
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="card-title">Resumo Geral</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><strong>Total de Recibos:</strong> ${totalRecibos}</li>
                                    <li><strong>Com CPF:</strong> ${comCPF} (${Math.round((comCPF/totalRecibos)*100)}%)</li>
                                    <li><strong>Com WhatsApp:</strong> ${comWhatsApp} (${Math.round((comWhatsApp/totalRecibos)*100)}%)</li>
                                </ul>
                            </div>
                            <div class="col-md-6">
                                <ul class="list-unstyled">
                                    <li><strong>Urgentes:</strong> ${urgentes}</li>
                                    <li><strong>Alta Prioridade:</strong> ${altos}</li>
                                    <li><strong>Vendedores Ativos:</strong> ${Object.keys(vendedoresData).length}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Recomendações</h5>
                        <ul>
                            <li>Priorizar recibos com urgência "URGENTE" e "ALTO"</li>
                            <li>Completar dados de CPF para ${totalRecibos - comCPF} recibos</li>
                            <li>Adicionar WhatsApp para ${totalRecibos - comWhatsApp} recibos</li>
                            <li>Focar nos vendedores com mais pendências</li>
                        </ul>
                    </div>
                </div>
            `;
            
            document.getElementById('relatorioDetalhado').innerHTML = html;
        }

        // ================================================================================
        // FILTROS E INTERAÇÕES
        // ================================================================================
        
        function filtrarPorVendedor(vendedor) {
            addDebugLog(`🔍 Filtrando por vendedor: ${vendedor}`, 'info');
            
            recibosData = recibosDataOriginal.filter(r => r.vendedor === vendedor);
            exibirRecibos();
            
            // Ativar tab de recibos
            ativarTab('recibos');
            
            // Scroll para a seção de recibos
            document.getElementById('tabContainer').scrollIntoView({ 
                behavior: 'smooth' 
            });
        }

        // ================================================================================
        // FUNÇÕES DE EXPORTAÇÃO
        // ================================================================================
        
        function exportarDados() {
            exportarCSV();
        }
        
        function exportarCSV() {
            addDebugLog('📁 Exportando dados para CSV...', 'info');
            
            const headers = ['Recibo', 'Cliente', 'Vendedor', 'Data Ida', 'Tipo', 'CIA', 'CPF', 'WhatsApp', 'Urgência'];
            const csvContent = [
                headers.join(','),
                ...recibosDataOriginal.map(recibo => [
                    recibo.recibo || '',
                    `"${recibo.nomeCliente || ''}"`,
                    recibo.vendedor || '',
                    recibo.dataIda || '',
                    recibo.tipo || '',
                    recibo.cia || '',
                    recibo.cpfCliente || '',
                    recibo.whatsappCliente || '',
                    recibo.urgencia || ''
                ].join(','))
            ].join('\n');
            
            const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', `recibos_pendentes_${new Date().toISOString().split('T')[0]}.csv`);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            
            addDebugLog('✅ CSV exportado com sucesso', 'success');
        }
        
        function exportarPDF() {
            addDebugLog('📄 Função de exportação PDF ainda não implementada', 'warning');
            alert('Função de exportação PDF será implementada em versão futura.');
        }
        
        function imprimirRelatorio() {
            addDebugLog('🖨️ Preparando para impressão...', 'info');
            window.print();
        }

        // ================================================================================
        // FUNÇÃO DE ATUALIZAÇÃO
        // ================================================================================
        
        function atualizarDados() {
            addDebugLog('🔄 Atualizando dados...', 'info');
            carregarDadosInicial();
        }

        // ================================================================================
        // TRATAMENTO DE ERROS
        // ================================================================================
        
        function mostrarErro(mensagem) {
            document.getElementById('loadingContainer').style.display = 'none';
            document.getElementById('errorContainer').style.display = 'block';
            document.getElementById('errorMessage').textContent = mensagem;
            
            addDebugLog(`❌ Erro exibido: ${mensagem}`, 'error');
        }

        // ================================================================================
        // INICIALIZAÇÃO DO SISTEMA
        // ================================================================================
        
        document.addEventListener('DOMContentLoaded', function() {
            console.log('🤖 CVC Portal Itaquá - Sistema de Vendas Automatizado v9.0');
            console.log('📋 Funcionalidades disponíveis:');
            console.log('   • Dados reais da planilha de embarques');
            console.log('   • Bypass CORS com JSONP v9.0 PURO');
            console.log('   • ZERO fetch() - APENAS JSONP');
            console.log('   • Interface completa por vendedores');
            console.log('   • Filtros dinâmicos e busca');
            console.log('   • Análise de dados e relatórios');
            console.log('   • Sistema de exportação');
            console.log('   • Debug detalhado');
            console.log('   • Responsivo e acessível');
            
            // Inicializar sistema
            inicializarSistema();
            
            console.log('🎯 Sistema de vendas automatizado v9.0 carregado e pronto!');
        });
    </script>
</body>
</html>
